import{G as d,d as b,m as k,M as i,U as g,N as D,u as y,_ as V,r as p,o as _,j as $,h as m,e as t,w as U,c as B,b as s,k as c,V as f,i as h,t as F,n as N,R as T,p as I,q as P}from"./index-hn7FtaHd.js";import{C as R}from"./CommentMuteSettings-DbjH_3dH.js";import{S as M}from"./Base-mjgk3uJB.js";import{V as E}from"./VSlider-4qlCdtol.js";import{V as O}from"./VSwitch-BhQ9t9wF.js";import"./VDialog-Crh-ubTi.js";import"./VTextField-H8bOYj6f.js";import"./VAvatar-CNGnEK6E.js";import"./VCard-B2gzrKI3.js";import"./ssrBoot-BUCv2yCo.js";import"./VSelect-zHv_Oysx.js";import"./Navigation-Dr2kqHz7.js";class L{static async fetchAuthorizationURL(){const e=await d.get("/niconico/auth");return e.type==="error"?(d.showGenericError(e,"ニコニコアカウントとの連携用の認証 URL を取得できませんでした。"),null):e.data.authorization_url}static async logoutAccount(){const e=await d.delete("/niconico/logout");return e.type==="error"?(d.showGenericError(e,"ニコニコアカウントとの連携を解除できませんでした。"),!1):!0}}const w=L,W=b({name:"Settings-Jikkyo",components:{SettingsBase:M,CommentMuteSettings:R},data(){return{comment_mute_settings_modal:!1,is_loading:!0}},computed:{...k(y,D)},async created(){if(await this.userStore.fetchUser(),this.is_loading=!1,location.hash!==""){const u=new URLSearchParams(location.hash.replace("#",""));if(u.get("status")!==null&&u.get("detail")!==null){const e=parseInt(u.get("status")),a=u.get("detail");this.onOAuthCallbackReceived(e,a),history.replaceState(null,""," ")}}},methods:{async loginNiconicoAccount(){if(this.userStore.is_logged_in===!1){i.warning("連携をはじめるには、KonomiTV アカウントにログインしてください。");return}const u=await w.fetchAuthorizationURL();if(u===null)return;if(g.isMobileDevice()===!0){location.href=u;return}const e=window.open(u,"KonomiTV-OAuthPopup",g.getWindowFeatures());if(e===null){i.error("ポップアップウインドウを開けませんでした。");return}const a=async l=>{if(e.closed||g.typeof(l.data)!=="object"||!("KonomiTV-OAuthPopup"in l.data))return;e&&e.close(),window.removeEventListener("message",a);const C=l.data["KonomiTV-OAuthPopup"].status,A=l.data["KonomiTV-OAuthPopup"].detail;this.onOAuthCallbackReceived(C,A)};window.addEventListener("message",a)},async onOAuthCallbackReceived(u,e){if(console.log(`NiconicoAuthCallbackAPI: Status: ${u} / Detail: ${e}`),u!==200){if(e.startsWith("Authorization was denied (access_denied)"))i.error("ニコニコアカウントとの連携がキャンセルされました。");else if(e.startsWith("Failed to get access token (HTTP Error ")){const a=e.replace("Failed to get access token ","");i.error(`アクセストークンの取得に失敗しました。${a}`)}else if(e.startsWith("Failed to get access token (Connection Timeout)"))i.error("アクセストークンの取得に失敗しました。ニコニコで障害が発生している可能性があります。");else if(e.startsWith("Failed to get user information (HTTP Error ")){const a=e.replace("Failed to get user information ","");i.error(`ニコニコアカウントのユーザー情報の取得に失敗しました。${a}`)}else e.startsWith("Failed to get user information (Connection Timeout)")?i.error("ニコニコアカウントのユーザー情報の取得に失敗しました。ニコニコで障害が発生している可能性があります。"):i.error(`ニコニコアカウントとの連携に失敗しました。(${e})`);return}await this.userStore.fetchUser(!0),i.success("ニコニコアカウントと連携しました。")},async logoutNiconicoAccount(){await w.logoutAccount()!==!1&&(await this.userStore.fetchUser(!0),i.success("ニコニコアカウントとの連携を解除しました。"))}}}),n=u=>(I("data-v-a24f4904"),u=u(),P(),u),K={class:"settings__heading"},j=n(()=>t("span",{class:"ml-3"},"ニコニコ実況",-1)),z={key:0,class:"niconico-account niconico-account--anonymous"},G={class:"niconico-account-wrapper"},H=n(()=>t("div",{class:"niconico-account__info ml-4"},[t("div",{class:"niconico-account__info-name"},[t("span",{class:"niconico-account__info-name-text"},"ニコニコアカウントと連携していません")]),t("span",{class:"niconico-account__info-description"}," ニコニコアカウントと連携すると、テレビを見ながらニコニコ実況にコメントできるようになります。 ")],-1)),J={key:1,class:"niconico-account"},q={class:"niconico-account-wrapper"},Q=["src"],X={class:"niconico-account__info"},Y={class:"niconico-account__info-name"},Z={class:"niconico-account__info-name-text"},x={class:"niconico-account__info-description"},uu=n(()=>t("span",{class:"mr-2",style:{"white-space":"nowrap"}},"Niconico User ID:",-1)),eu=["href"],tu={key:0,class:"text-secondary"},su=n(()=>t("div",{class:"settings__item mt-7"},[t("div",{class:"settings__item-heading"},"コメントのミュート設定"),t("div",{class:"settings__item-label"},[c(" 表示したくないコメントを、映像上やコメントリストに表示しないようにミュートできます。"),t("br")])],-1)),ou=n(()=>t("span",{class:"ml-1"},"コメントのミュート設定を開く",-1)),nu={class:"settings__item"},iu=n(()=>t("div",{class:"settings__item-heading"},"コメントの速さ",-1)),au=n(()=>t("div",{class:"settings__item-label"},[c(" プレイヤーに流れるコメントの速さを設定します。"),t("br"),c(" たとえば 1.2 に設定すると、コメントが 1.2 倍速く流れます。"),t("br")],-1)),cu={class:"settings__item"},ru=n(()=>t("div",{class:"settings__item-heading"},"コメントの文字サイズ",-1)),lu=n(()=>t("div",{class:"settings__item-label"},[c(" プレイヤーに流れるコメントの文字サイズの基準値を設定します。"),t("br"),c(" 実際の文字サイズは画面サイズに合わせて調整されます。デフォルトの文字サイズは 34px です。"),t("br")],-1)),_u={class:"settings__item settings__item--switch"},du=n(()=>t("label",{class:"settings__item-heading",for:"close_comment_form_after_sending"},"コメント送信後にコメント入力フォームを閉じる",-1)),mu=n(()=>t("label",{class:"settings__item-label",for:"close_comment_form_after_sending"},[c(" この設定をオンにすると、コメントを送信した後に、コメント入力フォームが自動で閉じるようになります。"),t("br"),c(" コメント入力フォームが表示されたままだと、大半のショートカットキーが文字入力と競合して使えなくなります。とくに理由がなければ、オンにしておくのがおすすめです。"),t("br")],-1));function Bu(u,e,a,l,C,A){const r=p("Icon"),S=p("CommentMuteSettings"),v=p("SettingsBase");return _(),$(v,null,{default:m(()=>[t("h2",K,[U((_(),B("a",{class:"settings__back-button",onClick:e[0]||(e[0]=o=>u.$router.back())},[s(r,{icon:"fluent:arrow-left-12-filled",width:"25px"})])),[[T]]),s(r,{icon:"bi:chat-left-text-fill",width:"19px"}),j]),t("div",{class:N(["settings__content",{"settings__content--loading":u.is_loading}])},[u.userStore.user===null||u.userStore.user.niconico_user_id===null?(_(),B("div",z,[t("div",G,[s(r,{class:"flex-shrink-0",icon:"bi:chat-left-text-fill",width:"45px"}),H]),s(f,{class:"niconico-account__login ml-auto",color:"secondary",width:"130",height:"56",variant:"flat",onClick:e[1]||(e[1]=o=>u.loginNiconicoAccount())},{default:m(()=>[s(r,{icon:"fluent:plug-connected-20-filled",class:"mr-2",height:"26"}),c("連携する ")]),_:1})])):h("",!0),u.userStore.user!==null&&u.userStore.user.niconico_user_id!==null?(_(),B("div",J,[t("div",q,[t("img",{class:"niconico-account__icon",src:u.userStore.user_niconico_icon_url??""},null,8,Q),t("div",X,[t("div",Y,[t("span",Z,F(u.userStore.user.niconico_user_name)+" と連携しています",1)]),t("span",x,[uu,t("a",{class:"link mr-2",href:`https://www.nicovideo.jp/user/${u.userStore.user.niconico_user_id}`,target:"_blank"},F(u.userStore.user.niconico_user_id),9,eu),u.userStore.user.niconico_user_premium===!0?(_(),B("span",tu,"(Premium)")):h("",!0)])])]),s(f,{class:"niconico-account__login ml-auto",color:"secondary",width:"130",height:"56",variant:"flat",onClick:e[2]||(e[2]=o=>u.logoutNiconicoAccount())},{default:m(()=>[s(r,{icon:"fluent:plug-disconnected-20-filled",class:"mr-2",height:"26"}),c("連携解除 ")]),_:1})])):h("",!0),su,s(f,{class:"settings__save-button mt-4",variant:"flat",onClick:e[3]||(e[3]=o=>u.comment_mute_settings_modal=!u.comment_mute_settings_modal)},{default:m(()=>[s(r,{icon:"heroicons-solid:filter",height:"19px"}),ou]),_:1}),t("div",nu,[iu,au,s(E,{class:"settings__item-form",color:"primary","show-ticks":"always","thumb-label":"","hide-details":"",step:.1,min:.5,max:2,modelValue:u.settingsStore.settings.comment_speed_rate,"onUpdate:modelValue":e[4]||(e[4]=o=>u.settingsStore.settings.comment_speed_rate=o)},null,8,["modelValue"])]),t("div",cu,[ru,lu,s(E,{class:"settings__item-form",color:"primary","show-ticks":"always","thumb-label":"","hide-details":"",step:1,min:20,max:60,modelValue:u.settingsStore.settings.comment_font_size,"onUpdate:modelValue":e[5]||(e[5]=o=>u.settingsStore.settings.comment_font_size=o)},null,8,["modelValue"])]),t("div",_u,[du,mu,s(O,{class:"settings__item-switch",color:"primary",id:"close_comment_form_after_sending","hide-details":"",modelValue:u.settingsStore.settings.close_comment_form_after_sending,"onUpdate:modelValue":e[6]||(e[6]=o=>u.settingsStore.settings.close_comment_form_after_sending=o)},null,8,["modelValue"])])],2),s(S,{modelValue:u.comment_mute_settings_modal,"onUpdate:modelValue":e[7]||(e[7]=o=>u.comment_mute_settings_modal=o)},null,8,["modelValue"])]),_:1})}const ku=V(W,[["render",Bu],["__scopeId","data-v-a24f4904"]]);export{ku as default};
