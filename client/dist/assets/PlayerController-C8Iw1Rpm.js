var sp=Object.defineProperty;var ap=(a,e,t)=>e in a?sp(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var ve=(a,e,t)=>ap(a,typeof e!="symbol"?e+"":e,t);import{B as ks,C as Ao,D as gc,E as yc,G as _c,H as Ac,I as Pi,J as vc,K as al,L as Oi,N as op,u as Mn,d as zn,U as Dt,P as Rs,A as jn,m as hi,_ as fi,c as Lt,h as Tn,k as On,w as an,i as Bn,b as je,t as Kt,a as wt,n as on,j as pn,o as mt,R as xn,r as Yn,F as Xn,v as lp,p as bc,g as ds,e as dp,V as vo,s as cs,O as bo,Q as cp,S as up,T as Mi,W as hp,X as fp,Y as So,Z as Eo,$ as Gs,a0 as Ir,a1 as pp}from"./index-CO6Oz8Ox.js";import{u as ci,C as Sc,I as mp,a as gp}from"./ChannelsStore-BlcXnaKN.js";import{V as Is,_ as yp}from"./ssrBoot-PayXtu77.js";import{V as _p}from"./VSwitch-fA5381X3.js";import{V as Ap,a as vp}from"./VCard-B8R8_TCC.js";import{S as bp,a as Sp}from"./swiper-BUigBo7s.js";import{C as Ep}from"./CommentMuteSettings-DYtvxDnw.js";import{b as Tp,c as Vs,d as js}from"./VSelect-CBc8aCpp.js";class Hs{static extractLiveAPIQualityFromDPlayer(e){if(e.quality===null)return"1080p";const t=/streams\/live\/[a-z0-9-]*\/(.*)\/mpegts/,n=e.quality.url.match(t);return n?n[1]:"1080p"}static extractVideoAPIQualityFromDPlayer(e){if(e.quality===null)return"1080p";const t=/streams\/video\/[0-9]*\/(.*)\/playlist/,n=e.quality.url.match(t);return n?n[1]:"1080p"}static generatePlayerBackgroundURL(){return`/assets/images/player-backgrounds/${(Math.floor(Math.random()*50)+1).toString().padStart(2,"0")}.jpg`}static getNetworkCircuitType(){if(navigator.connection&&navigator.connection.type)switch(navigator.connection.type){case"cellular":return"Cellular";default:return"Wi-Fi"}else return console.warn("[PlayerUtils] navigator.connection.type is not available."),null}static isHEVCVideoSupported(){return document.createElement("video").canPlayType('video/mp4; codecs="hvc1.1.6.L123.B0"')==="probably"}}const Ec=ks.reduce((a,e)=>(a[e]={type:[Boolean,String,Number],default:!1},a),{}),Tc=ks.reduce((a,e)=>{const t="offset"+Ao(e);return a[t]={type:[String,Number],default:null},a},{}),xc=ks.reduce((a,e)=>{const t="order"+Ao(e);return a[t]={type:[String,Number],default:null},a},{}),ol={col:Object.keys(Ec),offset:Object.keys(Tc),order:Object.keys(xc)};function xp(a,e,t){let n=a;if(!(t==null||t===!1)){if(e){const i=e.replace(a,"");n+=`-${i}`}return a==="col"&&(n="v-"+n),a==="col"&&(t===""||t===!0)||(n+=`-${t}`),n.toLowerCase()}}const Cp=["auto","start","end","center","baseline","stretch"],wp=gc({cols:{type:[Boolean,String,Number],default:!1},...Ec,offset:{type:[String,Number],default:null},...Tc,order:{type:[String,Number],default:null},...xc,alignSelf:{type:String,default:null,validator:a=>Cp.includes(a)},...yc(),..._c()},"VCol"),kp=Ac()({name:"VCol",props:wp(),setup(a,e){let{slots:t}=e;const n=Pi(()=>{const i=[];let s;for(s in ol)ol[s].forEach(d=>{const u=a[d],c=xp(s,d,u);c&&i.push(c)});const r=i.some(d=>d.startsWith("v-col-"));return i.push({"v-col":!r||!a.cols,[`v-col-${a.cols}`]:a.cols,[`offset-${a.offset}`]:a.offset,[`order-${a.order}`]:a.order,[`align-self-${a.alignSelf}`]:a.alignSelf}),i});return()=>{var i;return vc(a.tag,{class:[n.value,a.class],style:a.style},(i=t.default)==null?void 0:i.call(t))}}}),To=["start","end","center"],Cc=["space-between","space-around","space-evenly"];function xo(a,e){return ks.reduce((t,n)=>{const i=a+Ao(n);return t[i]=e(),t},{})}const Rp=[...To,"baseline","stretch"],wc=a=>Rp.includes(a),kc=xo("align",()=>({type:String,default:null,validator:wc})),Ip=[...To,...Cc],Rc=a=>Ip.includes(a),Ic=xo("justify",()=>({type:String,default:null,validator:Rc})),Lp=[...To,...Cc,"stretch"],Lc=a=>Lp.includes(a),Dc=xo("alignContent",()=>({type:String,default:null,validator:Lc})),ll={align:Object.keys(kc),justify:Object.keys(Ic),alignContent:Object.keys(Dc)},Dp={align:"align",justify:"justify",alignContent:"align-content"};function Pp(a,e,t){let n=Dp[a];if(t!=null){if(e){const i=e.replace(a,"");n+=`-${i}`}return n+=`-${t}`,n.toLowerCase()}}const Op=gc({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:wc},...kc,justify:{type:String,default:null,validator:Rc},...Ic,alignContent:{type:String,default:null,validator:Lc},...Dc,...yc(),..._c()},"VRow"),Mp=Ac()({name:"VRow",props:Op(),setup(a,e){let{slots:t}=e;const n=Pi(()=>{const i=[];let s;for(s in ll)ll[s].forEach(r=>{const d=a[r],u=Pp(s,r,d);u&&i.push(u)});return i.push({"v-row--no-gutters":a.noGutters,"v-row--dense":a.dense,[`align-${a.align}`]:a.align,[`justify-${a.justify}`]:a.justify,[`align-content-${a.alignContent}`]:a.alignContent}),i});return()=>{var i;return vc(a.tag,{class:["v-row",n.value,a.class],style:a.style},(i=t.default)==null?void 0:i.call(t))}}});function Bp(a){return{all:a=a||new Map,on:function(e,t){var n=a.get(e);n?n.push(t):a.set(e,[t])},off:function(e,t){var n=a.get(e);n&&(t?n.splice(n.indexOf(t)>>>0,1):a.set(e,[]))},emit:function(e,t){var n=a.get(e);n&&n.slice().map(function(i){i(t)}),(n=a.get("*"))&&n.slice().map(function(i){i(e,t)})}}}const Fp={id:-1,file_path:"",file_hash:"",file_size:0,recording_start_time:null,recording_end_time:null,duration:0,container_format:"MPEG-TS",video_codec:"MPEG-2",video_codec_profile:"High",video_scan_type:"Interlaced",video_frame_rate:29.97,video_resolution_width:1440,video_resolution_height:1080,primary_audio_codec:"AAC-LC",primary_audio_channel:"Stereo",primary_audio_sampling_rate:48e3,secondary_audio_codec:null,secondary_audio_channel:null,secondary_audio_sampling_rate:null,cm_sections:[]},dl={id:-1,recorded_video:Fp,recording_start_margin:0,recording_end_margin:0,is_partially_recorded:!1,channel:null,network_id:null,service_id:null,event_id:null,series_id:null,series_broadcast_period_id:null,title:"取得中…",series_title:null,episode_number:null,subtitle:null,description:"取得中…",detail:{},start_time:"2000-01-01T00:00:00+09:00",end_time:"2000-01-01T00:00:00+09:00",duration:0,is_free:!0,genres:[],primary_audio_type:"2/0モード(ステレオ)",primary_audio_language:"日本語",secondary_audio_type:null,secondary_audio_language:null};class Np{static async fetchVideoJikkyoComments(e){const t=new Date(e.start_time).getTime()/1e3,n=new Date(e.end_time).getTime()/1e3,s=`https://jikkyo.tsukumijima.net/api/kakolog/${e.channel.id}?starttime=${t}&endtime=${n}&format=json`,r=await al.get(s,{timeout:3e4});if(r.type==="error"){let l;switch(r.status){case 500:l="過去ログ API でサーバーエラーが発生しました。過去ログ API に不具合がある可能性があります。(HTTP Error 500)";break;case 503:l="現在、過去ログ API は一時的に利用できなくなっています。(HTTP Error 503)";break;default:l=`現在、過去ログ API でエラーが発生しています。(HTTP Error ${r.status})`}return al.showGenericError(r,l),{is_success:!1,comments:[],detail:l}}const d=await r.data;if("error"in d)return{is_success:!1,comments:[],detail:d.error||"過去ログコメントを取得できませんでした。"};const u=d.packet;return u.length===0?{is_success:!1,comments:[],detail:"この録画番組の過去ログコメントは存在しないか、現在取得中です。"}:{is_success:!0,comments:u.map(l=>{const h=l.chat.content;if(typeof h!="string"||h===""||l.chat.deleted==="1"||/\/[a-z]+ /.test(h))return null;const o=Oi.parseCommentCommand(l.chat.mail),f=o.color,p=o.position,m=o.size,y=parseInt(l.chat.date),_=parseInt(l.chat.date_usec||"0",10),b={time:parseFloat(`${y-t}.${_}`),type:p,size:m,color:f,author:l.chat.user_id||"",text:h};return Oi.isMutedComment(b.text,b.author,b.color,b.type,b.size)?null:b}).filter(l=>l!==null),detail:"過去ログコメントを取得しました。"}}}const _n=op("player",{state:()=>({is_watching:!1,is_player_initialized:!1,event_emitter:Bp(),recorded_program:dl,is_virtual_keyboard_display:!1,is_fullscreen:!1,is_document_pip:!1,is_control_display:!0,is_panel_display:(()=>{const a=Mn();switch(a.settings.panel_display_state){case"AlwaysDisplay":return!0;case"AlwaysFold":return!1;case"RestorePreviousState":return a.settings.showed_panel_last_time}})(),tv_panel_active_tab:Mn().settings.tv_panel_active_tab,video_panel_active_tab:Mn().settings.video_panel_active_tab,twitter_active_tab:Mn().settings.twitter_active_tab,is_remocon_display:!1,is_zapping:!1,is_loading:!0,is_video_buffering:!0,is_video_paused:!1,is_background_display:!1,background_url:"",shortcut_key_modal:!1,live_stream_status:null,live_comment_init_failed_message:null,video_comment_init_failed_message:null}),actions:{startWatching(){this.reset(),this.is_watching=!0},stopWatching(){this.reset(),this.is_watching=!1},reset(){this.is_watching=!1,this.is_player_initialized=!1,this.recorded_program=dl,this.is_virtual_keyboard_display=!1,this.is_fullscreen=!1,this.is_document_pip=!1,this.is_control_display=!0,this.is_panel_display=(()=>{const a=Mn();switch(a.settings.panel_display_state){case"AlwaysDisplay":return!0;case"AlwaysFold":return!1;case"RestorePreviousState":return a.settings.showed_panel_last_time}})(),this.tv_panel_active_tab=Mn().settings.tv_panel_active_tab,this.video_panel_active_tab=Mn().settings.video_panel_active_tab,this.twitter_active_tab=Mn().settings.twitter_active_tab,this.is_remocon_display=!1,this.is_zapping=!1,this.is_loading=!0,this.is_video_buffering=!0,this.is_video_paused=!1,this.is_background_display=!1,this.background_url="",this.shortcut_key_modal=!1,this.live_stream_status=null,this.live_comment_init_failed_message=null}}}),Up=zn({name:"Watch-Header",props:{playback_mode:{type:String,required:!0}},data(){return{Utils:Object.freeze(Dt),ProgramUtils:Object.freeze(Rs),time:jn().format(Dt.isSmartphoneHorizontal()?"HH:mm:ss":"YYYY/MM/DD HH:mm:ss"),time_interval_id:0}},computed:{...hi(ci,_n)},created(){this.time_interval_id=window.setInterval(()=>{this.time=jn().format(Dt.isSmartphoneHorizontal()?"HH:mm:ss":"YYYY/MM/DD HH:mm:ss")},.1*1e3)},beforeUnmount(){window.clearInterval(this.time_interval_id)}}),$p=["src"],Gp=["innerHTML"],Vp={class:"watch-header__program-time"},jp={class:"watch-header__now"};function Hp(a,e,t,n,i,s){const r=pn("Icon"),d=pn("router-link");return mt(),Lt("header",{class:on(["watch-header",{"watch-header--video":a.playback_mode==="Video"}])},[Tn((mt(),On(d,{class:"watch-header__back-icon",to:a.playback_mode==="Live"?"/":"/log/"},{default:an(()=>[wt(r,{icon:"fluent:arrow-left-12-filled",width:"25px"})]),_:1},8,["to"])),[[xn]]),a.playback_mode==="Live"?(mt(),Lt("img",{key:0,class:"watch-header__broadcaster",src:`${a.Utils.api_base_url}/channels/${a.channelsStore.channel.current.id}/logo`},null,8,$p)):Bn("",!0),je("span",{class:"watch-header__program-title",innerHTML:a.ProgramUtils.decorateProgramInfo(a.playback_mode==="Live"?a.channelsStore.channel.current.program_present:a.playerStore.recorded_program,"title")},null,8,Gp),je("span",Vp,Kt(a.ProgramUtils.getProgramTime(a.playback_mode==="Live"?a.channelsStore.channel.current.program_present:a.playerStore.recorded_program,!0)),1),wt(Is),je("span",jp,Kt(a.time),1)],2)}const qp=fi(Up,[["render",Hp],["__scopeId","data-v-453c24f7"]]),zp={left_column:[{name:"全般",icon:"fluent:home-20-filled",icon_height:"22px",shortcuts:[{name:"数字キー/テンキーに対応するリモコン番号 (1~12) の地デジチャンネルに切り替える",keys:[{name:"1~9, 0, -(=), ^(~)",icon:!1}]},{name:"数字キー/テンキーに対応するリモコン番号 (1~12) の BS チャンネルに切り替える",keys:[{name:"Shift",icon:!1},{name:"1~9, 0, -(=), ^(~)",icon:!1}]},{name:"前のチャンネルに切り替える",keys:[{name:"fluent:arrow-up-12-filled",icon:!0}]},{name:"次のチャンネルに切り替える",keys:[{name:"fluent:arrow-down-12-filled",icon:!0}]},{name:"キーボードショートカットの一覧を表示する",keys:[{name:"／(？)",icon:!1}]}]},{name:"プレイヤー",icon:"fluent:play-20-filled",icon_height:"20px",shortcuts:[{name:"再生 / 一時停止の切り替え",keys:[{name:"Space",icon:!1}]},{name:"フルスクリーンの切り替え",keys:[{name:"F",icon:!1}]},{name:"Picture-in-Picture の表示切り替え",keys:[{name:"E",icon:!1}]},{name:"コメントの表示切り替え",keys:[{name:"D",icon:!1}]},{name:"コメント入力フォームにフォーカスする",keys:[{name:"M",icon:!1}]},{name:"コメント入力フォームを閉じる",keys:[{name:Dt.CtrlOrCmd(),icon:!1},{name:"M",icon:!1}]},{name:"コメントを送信する",keys:[{name:"コメント入力フォームを表示",icon:!1},{name:"Enter",icon:!1}]}]}],right_column:[{name:"パネル",icon:"fluent:panel-right-20-filled",icon_height:"24px",shortcuts:[{name:"パネルの表示切り替え",keys:[{name:"P",icon:!1}]},{name:"番組情報タブを表示する",keys:[{name:"K",icon:!1}]},{name:"チャンネルタブを表示する",keys:[{name:"L",icon:!1}]},{name:"コメントタブを表示する",keys:[{name:"；(＋)",icon:!1}]}]}]},Kp={left_column:[{name:"全般",icon:"fluent:home-20-filled",icon_height:"22px",shortcuts:[{name:"キーボードショートカットの一覧を表示する",keys:[{name:"／(？)",icon:!1}]}]},{name:"プレイヤー",icon:"fluent:play-20-filled",icon_height:"20px",shortcuts:[{name:"再生 / 一時停止の切り替え",keys:[{name:"Space",icon:!1}]},{name:"5秒早戻し",keys:[{name:"fluent:arrow-left-12-filled",icon:!0}]},{name:"5秒早送り",keys:[{name:"fluent:arrow-right-12-filled",icon:!0}]},{name:"15秒早戻し",keys:[{name:Dt.CtrlOrCmd(),icon:!1},{name:"fluent:arrow-left-12-filled",icon:!0}]},{name:"15秒早送り",keys:[{name:Dt.CtrlOrCmd(),icon:!1},{name:"fluent:arrow-right-12-filled",icon:!0}]},{name:"30秒早戻し",keys:[{name:"Shift",icon:!1},{name:"fluent:arrow-left-12-filled",icon:!0}]},{name:"30秒早送り",keys:[{name:"Shift",icon:!1},{name:"fluent:arrow-right-12-filled",icon:!0}]},{name:"60秒早戻し",keys:[{name:Dt.AltOrOption(),icon:!1},{name:"fluent:arrow-left-12-filled",icon:!0}]},{name:"60秒早送り",keys:[{name:Dt.AltOrOption(),icon:!1},{name:"fluent:arrow-right-12-filled",icon:!0}]},{name:"フルスクリーンの切り替え",keys:[{name:"F",icon:!1}]},{name:"Picture-in-Picture の表示切り替え",keys:[{name:"E",icon:!1}]},{name:"コメントの表示切り替え",keys:[{name:"D",icon:!1}]}]}],right_column:[{name:"パネル",icon:"fluent:panel-right-20-filled",icon_height:"24px",shortcuts:[{name:"パネルの表示切り替え",keys:[{name:"P",icon:!1}]},{name:"番組情報タブを表示する",keys:[{name:"K",icon:!1}]},{name:"コメントタブを表示する",keys:[{name:"；(＋)",icon:!1}]}]}]},Wp=zn({name:"KeyboardShortcutList",props:{playback_mode:{type:String,required:!0}},data(){return{Utils:Object.freeze(Dt),live_shortcut_list:structuredClone(zp),video_shortcut_list:structuredClone(Kp)}},computed:{...hi(_n,Mn),shortcut_list(){return this.playback_mode==="Live"?this.live_shortcut_list:this.video_shortcut_list}},created(){this.settingsStore.settings.tv_channel_selection_requires_alt_key===!0&&(this.live_shortcut_list.left_column[0].shortcuts[0].keys.unshift({name:Dt.AltOrOption(),icon:!1}),this.live_shortcut_list.left_column[0].shortcuts[1].keys.unshift({name:Dt.AltOrOption(),icon:!1}))}}),Yp={class:"px-5 pb-6"},Xp={class:"text-subtitle-1 d-flex align-center font-weight-bold"},Jp={key:1,width:"24px",height:"24px",viewBox:"0 0 512 512"},Qp={class:"ml-2"},Zp={class:"text-subtitle-2 mt-2 d-flex align-center font-weight-medium"},em=["innerHTML"],tm={class:"ml-auto d-flex align-center flex-shrink-0"},nm={class:"shortcut-key"},im=["innerHTML"],rm={key:0,class:"shortcut-key-plus"};function sm(a,e,t,n,i,s){const r=pn("Icon");return mt(),On(_p,{"max-width":"1050",transition:"slide-y-transition",modelValue:a.playerStore.shortcut_key_modal,"onUpdate:modelValue":e[1]||(e[1]=d=>a.playerStore.shortcut_key_modal=d)},{default:an(()=>[wt(vp,null,{default:an(()=>[wt(Ap,{class:"px-5 pt-6 pb-3 d-flex align-center font-weight-bold"},{default:an(()=>[wt(r,{icon:"fluent:keyboard-20-filled",height:"28px"}),e[2]||(e[2]=je("span",{class:"ml-3"},"キーボードショートカット",-1)),wt(Is),Tn((mt(),Lt("div",{class:"d-flex align-center rounded-circle cursor-pointer px-2 py-2",onClick:e[0]||(e[0]=d=>a.playerStore.shortcut_key_modal=!1)},[wt(r,{icon:"fluent:dismiss-12-filled",width:"23px",height:"23px"})])),[[xn]])]),_:1}),je("div",Yp,[wt(Mp,null,{default:an(()=>[(mt(!0),Lt(Xn,null,Yn(a.shortcut_list,(d,u)=>(mt(),On(kp,{cols:"6",key:u},{default:an(()=>[(mt(!0),Lt(Xn,null,Yn(d,c=>(mt(),Lt("div",{class:"mt-3",key:c.name},[je("div",Xp,[c.name!=="データ放送"?(mt(),On(r,{key:0,icon:c.icon,height:c.icon_height},null,8,["icon","height"])):(mt(),Lt("svg",Jp,e[3]||(e[3]=[je("path",{fill:"currentColor",d:"M248.039 381.326L355.039 67.8258C367.539 28.3257 395.039 34.3258 406.539 34.3258C431.039 34.3258 453.376 61.3258 441.039 96.8258C362.639 322.426 343.539 375.326 340.539 384.826C338.486 391.326 342.039 391.326 345.539 391.326C377.039 391.326 386.539 418.326 386.539 435.326C386.539 458.826 371.539 477.326 350.039 477.326H214.539C179.039 477.326 85.8269 431.3 88.0387 335.826C91.0387 206.326 192.039 183.326 243.539 183.326H296.539L265.539 272.326H243.539C185.539 272.326 174.113 314.826 176.039 334.326C180.039 374.826 215.039 389.814 237.039 390.326C244.539 390.5 246.039 386.826 248.039 381.326Z"},null,-1)]))),je("span",Qp,Kt(c.name),1)]),(mt(!0),Lt(Xn,null,Yn(c.shortcuts,l=>(mt(),Lt("div",{class:"mt-3",key:l.name},[je("div",Zp,[je("span",{class:"mr-2",innerHTML:l.name},null,8,em),je("div",tm,[(mt(!0),Lt(Xn,null,Yn(l.keys,(h,o)=>(mt(),Lt("div",{class:"ml-auto d-flex align-center",key:h.name},[je("span",nm,[(mt(!0),Lt(Xn,null,Yn(h.name.split(";"),f=>Tn((mt(),On(r,{icon:f,height:"18px",key:f},null,8,["icon"])),[[lp,h.icon===!0]])),128)),h.icon===!1?(mt(),Lt("span",{key:0,innerHTML:h.name},null,8,im)):Bn("",!0)]),o<l.keys.length-1?(mt(),Lt("span",rm,"+")):Bn("",!0)]))),128))])])]))),128))]))),128))]),_:2},1024))),128))]),_:1})])]),_:1})]),_:1},8,["modelValue"])}const am=fi(Wp,[["render",sm],["__scopeId","data-v-68c6a102"]]),om=zn({name:"Watch-Navigation",computed:{...hi(_n)}}),lm="/assets/images/icon.svg",dm={class:"watch-navigation__link",href:"https://jikkyo.tsukumijima.net",target:"_blank"};function cm(a,e,t,n,i,s){const r=pn("router-link"),d=pn("Icon"),u=bc("ftooltip");return mt(),Lt("nav",{class:"watch-navigation",onMousemove:e[0]||(e[0]=c=>a.playerStore.event_emitter.emit("SetControlDisplayTimer",{event:c})),onTouchmove:e[1]||(e[1]=c=>a.playerStore.event_emitter.emit("SetControlDisplayTimer",{event:c})),onClick:e[2]||(e[2]=c=>a.playerStore.event_emitter.emit("SetControlDisplayTimer",{event:c}))},[Tn((mt(),On(r,{class:"watch-navigation__icon",to:"/"},{default:an(()=>e[3]||(e[3]=[je("img",{class:"watch-navigation__icon-image",src:lm,width:"23px"},null,-1)])),_:1})),[[xn]]),Tn((mt(),On(r,{class:on(["watch-navigation__link",{"watch-navigation__link--active":a.$route.path.startsWith("/watch")}]),"active-class":"watch-navigation__link--active",to:"/"},{default:an(()=>[wt(d,{class:"watch-navigation__link-icon",icon:"fluent:tv-20-regular",width:"26px"})]),_:1},8,["class"])),[[xn],[u,"テレビ実況",void 0,{right:!0}]]),Tn((mt(),On(r,{class:on(["watch-navigation__link",{"watch-navigation__link--active":a.$route.path.startsWith("/log")}]),"active-class":"watch-navigation__link--active",to:"/log/"},{default:an(()=>[wt(d,{class:"watch-navigation__link-icon",icon:"fluent:receipt-play-20-regular",width:"26px"})]),_:1},8,["class"])),[[xn],[u,"過去ログ再生",void 0,{right:!0}]]),Tn((mt(),Lt("a",dm,[wt(d,{class:"watch-navigation__link-icon",icon:"fluent:slide-text-multiple-20-regular",width:"26px"})])),[[xn],[u,"過去ログ API",void 0,{right:!0}]]),Tn((mt(),On(r,{class:on(["watch-navigation__link",{"watch-navigation__link--active":a.$route.path.startsWith("/about")}]),"active-class":"watch-navigation__link--active",to:"/about/"},{default:an(()=>[wt(d,{class:"watch-navigation__link-icon",icon:"fluent:info-16-regular",width:"26px"})]),_:1},8,["class"])),[[xn],[u,"NX-Jikkyo とは",void 0,{right:!0}]]),wt(Is),Tn((mt(),On(r,{class:on(["watch-navigation__link",{"watch-navigation__link--active":a.$route.path.startsWith("/settings")}]),"active-class":"watch-navigation__link--active",to:"/settings/"},{default:an(()=>[wt(d,{class:"watch-navigation__link-icon",icon:"fluent:settings-20-regular",width:"26px"})]),_:1},8,["class"])),[[xn],[u,"設定",void 0,{right:!0}]])],32)}const um=fi(om,[["render",cm],["__scopeId","data-v-aece88a4"]]),hm=zn({name:"Panel-ChannelTab",components:{Swiper:bp,SwiperSlide:Sp},data(){return{Utils:Object.freeze(Dt),ChannelUtils:Object.freeze(Sc),ProgramUtils:Object.freeze(Rs),active_tab_index:0,swiper_instance:null}},computed:{...hi(ci,_n)},watch:{active_tab_index(){var a,e;(a=this.swiper_instance)==null||a.updateAutoHeight(),(e=this.swiper_instance)==null||e.slideTo(this.active_tab_index)},async"playerStore.tv_panel_active_tab"(){var a;await Dt.sleep(.05),(a=this.swiper_instance)==null||a.updateAutoHeight()},async"playerStore.video_panel_active_tab"(){var a;await Dt.sleep(.05),(a=this.swiper_instance)==null||a.updateAutoHeight()}},async mounted(){var a,e,t;if(await Dt.sleep(.05),(a=this.swiper_instance)==null||a.updateAutoHeight(),(e=document.querySelector(".channels-list-container"))==null||e.addEventListener("scroll",()=>{var n;(n=this.swiper_instance)==null||n.updateAutoHeight()},{passive:!0}),this.playerStore.tv_panel_active_tab==="Channel")for(let n=0;n<20;n++)await Dt.sleep(.1),(t=this.swiper_instance)==null||t.updateAutoHeight()}}),fm={class:"channels-container channels-container--watch"},pm={class:"channels-tab"},mm={class:"channels-list-container"},gm={class:"channels"},ym={class:"channel__broadcaster"},_m=["src"],Am={class:"channel__broadcaster-content"},vm={class:"channel__broadcaster-name"},bm={class:"ml-1"},Sm={class:"channel__program-present"},Em=["innerHTML"],Tm={class:"channel__program-present-time"},xm={class:"channel__program-following"},Cm={class:"channel__program-following-title"},wm=["innerHTML"],km={class:"channel__program-following-time"},Rm={class:"channel__progressbar"};function Im(a,e,t,n,i,s){const r=pn("router-link"),d=pn("SwiperSlide"),u=pn("Swiper");return mt(),Lt("div",fm,[je("div",pm,[je("div",{class:"channels-tab__buttons",style:ds({"--tab-length":Array.from(a.channelsStore.channels_list_with_pinned_for_watch).length,"--active-tab-index":a.active_tab_index})},[(mt(!0),Lt(Xn,null,Yn(Array.from(a.channelsStore.channels_list_with_pinned_for_watch),([c],l)=>(mt(),On(vo,{variant:"flat",class:on(["channels-tab__button",{"channels-tab__button--active":a.active_tab_index===l}]),key:c,onClick:h=>a.active_tab_index=l},{default:an(()=>[dp(Kt(c),1)]),_:2},1032,["class","onClick"]))),128)),e[2]||(e[2]=je("div",{class:"channels-tab__highlight"},null,-1))],4)]),je("div",mm,[wt(u,{class:"channels-list","space-between":32,"auto-height":!0,"touch-start-prevent-default":!1,observer:!0,"observe-parents":!0,onSwiper:e[0]||(e[0]=c=>a.swiper_instance=c),onSlideChange:e[1]||(e[1]=c=>a.active_tab_index=c.activeIndex)},{default:an(()=>[(mt(!0),Lt(Xn,null,Yn(Array.from(a.channelsStore.channels_list_with_pinned_for_watch),([c,l])=>(mt(),On(d,{key:c},{default:an(()=>[je("div",gm,[(mt(!0),Lt(Xn,null,Yn(l,h=>Tn((mt(),On(r,{class:"channel",draggable:"false",key:h.id,to:`/watch/${h.display_channel_id}`},{default:an(()=>[je("div",ym,[je("img",{class:"channel__broadcaster-icon",src:`${a.Utils.api_base_url}/channels/${h.id}/logo`},null,8,_m),je("div",Am,[je("span",vm,"Ch: "+Kt(h.channel_number)+" "+Kt(h.name),1),je("div",{class:on(["channel__broadcaster-force",`channel__broadcaster-force--${a.ChannelUtils.getChannelForceType(h.jikkyo_force)}`])},[e[3]||(e[3]=je("svg",{class:"iconify iconify--fa-solid",width:"9.63px",height:"11px",viewBox:"0 0 448 512"},[je("path",{fill:"currentColor",d:"M323.56 51.2c-20.8 19.3-39.58 39.59-56.22 59.97C240.08 73.62 206.28 35.53 168 0C69.74 91.17 0 209.96 0 281.6C0 408.85 100.29 512 224 512s224-103.15 224-230.4c0-53.27-51.98-163.14-124.44-230.4zm-19.47 340.65C282.43 407.01 255.72 416 226.86 416C154.71 416 96 368.26 96 290.75c0-38.61 24.31-72.63 72.79-130.75c6.93 7.98 98.83 125.34 98.83 125.34l58.63-66.88c4.14 6.85 7.91 13.55 11.27 19.97c27.35 52.19 15.81 118.97-33.43 153.42z"})],-1)),je("span",bm,Kt(h.jikkyo_force??"--"),1)],2)])]),je("div",Sm,[je("span",{class:"channel__program-present-title",innerHTML:a.ProgramUtils.decorateProgramInfo(h.program_present,"title")},null,8,Em),je("span",Tm,Kt(a.ProgramUtils.getProgramTime(h.program_present)),1)]),je("div",xm,[je("div",Cm,[e[4]||(e[4]=je("span",{class:"channel__program-following-title-decorate"},"NEXT",-1)),e[5]||(e[5]=je("svg",{class:"channel__program-following-title-icon iconify iconify--fluent",width:"16px",height:"16px",viewBox:"0 0 20 20"},[je("path",{fill:"currentColor",d:"M10.018 5.486a1 1 0 0 1 1.592-.806l5.88 4.311a1.25 1.25 0 0 1 0 2.017l-5.88 4.311a1 1 0 0 1-1.592-.806v-3.16L4.61 15.319a1 1 0 0 1-1.592-.806V5.486A1 1 0 0 1 4.61 4.68l5.408 3.966v-3.16Z"})],-1)),je("span",{class:"channel__program-following-title-text",innerHTML:a.ProgramUtils.decorateProgramInfo(h.program_following,"title")},null,8,wm)]),je("span",km,Kt(a.ProgramUtils.getProgramTime(h.program_following)),1)]),je("div",Rm,[je("div",{class:"channel__progressbar-progress",style:ds(`width:${a.ProgramUtils.getProgramProgress(h.program_present)}%;`)},null,4)])]),_:2},1032,["to"])),[[xn]])),128))])]),_:2},1024))),128))]),_:1})])])}const Lm=fi(hm,[["render",Im],["__scopeId","data-v-2fa686b9"]]),Qi=null,{min:Di,max:ri,abs:cl,floor:Dm}=Math,Pc=(a,e,t)=>Di(t,ri(e,a)),Oc=a=>[...a].sort((e,t)=>e-t),ul=typeof queueMicrotask=="function"?queueMicrotask:a=>{Promise.resolve().then(a)},Co=a=>{let e;return()=>(a&&(e=a(),a=void 0),e)},Bi=-1,us=(a,e,t)=>{const n=t?"unshift":"push";for(let i=0;i<e;i++)a[n](Bi);return a},hs=(a,e)=>{const t=a.t[e];return t===Bi?a.o:t},Pm=(a,e,t)=>{const n=a.t[e]===Bi;return a.t[e]=t,a.i=Di(e,a.i),n},zr=(a,e)=>{if(!a.l)return 0;if(a.i>=e)return a.u[e];a.i<0&&(a.u[0]=0,a.i=0);let t=a.i,n=a.u[t];for(;t<e;)n+=hs(a,t),a.u[++t]=n;return a.i=e,n},Ri=(a,e,t=0,n=a.l-1)=>{for(;t<=n;){const i=Dm((t+n)/2),s=zr(a,i);if(s<=e){if(s+hs(a,i)>e)return i;t=i+1}else n=i-1}return Pc(t,0,a.l-1)},hl=(a,e,t)=>{const n=e-a.l;return a.i=t?-1:Di(e-1,a.i),a.l=e,n>0?(us(a.u,n),us(a.t,n,t),a.o*n):(a.u.splice(n),(t?a.t.splice(0,-n):a.t.splice(n)).reduce((i,s)=>i-(s===Bi?a.o:s),0))},Om=typeof window<"u",Mc=()=>document.documentElement,Mm=a=>a.ownerDocument,Bm=a=>a.defaultView,Bc=Co(()=>!!Om&&getComputedStyle(Mc()).direction==="rtl"),Fc=Co(()=>/iP(hone|od|ad)/.test(navigator.userAgent)),Fm=Co(()=>"scrollBehavior"in Mc().style),Nm=a=>!!a.p(),Um=(a,e=40,t=4,n=0,i,s=!1)=>{let r=!!n,d=1,u=0,c=0,l=0,h=0,o=0,f=0,p=0,m=0,y=r?[0,ri(n-1,0)]:Qi,_=[0,0],S=0;const b=((V,ne)=>({o:ne,t:us([],V),l:V,i:-1,u:us([],V)}))(a,e),x=new Set,L=()=>l-c,N=()=>L()+o+h,P=V=>((ne,te,Z,Q)=>{if(Q=Di(Q,ne.l-1),zr(ne,Q)<=te){const he=Ri(ne,te+Z,Q);return[Ri(ne,te,Q,he),he]}{const he=Ri(ne,te,void 0,Q);return[he,Ri(ne,te+Z,he)]}})(b,V,u,_[0]),T=()=>(V=>V.l?zr(V,V.l-1)+hs(V,V.l-1):0)(b),k=V=>zr(b,V)-o,I=V=>hs(b,V),F=V=>{V&&(Fc()&&p!==0?o+=V:h+=V)};return{h:()=>d,m:()=>(V=>[V.t.slice(),V.o])(b),v:()=>{let V,ne;return f?[V,ne]=_:([V,ne]=_=P(ri(0,N())),y&&(V=Di(V,y[0]),ne=ri(ne,y[1]))),p!==1&&(V-=ri(0,t)),p!==2&&(ne+=ri(0,t)),[ri(V,0),Di(ne,b.l-1)]},S:()=>Ri(b,N()),I:()=>Ri(b,N()+u),k:V=>b.t[V]===Bi,O:()=>!!y&&b.t.slice(ri(0,y[0]-1),Di(b.l-1,y[1]+1)+1).includes(Bi),j:k,T:I,B:()=>b.l,q:()=>l,P:()=>p!==0,p:()=>u,R:()=>c,M:T,N:()=>(f=h,h=0,[f,m===2||L()+u>=T()]),A:(V,ne)=>{const te=[V,ne];return x.add(te),()=>{x.delete(te)}},H:(V,ne)=>{let te,Z,Q=0;switch(V){case 1:{const he=f;f=0;const de=ne-l,M=cl(de);he&&M<cl(he)+1||m!==0||(p=de<0?2:1),r&&(y=Qi,r=!1),l=ne,Q=4;const A=L();A>=-u&&A<=T()&&(Q+=1,Z=M>u);break}case 2:Q=8,p!==0&&(te=!0,Q+=1),p=0,m=0,y=Qi;break;case 3:{const he=ne.filter(([de,M])=>b.t[de]!==M);if(!he.length)break;F(he.reduce((de,[M,A])=>((m===2||(y?!r&&M<y[0]:k(M)+(p===0&&m===0?I(M):0)<L()))&&(de+=A-I(M)),de),0));for(const[de,M]of he){const A=I(de),v=Pm(b,de,M);s&&(S+=v?M:M-A)}s&&u&&S>u&&(F(((de,M)=>{let A=0;const v=[];de.t.forEach((z,Y)=>{z!==Bi&&(v.push(z),Y<M&&A++)}),de.i=-1;const w=Oc(v),R=w.length,C=R/2|0,O=R%2==0?(w[C-1]+w[C])/2:w[C],G=de.o;return((de.o=O)-G)*ri(M-A,0)})(b,Ri(b,N()))),s=!1),Q=3,Z=!0;break}case 4:u!==ne&&(u=ne,Q=3);break;case 5:ne[1]?(F(hl(b,ne[0],!0)),m=2,Q=1):(hl(b,ne[0]),Q=1);break;case 6:c=ne;break;case 7:m=1;break;case 8:y=P(ne),Q=1}Q&&(d=1+(2147483647&d),te&&o&&(h+=o,o=0),x.forEach(([he,de])=>{Q&he&&de(Z)}))}}},qa=setTimeout,Kr=(a,e)=>e&&Bc()?-a:a,$m=(a,e,t,n,i,s)=>{const r=Date.now;let d=0,u=!1,c=!1,l=!1,h=!1;const o=(()=>{let _;const S=()=>{_!=Qi&&clearTimeout(_)},b=()=>{S(),_=qa(()=>{_=Qi,(()=>{if(u||c)return u=!1,void o();l=!1,a.H(2)})()},150)};return b.V=S,b})(),f=()=>{d=r(),l&&(h=!0),a.H(1,n()),o()},p=_=>{if(u||!a.P()||_.ctrlKey)return;const S=r()-d;150>S&&50<S&&(t?_.deltaX:_.deltaY)&&(u=!0)},m=()=>{c=!0,l=h=!1},y=()=>{c=!1,Fc()&&(l=!0)};return e.addEventListener("scroll",f),e.addEventListener("wheel",p,{passive:!0}),e.addEventListener("touchstart",m,{passive:!0}),e.addEventListener("touchend",y,{passive:!0}),{C:()=>{e.removeEventListener("scroll",f),e.removeEventListener("wheel",p),e.removeEventListener("touchstart",m),e.removeEventListener("touchend",y),o.V()},F:()=>{const[_,S]=a.N();_&&(i(Kr(_,t),S,h),h=!1,S&&a.p()>a.M()&&a.H(1,n()))}}},Gm=a=>{let e;return{J(t){(e||(e=new(Bm(Mm(t))).ResizeObserver(a))).observe(t)},L(t){e.unobserve(t)},C(){e&&e.disconnect()}}},Vm=zn({props:{W:{type:Object,required:!0},X:{type:Object,required:!0},Y:{type:Object,required:!0},U:{type:Function,required:!0},D:{type:Number,required:!0},G:{type:Boolean},K:{type:Boolean},Z:{type:String,required:!0},ee:Object},setup(a){const e=cs(),t=Pi(()=>a.W.value&&a.X.j(a.D)),n=Pi(()=>a.W.value&&a.X.k(a.D));return Mi(()=>e.value&&a.D,(i,s,r)=>{r(a.U(e.value,a.D))},{flush:"post"}),()=>{var i;const{Y:s,G:r,K:d,Z:u}=a,c=n.value,{style:l,...h}=(i=a.ee)!==null&&i!==void 0?i:{},o={position:c&&d?void 0:"absolute",[r?"height":"width"]:"100%",[r?"top":"left"]:"0px",[r?Bc()?"right":"left":"top"]:t.value+"px",visibility:!c||d?"visible":"hidden",...l};return r&&(o.display="flex"),wt(u,hp({ref:e,style:o},h),typeof(f=s)=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!bo(f)?s:{default:()=>[s],_:2},16,["style"]);var f}}}),jm=(a,e)=>{const t=a.key;return t??"_"+e},Hm=(a,e)=>a[0]===e[0]&&a[1]===e[1],qm=zn({props:{data:{type:Array,required:!0},overscan:Number,itemSize:Number,shift:Boolean,horizontal:Boolean,startMargin:{type:Number,default:0},ssrCount:Number,scrollRef:Object,as:{type:String,default:"div"},item:{type:String,default:"div"},itemProps:Function,keepMounted:Array},emits:["scroll","scrollEnd"],setup(a,{emit:e,expose:t,slots:n}){let i=!!a.ssrCount;const s=a.horizontal,r=cs(),d=Um(a.data.length,a.itemSize,a.overscan,a.ssrCount,0,!a.itemSize),u=((_,S)=>{let b;const x=S?"width":"height",L=new WeakMap,N=Gm(P=>{const T=[];for(const{target:k,contentRect:I}of P)if(k.offsetParent)if(k===b)_.H(4,I[x]);else{const F=L.get(k);F!=Qi&&T.push([F,I[x]])}T.length&&_.H(3,T)});return{te(P){N.J(b=P)},re:(P,T)=>(L.set(P,T),N.J(P),()=>{L.delete(P),N.L(P)}),oe:N.C}})(d,s),c=((_,S)=>{let b,x,L;const N=S?"scrollLeft":"scrollTop",P=S?"overflowX":"overflowY",T=async(k,I)=>{if(!b)return void ul(()=>T(k,I));L&&L();const F=()=>{let V;return[new Promise((ne,te)=>{V=ne,L=te,Nm(_)&&qa(te,150)}),_.A(2,()=>{V&&V()})]};if(I&&Fm()){for(;_.H(8,k()),_.O();){const[V,ne]=F();try{await V}catch{return}finally{ne()}}b.scrollTo({[S?"left":"top"]:Kr(k(),S),behavior:"smooth"})}else for(;;){const[V,ne]=F();try{b[N]=Kr(k(),S),_.H(7),await V}catch{return}finally{ne()}}};return{ne(k){b=k,x=$m(_,k,S,()=>Kr(k[N],S),(I,F,V)=>{if(V){const ne=k.style,te=ne[P];ne[P]="hidden",qa(()=>{ne[P]=te})}F?(k[N]=_.q()+I,L&&L()):k[N]+=I})},oe(){x&&x.C()},se(k){T(()=>k)},ie(k){k+=_.q(),T(()=>k)},le(k,{align:I,smooth:F,offset:V=0}={}){if(k=Pc(k,0,_.B()-1),I==="nearest"){const ne=_.j(k),te=_.q();if(ne<te)I="start";else{if(!(ne+_.T(k)>te+_.p()))return;I="end"}}T(()=>V+_.R()+_.j(k)+(I==="end"?_.T(k)-_.p():I==="center"?(_.T(k)-_.p())/2:0),F)},ce:()=>{x&&x.F()}}})(d,s),l=cs(d.h()),h=d.A(1,()=>{l.value=d.h()}),o=d.A(4,()=>{e("scroll",d.q())}),f=d.A(8,()=>{e("scrollEnd")}),p=Pi(_=>{l.value;const S=d.v();return _&&Hm(_,S)?_:S}),m=Pi(()=>l.value&&d.P()),y=Pi(()=>l.value&&d.M());return cp(()=>{i=!1,ul(()=>{const _=S=>{u.te(S),c.ne(S)};a.scrollRef?_(a.scrollRef):_(r.value.parentElement)})}),up(()=>{h(),o(),f(),u.oe(),c.oe()}),Mi(()=>a.data.length,_=>{d.H(5,[_,a.shift])}),Mi(()=>a.startMargin,_=>{d.H(6,_)},{immediate:!0}),Mi([l],()=>{c.ce()},{flush:"post"}),t({get scrollOffset(){return d.q()},get scrollSize(){return(_=>ri(_.M(),_.p()))(d)},get viewportSize(){return d.p()},findStartIndex:d.S,findEndIndex:d.I,getItemOffset:d.j,getItemSize:d.T,scrollToIndex:c.le,scrollTo:c.se,scrollBy:c.ie}),()=>{const _=a.as,S=a.item,[b,x]=p.value,L=y.value,N=[];function P(k){var I;const F=n.default({item:a.data[k],index:k})[0];return wt(Vm,{key:jm(F,k),W:l,X:d,U:u.re,D:k,Y:F,G:s,K:i,Z:S,ee:(I=a.itemProps)===null||I===void 0?void 0:I.call(a,{item:a.data[k],index:k})},null,8,["W","X","U","D","Y","G","K","Z","ee"])}for(let k=b,I=x;k<=I;k++)N.push(P(k));if(a.keepMounted){const k=[],I=[];Oc(a.keepMounted).forEach(F=>{F<b&&k.push(P(F)),F>x&&I.push(P(F))}),N.unshift(...k),N.push(...I)}return wt(_,{ref:r,style:{overflowAnchor:"none",flex:"none",position:"relative",visibility:"hidden",width:s?L+"px":"100%",height:s?"100%":L+"px",pointerEvents:m.value?"none":void 0}},typeof(T=N)=="function"||Object.prototype.toString.call(T)==="[object Object]"&&!bo(T)?N:{default:()=>[N],_:2},8,["style"]);var T}}}),zm=zn({props:{data:{type:Array,required:!0},overscan:Number,itemSize:Number,shift:Boolean,horizontal:Boolean,ssrCount:Number,itemProps:Function,keepMounted:Array},emits:["scroll","scrollEnd"],setup(a,{emit:e,expose:t,slots:n}){const i=a.horizontal,s=u=>{e("scroll",u)},r=()=>{e("scrollEnd")},d=cs();return t({get scrollOffset(){return d.value.scrollOffset},get scrollSize(){return d.value.scrollSize},get viewportSize(){return d.value.viewportSize},findStartIndex:(...u)=>d.value.findStartIndex(...u),findEndIndex:(...u)=>d.value.findEndIndex(...u),getItemOffset:(...u)=>d.value.getItemOffset(...u),getItemSize:(...u)=>d.value.getItemSize(...u),scrollToIndex:(...u)=>d.value.scrollToIndex(...u),scrollTo:(...u)=>d.value.scrollTo(...u),scrollBy:(...u)=>d.value.scrollBy(...u)}),()=>{return wt("div",{style:{display:i?"inline-block":"block",[i?"overflowX":"overflowY"]:"auto",contain:"strict",width:"100%",height:"100%"}},[wt(qm,{ref:d,data:a.data,overscan:a.overscan,itemSize:a.itemSize,itemProps:a.itemProps,shift:a.shift,ssrCount:a.ssrCount,horizontal:i,keepMounted:a.keepMounted,onScroll:s,onScrollEnd:r},(u=n,typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!bo(u)?n:{default:()=>[n],_:2}),8,["data","overscan","itemSize","itemProps","shift","ssrCount","horizontal","keepMounted","onScroll","onScrollEnd"])],4);var u}}}),Km=zn({name:"Panel-CommentTab",components:{CommentMuteSettings:Ep,VirtuaList:zm},props:{playback_mode:{type:String,required:!0}},data(){return{Utils:Object.freeze(Dt),is_manual_scroll:!1,is_auto_scrolling:!1,comment_list:[],comment_list_element:null,is_comment_list_dropdown_display:!1,comment_list_dropdown_top:0,comment_list_dropdown_comment:null,comment_mute_settings_modal:!1,visibilitychange_listener:null,current_playback_position:0,target_comment_index:0,virtua_scroller:null}},computed:{...hi(ci,_n)},watch:{"channelsStore.channel.current.id":{handler(){this.playback_mode==="Live"&&(this.comment_list=[])}}},mounted(){this.comment_list_element===null&&(this.comment_list_element=document.querySelector(".comment-list")),this.playback_mode==="Video"&&(this.virtua_scroller=this.$refs.virtua_scroller);let a=!1;this.comment_list_element.onmousedown=s=>{if(this.comment_list_element===null)return;s.clientX-this.comment_list_element.getBoundingClientRect().left>this.comment_list_element.clientWidth&&(a=!0)},this.comment_list_element.onmouseup=s=>{if(this.comment_list_element===null)return;s.clientX-this.comment_list_element.getBoundingClientRect().left>this.comment_list_element.clientWidth&&(a=!1)};const e=()=>{a=!0,window.setTimeout(()=>a=!1,100)};let t=!1;this.comment_list_element.ontouchstart=()=>t=!0,this.comment_list_element.ontouchend=()=>t=!1,this.comment_list_element.ontouchmove=()=>t===!0?e():"",this.comment_list_element.onwheel=e,this.comment_list_element.onscroll=async()=>{this.comment_list_element!==null&&this.is_auto_scrolling===!1&&a===!0&&(this.is_manual_scroll=!0,console.log("[Comment.vue] Manual scroll is enabled."),await Dt.sleep(.1),this.playback_mode==="Live"&&this.comment_list_element.scrollTop+this.comment_list_element.offsetHeight>this.comment_list_element.scrollHeight-10&&(this.is_manual_scroll=!1,console.log("[Comment.vue] Manual scroll is disabled because bottom of comment list is reached.")))};const n=[],i=500;this.playerStore.event_emitter.on("CommentReceived",async s=>{if(s.is_initial_comments===!0)this.comment_list=[],this.comment_list.push(...s.comments),console.log(`[Comment.vue] Comment list updated. ${this.comment_list.length} comments.`),this.playback_mode==="Live"&&this.scrollCommentList(!1);else{if(document.visibilityState==="hidden"){n.push(...s.comments);return}this.comment_list.length>=i&&this.is_manual_scroll===!1&&this.comment_list.splice(0,Math.max(0,this.comment_list.length-i)),this.comment_list.push(...s.comments),this.scrollCommentList(!1)}}),this.playback_mode==="Live"&&(this.playerStore.event_emitter.on("CommentSendCompleted",async s=>{this.comment_list.push(s.comment),this.scrollCommentList(!1)}),this.visibilitychange_listener=()=>{if(document.visibilityState==="visible"){const s=this.comment_list.length+n.length;s>=i&&this.is_manual_scroll===!1&&this.comment_list.splice(0,Math.max(0,s-i)),this.comment_list.push(...n),n.length=0,this.scrollCommentList(!1)}},document.addEventListener("visibilitychange",this.visibilitychange_listener)),this.playback_mode==="Video"&&(console.log("[Comment.vue] Setting up PlaybackPositionChanged event listener."),this.playerStore.event_emitter.on("PlaybackPositionChanged",s=>{this.current_playback_position=s.playback_position,this.is_manual_scroll===!1&&this.scrollPlaybackComment(!1)}))},beforeUnmount(){this.playback_mode==="Live"&&this.visibilitychange_listener!==null&&(document.removeEventListener("visibilitychange",this.visibilitychange_listener),this.visibilitychange_listener=null),this.playerStore.event_emitter.off("CommentReceived"),this.playback_mode==="Live"&&this.playerStore.event_emitter.off("CommentSendCompleted"),this.playback_mode==="Video"&&this.playerStore.event_emitter.off("PlaybackPositionChanged"),this.comment_list=[]},methods:{showCommentListDropdown(a,e){const t=this.$refs.comment_list_wrapper.getBoundingClientRect(),n=106,i=a.currentTarget.getBoundingClientRect();this.comment_list_dropdown_top=i.top-t.top,this.comment_list_dropdown_top+n>t.height&&(this.comment_list_dropdown_top=this.comment_list_dropdown_top-n+i.height),this.comment_list_dropdown_comment=e,this.is_comment_list_dropdown_display=!0},hideCommentListDropdown(){this.is_comment_list_dropdown_display=!1,this.comment_list=this.comment_list.filter(a=>Oi.isMutedComment(a.text,a.user_id)===!1)},copyTextToClipboard(){this.comment_list_dropdown_comment!==null&&(navigator.clipboard.writeText(this.comment_list_dropdown_comment.text),this.hideCommentListDropdown())},addMutedKeywords(){this.comment_list_dropdown_comment!==null&&(Oi.addMutedKeywords(this.comment_list_dropdown_comment.text),this.hideCommentListDropdown())},addMutedNiconicoUserIds(){this.comment_list_dropdown_comment!==null&&(Oi.addMutedNiconicoUserIDs(this.comment_list_dropdown_comment.user_id),this.hideCommentListDropdown())},async scrollCommentList(a=!1){if(this.comment_list_element===null||(this.is_comment_list_dropdown_display===!0&&(this.is_manual_scroll=!0,console.log("[Comment.vue] Manual scroll is enabled because dropdown menu is displayed.")),this.is_manual_scroll===!0))return;this.is_auto_scrolling=!0;const e=(t=3)=>{t<=0||window.requestAnimationFrame(()=>{var n,i;a===!0?(n=this.comment_list_element)==null||n.scrollTo({top:this.comment_list_element.scrollHeight,left:0,behavior:"smooth"}):(i=this.comment_list_element)==null||i.scrollTo(0,this.comment_list_element.scrollHeight),e(t-1)})};e(),await Dt.sleep(.1),this.is_auto_scrolling=!1},async scrollPlaybackComment(a=!1){if(this.is_comment_list_dropdown_display===!0&&(this.is_manual_scroll=!0,console.log("[Comment.vue] Manual scroll is enabled because dropdown menu is displayed.")),this.is_manual_scroll===!0||this.playback_mode==="Video"&&this.playerStore.video_panel_active_tab!=="Comment")return;let e=-1;for(let t=0;t<this.comment_list.length;t++){const n=this.comment_list[t];if(n.playback_position!==void 0&&n.playback_position<=this.current_playback_position)e=t;else break}e===this.target_comment_index&&a===!1||(this.is_auto_scrolling=!0,e!==-1&&this.virtua_scroller!==null&&(this.virtua_scroller.scrollToIndex(e,{align:"end",smooth:a,offset:-3}),this.target_comment_index=e),await Dt.sleep(.1),this.is_auto_scrolling=!1)},handleAutoScrollButtonClick(){this.is_manual_scroll=!1,console.log("[Comment.vue] Manual scroll is disabled because Auto-scroll button clicked."),this.playback_mode==="Live"?this.scrollCommentList(!0):this.playback_mode==="Video"&&this.scrollPlaybackComment(!0)}}}),Wm={class:"comment-header"},Ym={class:"comment-header__title"},Xm={class:"comment-list-wrapper",ref:"comment_list_wrapper"},Jm={class:"comment__text"},Qm={class:"comment__time"},Zm=["onMouseup","onTouchend"],eg={class:"comment__text"},tg={class:"comment__time"},ng=["onMouseup","onTouchend"],ig={key:2,class:"comment-announce"},rg={key:3,class:"comment-announce"},sg={class:"comment-announce__text"},ag={class:"mt-0 mb-0"},og={key:4,class:"comment-announce"},lg={key:5,class:"comment-announce"},dg={class:"comment-announce__text"},cg={class:"mt-0 mb-0"};function ug(a,e,t,n,i,s){const r=pn("Icon"),d=pn("DynamicScrollerItem"),u=pn("DynamicScroller"),c=pn("VirtuaList"),l=pn("CommentMuteSettings");return mt(),Lt("div",{class:on(["comment-container",{"comment-container--video":a.playback_mode==="Video"}])},[je("section",Wm,[je("h2",Ym,[wt(r,{class:"comment-header__title-icon",icon:"bi:chat-left-text-fill",height:"18.5px"}),e[7]||(e[7]=je("span",{class:"comment-header__title-text"},"コメント",-1))]),Tn((mt(),Lt("button",{class:"comment-header__button ml-auto",onClick:e[0]||(e[0]=h=>a.comment_mute_settings_modal=!a.comment_mute_settings_modal)},[wt(r,{icon:"heroicons-solid:filter",height:"11px"}),e[8]||(e[8]=je("span",{class:"ml-1"},"ミュート設定",-1))])),[[xn]])]),je("section",Xm,[je("div",{class:on(["comment-list-dropdown",{"comment-list-dropdown--display":a.is_comment_list_dropdown_display}]),style:ds({"--comment-list-dropdown-top":`${a.comment_list_dropdown_top}px`})},[wt(Tp,{style:{background:"rgb(var(--v-theme-background-lighten-1))"}},{default:an(()=>[wt(Vs,{density:"compact",style:{"min-height":"30px"},onClick:e[1]||(e[1]=h=>a.copyTextToClipboard())},{default:an(()=>[wt(js,{class:"d-flex align-center"},{default:an(()=>[wt(r,{icon:"fluent:clipboard-paste-20-filled",width:"20px"}),e[9]||(e[9]=je("span",{class:"ml-2"},"クリップボードにコピー",-1))]),_:1})]),_:1}),wt(Vs,{density:"compact",style:{"min-height":"30px"},onClick:e[2]||(e[2]=h=>a.addMutedKeywords())},{default:an(()=>[wt(js,{class:"d-flex align-center"},{default:an(()=>[wt(r,{icon:"fluent:comment-dismiss-20-filled",width:"20px"}),e[10]||(e[10]=je("span",{class:"ml-2"},"このコメントをミュート",-1))]),_:1})]),_:1}),wt(Vs,{density:"compact",style:{"min-height":"30px"},onClick:e[3]||(e[3]=h=>a.addMutedNiconicoUserIds())},{default:an(()=>[wt(js,{class:"d-flex align-center"},{default:an(()=>[wt(r,{icon:"fluent:person-prohibited-20-filled",width:"20px"}),e[11]||(e[11]=je("span",{class:"ml-2"},"このコメントの投稿者をミュート",-1))]),_:1})]),_:1})]),_:1})],6),je("div",{class:on(["comment-list-cover",{"comment-list-cover--display":a.is_comment_list_dropdown_display}]),onClick:e[4]||(e[4]=h=>a.hideCommentListDropdown())},null,2),a.playback_mode==="Live"?(mt(),On(u,{key:0,class:"comment-list",direction:"vertical",items:a.comment_list,"min-item-size":34},{default:an(({item:h,active:o})=>[wt(d,{item:h,active:o,"size-dependencies":[h.text]},{default:an(()=>[je("div",{class:on(["comment",{"comment--my-post":h.my_post}])},[je("span",Jm,Kt(h.text),1),je("span",Qm,Kt(h.comment_source?`[${h.comment_source}] `:"")+Kt(h.time),1),Tn((mt(),Lt("div",{class:"comment__icon",onMouseup:f=>a.showCommentListDropdown(f,h),onTouchend:f=>a.showCommentListDropdown(f,h)},e[12]||(e[12]=[je("svg",{class:"iconify iconify--fluent",width:"20px",height:"20px",viewBox:"0 0 20 20"},[je("path",{fill:"currentColor",d:"M10 6.5A1.75 1.75 0 1 1 10 3a1.75 1.75 0 0 1 0 3.5ZM10 17a1.75 1.75 0 1 1 0-3.5a1.75 1.75 0 0 1 0 3.5Zm-1.75-7a1.75 1.75 0 1 0 3.5 0a1.75 1.75 0 0 0-3.5 0Z"})],-1)]),40,Zm)),[[xn,!a.Utils.isTouchDevice()]])],2)]),_:2},1032,["item","active","size-dependencies"])]),_:1},8,["items"])):(mt(),On(c,{key:1,ref:"virtua_scroller",class:"comment-list",data:a.comment_list,"item-size":34},{default:an(({item:h})=>[je("div",{class:on(["comment",{"comment--my-post":h.my_post}])},[je("span",eg,Kt(h.text),1),je("span",tg,Kt(h.comment_source?`[${h.comment_source}] `:"")+Kt(h.time),1),Tn((mt(),Lt("div",{class:"comment__icon",onMouseup:o=>a.showCommentListDropdown(o,h),onTouchend:o=>a.showCommentListDropdown(o,h)},e[13]||(e[13]=[je("svg",{class:"iconify iconify--fluent",width:"20px",height:"20px",viewBox:"0 0 20 20"},[je("path",{fill:"currentColor",d:"M10 6.5A1.75 1.75 0 1 1 10 3a1.75 1.75 0 0 1 0 3.5ZM10 17a1.75 1.75 0 1 1 0-3.5a1.75 1.75 0 0 1 0 3.5Zm-1.75-7a1.75 1.75 0 1 0 3.5 0a1.75 1.75 0 0 0-3.5 0Z"})],-1)]),40,ng)),[[xn,!a.Utils.isTouchDevice()]])],2)]),_:1},8,["data"])),a.playback_mode==="Live"&&a.playerStore.live_comment_init_failed_message===null&&a.comment_list.length===0?(mt(),Lt("div",ig,e[14]||(e[14]=[je("div",{class:"comment-announce__heading"},"まだコメントがありません。",-1),je("div",{class:"comment-announce__text"},[je("p",{class:"mt-0 mb-0"},"このチャンネルに対応する実況のコメントが、リアルタイムで表示されます。")],-1)]))):Bn("",!0),a.playback_mode==="Live"&&a.playerStore.live_comment_init_failed_message!==null&&a.comment_list.length===0?(mt(),Lt("div",rg,[e[15]||(e[15]=je("div",{class:"comment-announce__heading"},"コメントがありません。",-1)),je("div",sg,[je("p",ag,Kt(a.playerStore.live_comment_init_failed_message),1)])])):Bn("",!0),a.playback_mode==="Video"&&a.playerStore.video_comment_init_failed_message===null&&a.comment_list.length===0?(mt(),Lt("div",og,e[16]||(e[16]=[je("div",{class:"comment-announce__heading"},"まだコメントがありません。",-1),je("div",{class:"comment-announce__text"},[je("p",{class:"mt-0 mb-0"},"この録画番組に対応する、実況の過去ログコメントを取得しています...")],-1)]))):Bn("",!0),a.playback_mode==="Video"&&a.playerStore.video_comment_init_failed_message!==null&&a.comment_list.length===0?(mt(),Lt("div",lg,[e[17]||(e[17]=je("div",{class:"comment-announce__heading"},"コメントがありません。",-1)),je("div",dg,[je("p",cg,Kt(a.playerStore.video_comment_init_failed_message),1)])])):Bn("",!0)],512),Tn((mt(),Lt("div",{class:on(["comment-scroll-button elevation-5",{"comment-scroll-button--display":a.is_manual_scroll}]),onClick:e[5]||(e[5]=(...h)=>a.handleAutoScrollButtonClick&&a.handleAutoScrollButtonClick(...h))},[wt(r,{icon:"fluent:arrow-down-12-filled",height:"29px"})],2)),[[xn]]),wt(l,{modelValue:a.comment_mute_settings_modal,"onUpdate:modelValue":e[6]||(e[6]=h=>a.comment_mute_settings_modal=h)},null,8,["modelValue"])],2)}const hg=fi(Km,[["render",ug],["__scopeId","data-v-0c8e3d45"]]),fg=zn({name:"Panel-ProgramTab",data(){return{Utils:Object.freeze(Dt),ChannelUtils:Object.freeze(Sc),ProgramUtils:Object.freeze(Rs)}},computed:{...hi(ci)},methods:{shareToTwitter(){var t;const a=this.channelsStore.channel.current,e=`NX-Jikkyo で【Ch: ${a.channel_number} ${a.name}】「${(t=a.program_present)==null?void 0:t.title}」を実況中🎧  #NXJikkyo
https://nx-jikkyo.tsukumijima.net/watch/${a.id}`;window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(e)}`)}}}),pg={class:"program-container"},mg={class:"program-broadcaster"},gg=["src"],yg={class:"program-broadcaster__number"},_g={class:"program-broadcaster__name"},Ag={class:"program-info"},vg=["innerHTML"],bg={class:"program-info__time"},Sg=["innerHTML"],Eg={class:"program-info__genre-container"},Tg={class:"program-info__next"},xg=["innerHTML"],Cg={class:"program-info__next-time"},wg={class:"program-info__status"},kg={class:"ml-1"},Rg={class:"program-info__status-viewers ml-3"},Ig={class:"ml-1"},Lg={class:"program-detail-container"},Dg={class:"program-detail__heading"},Pg=["innerHTML"];function Og(a,e,t,n,i,s){var d,u;const r=pn("Icon");return mt(),Lt("div",pg,[je("section",mg,[je("img",{class:"program-broadcaster__icon",src:`${a.Utils.api_base_url}/channels/${a.channelsStore.channel.current.id}/logo`},null,8,gg),je("div",yg,"Ch: "+Kt(a.channelsStore.channel.current.channel_number),1),je("div",_g,Kt(a.channelsStore.channel.current.name),1)]),je("section",Ag,[je("h1",{class:"program-info__title",innerHTML:a.ProgramUtils.decorateProgramInfo(a.channelsStore.channel.current.program_present,"title")},null,8,vg),je("div",bg,Kt(a.ProgramUtils.getProgramTime(a.channelsStore.channel.current.program_present)),1),je("div",{class:"program-info__description",innerHTML:a.ProgramUtils.decorateProgramInfo(a.channelsStore.channel.current.program_present,"description")},null,8,Sg),je("div",Eg,[(mt(!0),Lt(Xn,null,Yn(((d=a.channelsStore.channel.current.program_present)==null?void 0:d.genres)??[],(c,l)=>(mt(),Lt("div",{class:"program-info__genre",key:l}," ジャンル: "+Kt(c.major),1))),128))]),je("div",Tg,[e[1]||(e[1]=je("span",{class:"program-info__next-decorate"},"NEXT",-1)),wt(r,{class:"program-info__next-icon",icon:"fluent:fast-forward-20-filled",width:"16px"})]),je("span",{class:"program-info__next-title",innerHTML:a.ProgramUtils.decorateProgramInfo(a.channelsStore.channel.current.program_following,"title")},null,8,xg),je("div",Cg,Kt(a.ProgramUtils.getProgramTime(a.channelsStore.channel.current.program_following)),1),je("div",wg,[je("div",{class:on(["program-info__status-force",`program-info__status-force--${a.ChannelUtils.getChannelForceType(a.channelsStore.channel.current.jikkyo_force)}`])},[wt(r,{icon:"fa-solid:fire-alt",height:"14px"}),e[2]||(e[2]=je("span",{class:"ml-2"},"勢い:",-1)),je("span",kg,Kt(a.channelsStore.channel.current.jikkyo_force??"--")+" コメ/分",1)],2),je("div",Rg,[wt(r,{icon:"bi:chat-left-text-fill",height:"14px"}),e[3]||(e[3]=je("span",{class:"ml-2"},"累計コメント数:",-1)),je("span",Ig,Kt(a.channelsStore.channel.current.viewer_count),1)])]),wt(vo,{class:"mt-4 px-3 py-0",style:{background:"#1d9BF0",height:"32px","border-radius":"6px","font-size":"13.5px"},onClick:e[0]||(e[0]=c=>a.shareToTwitter())},{default:an(()=>[wt(r,{icon:"fa-brands:twitter",height:"16px"}),e[4]||(e[4]=je("span",{class:"ml-1"},"Twitter でシェア",-1))]),_:1})]),je("section",Lg,[(mt(!0),Lt(Xn,null,Yn(((u=a.channelsStore.channel.current.program_present)==null?void 0:u.detail)??{},(c,l)=>(mt(),Lt("div",{class:"program-detail",key:l},[je("h2",Dg,Kt(l),1),je("div",{class:"program-detail__text",innerHTML:a.Utils.URLtoLink(c)},null,8,Pg)]))),128))])])}const Mg=fi(fg,[["render",Og],["__scopeId","data-v-9f30c8e4"]]),Bg=zn({name:"Panel-RecordedProgramTab",data(){return{Utils:Object.freeze(Dt),ProgramUtils:Object.freeze(Rs),comment_count:null}},computed:{...hi(_n)},created(){this.playerStore.event_emitter.on("CommentReceived",a=>{a.is_initial_comments===!0&&(this.comment_count=a.comments.length)})},beforeUnmount(){this.playerStore.event_emitter.off("CommentReceived")},methods:{shareToTwitter(){const a=this.playerStore.recorded_program.channel??mp,e=jn(this.playerStore.recorded_program.start_time),t=jn(this.playerStore.recorded_program.end_time),n=e.hour()<4?e.subtract(1,"day"):e,i=`NX-Jikkyo で【Ch: ${a.channel_number} ${a.name}】${n.format("YYYY年MM月DD日 (dd)")} ${n.format("HH:mm")} 〜 ${t.format("HH:mm")} の過去ログコメントを再生中🎧  #NXJikkyo
https://nx-jikkyo.tsukumijima.net/log/${this.$route.params.display_channel_id}/${this.$route.params.kakolog_period_id}`;window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(i)}`)}}}),Fg={class:"program-container"},Ng={class:"program-info"},Ug=["innerHTML"],$g={key:0,class:"program-info__broadcaster"},Gg=["src"],Vg={class:"program-info__broadcaster-container"},jg={class:"d-flex align-center"},Hg={class:"program-info__broadcaster-number"},qg={class:"program-info__broadcaster-name"},zg={class:"program-info__broadcaster-time"},Kg={class:"program-info__genre-container"},Wg={class:"mt-2"},Yg={class:"program-info__status"},Xg={class:"ml-2"},Jg={class:"program-detail-container"},Qg={class:"program-detail__heading"},Zg=["innerHTML"];function e0(a,e,t,n,i,s){const r=pn("Icon");return mt(),Lt("div",Fg,[je("section",Ng,[je("h1",{class:"program-info__title",innerHTML:a.ProgramUtils.decorateProgramInfo(a.playerStore.recorded_program,"title")},null,8,Ug),a.playerStore.recorded_program.channel!==null?(mt(),Lt("div",$g,[je("img",{class:"program-info__broadcaster-icon",src:`${a.Utils.api_base_url}/channels/${a.playerStore.recorded_program.channel.id}/logo`},null,8,Gg),je("div",Vg,[je("div",jg,[je("div",Hg,"Ch: "+Kt(a.playerStore.recorded_program.channel.channel_number),1),je("div",qg,Kt(a.playerStore.recorded_program.channel.name),1)]),je("div",zg,Kt(a.ProgramUtils.getProgramTime(a.playerStore.recorded_program)),1)])])):Bn("",!0),je("div",Kg,[(mt(!0),Lt(Xn,null,Yn(a.playerStore.recorded_program.genres??[],(d,u)=>(mt(),Lt("div",{class:"program-info__genre",key:u},Kt(d.major)+" / "+Kt(d.middle),1))),128))]),je("div",Wg,[je("div",Yg,[wt(r,{icon:"bi:chat-left-text-fill",height:"12.5px",style:{"margin-bottom":"-3px"}}),e[1]||(e[1]=je("span",{class:"ml-2"},"コメント数:",-1)),je("span",Xg,Kt(a.comment_count??"--"),1)])]),wt(vo,{class:"mt-4 px-3 py-0",style:{background:"#1d9BF0",height:"32px","border-radius":"6px","font-size":"13.5px"},onClick:e[0]||(e[0]=d=>a.shareToTwitter())},{default:an(()=>[wt(r,{icon:"fa-brands:twitter",height:"16px"}),e[2]||(e[2]=je("span",{class:"ml-1"},"Twitter でシェア",-1))]),_:1})]),je("section",Jg,[(mt(!0),Lt(Xn,null,Yn(a.playerStore.recorded_program.detail??{},(d,u)=>(mt(),Lt("div",{class:"program-detail",key:u},[je("h2",Qg,Kt(u),1),je("div",{class:"program-detail__text",innerHTML:a.Utils.URLtoLink(d)},null,8,Zg)]))),128))])])}const t0=fi(Bg,[["render",e0],["__scopeId","data-v-9ac26b48"]]),n0=zn({name:"Watch-Panel",components:{Channel:Lm,Comment:hg,Program:Mg,RecordedProgram:t0},props:{playback_mode:{type:String,required:!0}},data(){return{Utils:Object.freeze(Dt)}},computed:{...hi(ci,_n),panel_active_tab(){return this.playback_mode==="Live"?this.playerStore.tv_panel_active_tab:this.playerStore.video_panel_active_tab}}}),i0={class:"watch-panel__header"},r0={key:0,class:"panel-broadcaster"},s0=["src"],a0={class:"panel-broadcaster__number"},o0={class:"panel-broadcaster__name"},l0={class:"watch-panel__content-container"},d0={class:"watch-panel__navigation"};function c0(a,e,t,n,i,s){const r=pn("Icon"),d=pn("Program"),u=pn("RecordedProgram"),c=pn("Channel"),l=pn("Comment");return mt(),Lt("div",{class:"watch-panel",onMousemove:e[5]||(e[5]=h=>a.playerStore.event_emitter.emit("SetControlDisplayTimer",{event:h}))},[je("div",i0,[Tn((mt(),Lt("div",{class:"panel-close-button",onClick:e[0]||(e[0]=h=>a.playerStore.is_panel_display=!1)},[wt(r,{class:"panel-close-button__icon",icon:"akar-icons:chevron-right",width:"25px"}),e[6]||(e[6]=je("span",{class:"panel-close-button__text"},"閉じる",-1))])),[[xn]]),wt(Is),a.playback_mode==="Live"?(mt(),Lt("div",r0,[je("img",{class:"panel-broadcaster__icon",src:`${a.Utils.api_base_url}/channels/${a.channelsStore.channel.current.id}/logo`},null,8,s0),je("div",a0,Kt(a.channelsStore.channel.current.channel_number),1),je("div",o0,Kt(a.channelsStore.channel.current.name),1)])):Bn("",!0)]),je("div",l0,[a.playback_mode==="Live"?(mt(),On(d,{key:0,class:on(["watch-panel__content",{"watch-panel__content--active":a.panel_active_tab==="Program"}])},null,8,["class"])):Bn("",!0),a.playback_mode==="Video"?(mt(),On(u,{key:1,class:on(["watch-panel__content",{"watch-panel__content--active":a.panel_active_tab==="RecordedProgram"}])},null,8,["class"])):Bn("",!0),a.playback_mode==="Live"?(mt(),On(c,{key:2,class:on(["watch-panel__content",{"watch-panel__content--active":a.panel_active_tab==="Channel"}])},null,8,["class"])):Bn("",!0),wt(l,{class:on(["watch-panel__content",{"watch-panel__content--active":a.panel_active_tab==="Comment"}]),playback_mode:a.playback_mode},null,8,["playback_mode","class"])]),je("div",d0,[a.playback_mode==="Live"?Tn((mt(),Lt("div",{key:0,class:on(["panel-navigation-button",{"panel-navigation-button--active":a.panel_active_tab==="Program"}]),onClick:e[1]||(e[1]=h=>a.playerStore.tv_panel_active_tab="Program")},[wt(r,{class:"panel-navigation-button__icon",icon:"fa-solid:info-circle",width:"33px"}),e[7]||(e[7]=je("span",{class:"panel-navigation-button__text"},"情報",-1))],2)),[[xn]]):Bn("",!0),a.playback_mode==="Video"?Tn((mt(),Lt("div",{key:1,class:on(["panel-navigation-button",{"panel-navigation-button--active":a.panel_active_tab==="RecordedProgram"}]),onClick:e[2]||(e[2]=h=>a.playerStore.video_panel_active_tab="RecordedProgram")},[wt(r,{class:"panel-navigation-button__icon",icon:"fa-solid:info-circle",width:"33px"}),e[8]||(e[8]=je("span",{class:"panel-navigation-button__text"},"情報",-1))],2)),[[xn]]):Bn("",!0),a.playback_mode==="Live"?Tn((mt(),Lt("div",{key:2,class:on(["panel-navigation-button",{"panel-navigation-button--active":a.panel_active_tab==="Channel"}]),onClick:e[3]||(e[3]=h=>a.playerStore.tv_panel_active_tab="Channel")},[wt(r,{class:"panel-navigation-button__icon",icon:"fa-solid:broadcast-tower",width:"34px"}),e[9]||(e[9]=je("span",{class:"panel-navigation-button__text"},"チャンネル",-1))],2)),[[xn]]):Bn("",!0),Tn((mt(),Lt("div",{class:on(["panel-navigation-button",{"panel-navigation-button--active":a.panel_active_tab==="Comment"}]),onClick:e[4]||(e[4]=h=>a.playback_mode==="Live"?a.playerStore.tv_panel_active_tab="Comment":a.playerStore.video_panel_active_tab="Comment")},[wt(r,{class:"panel-navigation-button__icon",icon:"bi:chat-left-text-fill",width:"29px"}),e[10]||(e[10]=je("span",{class:"panel-navigation-button__text"},"コメント",-1))],2)),[[xn]])])],32)}const u0=fi(n0,[["render",c0],["__scopeId","data-v-618f120a"]]),h0=zn({name:"Watch-Player",props:{playback_mode:{type:String,required:!0}},data(){return{Utils:Object.freeze(Dt),time:jn().format(`YYYY/MM/DD
HH:mm:ss`),time_interval_id:0}},computed:{...hi(ci,_n,Mn)},created(){this.time_interval_id=window.setInterval(()=>{if(this.playerStore.recorded_program&&this.playerStore.recorded_program.id===-1){if(window.player&&window.player.video&&window.player.video.paused){this.time="〈コメント再生停止中〉";return}this.time=jn().format(`YYYY/MM/DD
HH:mm:ss`)}else if(this.playerStore.recorded_program){const a=window.player;a&&a.video&&(this.time=jn(this.playerStore.recorded_program.start_time).add(a.video.currentTime,"second").format(`YYYY/MM/DD
HH:mm:ss`))}},.1*1e3)},beforeUnmount(){window.clearInterval(this.time_interval_id)}}),f0={class:"watch-player__background-wrapper"},p0={class:"watch-player__background-text"};function m0(a,e,t,n,i,s){const r=pn("Icon"),d=bc("ftooltip");return mt(),Lt("div",{class:on(["watch-player",{"watch-player--loading":a.playerStore.is_loading,"watch-player--virtual-keyboard-display":a.playerStore.is_virtual_keyboard_display&&a.Utils.hasActiveElementClass("dplayer-comment-input"),"watch-player--video":a.playback_mode==="Video"}])},[je("div",f0,[je("div",{class:on(["watch-player__background",{"watch-player__background--display":a.playerStore.is_background_display,"watch-player__background--background-hide":a.settingsStore.settings.show_player_background_image===!1}]),style:ds({backgroundImage:`url(${a.playerStore.background_url})`})},[je("div",p0,Kt(a.time),1),e[6]||(e[6]=je("img",{class:"watch-player__background-logo",src:yp},null,-1))],6)]),wt(fp,{indeterminate:"",size:"60",width:"6",class:on(["watch-player__buffering",{"watch-player__buffering--display":a.playerStore.is_video_buffering}])},null,8,["class"]),e[7]||(e[7]=je("div",{class:"watch-player__dplayer"},null,-1)),je("div",{class:"watch-player__button",onMousemove:e[3]||(e[3]=u=>a.playerStore.event_emitter.emit("SetControlDisplayTimer",{event:u})),onTouchmove:e[4]||(e[4]=u=>a.playerStore.event_emitter.emit("SetControlDisplayTimer",{event:u})),onClick:e[5]||(e[5]=u=>a.playerStore.event_emitter.emit("SetControlDisplayTimer",{event:u}))},[a.playback_mode==="Live"?Tn((mt(),Lt("div",{key:0,class:"switch-button switch-button-up",onClick:e[0]||(e[0]=u=>{a.playerStore.is_zapping=!0,a.$router.push({path:`/watch/${a.channelsStore.channel.previous.display_channel_id}`})})},[wt(r,{class:"switch-button-icon",icon:"fluent:ios-arrow-left-24-filled",width:"32px",style:{transform:"rotate(90deg)"}})])),[[xn],[d,"前のチャンネル",void 0,{top:!0}]]):Bn("",!0),Tn((mt(),Lt("div",{class:on(["switch-button switch-button-panel",{"switch-button-panel--open":a.playerStore.is_panel_display}]),onClick:e[1]||(e[1]=u=>a.playerStore.is_panel_display=!a.playerStore.is_panel_display)},[wt(r,{class:"switch-button-icon",icon:"fluent:navigation-16-filled",width:"32px"})],2)),[[xn]]),a.playback_mode==="Live"?Tn((mt(),Lt("div",{key:1,class:"switch-button switch-button-down",onClick:e[2]||(e[2]=u=>{a.playerStore.is_zapping=!0,a.$router.push({path:`/watch/${a.channelsStore.channel.next.display_channel_id}`})})},[wt(r,{class:"switch-button-icon",icon:"fluent:ios-arrow-right-24-filled",width:"33px",style:{transform:"rotate(90deg)"}})])),[[xn],[d,"次のチャンネル",void 0,{bottom:!0}]]):Bn("",!0)],32)],2)}const g0=fi(h0,[["render",m0],["__scopeId","data-v-0a0ab654"]]),y0=zn({name:"Watch",components:{WatchHeader:qp,WatchNavigation:um,WatchPanel:u0,WatchPlayer:g0,KeyboardShortcutList:am},props:{playback_mode:{type:String,required:!0}},data(){return{Utils:Object.freeze(Dt)}},computed:{...hi(_n,Mn)},watch:{"playerStore.is_panel_display":{handler(){this.settingsStore.settings.showed_panel_last_time=this.playerStore.is_panel_display}}},created(){"virtualKeyboard"in navigator&&(navigator.virtualKeyboard.overlaysContent=!0,navigator.virtualKeyboard.ongeometrychange=a=>{a.target.boundingRect.width===0&&a.target.boundingRect.height===0?this.playerStore.is_virtual_keyboard_display=!1:this.playerStore.is_virtual_keyboard_display=!0}),this.playerStore.startWatching()},beforeUnmount(){this.playerStore.stopWatching(),"virtualKeyboard"in navigator&&(navigator.virtualKeyboard.overlaysContent=!1)}}),_0={class:"route-container"};function A0(a,e,t,n,i,s){const r=pn("WatchNavigation"),d=pn("WatchHeader"),u=pn("WatchPlayer"),c=pn("WatchPanel"),l=pn("KeyboardShortcutList");return mt(),Lt("div",_0,[je("main",{class:on(["watch-container",{"watch-container--control-display":a.playerStore.is_control_display,"watch-container--panel-display":a.Utils.isSmartphoneVertical()||a.Utils.isTabletVertical()?!0:a.playerStore.is_panel_display,"watch-container--fullscreen":a.playerStore.is_fullscreen,"watch-container--document-pip":a.playerStore.is_document_pip,"watch-container--video":a.playback_mode==="Video"}])},[wt(r),je("div",{class:"watch-content",onMousemove:e[0]||(e[0]=h=>a.playerStore.event_emitter.emit("SetControlDisplayTimer",{event:h,is_player_region_event:!0})),onTouchmove:e[1]||(e[1]=h=>a.playerStore.event_emitter.emit("SetControlDisplayTimer",{event:h,is_player_region_event:!0})),onClick:e[2]||(e[2]=h=>a.playerStore.event_emitter.emit("SetControlDisplayTimer",{event:h,is_player_region_event:!0}))},[wt(d,{playback_mode:a.playback_mode},null,8,["playback_mode"]),wt(u,{playback_mode:a.playback_mode},null,8,["playback_mode"])],32),wt(c,{playback_mode:a.playback_mode},null,8,["playback_mode"])],2),wt(l,{playback_mode:a.playback_mode},null,8,["playback_mode"])])}const JS=fi(y0,[["render",A0],["__scopeId","data-v-092f3824"]]);var qs={exports:{}},zs={},ir={},Nc={},wo=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),n=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;e[t]=i;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var r=Object.getOwnPropertySymbols(e);if(r.length!==1||r[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var d=Object.getOwnPropertyDescriptor(e,t);if(d.value!==i||d.enumerable!==!0)return!1}return!0},v0=wo,Ls=function(){return v0()&&!!Symbol.toStringTag},ko=Object,b0=Error,S0=EvalError,E0=RangeError,T0=ReferenceError,Uc=SyntaxError,Cr=TypeError,x0=URIError,C0=Math.abs,w0=Math.floor,k0=Math.max,R0=Math.min,I0=Math.pow,L0=Math.round,D0=Number.isNaN||function(e){return e!==e},P0=D0,O0=function(e){return P0(e)||e===0?e:e<0?-1:1},M0=Object.getOwnPropertyDescriptor,Wr=M0;if(Wr)try{Wr([],"length")}catch{Wr=null}var lr=Wr,Yr=Object.defineProperty||!1;if(Yr)try{Yr({},"a",{value:1})}catch{Yr=!1}var Ds=Yr,Ks,fl;function B0(){if(fl)return Ks;fl=1;var a=typeof Symbol<"u"&&Symbol,e=wo;return Ks=function(){return typeof a!="function"||typeof Symbol!="function"||typeof a("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},Ks}var Ws,pl;function $c(){return pl||(pl=1,Ws=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Ws}var Ys,ml;function Gc(){if(ml)return Ys;ml=1;var a=ko;return Ys=a.getPrototypeOf||null,Ys}var Xs,gl;function F0(){if(gl)return Xs;gl=1;var a="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,n="[object Function]",i=function(u,c){for(var l=[],h=0;h<u.length;h+=1)l[h]=u[h];for(var o=0;o<c.length;o+=1)l[o+u.length]=c[o];return l},s=function(u,c){for(var l=[],h=c,o=0;h<u.length;h+=1,o+=1)l[o]=u[h];return l},r=function(d,u){for(var c="",l=0;l<d.length;l+=1)c+=d[l],l+1<d.length&&(c+=u);return c};return Xs=function(u){var c=this;if(typeof c!="function"||e.apply(c)!==n)throw new TypeError(a+c);for(var l=s(arguments,1),h,o=function(){if(this instanceof h){var _=c.apply(this,i(l,arguments));return Object(_)===_?_:this}return c.apply(u,i(l,arguments))},f=t(0,c.length-l.length),p=[],m=0;m<f;m++)p[m]="$"+m;if(h=Function("binder","return function ("+r(p,",")+"){ return binder.apply(this,arguments); }")(o),c.prototype){var y=function(){};y.prototype=c.prototype,h.prototype=new y,y.prototype=null}return h},Xs}var Js,yl;function wr(){if(yl)return Js;yl=1;var a=F0();return Js=Function.prototype.bind||a,Js}var Qs,_l;function Ro(){return _l||(_l=1,Qs=Function.prototype.call),Qs}var Zs,Al;function Io(){return Al||(Al=1,Zs=Function.prototype.apply),Zs}var N0=typeof Reflect<"u"&&Reflect&&Reflect.apply,U0=wr(),$0=Io(),G0=Ro(),V0=N0,Vc=V0||U0.call(G0,$0),j0=wr(),H0=Cr,q0=Ro(),z0=Vc,Lo=function(e){if(e.length<1||typeof e[0]!="function")throw new H0("a function is required");return z0(j0,q0,e)},ea,vl;function K0(){if(vl)return ea;vl=1;var a=Lo,e=lr,t;try{t=[].__proto__===Array.prototype}catch(r){if(!r||typeof r!="object"||!("code"in r)||r.code!=="ERR_PROTO_ACCESS")throw r}var n=!!t&&e&&e(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return ea=n&&typeof n.get=="function"?a([n.get]):typeof s=="function"?function(d){return s(d==null?d:i(d))}:!1,ea}var ta,bl;function jc(){if(bl)return ta;bl=1;var a=$c(),e=Gc(),t=K0();return ta=a?function(i){return a(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:t?function(i){return t(i)}:null,ta}var na,Sl;function Hc(){if(Sl)return na;Sl=1;var a=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=wr();return na=t.call(a,e),na}var zt,W0=ko,Y0=b0,X0=S0,J0=E0,Q0=T0,rr=Uc,Zi=Cr,Z0=x0,ey=C0,ty=w0,ny=k0,iy=R0,ry=I0,sy=L0,ay=O0,qc=Function,ia=function(a){try{return qc('"use strict"; return ('+a+").constructor;")()}catch{}},yr=lr,oy=Ds,ra=function(){throw new Zi},ly=yr?function(){try{return arguments.callee,ra}catch{try{return yr(arguments,"callee").get}catch{return ra}}}():ra,Gi=B0()(),Dn=jc(),dy=Gc(),cy=$c(),zc=Io(),kr=Ro(),Ki={},uy=typeof Uint8Array>"u"||!Dn?zt:Dn(Uint8Array),Fi={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?zt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?zt:ArrayBuffer,"%ArrayIteratorPrototype%":Gi&&Dn?Dn([][Symbol.iterator]()):zt,"%AsyncFromSyncIteratorPrototype%":zt,"%AsyncFunction%":Ki,"%AsyncGenerator%":Ki,"%AsyncGeneratorFunction%":Ki,"%AsyncIteratorPrototype%":Ki,"%Atomics%":typeof Atomics>"u"?zt:Atomics,"%BigInt%":typeof BigInt>"u"?zt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?zt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?zt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?zt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Y0,"%eval%":eval,"%EvalError%":X0,"%Float32Array%":typeof Float32Array>"u"?zt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?zt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?zt:FinalizationRegistry,"%Function%":qc,"%GeneratorFunction%":Ki,"%Int8Array%":typeof Int8Array>"u"?zt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?zt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?zt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Gi&&Dn?Dn(Dn([][Symbol.iterator]())):zt,"%JSON%":typeof JSON=="object"?JSON:zt,"%Map%":typeof Map>"u"?zt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Gi||!Dn?zt:Dn(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":W0,"%Object.getOwnPropertyDescriptor%":yr,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?zt:Promise,"%Proxy%":typeof Proxy>"u"?zt:Proxy,"%RangeError%":J0,"%ReferenceError%":Q0,"%Reflect%":typeof Reflect>"u"?zt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?zt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Gi||!Dn?zt:Dn(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?zt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Gi&&Dn?Dn(""[Symbol.iterator]()):zt,"%Symbol%":Gi?Symbol:zt,"%SyntaxError%":rr,"%ThrowTypeError%":ly,"%TypedArray%":uy,"%TypeError%":Zi,"%Uint8Array%":typeof Uint8Array>"u"?zt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?zt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?zt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?zt:Uint32Array,"%URIError%":Z0,"%WeakMap%":typeof WeakMap>"u"?zt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?zt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?zt:WeakSet,"%Function.prototype.call%":kr,"%Function.prototype.apply%":zc,"%Object.defineProperty%":oy,"%Object.getPrototypeOf%":dy,"%Math.abs%":ey,"%Math.floor%":ty,"%Math.max%":ny,"%Math.min%":iy,"%Math.pow%":ry,"%Math.round%":sy,"%Math.sign%":ay,"%Reflect.getPrototypeOf%":cy};if(Dn)try{null.error}catch(a){var hy=Dn(Dn(a));Fi["%Error.prototype%"]=hy}var fy=function a(e){var t;if(e==="%AsyncFunction%")t=ia("async function () {}");else if(e==="%GeneratorFunction%")t=ia("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=ia("async function* () {}");else if(e==="%AsyncGenerator%"){var n=a("%AsyncGeneratorFunction%");n&&(t=n.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=a("%AsyncGenerator%");i&&Dn&&(t=Dn(i.prototype))}return Fi[e]=t,t},El={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Rr=wr(),fs=Hc(),py=Rr.call(kr,Array.prototype.concat),my=Rr.call(zc,Array.prototype.splice),Tl=Rr.call(kr,String.prototype.replace),ps=Rr.call(kr,String.prototype.slice),gy=Rr.call(kr,RegExp.prototype.exec),yy=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,_y=/\\(\\)?/g,Ay=function(e){var t=ps(e,0,1),n=ps(e,-1);if(t==="%"&&n!=="%")throw new rr("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&t!=="%")throw new rr("invalid intrinsic syntax, expected opening `%`");var i=[];return Tl(e,yy,function(s,r,d,u){i[i.length]=d?Tl(u,_y,"$1"):r||s}),i},vy=function(e,t){var n=e,i;if(fs(El,n)&&(i=El[n],n="%"+i[0]+"%"),fs(Fi,n)){var s=Fi[n];if(s===Ki&&(s=fy(n)),typeof s>"u"&&!t)throw new Zi("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:s}}throw new rr("intrinsic "+e+" does not exist!")},Do=function(e,t){if(typeof e!="string"||e.length===0)throw new Zi("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new Zi('"allowMissing" argument must be a boolean');if(gy(/^%?[^%]*%?$/,e)===null)throw new rr("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=Ay(e),i=n.length>0?n[0]:"",s=vy("%"+i+"%",t),r=s.name,d=s.value,u=!1,c=s.alias;c&&(i=c[0],my(n,py([0,1],c)));for(var l=1,h=!0;l<n.length;l+=1){var o=n[l],f=ps(o,0,1),p=ps(o,-1);if((f==='"'||f==="'"||f==="`"||p==='"'||p==="'"||p==="`")&&f!==p)throw new rr("property names with quotes must have matching quotes");if((o==="constructor"||!h)&&(u=!0),i+="."+o,r="%"+i+"%",fs(Fi,r))d=Fi[r];else if(d!=null){if(!(o in d)){if(!t)throw new Zi("base intrinsic for "+e+" exists, but the property is not available.");return}if(yr&&l+1>=n.length){var m=yr(d,o);h=!!m,h&&"get"in m&&!("originalValue"in m.get)?d=m.get:d=d[o]}else h=fs(d,o),d=d[o];h&&!u&&(Fi[r]=d)}}return d},Kc=Do,Wc=Lo,by=Wc([Kc("%String.prototype.indexOf%")]),dr=function(e,t){var n=Kc(e,!!t);return typeof n=="function"&&by(e,".prototype.")>-1?Wc([n]):n},Sy=Ls(),Ey=dr,za=Ey("Object.prototype.toString"),Ps=function(e){return Sy&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:za(e)==="[object Arguments]"},Yc=function(e){return Ps(e)?!0:e!==null&&typeof e=="object"&&"length"in e&&typeof e.length=="number"&&e.length>=0&&za(e)!=="[object Array]"&&"callee"in e&&za(e.callee)==="[object Function]"},Ty=function(){return Ps(arguments)}();Ps.isLegacyArguments=Yc;var xy=Ty?Ps:Yc,xl=dr,Cy=Ls(),wy=Hc(),ky=lr,Ka;if(Cy){var Ry=xl("RegExp.prototype.exec"),Cl={},sa=function(){throw Cl},wl={toString:sa,valueOf:sa};typeof Symbol.toPrimitive=="symbol"&&(wl[Symbol.toPrimitive]=sa),Ka=function(e){if(!e||typeof e!="object")return!1;var t=ky(e,"lastIndex"),n=t&&wy(t,"value");if(!n)return!1;try{Ry(e,wl)}catch(i){return i===Cl}}}else{var Iy=xl("Object.prototype.toString"),Ly="[object RegExp]";Ka=function(e){return!e||typeof e!="object"&&typeof e!="function"?!1:Iy(e)===Ly}}var Dy=Ka,Py=dr,Oy=Dy,My=Py("RegExp.prototype.exec"),By=Cr,Fy=function(e){if(!Oy(e))throw new By("`regex` must be a RegExp");return function(n){return My(e,n)!==null}},Xc=dr,Ny=Fy,Uy=Ny(/^\s*(?:function)?\*/),Jc=Ls(),aa=jc(),$y=Xc("Object.prototype.toString"),Gy=Xc("Function.prototype.toString"),Vy=function(){if(!Jc)return!1;try{return Function("return function*() {}")()}catch{}},oa,jy=function(e){if(typeof e!="function")return!1;if(Uy(Gy(e)))return!0;if(!Jc){var t=$y(e);return t==="[object GeneratorFunction]"}if(!aa)return!1;if(typeof oa>"u"){var n=Vy();oa=n?aa(n):!1}return aa(e)===oa},Qc=Function.prototype.toString,Yi=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Wa,Xr;if(typeof Yi=="function"&&typeof Object.defineProperty=="function")try{Wa=Object.defineProperty({},"length",{get:function(){throw Xr}}),Xr={},Yi(function(){throw 42},null,Wa)}catch(a){a!==Xr&&(Yi=null)}else Yi=null;var Hy=/^\s*class\b/,Ya=function(e){try{var t=Qc.call(e);return Hy.test(t)}catch{return!1}},la=function(e){try{return Ya(e)?!1:(Qc.call(e),!0)}catch{return!1}},Jr=Object.prototype.toString,qy="[object Object]",zy="[object Function]",Ky="[object GeneratorFunction]",Wy="[object HTMLAllCollection]",Yy="[object HTML document.all class]",Xy="[object HTMLCollection]",Jy=typeof Symbol=="function"&&!!Symbol.toStringTag,Qy=!(0 in[,]),Xa=function(){return!1};if(typeof document=="object"){var Zy=document.all;Jr.call(Zy)===Jr.call(document.all)&&(Xa=function(e){if((Qy||!e)&&(typeof e>"u"||typeof e=="object"))try{var t=Jr.call(e);return(t===Wy||t===Yy||t===Xy||t===qy)&&e("")==null}catch{}return!1})}var e_=Yi?function(e){if(Xa(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{Yi(e,null,Wa)}catch(t){if(t!==Xr)return!1}return!Ya(e)&&la(e)}:function(e){if(Xa(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(Jy)return la(e);if(Ya(e))return!1;var t=Jr.call(e);return t!==zy&&t!==Ky&&!/^\[object HTML/.test(t)?!1:la(e)},t_=e_,n_=Object.prototype.toString,Zc=Object.prototype.hasOwnProperty,i_=function(e,t,n){for(var i=0,s=e.length;i<s;i++)Zc.call(e,i)&&(n==null?t(e[i],i,e):t.call(n,e[i],i,e))},r_=function(e,t,n){for(var i=0,s=e.length;i<s;i++)n==null?t(e.charAt(i),i,e):t.call(n,e.charAt(i),i,e)},s_=function(e,t,n){for(var i in e)Zc.call(e,i)&&(n==null?t(e[i],i,e):t.call(n,e[i],i,e))},a_=function(e,t,n){if(!t_(t))throw new TypeError("iterator must be a function");var i;arguments.length>=3&&(i=n),n_.call(e)==="[object Array]"?i_(e,t,i):typeof e=="string"?r_(e,t,i):s_(e,t,i)},o_=a_,l_=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],da=l_,d_=typeof globalThis>"u"?So:globalThis,c_=function(){for(var e=[],t=0;t<da.length;t++)typeof d_[da[t]]=="function"&&(e[e.length]=da[t]);return e},eu={exports:{}},kl=Ds,u_=Uc,Vi=Cr,Rl=lr,tu=function(e,t,n){if(!e||typeof e!="object"&&typeof e!="function")throw new Vi("`obj` must be an object or a function`");if(typeof t!="string"&&typeof t!="symbol")throw new Vi("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Vi("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Vi("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Vi("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Vi("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,r=arguments.length>5?arguments[5]:null,d=arguments.length>6?arguments[6]:!1,u=!!Rl&&Rl(e,t);if(kl)kl(e,t,{configurable:r===null&&u?u.configurable:!r,enumerable:i===null&&u?u.enumerable:!i,value:n,writable:s===null&&u?u.writable:!s});else if(d||!i&&!s&&!r)e[t]=n;else throw new u_("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Ja=Ds,nu=function(){return!!Ja};nu.hasArrayLengthDefineBug=function(){if(!Ja)return null;try{return Ja([],"length",{value:1}).length!==1}catch{return!0}};var iu=nu,h_=Do,Il=tu,f_=iu(),Ll=lr,Dl=Cr,p_=h_("%Math.floor%"),m_=function(e,t){if(typeof e!="function")throw new Dl("`fn` is not a function");if(typeof t!="number"||t<0||t>4294967295||p_(t)!==t)throw new Dl("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],i=!0,s=!0;if("length"in e&&Ll){var r=Ll(e,"length");r&&!r.configurable&&(i=!1),r&&!r.writable&&(s=!1)}return(i||s||!n)&&(f_?Il(e,"length",t,!0,!0):Il(e,"length",t)),e},g_=wr(),y_=Io(),__=Vc,A_=function(){return __(g_,y_,arguments)};(function(a){var e=m_,t=Ds,n=Lo,i=A_;a.exports=function(r){var d=n(arguments),u=r.length-(arguments.length-1);return e(d,1+(u>0?u:0),!0)},t?t(a.exports,"apply",{value:i}):a.exports.apply=i})(eu);var Os=eu.exports,ms=o_,v_=c_,Pl=Os,Po=dr,Qr=lr,b_=Po("Object.prototype.toString"),ru=Ls(),Ol=typeof globalThis>"u"?So:globalThis,Qa=v_(),Oo=Po("String.prototype.slice"),ca=Object.getPrototypeOf,S_=Po("Array.prototype.indexOf",!0)||function(e,t){for(var n=0;n<e.length;n+=1)if(e[n]===t)return n;return-1},gs={__proto__:null};ru&&Qr&&ca?ms(Qa,function(a){var e=new Ol[a];if(Symbol.toStringTag in e){var t=ca(e),n=Qr(t,Symbol.toStringTag);if(!n){var i=ca(t);n=Qr(i,Symbol.toStringTag)}gs["$"+a]=Pl(n.get)}}):ms(Qa,function(a){var e=new Ol[a],t=e.slice||e.set;t&&(gs["$"+a]=Pl(t))});var E_=function(e){var t=!1;return ms(gs,function(n,i){if(!t)try{"$"+n(e)===i&&(t=Oo(i,1))}catch{}}),t},T_=function(e){var t=!1;return ms(gs,function(n,i){if(!t)try{n(e),t=Oo(i,1)}catch{}}),t},su=function(e){if(!e||typeof e!="object")return!1;if(!ru){var t=Oo(b_(e),8,-1);return S_(Qa,t)>-1?t:t!=="Object"?!1:T_(e)}return Qr?E_(e):null},x_=su,C_=function(e){return!!x_(e)};(function(a){var e=xy,t=jy,n=su,i=C_;function s(xe){return xe.call.bind(xe)}var r=typeof BigInt<"u",d=typeof Symbol<"u",u=s(Object.prototype.toString),c=s(Number.prototype.valueOf),l=s(String.prototype.valueOf),h=s(Boolean.prototype.valueOf);if(r)var o=s(BigInt.prototype.valueOf);if(d)var f=s(Symbol.prototype.valueOf);function p(xe,ht){if(typeof xe!="object")return!1;try{return ht(xe),!0}catch{return!1}}a.isArgumentsObject=e,a.isGeneratorFunction=t,a.isTypedArray=i;function m(xe){return typeof Promise<"u"&&xe instanceof Promise||xe!==null&&typeof xe=="object"&&typeof xe.then=="function"&&typeof xe.catch=="function"}a.isPromise=m;function y(xe){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(xe):i(xe)||R(xe)}a.isArrayBufferView=y;function _(xe){return n(xe)==="Uint8Array"}a.isUint8Array=_;function S(xe){return n(xe)==="Uint8ClampedArray"}a.isUint8ClampedArray=S;function b(xe){return n(xe)==="Uint16Array"}a.isUint16Array=b;function x(xe){return n(xe)==="Uint32Array"}a.isUint32Array=x;function L(xe){return n(xe)==="Int8Array"}a.isInt8Array=L;function N(xe){return n(xe)==="Int16Array"}a.isInt16Array=N;function P(xe){return n(xe)==="Int32Array"}a.isInt32Array=P;function T(xe){return n(xe)==="Float32Array"}a.isFloat32Array=T;function k(xe){return n(xe)==="Float64Array"}a.isFloat64Array=k;function I(xe){return n(xe)==="BigInt64Array"}a.isBigInt64Array=I;function F(xe){return n(xe)==="BigUint64Array"}a.isBigUint64Array=F;function V(xe){return u(xe)==="[object Map]"}V.working=typeof Map<"u"&&V(new Map);function ne(xe){return typeof Map>"u"?!1:V.working?V(xe):xe instanceof Map}a.isMap=ne;function te(xe){return u(xe)==="[object Set]"}te.working=typeof Set<"u"&&te(new Set);function Z(xe){return typeof Set>"u"?!1:te.working?te(xe):xe instanceof Set}a.isSet=Z;function Q(xe){return u(xe)==="[object WeakMap]"}Q.working=typeof WeakMap<"u"&&Q(new WeakMap);function he(xe){return typeof WeakMap>"u"?!1:Q.working?Q(xe):xe instanceof WeakMap}a.isWeakMap=he;function de(xe){return u(xe)==="[object WeakSet]"}de.working=typeof WeakSet<"u"&&de(new WeakSet);function M(xe){return de(xe)}a.isWeakSet=M;function A(xe){return u(xe)==="[object ArrayBuffer]"}A.working=typeof ArrayBuffer<"u"&&A(new ArrayBuffer);function v(xe){return typeof ArrayBuffer>"u"?!1:A.working?A(xe):xe instanceof ArrayBuffer}a.isArrayBuffer=v;function w(xe){return u(xe)==="[object DataView]"}w.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&w(new DataView(new ArrayBuffer(1),0,1));function R(xe){return typeof DataView>"u"?!1:w.working?w(xe):xe instanceof DataView}a.isDataView=R;var C=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function O(xe){return u(xe)==="[object SharedArrayBuffer]"}function G(xe){return typeof C>"u"?!1:(typeof O.working>"u"&&(O.working=O(new C)),O.working?O(xe):xe instanceof C)}a.isSharedArrayBuffer=G;function z(xe){return u(xe)==="[object AsyncFunction]"}a.isAsyncFunction=z;function Y(xe){return u(xe)==="[object Map Iterator]"}a.isMapIterator=Y;function ie(xe){return u(xe)==="[object Set Iterator]"}a.isSetIterator=ie;function se(xe){return u(xe)==="[object Generator]"}a.isGeneratorObject=se;function Se(xe){return u(xe)==="[object WebAssembly.Module]"}a.isWebAssemblyCompiledModule=Se;function we(xe){return p(xe,c)}a.isNumberObject=we;function Pe(xe){return p(xe,l)}a.isStringObject=Pe;function Ge(xe){return p(xe,h)}a.isBooleanObject=Ge;function it(xe){return r&&p(xe,o)}a.isBigIntObject=it;function Ie(xe){return d&&p(xe,f)}a.isSymbolObject=Ie;function rt(xe){return we(xe)||Pe(xe)||Ge(xe)||it(xe)||Ie(xe)}a.isBoxedPrimitive=rt;function tt(xe){return typeof Uint8Array<"u"&&(v(xe)||G(xe))}a.isAnyArrayBuffer=tt,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(xe){Object.defineProperty(a,xe,{enumerable:!1,value:function(){throw new Error(xe+" is not supported in userland")}})})})(Nc);var w_=function(e){return e&&typeof e=="object"&&typeof e.copy=="function"&&typeof e.fill=="function"&&typeof e.readUInt8=="function"},Za={exports:{}};typeof Object.create=="function"?Za.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:Za.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}};var k_=Za.exports;(function(a){var e={},t=Object.getOwnPropertyDescriptors||function(C){for(var O=Object.keys(C),G={},z=0;z<O.length;z++)G[O[z]]=Object.getOwnPropertyDescriptor(C,O[z]);return G},n=/%[sdj%]/g;a.format=function(R){if(!N(R)){for(var C=[],O=0;O<arguments.length;O++)C.push(d(arguments[O]));return C.join(" ")}for(var O=1,G=arguments,z=G.length,Y=String(R).replace(n,function(se){if(se==="%%")return"%";if(O>=z)return se;switch(se){case"%s":return String(G[O++]);case"%d":return Number(G[O++]);case"%j":try{return JSON.stringify(G[O++])}catch{return"[Circular]"}default:return se}}),ie=G[O];O<z;ie=G[++O])b(ie)||!I(ie)?Y+=" "+ie:Y+=" "+d(ie);return Y},a.deprecate=function(R,C){if(typeof process<"u"&&process.noDeprecation===!0)return R;if(typeof process>"u")return function(){return a.deprecate(R,C).apply(this,arguments)};var O=!1;function G(){if(!O){if(process.throwDeprecation)throw new Error(C);process.traceDeprecation?console.trace(C):console.error(C),O=!0}return R.apply(this,arguments)}return G};var i={},s=/^$/;if(e.NODE_DEBUG){var r=e.NODE_DEBUG;r=r.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),s=new RegExp("^"+r+"$","i")}a.debuglog=function(R){if(R=R.toUpperCase(),!i[R])if(s.test(R)){var C=process.pid;i[R]=function(){var O=a.format.apply(a,arguments);console.error("%s %d: %s",R,C,O)}}else i[R]=function(){};return i[R]};function d(R,C){var O={seen:[],stylize:c};return arguments.length>=3&&(O.depth=arguments[2]),arguments.length>=4&&(O.colors=arguments[3]),S(C)?O.showHidden=C:C&&a._extend(O,C),T(O.showHidden)&&(O.showHidden=!1),T(O.depth)&&(O.depth=2),T(O.colors)&&(O.colors=!1),T(O.customInspect)&&(O.customInspect=!0),O.colors&&(O.stylize=u),h(O,R,O.depth)}a.inspect=d,d.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},d.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function u(R,C){var O=d.styles[C];return O?"\x1B["+d.colors[O][0]+"m"+R+"\x1B["+d.colors[O][1]+"m":R}function c(R,C){return R}function l(R){var C={};return R.forEach(function(O,G){C[O]=!0}),C}function h(R,C,O){if(R.customInspect&&C&&ne(C.inspect)&&C.inspect!==a.inspect&&!(C.constructor&&C.constructor.prototype===C)){var G=C.inspect(O,R);return N(G)||(G=h(R,G,O)),G}var z=o(R,C);if(z)return z;var Y=Object.keys(C),ie=l(Y);if(R.showHidden&&(Y=Object.getOwnPropertyNames(C)),V(C)&&(Y.indexOf("message")>=0||Y.indexOf("description")>=0))return f(C);if(Y.length===0){if(ne(C)){var se=C.name?": "+C.name:"";return R.stylize("[Function"+se+"]","special")}if(k(C))return R.stylize(RegExp.prototype.toString.call(C),"regexp");if(F(C))return R.stylize(Date.prototype.toString.call(C),"date");if(V(C))return f(C)}var Se="",we=!1,Pe=["{","}"];if(_(C)&&(we=!0,Pe=["[","]"]),ne(C)){var Ge=C.name?": "+C.name:"";Se=" [Function"+Ge+"]"}if(k(C)&&(Se=" "+RegExp.prototype.toString.call(C)),F(C)&&(Se=" "+Date.prototype.toUTCString.call(C)),V(C)&&(Se=" "+f(C)),Y.length===0&&(!we||C.length==0))return Pe[0]+Se+Pe[1];if(O<0)return k(C)?R.stylize(RegExp.prototype.toString.call(C),"regexp"):R.stylize("[Object]","special");R.seen.push(C);var it;return we?it=p(R,C,O,ie,Y):it=Y.map(function(Ie){return m(R,C,O,ie,Ie,we)}),R.seen.pop(),y(it,Se,Pe)}function o(R,C){if(T(C))return R.stylize("undefined","undefined");if(N(C)){var O="'"+JSON.stringify(C).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return R.stylize(O,"string")}if(L(C))return R.stylize(""+C,"number");if(S(C))return R.stylize(""+C,"boolean");if(b(C))return R.stylize("null","null")}function f(R){return"["+Error.prototype.toString.call(R)+"]"}function p(R,C,O,G,z){for(var Y=[],ie=0,se=C.length;ie<se;++ie)M(C,String(ie))?Y.push(m(R,C,O,G,String(ie),!0)):Y.push("");return z.forEach(function(Se){Se.match(/^\d+$/)||Y.push(m(R,C,O,G,Se,!0))}),Y}function m(R,C,O,G,z,Y){var ie,se,Se;if(Se=Object.getOwnPropertyDescriptor(C,z)||{value:C[z]},Se.get?Se.set?se=R.stylize("[Getter/Setter]","special"):se=R.stylize("[Getter]","special"):Se.set&&(se=R.stylize("[Setter]","special")),M(G,z)||(ie="["+z+"]"),se||(R.seen.indexOf(Se.value)<0?(b(O)?se=h(R,Se.value,null):se=h(R,Se.value,O-1),se.indexOf(`
`)>-1&&(Y?se=se.split(`
`).map(function(we){return"  "+we}).join(`
`).slice(2):se=`
`+se.split(`
`).map(function(we){return"   "+we}).join(`
`))):se=R.stylize("[Circular]","special")),T(ie)){if(Y&&z.match(/^\d+$/))return se;ie=JSON.stringify(""+z),ie.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(ie=ie.slice(1,-1),ie=R.stylize(ie,"name")):(ie=ie.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),ie=R.stylize(ie,"string"))}return ie+": "+se}function y(R,C,O){var G=R.reduce(function(z,Y){return Y.indexOf(`
`)>=0,z+Y.replace(/\u001b\[\d\d?m/g,"").length+1},0);return G>60?O[0]+(C===""?"":C+`
 `)+" "+R.join(`,
  `)+" "+O[1]:O[0]+C+" "+R.join(", ")+" "+O[1]}a.types=Nc;function _(R){return Array.isArray(R)}a.isArray=_;function S(R){return typeof R=="boolean"}a.isBoolean=S;function b(R){return R===null}a.isNull=b;function x(R){return R==null}a.isNullOrUndefined=x;function L(R){return typeof R=="number"}a.isNumber=L;function N(R){return typeof R=="string"}a.isString=N;function P(R){return typeof R=="symbol"}a.isSymbol=P;function T(R){return R===void 0}a.isUndefined=T;function k(R){return I(R)&&Z(R)==="[object RegExp]"}a.isRegExp=k,a.types.isRegExp=k;function I(R){return typeof R=="object"&&R!==null}a.isObject=I;function F(R){return I(R)&&Z(R)==="[object Date]"}a.isDate=F,a.types.isDate=F;function V(R){return I(R)&&(Z(R)==="[object Error]"||R instanceof Error)}a.isError=V,a.types.isNativeError=V;function ne(R){return typeof R=="function"}a.isFunction=ne;function te(R){return R===null||typeof R=="boolean"||typeof R=="number"||typeof R=="string"||typeof R=="symbol"||typeof R>"u"}a.isPrimitive=te,a.isBuffer=w_;function Z(R){return Object.prototype.toString.call(R)}function Q(R){return R<10?"0"+R.toString(10):R.toString(10)}var he=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function de(){var R=new Date,C=[Q(R.getHours()),Q(R.getMinutes()),Q(R.getSeconds())].join(":");return[R.getDate(),he[R.getMonth()],C].join(" ")}a.log=function(){console.log("%s - %s",de(),a.format.apply(a,arguments))},a.inherits=k_,a._extend=function(R,C){if(!C||!I(C))return R;for(var O=Object.keys(C),G=O.length;G--;)R[O[G]]=C[O[G]];return R};function M(R,C){return Object.prototype.hasOwnProperty.call(R,C)}var A=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;a.promisify=function(C){if(typeof C!="function")throw new TypeError('The "original" argument must be of type Function');if(A&&C[A]){var O=C[A];if(typeof O!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(O,A,{value:O,enumerable:!1,writable:!1,configurable:!0}),O}function O(){for(var G,z,Y=new Promise(function(Se,we){G=Se,z=we}),ie=[],se=0;se<arguments.length;se++)ie.push(arguments[se]);ie.push(function(Se,we){Se?z(Se):G(we)});try{C.apply(this,ie)}catch(Se){z(Se)}return Y}return Object.setPrototypeOf(O,Object.getPrototypeOf(C)),A&&Object.defineProperty(O,A,{value:O,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(O,t(C))},a.promisify.custom=A;function v(R,C){if(!R){var O=new Error("Promise was rejected with a falsy value");O.reason=R,R=O}return C(R)}function w(R){if(typeof R!="function")throw new TypeError('The "original" argument must be of type Function');function C(){for(var O=[],G=0;G<arguments.length;G++)O.push(arguments[G]);var z=O.pop();if(typeof z!="function")throw new TypeError("The last argument must be of type Function");var Y=this,ie=function(){return z.apply(Y,arguments)};R.apply(this,O).then(function(se){process.nextTick(ie.bind(null,null,se))},function(se){process.nextTick(v.bind(null,se,ie))})}return Object.setPrototypeOf(C,Object.getPrototypeOf(R)),Object.defineProperties(C,t(R)),C}a.callbackify=w})(ir);var Ml;function au(){if(Ml)return zs;Ml=1;function a(S){"@babel/helpers - typeof";return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},a(S)}function e(S,b,x){return Object.defineProperty(S,"prototype",{writable:!1}),S}function t(S,b){if(!(S instanceof b))throw new TypeError("Cannot call a class as a function")}function n(S,b){if(typeof b!="function"&&b!==null)throw new TypeError("Super expression must either be null or a function");S.prototype=Object.create(b&&b.prototype,{constructor:{value:S,writable:!0,configurable:!0}}),Object.defineProperty(S,"prototype",{writable:!1}),b&&i(S,b)}function i(S,b){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(L,N){return L.__proto__=N,L},i(S,b)}function s(S){var b=u();return function(){var L=c(S),N;if(b){var P=c(this).constructor;N=Reflect.construct(L,arguments,P)}else N=L.apply(this,arguments);return r(this,N)}}function r(S,b){if(b&&(a(b)==="object"||typeof b=="function"))return b;if(b!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return d(S)}function d(S){if(S===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S}function u(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function c(S){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(x){return x.__proto__||Object.getPrototypeOf(x)},c(S)}var l={},h,o;function f(S,b,x){x||(x=Error);function L(P,T,k){return typeof b=="string"?b:b(P,T,k)}var N=function(P){n(k,P);var T=s(k);function k(I,F,V){var ne;return t(this,k),ne=T.call(this,L(I,F,V)),ne.code=S,ne}return e(k)}(x);l[S]=N}function p(S,b){if(Array.isArray(S)){var x=S.length;return S=S.map(function(L){return String(L)}),x>2?"one of ".concat(b," ").concat(S.slice(0,x-1).join(", "),", or ")+S[x-1]:x===2?"one of ".concat(b," ").concat(S[0]," or ").concat(S[1]):"of ".concat(b," ").concat(S[0])}else return"of ".concat(b," ").concat(String(S))}function m(S,b,x){return S.substr(0,b.length)===b}function y(S,b,x){return(x===void 0||x>S.length)&&(x=S.length),S.substring(x-b.length,x)===b}function _(S,b,x){return typeof x!="number"&&(x=0),x+b.length>S.length?!1:S.indexOf(b,x)!==-1}return f("ERR_AMBIGUOUS_ARGUMENT",'The "%s" argument is ambiguous. %s',TypeError),f("ERR_INVALID_ARG_TYPE",function(S,b,x){h===void 0&&(h=eo()),h(typeof S=="string","'name' must be a string");var L;typeof b=="string"&&m(b,"not ")?(L="must not be",b=b.replace(/^not /,"")):L="must be";var N;if(y(S," argument"))N="The ".concat(S," ").concat(L," ").concat(p(b,"type"));else{var P=_(S,".")?"property":"argument";N='The "'.concat(S,'" ').concat(P," ").concat(L," ").concat(p(b,"type"))}return N+=". Received type ".concat(a(x)),N},TypeError),f("ERR_INVALID_ARG_VALUE",function(S,b){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"is invalid";o===void 0&&(o=ir);var L=o.inspect(b);return L.length>128&&(L="".concat(L.slice(0,128),"...")),"The argument '".concat(S,"' ").concat(x,". Received ").concat(L)},TypeError),f("ERR_INVALID_RETURN_VALUE",function(S,b,x){var L;return x&&x.constructor&&x.constructor.name?L="instance of ".concat(x.constructor.name):L="type ".concat(a(x)),"Expected ".concat(S,' to be returned from the "').concat(b,'"')+" function but got ".concat(L,".")},TypeError),f("ERR_MISSING_ARGS",function(){for(var S=arguments.length,b=new Array(S),x=0;x<S;x++)b[x]=arguments[x];h===void 0&&(h=eo()),h(b.length>0,"At least one arg needs to be specified");var L="The ",N=b.length;switch(b=b.map(function(P){return'"'.concat(P,'"')}),N){case 1:L+="".concat(b[0]," argument");break;case 2:L+="".concat(b[0]," and ").concat(b[1]," arguments");break;default:L+=b.slice(0,N-1).join(", "),L+=", and ".concat(b[N-1]," arguments");break}return"".concat(L," must be specified")},TypeError),zs.codes=l,zs}var ua,Bl;function R_(){if(Bl)return ua;Bl=1;function a(M,A){var v=Object.keys(M);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(M);A&&(w=w.filter(function(R){return Object.getOwnPropertyDescriptor(M,R).enumerable})),v.push.apply(v,w)}return v}function e(M){for(var A=1;A<arguments.length;A++){var v=arguments[A]!=null?arguments[A]:{};A%2?a(Object(v),!0).forEach(function(w){t(M,w,v[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(v)):a(Object(v)).forEach(function(w){Object.defineProperty(M,w,Object.getOwnPropertyDescriptor(v,w))})}return M}function t(M,A,v){return A=r(A),A in M?Object.defineProperty(M,A,{value:v,enumerable:!0,configurable:!0,writable:!0}):M[A]=v,M}function n(M,A){if(!(M instanceof A))throw new TypeError("Cannot call a class as a function")}function i(M,A){for(var v=0;v<A.length;v++){var w=A[v];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(M,r(w.key),w)}}function s(M,A,v){return i(M.prototype,A),Object.defineProperty(M,"prototype",{writable:!1}),M}function r(M){var A=d(M,"string");return S(A)==="symbol"?A:String(A)}function d(M,A){if(S(M)!=="object"||M===null)return M;var v=M[Symbol.toPrimitive];if(v!==void 0){var w=v.call(M,A);if(S(w)!=="object")return w;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(M)}function u(M,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function");M.prototype=Object.create(A&&A.prototype,{constructor:{value:M,writable:!0,configurable:!0}}),Object.defineProperty(M,"prototype",{writable:!1}),A&&y(M,A)}function c(M){var A=p();return function(){var w=_(M),R;if(A){var C=_(this).constructor;R=Reflect.construct(w,arguments,C)}else R=w.apply(this,arguments);return l(this,R)}}function l(M,A){if(A&&(S(A)==="object"||typeof A=="function"))return A;if(A!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return h(M)}function h(M){if(M===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return M}function o(M){var A=typeof Map=="function"?new Map:void 0;return o=function(w){if(w===null||!m(w))return w;if(typeof w!="function")throw new TypeError("Super expression must either be null or a function");if(typeof A<"u"){if(A.has(w))return A.get(w);A.set(w,R)}function R(){return f(w,arguments,_(this).constructor)}return R.prototype=Object.create(w.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),y(R,w)},o(M)}function f(M,A,v){return p()?f=Reflect.construct.bind():f=function(R,C,O){var G=[null];G.push.apply(G,C);var z=Function.bind.apply(R,G),Y=new z;return O&&y(Y,O.prototype),Y},f.apply(null,arguments)}function p(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function m(M){return Function.toString.call(M).indexOf("[native code]")!==-1}function y(M,A){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(w,R){return w.__proto__=R,w},y(M,A)}function _(M){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(v){return v.__proto__||Object.getPrototypeOf(v)},_(M)}function S(M){"@babel/helpers - typeof";return S=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},S(M)}var b=ir,x=b.inspect,L=au(),N=L.codes.ERR_INVALID_ARG_TYPE;function P(M,A,v){return(v===void 0||v>M.length)&&(v=M.length),M.substring(v-A.length,v)===A}function T(M,A){if(A=Math.floor(A),M.length==0||A==0)return"";var v=M.length*A;for(A=Math.floor(Math.log(A)/Math.log(2));A;)M+=M,A--;return M+=M.substring(0,v-M.length),M}var k="",I="",F="",V="",ne={deepStrictEqual:"Expected values to be strictly deep-equal:",strictEqual:"Expected values to be strictly equal:",strictEqualObject:'Expected "actual" to be reference-equal to "expected":',deepEqual:"Expected values to be loosely deep-equal:",equal:"Expected values to be loosely equal:",notDeepStrictEqual:'Expected "actual" not to be strictly deep-equal to:',notStrictEqual:'Expected "actual" to be strictly unequal to:',notStrictEqualObject:'Expected "actual" not to be reference-equal to "expected":',notDeepEqual:'Expected "actual" not to be loosely deep-equal to:',notEqual:'Expected "actual" to be loosely unequal to:',notIdentical:"Values identical but not reference-equal:"},te=10;function Z(M){var A=Object.keys(M),v=Object.create(Object.getPrototypeOf(M));return A.forEach(function(w){v[w]=M[w]}),Object.defineProperty(v,"message",{value:M.message}),v}function Q(M){return x(M,{compact:!1,customInspect:!1,depth:1e3,maxArrayLength:1/0,showHidden:!1,breakLength:1/0,showProxy:!1,sorted:!0,getters:!0})}function he(M,A,v){var w="",R="",C=0,O="",G=!1,z=Q(M),Y=z.split(`
`),ie=Q(A).split(`
`),se=0,Se="";if(v==="strictEqual"&&S(M)==="object"&&S(A)==="object"&&M!==null&&A!==null&&(v="strictEqualObject"),Y.length===1&&ie.length===1&&Y[0]!==ie[0]){var we=Y[0].length+ie[0].length;if(we<=te){if((S(M)!=="object"||M===null)&&(S(A)!=="object"||A===null)&&(M!==0||A!==0))return"".concat(ne[v],`

`)+"".concat(Y[0]," !== ").concat(ie[0],`
`)}else if(v!=="strictEqualObject"){var Pe=process.stderr&&process.stderr.isTTY?process.stderr.columns:80;if(we<Pe){for(;Y[0][se]===ie[0][se];)se++;se>2&&(Se=`
  `.concat(T(" ",se),"^"),se=0)}}}for(var Ge=Y[Y.length-1],it=ie[ie.length-1];Ge===it&&(se++<2?O=`
  `.concat(Ge).concat(O):w=Ge,Y.pop(),ie.pop(),!(Y.length===0||ie.length===0));)Ge=Y[Y.length-1],it=ie[ie.length-1];var Ie=Math.max(Y.length,ie.length);if(Ie===0){var rt=z.split(`
`);if(rt.length>30)for(rt[26]="".concat(k,"...").concat(V);rt.length>27;)rt.pop();return"".concat(ne.notIdentical,`

`).concat(rt.join(`
`),`
`)}se>3&&(O=`
`.concat(k,"...").concat(V).concat(O),G=!0),w!==""&&(O=`
  `.concat(w).concat(O),w="");var tt=0,xe=ne[v]+`
`.concat(I,"+ actual").concat(V," ").concat(F,"- expected").concat(V),ht=" ".concat(k,"...").concat(V," Lines skipped");for(se=0;se<Ie;se++){var _t=se-C;if(Y.length<se+1)_t>1&&se>2&&(_t>4?(R+=`
`.concat(k,"...").concat(V),G=!0):_t>3&&(R+=`
  `.concat(ie[se-2]),tt++),R+=`
  `.concat(ie[se-1]),tt++),C=se,w+=`
`.concat(F,"-").concat(V," ").concat(ie[se]),tt++;else if(ie.length<se+1)_t>1&&se>2&&(_t>4?(R+=`
`.concat(k,"...").concat(V),G=!0):_t>3&&(R+=`
  `.concat(Y[se-2]),tt++),R+=`
  `.concat(Y[se-1]),tt++),C=se,R+=`
`.concat(I,"+").concat(V," ").concat(Y[se]),tt++;else{var et=ie[se],Ve=Y[se],fe=Ve!==et&&(!P(Ve,",")||Ve.slice(0,-1)!==et);fe&&P(et,",")&&et.slice(0,-1)===Ve&&(fe=!1,Ve+=","),fe?(_t>1&&se>2&&(_t>4?(R+=`
`.concat(k,"...").concat(V),G=!0):_t>3&&(R+=`
  `.concat(Y[se-2]),tt++),R+=`
  `.concat(Y[se-1]),tt++),C=se,R+=`
`.concat(I,"+").concat(V," ").concat(Ve),w+=`
`.concat(F,"-").concat(V," ").concat(et),tt+=2):(R+=w,w="",(_t===1||se===0)&&(R+=`
  `.concat(Ve),tt++))}if(tt>20&&se<Ie-2)return"".concat(xe).concat(ht,`
`).concat(R,`
`).concat(k,"...").concat(V).concat(w,`
`)+"".concat(k,"...").concat(V)}return"".concat(xe).concat(G?ht:"",`
`).concat(R).concat(w).concat(O).concat(Se)}var de=function(M,A){u(w,M);var v=c(w);function w(R){var C;if(n(this,w),S(R)!=="object"||R===null)throw new N("options","Object",R);var O=R.message,G=R.operator,z=R.stackStartFn,Y=R.actual,ie=R.expected,se=Error.stackTraceLimit;if(Error.stackTraceLimit=0,O!=null)C=v.call(this,String(O));else if(process.stderr&&process.stderr.isTTY&&(process.stderr&&process.stderr.getColorDepth&&process.stderr.getColorDepth()!==1?(k="\x1B[34m",I="\x1B[32m",V="\x1B[39m",F="\x1B[31m"):(k="",I="",V="",F="")),S(Y)==="object"&&Y!==null&&S(ie)==="object"&&ie!==null&&"stack"in Y&&Y instanceof Error&&"stack"in ie&&ie instanceof Error&&(Y=Z(Y),ie=Z(ie)),G==="deepStrictEqual"||G==="strictEqual")C=v.call(this,he(Y,ie,G));else if(G==="notDeepStrictEqual"||G==="notStrictEqual"){var Se=ne[G],we=Q(Y).split(`
`);if(G==="notStrictEqual"&&S(Y)==="object"&&Y!==null&&(Se=ne.notStrictEqualObject),we.length>30)for(we[26]="".concat(k,"...").concat(V);we.length>27;)we.pop();we.length===1?C=v.call(this,"".concat(Se," ").concat(we[0])):C=v.call(this,"".concat(Se,`

`).concat(we.join(`
`),`
`))}else{var Pe=Q(Y),Ge="",it=ne[G];G==="notDeepEqual"||G==="notEqual"?(Pe="".concat(ne[G],`

`).concat(Pe),Pe.length>1024&&(Pe="".concat(Pe.slice(0,1021),"..."))):(Ge="".concat(Q(ie)),Pe.length>512&&(Pe="".concat(Pe.slice(0,509),"...")),Ge.length>512&&(Ge="".concat(Ge.slice(0,509),"...")),G==="deepEqual"||G==="equal"?Pe="".concat(it,`

`).concat(Pe,`

should equal

`):Ge=" ".concat(G," ").concat(Ge)),C=v.call(this,"".concat(Pe).concat(Ge))}return Error.stackTraceLimit=se,C.generatedMessage=!O,Object.defineProperty(h(C),"name",{value:"AssertionError [ERR_ASSERTION]",enumerable:!1,writable:!0,configurable:!0}),C.code="ERR_ASSERTION",C.actual=Y,C.expected=ie,C.operator=G,Error.captureStackTrace&&Error.captureStackTrace(h(C),z),C.stack,C.name="AssertionError",l(C)}return s(w,[{key:"toString",value:function(){return"".concat(this.name," [").concat(this.code,"]: ").concat(this.message)}},{key:A,value:function(C,O){return x(this,e(e({},O),{},{customInspect:!1,depth:0}))}}]),w}(o(Error),x.custom);return ua=de,ua}var Fl=Object.prototype.toString,ou=function(e){var t=Fl.call(e),n=t==="[object Arguments]";return n||(n=t!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Fl.call(e.callee)==="[object Function]"),n},ha,Nl;function I_(){if(Nl)return ha;Nl=1;var a;if(!Object.keys){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,n=ou,i=Object.prototype.propertyIsEnumerable,s=!i.call({toString:null},"toString"),r=i.call(function(){},"prototype"),d=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],u=function(o){var f=o.constructor;return f&&f.prototype===o},c={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},l=function(){if(typeof window>"u")return!1;for(var o in window)try{if(!c["$"+o]&&e.call(window,o)&&window[o]!==null&&typeof window[o]=="object")try{u(window[o])}catch{return!0}}catch{return!0}return!1}(),h=function(o){if(typeof window>"u"||!l)return u(o);try{return u(o)}catch{return!1}};a=function(f){var p=f!==null&&typeof f=="object",m=t.call(f)==="[object Function]",y=n(f),_=p&&t.call(f)==="[object String]",S=[];if(!p&&!m&&!y)throw new TypeError("Object.keys called on a non-object");var b=r&&m;if(_&&f.length>0&&!e.call(f,0))for(var x=0;x<f.length;++x)S.push(String(x));if(y&&f.length>0)for(var L=0;L<f.length;++L)S.push(String(L));else for(var N in f)!(b&&N==="prototype")&&e.call(f,N)&&S.push(String(N));if(s)for(var P=h(f),T=0;T<d.length;++T)!(P&&d[T]==="constructor")&&e.call(f,d[T])&&S.push(d[T]);return S}}return ha=a,ha}var L_=Array.prototype.slice,D_=ou,Ul=Object.keys,Zr=Ul?function(e){return Ul(e)}:I_(),$l=Object.keys;Zr.shim=function(){if(Object.keys){var e=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);e||(Object.keys=function(n){return D_(n)?$l(L_.call(n)):$l(n)})}else Object.keys=Zr;return Object.keys||Zr};var lu=Zr,P_=lu,du=wo(),cu=dr,es=ko,O_=cu("Array.prototype.push"),Gl=cu("Object.prototype.propertyIsEnumerable"),M_=du?es.getOwnPropertySymbols:null,B_=function(e,t){if(e==null)throw new TypeError("target must be an object");var n=es(e);if(arguments.length===1)return n;for(var i=1;i<arguments.length;++i){var s=es(arguments[i]),r=P_(s),d=du&&(es.getOwnPropertySymbols||M_);if(d)for(var u=d(s),c=0;c<u.length;++c){var l=u[c];Gl(s,l)&&O_(r,l)}for(var h=0;h<r.length;++h){var o=r[h];if(Gl(s,o)){var f=s[o];n[o]=f}}}return n},fa=B_,F_=function(){if(!Object.assign)return!1;for(var a="abcdefghijklmnopqrst",e=a.split(""),t={},n=0;n<e.length;++n)t[e[n]]=e[n];var i=Object.assign({},t),s="";for(var r in i)s+=r;return a!==s},N_=function(){if(!Object.assign||!Object.preventExtensions)return!1;var a=Object.preventExtensions({1:2});try{Object.assign(a,"xy")}catch{return a[1]==="y"}return!1},U_=function(){return!Object.assign||F_()||N_()?fa:Object.assign},Vl=function(a){return a!==a},uu=function(e,t){return e===0&&t===0?1/e===1/t:!!(e===t||Vl(e)&&Vl(t))},$_=uu,Mo=function(){return typeof Object.is=="function"?Object.is:$_},hu=Do,fu=Os,G_=fu(hu("String.prototype.indexOf")),V_=function(e,t){var n=hu(e,!!t);return typeof n=="function"&&G_(e,".prototype.")>-1?fu(n):n},pa,jl;function Ms(){if(jl)return pa;jl=1;var a=lu,e=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",t=Object.prototype.toString,n=Array.prototype.concat,i=tu,s=function(c){return typeof c=="function"&&t.call(c)==="[object Function]"},r=iu(),d=function(c,l,h,o){if(l in c){if(o===!0){if(c[l]===h)return}else if(!s(o)||!o())return}r?i(c,l,h,!0):i(c,l,h)},u=function(c,l){var h=arguments.length>2?arguments[2]:{},o=a(l);e&&(o=n.call(o,Object.getOwnPropertySymbols(l)));for(var f=0;f<o.length;f+=1)d(c,o[f],l[o[f]],h[o[f]])};return u.supportsDescriptors=!!r,pa=u,pa}var ma,Hl;function j_(){if(Hl)return ma;Hl=1;var a=Mo,e=Ms();return ma=function(){var n=a();return e(Object,{is:n},{is:function(){return Object.is!==n}}),n},ma}var ga,ql;function H_(){if(ql)return ga;ql=1;var a=Ms(),e=Os,t=uu,n=Mo,i=j_(),s=e(n(),Object);return a(s,{getPolyfill:n,implementation:t,shim:i}),ga=s,ga}var ya,zl;function pu(){return zl||(zl=1,ya=function(e){return e!==e}),ya}var _a,Kl;function mu(){if(Kl)return _a;Kl=1;var a=pu();return _a=function(){return Number.isNaN&&Number.isNaN(NaN)&&!Number.isNaN("a")?Number.isNaN:a},_a}var Aa,Wl;function q_(){if(Wl)return Aa;Wl=1;var a=Ms(),e=mu();return Aa=function(){var n=e();return a(Number,{isNaN:n},{isNaN:function(){return Number.isNaN!==n}}),n},Aa}var va,Yl;function z_(){if(Yl)return va;Yl=1;var a=Os,e=Ms(),t=pu(),n=mu(),i=q_(),s=a(n(),Number);return e(s,{getPolyfill:n,implementation:t,shim:i}),va=s,va}var ba,Xl;function K_(){if(Xl)return ba;Xl=1;function a(fe,be){return s(fe)||i(fe,be)||t(fe,be)||e()}function e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t(fe,be){if(fe){if(typeof fe=="string")return n(fe,be);var Ue=Object.prototype.toString.call(fe).slice(8,-1);if(Ue==="Object"&&fe.constructor&&(Ue=fe.constructor.name),Ue==="Map"||Ue==="Set")return Array.from(fe);if(Ue==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ue))return n(fe,be)}}function n(fe,be){(be==null||be>fe.length)&&(be=fe.length);for(var Ue=0,ge=new Array(be);Ue<be;Ue++)ge[Ue]=fe[Ue];return ge}function i(fe,be){var Ue=fe==null?null:typeof Symbol<"u"&&fe[Symbol.iterator]||fe["@@iterator"];if(Ue!=null){var ge,Je,ut,st,We=[],gt=!0,X=!1;try{if(ut=(Ue=Ue.call(fe)).next,be!==0)for(;!(gt=(ge=ut.call(Ue)).done)&&(We.push(ge.value),We.length!==be);gt=!0);}catch(re){X=!0,Je=re}finally{try{if(!gt&&Ue.return!=null&&(st=Ue.return(),Object(st)!==st))return}finally{if(X)throw Je}}return We}}function s(fe){if(Array.isArray(fe))return fe}function r(fe){"@babel/helpers - typeof";return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(be){return typeof be}:function(be){return be&&typeof Symbol=="function"&&be.constructor===Symbol&&be!==Symbol.prototype?"symbol":typeof be},r(fe)}var d=/a/g.flags!==void 0,u=function(be){var Ue=[];return be.forEach(function(ge){return Ue.push(ge)}),Ue},c=function(be){var Ue=[];return be.forEach(function(ge,Je){return Ue.push([Je,ge])}),Ue},l=Object.is?Object.is:H_(),h=Object.getOwnPropertySymbols?Object.getOwnPropertySymbols:function(){return[]},o=Number.isNaN?Number.isNaN:z_();function f(fe){return fe.call.bind(fe)}var p=f(Object.prototype.hasOwnProperty),m=f(Object.prototype.propertyIsEnumerable),y=f(Object.prototype.toString),_=ir.types,S=_.isAnyArrayBuffer,b=_.isArrayBufferView,x=_.isDate,L=_.isMap,N=_.isRegExp,P=_.isSet,T=_.isNativeError,k=_.isBoxedPrimitive,I=_.isNumberObject,F=_.isStringObject,V=_.isBooleanObject,ne=_.isBigIntObject,te=_.isSymbolObject,Z=_.isFloat32Array,Q=_.isFloat64Array;function he(fe){if(fe.length===0||fe.length>10)return!0;for(var be=0;be<fe.length;be++){var Ue=fe.charCodeAt(be);if(Ue<48||Ue>57)return!0}return fe.length===10&&fe>=Math.pow(2,32)}function de(fe){return Object.keys(fe).filter(he).concat(h(fe).filter(Object.prototype.propertyIsEnumerable.bind(fe)))}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function M(fe,be){if(fe===be)return 0;for(var Ue=fe.length,ge=be.length,Je=0,ut=Math.min(Ue,ge);Je<ut;++Je)if(fe[Je]!==be[Je]){Ue=fe[Je],ge=be[Je];break}return Ue<ge?-1:ge<Ue?1:0}var A=!0,v=!1,w=0,R=1,C=2,O=3;function G(fe,be){return d?fe.source===be.source&&fe.flags===be.flags:RegExp.prototype.toString.call(fe)===RegExp.prototype.toString.call(be)}function z(fe,be){if(fe.byteLength!==be.byteLength)return!1;for(var Ue=0;Ue<fe.byteLength;Ue++)if(fe[Ue]!==be[Ue])return!1;return!0}function Y(fe,be){return fe.byteLength!==be.byteLength?!1:M(new Uint8Array(fe.buffer,fe.byteOffset,fe.byteLength),new Uint8Array(be.buffer,be.byteOffset,be.byteLength))===0}function ie(fe,be){return fe.byteLength===be.byteLength&&M(new Uint8Array(fe),new Uint8Array(be))===0}function se(fe,be){return I(fe)?I(be)&&l(Number.prototype.valueOf.call(fe),Number.prototype.valueOf.call(be)):F(fe)?F(be)&&String.prototype.valueOf.call(fe)===String.prototype.valueOf.call(be):V(fe)?V(be)&&Boolean.prototype.valueOf.call(fe)===Boolean.prototype.valueOf.call(be):ne(fe)?ne(be)&&BigInt.prototype.valueOf.call(fe)===BigInt.prototype.valueOf.call(be):te(be)&&Symbol.prototype.valueOf.call(fe)===Symbol.prototype.valueOf.call(be)}function Se(fe,be,Ue,ge){if(fe===be)return fe!==0?!0:Ue?l(fe,be):!0;if(Ue){if(r(fe)!=="object")return typeof fe=="number"&&o(fe)&&o(be);if(r(be)!=="object"||fe===null||be===null||Object.getPrototypeOf(fe)!==Object.getPrototypeOf(be))return!1}else{if(fe===null||r(fe)!=="object")return be===null||r(be)!=="object"?fe==be:!1;if(be===null||r(be)!=="object")return!1}var Je=y(fe),ut=y(be);if(Je!==ut)return!1;if(Array.isArray(fe)){if(fe.length!==be.length)return!1;var st=de(fe),We=de(be);return st.length!==We.length?!1:Pe(fe,be,Ue,ge,R,st)}if(Je==="[object Object]"&&(!L(fe)&&L(be)||!P(fe)&&P(be)))return!1;if(x(fe)){if(!x(be)||Date.prototype.getTime.call(fe)!==Date.prototype.getTime.call(be))return!1}else if(N(fe)){if(!N(be)||!G(fe,be))return!1}else if(T(fe)||fe instanceof Error){if(fe.message!==be.message||fe.name!==be.name)return!1}else if(b(fe)){if(!Ue&&(Z(fe)||Q(fe))){if(!z(fe,be))return!1}else if(!Y(fe,be))return!1;var gt=de(fe),X=de(be);return gt.length!==X.length?!1:Pe(fe,be,Ue,ge,w,gt)}else{if(P(fe))return!P(be)||fe.size!==be.size?!1:Pe(fe,be,Ue,ge,C);if(L(fe))return!L(be)||fe.size!==be.size?!1:Pe(fe,be,Ue,ge,O);if(S(fe)){if(!ie(fe,be))return!1}else if(k(fe)&&!se(fe,be))return!1}return Pe(fe,be,Ue,ge,w)}function we(fe,be){return be.filter(function(Ue){return m(fe,Ue)})}function Pe(fe,be,Ue,ge,Je,ut){if(arguments.length===5){ut=Object.keys(fe);var st=Object.keys(be);if(ut.length!==st.length)return!1}for(var We=0;We<ut.length;We++)if(!p(be,ut[We]))return!1;if(Ue&&arguments.length===5){var gt=h(fe);if(gt.length!==0){var X=0;for(We=0;We<gt.length;We++){var re=gt[We];if(m(fe,re)){if(!m(be,re))return!1;ut.push(re),X++}else if(m(be,re))return!1}var K=h(be);if(gt.length!==K.length&&we(be,K).length!==X)return!1}else{var j=h(be);if(j.length!==0&&we(be,j).length!==0)return!1}}if(ut.length===0&&(Je===w||Je===R&&fe.length===0||fe.size===0))return!0;if(ge===void 0)ge={val1:new Map,val2:new Map,position:0};else{var oe=ge.val1.get(fe);if(oe!==void 0){var _e=ge.val2.get(be);if(_e!==void 0)return oe===_e}ge.position++}ge.val1.set(fe,ge.position),ge.val2.set(be,ge.position);var ae=_t(fe,be,Ue,ut,ge,Je);return ge.val1.delete(fe),ge.val2.delete(be),ae}function Ge(fe,be,Ue,ge){for(var Je=u(fe),ut=0;ut<Je.length;ut++){var st=Je[ut];if(Se(be,st,Ue,ge))return fe.delete(st),!0}return!1}function it(fe){switch(r(fe)){case"undefined":return null;case"object":return;case"symbol":return!1;case"string":fe=+fe;case"number":if(o(fe))return!1}return!0}function Ie(fe,be,Ue){var ge=it(Ue);return ge??(be.has(ge)&&!fe.has(ge))}function rt(fe,be,Ue,ge,Je){var ut=it(Ue);if(ut!=null)return ut;var st=be.get(ut);return st===void 0&&!be.has(ut)||!Se(ge,st,!1,Je)?!1:!fe.has(ut)&&Se(ge,st,!1,Je)}function tt(fe,be,Ue,ge){for(var Je=null,ut=u(fe),st=0;st<ut.length;st++){var We=ut[st];if(r(We)==="object"&&We!==null)Je===null&&(Je=new Set),Je.add(We);else if(!be.has(We)){if(Ue||!Ie(fe,be,We))return!1;Je===null&&(Je=new Set),Je.add(We)}}if(Je!==null){for(var gt=u(be),X=0;X<gt.length;X++){var re=gt[X];if(r(re)==="object"&&re!==null){if(!Ge(Je,re,Ue,ge))return!1}else if(!Ue&&!fe.has(re)&&!Ge(Je,re,Ue,ge))return!1}return Je.size===0}return!0}function xe(fe,be,Ue,ge,Je,ut){for(var st=u(fe),We=0;We<st.length;We++){var gt=st[We];if(Se(Ue,gt,Je,ut)&&Se(ge,be.get(gt),Je,ut))return fe.delete(gt),!0}return!1}function ht(fe,be,Ue,ge){for(var Je=null,ut=c(fe),st=0;st<ut.length;st++){var We=a(ut[st],2),gt=We[0],X=We[1];if(r(gt)==="object"&&gt!==null)Je===null&&(Je=new Set),Je.add(gt);else{var re=be.get(gt);if(re===void 0&&!be.has(gt)||!Se(X,re,Ue,ge)){if(Ue||!rt(fe,be,gt,X,ge))return!1;Je===null&&(Je=new Set),Je.add(gt)}}}if(Je!==null){for(var K=c(be),j=0;j<K.length;j++){var oe=a(K[j],2),_e=oe[0],ae=oe[1];if(r(_e)==="object"&&_e!==null){if(!xe(Je,fe,_e,ae,Ue,ge))return!1}else if(!Ue&&(!fe.has(_e)||!Se(fe.get(_e),ae,!1,ge))&&!xe(Je,fe,_e,ae,!1,ge))return!1}return Je.size===0}return!0}function _t(fe,be,Ue,ge,Je,ut){var st=0;if(ut===C){if(!tt(fe,be,Ue,Je))return!1}else if(ut===O){if(!ht(fe,be,Ue,Je))return!1}else if(ut===R)for(;st<fe.length;st++)if(p(fe,st)){if(!p(be,st)||!Se(fe[st],be[st],Ue,Je))return!1}else{if(p(be,st))return!1;for(var We=Object.keys(fe);st<We.length;st++){var gt=We[st];if(!p(be,gt)||!Se(fe[gt],be[gt],Ue,Je))return!1}return We.length===Object.keys(be).length}for(st=0;st<ge.length;st++){var X=ge[st];if(!Se(fe[X],be[X],Ue,Je))return!1}return!0}function et(fe,be){return Se(fe,be,v)}function Ve(fe,be){return Se(fe,be,A)}return ba={isDeepEqual:et,isDeepStrictEqual:Ve},ba}var Jl;function eo(){if(Jl)return qs.exports;Jl=1;function a(C){"@babel/helpers - typeof";return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(O){return typeof O}:function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},a(C)}function e(C,O,G){return Object.defineProperty(C,"prototype",{writable:!1}),C}function t(C,O){if(!(C instanceof O))throw new TypeError("Cannot call a class as a function")}var n=au(),i=n.codes,s=i.ERR_AMBIGUOUS_ARGUMENT,r=i.ERR_INVALID_ARG_TYPE,d=i.ERR_INVALID_ARG_VALUE,u=i.ERR_INVALID_RETURN_VALUE,c=i.ERR_MISSING_ARGS,l=R_(),h=ir,o=h.inspect,f=ir.types,p=f.isPromise,m=f.isRegExp,y=U_(),_=Mo(),S=V_("RegExp.prototype.test"),b,x;function L(){var C=K_();b=C.isDeepEqual,x=C.isDeepStrictEqual}var N=!1,P=qs.exports=V,T={};function k(C){throw C.message instanceof Error?C.message:new l(C)}function I(C,O,G,z,Y){var ie=arguments.length,se;if(ie===0)se="Failed";else if(ie===1)G=C,C=void 0;else{if(N===!1){N=!0;var Se=process.emitWarning?process.emitWarning:console.warn.bind(console);Se("assert.fail() with more than one argument is deprecated. Please use assert.strictEqual() instead or only pass a message.","DeprecationWarning","DEP0094")}ie===2&&(z="!=")}if(G instanceof Error)throw G;var we={actual:C,expected:O,operator:z===void 0?"fail":z,stackStartFn:Y||I};G!==void 0&&(we.message=G);var Pe=new l(we);throw se&&(Pe.message=se,Pe.generatedMessage=!0),Pe}P.fail=I,P.AssertionError=l;function F(C,O,G,z){if(!G){var Y=!1;if(O===0)Y=!0,z="No value argument passed to `assert.ok()`";else if(z instanceof Error)throw z;var ie=new l({actual:G,expected:!0,message:z,operator:"==",stackStartFn:C});throw ie.generatedMessage=Y,ie}}function V(){for(var C=arguments.length,O=new Array(C),G=0;G<C;G++)O[G]=arguments[G];F.apply(void 0,[V,O.length].concat(O))}P.ok=V,P.equal=function C(O,G,z){if(arguments.length<2)throw new c("actual","expected");O!=G&&k({actual:O,expected:G,message:z,operator:"==",stackStartFn:C})},P.notEqual=function C(O,G,z){if(arguments.length<2)throw new c("actual","expected");O==G&&k({actual:O,expected:G,message:z,operator:"!=",stackStartFn:C})},P.deepEqual=function C(O,G,z){if(arguments.length<2)throw new c("actual","expected");b===void 0&&L(),b(O,G)||k({actual:O,expected:G,message:z,operator:"deepEqual",stackStartFn:C})},P.notDeepEqual=function C(O,G,z){if(arguments.length<2)throw new c("actual","expected");b===void 0&&L(),b(O,G)&&k({actual:O,expected:G,message:z,operator:"notDeepEqual",stackStartFn:C})},P.deepStrictEqual=function C(O,G,z){if(arguments.length<2)throw new c("actual","expected");b===void 0&&L(),x(O,G)||k({actual:O,expected:G,message:z,operator:"deepStrictEqual",stackStartFn:C})},P.notDeepStrictEqual=ne;function ne(C,O,G){if(arguments.length<2)throw new c("actual","expected");b===void 0&&L(),x(C,O)&&k({actual:C,expected:O,message:G,operator:"notDeepStrictEqual",stackStartFn:ne})}P.strictEqual=function C(O,G,z){if(arguments.length<2)throw new c("actual","expected");_(O,G)||k({actual:O,expected:G,message:z,operator:"strictEqual",stackStartFn:C})},P.notStrictEqual=function C(O,G,z){if(arguments.length<2)throw new c("actual","expected");_(O,G)&&k({actual:O,expected:G,message:z,operator:"notStrictEqual",stackStartFn:C})};var te=e(function C(O,G,z){var Y=this;t(this,C),G.forEach(function(ie){ie in O&&(z!==void 0&&typeof z[ie]=="string"&&m(O[ie])&&S(O[ie],z[ie])?Y[ie]=z[ie]:Y[ie]=O[ie])})});function Z(C,O,G,z,Y,ie){if(!(G in C)||!x(C[G],O[G])){if(!z){var se=new te(C,Y),Se=new te(O,Y,C),we=new l({actual:se,expected:Se,operator:"deepStrictEqual",stackStartFn:ie});throw we.actual=C,we.expected=O,we.operator=ie.name,we}k({actual:C,expected:O,message:z,operator:ie.name,stackStartFn:ie})}}function Q(C,O,G,z){if(typeof O!="function"){if(m(O))return S(O,C);if(arguments.length===2)throw new r("expected",["Function","RegExp"],O);if(a(C)!=="object"||C===null){var Y=new l({actual:C,expected:O,message:G,operator:"deepStrictEqual",stackStartFn:z});throw Y.operator=z.name,Y}var ie=Object.keys(O);if(O instanceof Error)ie.push("name","message");else if(ie.length===0)throw new d("error",O,"may not be an empty object");return b===void 0&&L(),ie.forEach(function(se){typeof C[se]=="string"&&m(O[se])&&S(O[se],C[se])||Z(C,O,se,G,ie,z)}),!0}return O.prototype!==void 0&&C instanceof O?!0:Error.isPrototypeOf(O)?!1:O.call({},C)===!0}function he(C){if(typeof C!="function")throw new r("fn","Function",C);try{C()}catch(O){return O}return T}function de(C){return p(C)||C!==null&&a(C)==="object"&&typeof C.then=="function"&&typeof C.catch=="function"}function M(C){return Promise.resolve().then(function(){var O;if(typeof C=="function"){if(O=C(),!de(O))throw new u("instance of Promise","promiseFn",O)}else if(de(C))O=C;else throw new r("promiseFn",["Function","Promise"],C);return Promise.resolve().then(function(){return O}).then(function(){return T}).catch(function(G){return G})})}function A(C,O,G,z){if(typeof G=="string"){if(arguments.length===4)throw new r("error",["Object","Error","Function","RegExp"],G);if(a(O)==="object"&&O!==null){if(O.message===G)throw new s("error/message",'The error message "'.concat(O.message,'" is identical to the message.'))}else if(O===G)throw new s("error/message",'The error "'.concat(O,'" is identical to the message.'));z=G,G=void 0}else if(G!=null&&a(G)!=="object"&&typeof G!="function")throw new r("error",["Object","Error","Function","RegExp"],G);if(O===T){var Y="";G&&G.name&&(Y+=" (".concat(G.name,")")),Y+=z?": ".concat(z):".";var ie=C.name==="rejects"?"rejection":"exception";k({actual:void 0,expected:G,operator:C.name,message:"Missing expected ".concat(ie).concat(Y),stackStartFn:C})}if(G&&!Q(O,G,z,C))throw O}function v(C,O,G,z){if(O!==T){if(typeof G=="string"&&(z=G,G=void 0),!G||Q(O,G)){var Y=z?": ".concat(z):".",ie=C.name==="doesNotReject"?"rejection":"exception";k({actual:O,expected:G,operator:C.name,message:"Got unwanted ".concat(ie).concat(Y,`
`)+'Actual message: "'.concat(O&&O.message,'"'),stackStartFn:C})}throw O}}P.throws=function C(O){for(var G=arguments.length,z=new Array(G>1?G-1:0),Y=1;Y<G;Y++)z[Y-1]=arguments[Y];A.apply(void 0,[C,he(O)].concat(z))},P.rejects=function C(O){for(var G=arguments.length,z=new Array(G>1?G-1:0),Y=1;Y<G;Y++)z[Y-1]=arguments[Y];return M(O).then(function(ie){return A.apply(void 0,[C,ie].concat(z))})},P.doesNotThrow=function C(O){for(var G=arguments.length,z=new Array(G>1?G-1:0),Y=1;Y<G;Y++)z[Y-1]=arguments[Y];v.apply(void 0,[C,he(O)].concat(z))},P.doesNotReject=function C(O){for(var G=arguments.length,z=new Array(G>1?G-1:0),Y=1;Y<G;Y++)z[Y-1]=arguments[Y];return M(O).then(function(ie){return v.apply(void 0,[C,ie].concat(z))})},P.ifError=function C(O){if(O!=null){var G="ifError got unwanted exception: ";a(O)==="object"&&typeof O.message=="string"?O.message.length===0&&O.constructor?G+=O.constructor.name:G+=O.message:G+=o(O);var z=new l({actual:O,expected:null,operator:"ifError",message:G,stackStartFn:C}),Y=O.stack;if(typeof Y=="string"){var ie=Y.split(`
`);ie.shift();for(var se=z.stack.split(`
`),Se=0;Se<ie.length;Se++){var we=se.indexOf(ie[Se]);if(we!==-1){se=se.slice(0,we);break}}z.stack="".concat(se.join(`
`),`
`).concat(ie.join(`
`))}throw z}};function w(C,O,G,z,Y){if(!m(O))throw new r("regexp","RegExp",O);var ie=Y==="match";if(typeof C!="string"||S(O,C)!==ie){if(G instanceof Error)throw G;var se=!G;G=G||(typeof C!="string"?'The "string" argument must be of type string. Received type '+"".concat(a(C)," (").concat(o(C),")"):(ie?"The input did not match the regular expression ":"The input was expected to not match the regular expression ")+"".concat(o(O),`. Input:

`).concat(o(C),`
`));var Se=new l({actual:C,expected:O,message:G,operator:Y,stackStartFn:z});throw Se.generatedMessage=se,Se}}P.match=function C(O,G,z){w(O,G,z,C,"match")},P.doesNotMatch=function C(O,G,z){w(O,G,z,C,"doesNotMatch")};function R(){for(var C=arguments.length,O=new Array(C),G=0;G<C;G++)O[G]=arguments[G];F.apply(void 0,[R,O.length].concat(O))}return P.strict=y(R,P,{equal:P.strictEqual,deepEqual:P.deepStrictEqual,notEqual:P.notStrictEqual,notDeepEqual:P.notDeepStrictEqual}),P.strict.strict=P.strict,qs.exports}var W_=eo();const pi=Eo(W_);var gu={exports:{}};(function(a,e){(function(t,n){a.exports=n()})(globalThis,()=>(()=>{var t={456:(r,d,u)=>{var c=u(143);r.exports=function(l){var h,o="",f=(l=l||{}).video,p=l.options,m=c.$escape,y=l.tran,_=l.icons,S=c.$each,b=(l.$value,l.$index,l.index);return o+=`<div class="dplayer-mask"></div>
<div class="dplayer-video-wrap">
    <div class="dplayer-video-wrap-aspect">
      `,h=u(194)(f),o+=h,o+=`
    </div>
    `,p.logo&&(o+=`
    <div class="dplayer-logo">
        <img src="`,o+=m(p.logo),o+=`">
    </div>
    `),o+=`
    <div class="dplayer-danmaku"`,p.danmaku&&p.danmaku.bottom&&(o+=' style="margin-bottom:',o+=m(p.danmaku.bottom),o+='"'),o+=`>
        <div class="dplayer-danmaku-item dplayer-danmaku-item--demo"></div>
    </div>
    <div class="dplayer-subtitle"></div>
    <div class="dplayer-bezel">
        <span class="dplayer-bezel-icon"></span>
        `,p.danmaku&&(o+=`
        <span class="dplayer-danloading">`,o+=m(y("Danmaku is loading")),o+=`</span>
        `),o+=`
        <span class="dplayer-loading-icon">`,o+=_.loading,o+=`</span>
    </div>
</div>
<div class="dplayer-controller-mask"></div>
<div class="dplayer-controller">
    <div class="dplayer-icons dplayer-comment-box">
        <button class="dplayer-icon dplayer-comment-setting-icon" aria-label="`,o+=m(y("Setting")),o+=`" data-balloon-nofocus data-balloon-pos="up">
            <span class="dplayer-icon-content">`,o+=_.pallette,o+=`</span>
        </button>
        <input class="dplayer-comment-input" type="search" placeholder="`,o+=m(y("Input danmaku, hit Enter")),o+=`" spellcheck="false" maxlength="60">
        <button class="dplayer-icon dplayer-send-icon" aria-label="`,o+=m(y("Send")),o+=`" data-balloon-nofocus data-balloon-pos="up">
            <span class="dplayer-icon-content">`,o+=_.send,o+=`</span>
        </button>
    </div>
    <div class="dplayer-icons dplayer-icons-left">
        <button class="dplayer-icon dplayer-play-icon">
            <span class="dplayer-icon-content">`,o+=_.play,o+=`</span>
        </button>
        <div class="dplayer-volume">
            <button class="dplayer-icon dplayer-volume-icon">
                <span class="dplayer-icon-content">`,o+=_.volumeDown,o+=`</span>
            </button>
            <div class="dplayer-volume-bar-wrap" data-balloon-nofocus data-balloon-pos="up">
                <div class="dplayer-volume-bar">
                    <div class="dplayer-volume-bar-inner" style="background: `,o+=m(p.theme),o+=`;">
                        <span class="dplayer-thumb" style="background: `,o+=m(p.theme),o+=`;"></span>
                    </div>
                </div>
            </div>
        </div>
        <span class="dplayer-time">
            <span class="dplayer-ptime">00:00</span> /
            <span class="dplayer-dtime">00:00</span>
        </span>
        `,p.live&&(o+=`
        <span class="dplayer-live-badge" aria-label="`,o+=m(y("Synchronize")),o+=`" data-balloon-nofocus data-balloon-pos="up">
            <span class="dplayer-icon-content">
                <span class="dplayer-live-dot" style="background: `,o+=m(p.theme),o+=';"></span>',o+=m(y("Live")),o+=`
            </span>
        </span>
        `),o+=`
    </div>
    <div class="dplayer-icons dplayer-icons-right">
        `,p.screenshot&&(o+=`
        <div class="dplayer-icon dplayer-camera-icon" aria-label="`,o+=m(y("Screenshot")),o+=`" data-balloon-nofocus data-balloon-pos="up">
            <span class="dplayer-icon-content">`,o+=_.camera,o+=`</span>
        </div>
        `),o+=`
        `,p.airplay&&(o+=`
        <div class="dplayer-icon dplayer-airplay-icon" aria-label="`,o+=m(y("AirPlay")),o+=`" data-balloon-nofocus data-balloon-pos="up">
            <span class="dplayer-icon-content">`,o+=_.airplay,o+=`</span>
        </div>
        `),o+=`
        <div class="dplayer-comment">
            <button class="dplayer-icon dplayer-comment-icon" aria-label="`,o+=m(y("Send danmaku")),o+=`" data-balloon-nofocus data-balloon-pos="up">
                <span class="dplayer-icon-content">`,o+=_.comment,o+=`</span>
            </button>
        </div>
        `,p.subtitle&&(o+=`
        <div class="dplayer-subtitle-btn">
            <button class="dplayer-icon dplayer-subtitle-icon" aria-label="`,o+=m(y("Hide subtitle")),o+=`" data-balloon-nofocus data-balloon-pos="up">
                <span class="dplayer-icon-content">`,o+=_.subtitle,o+=`</span>
            </button>
        </div>
        `),o+=`
        <div class="dplayer-setting">
            <button class="dplayer-icon dplayer-setting-icon" aria-label="`,o+=m(y("Setting")),o+=`" data-balloon-nofocus data-balloon-pos="up">
                <span class="dplayer-icon-content">`,o+=_.setting,o+=`</span>
            </button>
        </div>
        <div class="dplayer-full">
            <button class="dplayer-icon dplayer-pip-icon" aria-label="`,o+=m(y("Picture-in-Picture")),o+=`" data-balloon-nofocus data-balloon-pos="up">
                <span class="dplayer-icon-content">`,o+=_.pip,o+=`</span>
            </button>
            <button class="dplayer-icon dplayer-full-in-icon" aria-label="`,o+=m(y("Web full screen")),o+=`" data-balloon-nofocus data-balloon-pos="up">
                <span class="dplayer-icon-content">`,o+=_.fullWeb,o+=`</span>
            </button>
            <button class="dplayer-icon dplayer-full-icon" aria-label="`,o+=m(y("Full screen")),o+=`" data-balloon-nofocus data-balloon-pos="up">
                <span class="dplayer-icon-content">`,o+=_.full,o+=`</span>
            </button>
        </div>
    </div>
    <div class="dplayer-bar-wrap">
        <div class="dplayer-bar-time hidden">00:00</div>
        <div class="dplayer-bar-preview"></div>
        <div class="dplayer-bar">
            <div class="dplayer-loaded" style="width: 0;"></div>
            <div class="dplayer-played" style="width: 0; background: `,o+=m(p.theme),o+=`;">
                <span class="dplayer-thumb" style="background: `,o+=m(p.theme),o+=`;"></span>
            </div>
        </div>
    </div>
</div>
<div class="dplayer-setting-box" style="`,o+=m(p.video.quality?`--quality-length:${p.video.quality.length}`:""),o+=`">
    <div class="dplayer-setting-origin-panel">
        `,p.video.quality&&(o+=`
        <div class="dplayer-setting-item dplayer-setting-quality">
            <span class="dplayer-label">`,o+=m(y("Quality")),o+=`</span>
            <span class="dplayer-label-value">`,o+=m(p.video.quality[p.video.defaultQuality].name),o+=`</span>
            <div class="dplayer-toggle">`,o+=_.right,o+=`</div>
        </div>
        `),o+=`
        <div class="dplayer-setting-item dplayer-setting-audio">
            <span class="dplayer-label">`,o+=m(y("Audio")),o+=`</span>
            <span class="dplayer-label-value">`,o+=m(y("Primary audio")),o+=`</span>
            <div class="dplayer-toggle">`,o+=_.right,o+=`</div>
        </div>
        <div class="dplayer-setting-item dplayer-setting-speed">
            <span class="dplayer-label">`,o+=m(y("Speed")),o+=`</span>
            <span class="dplayer-label-value">`,o+=m(y("Normal")),o+=`</span>
            <div class="dplayer-toggle">`,o+=_.right,o+=`</div>
        </div>
        <div class="dplayer-setting-item dplayer-setting-loop">
            <span class="dplayer-label">`,o+=m(y("Loop")),o+=`</span>
            <div class="dplayer-toggle">
                <input class="dplayer-toggle-setting-input" type="checkbox" name="dplayer-toggle">
                <label for="dplayer-toggle" style="--theme-color:`,o+=m(p.theme),o+=`"></label>
            </div>
        </div>
        <div class="dplayer-setting-item dplayer-setting-showdan">
            <span class="dplayer-label">`,o+=m(y("Show danmaku")),o+=`</span>
            <div class="dplayer-toggle">
                <input class="dplayer-showdan-setting-input" type="checkbox" name="dplayer-toggle-dan">
                <label for="dplayer-toggle-dan" style="--theme-color:`,o+=m(p.theme),o+=`"></label>
            </div>
        </div>
        <div class="dplayer-setting-item dplayer-setting-danunlimit">
            <span class="dplayer-label">`,o+=m(y("Unlimited danmaku")),o+=`</span>
            <div class="dplayer-toggle">
                <input class="dplayer-danunlimit-setting-input" type="checkbox" name="dplayer-toggle-danunlimit">
                <label for="dplayer-toggle-danunlimit" style="--theme-color:`,o+=m(p.theme),o+=`"></label>
            </div>
        </div>
        <div class="dplayer-setting-item dplayer-setting-danmaku">
            <span class="dplayer-label">`,o+=m(y("Opacity for danmaku")),o+=`</span>
            <span class="dplayer-label-value">1.0</span>
            <div class="dplayer-danmaku-bar-wrap">
                <div class="dplayer-danmaku-bar">
                    <div class="dplayer-danmaku-bar-inner" style="background: `,o+=m(p.theme),o+=`;">
                        <span class="dplayer-thumb" style="background: `,o+=m(p.theme),o+=`;"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    `,p.video.quality&&(o+=`
    <div class="dplayer-setting-quality-panel">
        <div class="dplayer-setting-header dplayer-setting-quality-header">
            <div class="dplayer-toggle">`,o+=_.left,o+=`</div>
            <span class="dplayer-label">`,o+=m(y("Quality")),o+=`</span>
        </div>
        `,S(p.video.quality,function(x,L){o+=`
            <div class="dplayer-setting-quality-item `,o+=m(x.name===p.video.quality[p.video.defaultQuality].name?"dplayer-setting-quality-current":""),o+='" data-index="',o+=m(L),o+=`">
                <div class="dplayer-toggle">`,o+=_.check,o+=`</div>
                <span class="dplayer-label">`,o+=m(x.name),o+=`</span>
            </div>
        `}),o+=`
    </div>
    `),o+=`
    <div class="dplayer-setting-speed-panel">
        <div class="dplayer-setting-header dplayer-setting-speed-header">
            <div class="dplayer-toggle">`,o+=_.left,o+=`</div>
            <span class="dplayer-label">`,o+=m(y("Speed")),o+=`</span>
        </div>
        `,S(p.playbackSpeed,function(x,L){o+=`
            <div class="dplayer-setting-speed-item `,o+=m(x===1?"dplayer-setting-speed-current":""),o+='" data-speed="',o+=m(x),o+=`">
                <div class="dplayer-toggle">`,o+=_.check,o+=`</div>
                <span class="dplayer-label">`,o+=m(x===1?y("Normal"):x),o+=`</span>
            </div>
        `}),o+=`
    </div>
    <div class="dplayer-setting-audio-panel">
        <div class="dplayer-setting-header dplayer-setting-audio-header">
            <div class="dplayer-toggle">`,o+=_.left,o+=`</div>
            <span class="dplayer-label">`,o+=m(y("Audio")),o+=`</span>
        </div>
        <div class="dplayer-setting-audio-item dplayer-setting-audio-current" data-audio="primary">
            <div class="dplayer-toggle">`,o+=_.check,o+=`</div>
            <span class="dplayer-label">`,o+=m(y("Primary audio")),o+=`</span>
        </div>
        <div class="dplayer-setting-audio-item" data-audio="secondary">
            <div class="dplayer-toggle">`,o+=_.check,o+=`</div>
            <span class="dplayer-label">`,o+=m(y("Secondary audio")),o+=`</span>
        </div>
    </div>
</div>
<div class="dplayer-comment-setting-box">
    <div class="dplayer-comment-setting-color">
        <div class="dplayer-comment-setting-title">`,o+=m(y("Set danmaku color")),o+=`</div>
        <div class="dplayer-comment-setting-color-list">
            <label>
                <input type="radio" name="dplayer-danmaku-color-`,o+=m(b),o+=`" value="#ffeaea" checked>
                <span style="background: #ffeaea"></span>
            </label>
            <label>
                <input type="radio" name="dplayer-danmaku-color-`,o+=m(b),o+=`" value="#f02840">
                <span style="background: #f02840"></span>
            </label>
            <label>
                <input type="radio" name="dplayer-danmaku-color-`,o+=m(b),o+=`" value="#fd7e80">
                <span style="background: #fd7e80"></span>
            </label>
            <label>
                <input type="radio" name="dplayer-danmaku-color-`,o+=m(b),o+=`" value="#fda708">
                <span style="background: #fda708"></span>
            </label>
            <label>
                <input type="radio" name="dplayer-danmaku-color-`,o+=m(b),o+=`" value="#ffe133">
                <span style="background: #ffe133"></span>
            </label>
            <label>
                <input type="radio" name="dplayer-danmaku-color-`,o+=m(b),o+=`" value="#64dd17">
                <span style="background: #64dd17"></span>
            </label>
            <label>
                <input type="radio" name="dplayer-danmaku-color-`,o+=m(b),o+=`" value="#00d4f5">
                <span style="background: #00d4f5"></span>
            </label>
            <label>
                <input type="radio" name="dplayer-danmaku-color-`,o+=m(b),o+=`" value="#4763ff">
                <span style="background: #4763ff"></span>
            </label>
        </div>
    </div>
    <div class="dplayer-comment-setting-type">
        <div class="dplayer-comment-setting-title">`,o+=m(y("Set danmaku type")),o+=`</div>
        <label>
            <input type="radio" name="dplayer-danmaku-type-`,o+=m(b),o+=`" value="top">
            <span>`,o+=m(y("Top")),o+=`</span>
        </label>
        <label>
            <input type="radio" name="dplayer-danmaku-type-`,o+=m(b),o+=`" value="right" checked>
            <span>`,o+=m(y("Rolling")),o+=`</span>
        </label>
        <label>
            <input type="radio" name="dplayer-danmaku-type-`,o+=m(b),o+=`" value="bottom">
            <span>`,o+=m(y("Bottom")),o+=`</span>
        </label>
    </div>
    <div class="dplayer-comment-setting-size">
        <div class="dplayer-comment-setting-title">`,o+=m(y("Set danmaku size")),o+=`</div>
        <label>
            <input type="radio" name="dplayer-danmaku-size-`,o+=m(b),o+=`" value="big">
            <span>`,o+=m(y("Big")),o+=`</span>
        </label>
        <label>
            <input type="radio" name="dplayer-danmaku-size-`,o+=m(b),o+=`" value="medium" checked>
            <span>`,o+=m(y("Medium")),o+=`</span>
        </label>
        <label>
            <input type="radio" name="dplayer-danmaku-size-`,o+=m(b),o+=`" value="small">
            <span>`,o+=m(y("Small")),o+=`</span>
        </label>
    </div>
</div>
<div class="dplayer-info-panel dplayer-info-panel-hide">
    <div class="dplayer-info-panel-close">[x]</div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-version">
        <span class="dplayer-info-panel-item-title">Player Version</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-mimetype">
        <span class="dplayer-info-panel-item-title">Mime Type</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-video-fps">
        <span class="dplayer-info-panel-item-title">Video FPS</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-page-fps">
        <span class="dplayer-info-panel-item-title">Page FPS</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-dropped-frames">
        <span class="dplayer-info-panel-item-title">Dropped Frames</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-type">
        <span class="dplayer-info-panel-item-title">Video Type</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-url">
        <span class="dplayer-info-panel-item-title">Video URL</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-resolution">
        <span class="dplayer-info-panel-item-title">Video Resolution</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-duration">
        <span class="dplayer-info-panel-item-title">Video Duration</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-buffer-remain">
        <span class="dplayer-info-panel-item-title">Buffer Remain</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
    <div class="dplayer-info-panel-item dplayer-info-panel-item-download-speed">
        <span class="dplayer-info-panel-item-title">Download Speed</span>
        <span class="dplayer-info-panel-item-data"></span>
    </div>
</div>
<div class="dplayer-menu">
    `,S(p.contextmenu,function(x,L){o+=`
        <div class="dplayer-menu-item">
            <a`,x.link&&(o+=' target="_blank"'),o+=' href="',o+=m(x.link||"javascript:void(0);"),o+='">',o+=m(y(x.text)),o+=`</a>
        </div>
    `}),o+=`
</div>
<div class="dplayer-notice"></div>
<div class="dplayer-mobile-icon-wrap">
    <button class="dplayer-mobile-icon dplayer-mobile-icon-backward">
        `,o+=_.backward,o+=`
    </button>
    <button class="dplayer-mobile-icon dplayer-mobile-icon-play">
        `,o+=_.play,o+=`
    </button>
    <button class="dplayer-mobile-icon dplayer-mobile-icon-forward">
        `,o+=_.forward,o+=`
    </button>
</div>
`}},194:(r,d,u)=>{var c=u(143);r.exports=function(l){var h="",o=(l=l||{}).enableSubtitle,f=l.subtitle,p=l.current,m=l.airplay,y=l.pic,_=c.$escape,S=l.crossOrigin,b=l.screenshot,x=l.preload,L=l.url;return o=f&&f.type==="webvtt",h+=`
<video
    class="dplayer-video `,p&&(h+="dplayer-video-current"),h+=`"
    webkit-playsinline
    `,m&&(h+=' x-webkit-airplay="allow" '),h+=`
    playsinline
    `,y&&(h+='poster="',h+=_(y),h+='"'),h+=`
    `,(S!==null||b||o)&&(h+='crossorigin="',h+=_(S||"anonymous"),h+='"'),h+=`
    `,x&&(h+='preload="',h+=_(x),h+='"'),h+=`
    `,L&&(h+='src="',h+=_(L),h+='"'),h+=`
    >
    `,o&&(h+=`
    <track kind="metadata" default src="`,h+=_(f.url),h+=`"></track>
    `),h+=`
</video>
`}},880:(r,d,u)=>{u.d(d,{A:()=>f});var c=u(34),l=u.n(c),h=u(122),o=u.n(h)()(l());o.push([r.id,':root{--balloon-border-radius:2px;--balloon-color:#101010f2;--balloon-text-color:#fff;--balloon-font-size:12px;--balloon-move:4px}button[aria-label][data-balloon-pos]{overflow:visible}[aria-label][data-balloon-pos]{cursor:pointer;position:relative}[aria-label][data-balloon-pos]:after{background:var(--balloon-color);border-radius:2px;border-radius:var(--balloon-border-radius);color:var(--balloon-text-color);content:attr(aria-label);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-size:var(--balloon-font-size);font-style:normal;font-weight:400;padding:.5em 1em;text-indent:0;text-shadow:none;white-space:nowrap}[aria-label][data-balloon-pos]:after,[aria-label][data-balloon-pos]:before{opacity:0;pointer-events:none;position:absolute;transition:all .18s ease-out .18s;z-index:10}[aria-label][data-balloon-pos]:before{border:5px solid #0000;border-top:5px solid var(--balloon-color);content:"";height:0;width:0}[aria-label][data-balloon-pos]:hover:after,[aria-label][data-balloon-pos]:hover:before,[aria-label][data-balloon-pos]:not([data-balloon-nofocus]):focus:after,[aria-label][data-balloon-pos]:not([data-balloon-nofocus]):focus:before,[aria-label][data-balloon-pos][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-visible]:before{opacity:1;pointer-events:none}[aria-label][data-balloon-pos].font-awesome:after{font-family:FontAwesome,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif}[aria-label][data-balloon-pos][data-balloon-break]:after{white-space:pre}[aria-label][data-balloon-pos][data-balloon-break][data-balloon-length]:after{white-space:pre-line;word-break:break-word}[aria-label][data-balloon-pos][data-balloon-blunt]:after,[aria-label][data-balloon-pos][data-balloon-blunt]:before{transition:none}[aria-label][data-balloon-pos][data-balloon-pos=down]:hover:after,[aria-label][data-balloon-pos][data-balloon-pos=down]:hover:before,[aria-label][data-balloon-pos][data-balloon-pos=down][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-pos=down][data-balloon-visible]:before,[aria-label][data-balloon-pos][data-balloon-pos=up]:hover:after,[aria-label][data-balloon-pos][data-balloon-pos=up]:hover:before,[aria-label][data-balloon-pos][data-balloon-pos=up][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-pos=up][data-balloon-visible]:before{transform:translate(-50%)}[aria-label][data-balloon-pos][data-balloon-pos*=-left]:after{left:0}[aria-label][data-balloon-pos][data-balloon-pos*=-left]:before{left:5px}[aria-label][data-balloon-pos][data-balloon-pos*=-right]:after{right:0}[aria-label][data-balloon-pos][data-balloon-pos*=-right]:before{right:5px}[aria-label][data-balloon-pos][data-balloon-po*=-left]:hover:after,[aria-label][data-balloon-pos][data-balloon-po*=-left]:hover:before,[aria-label][data-balloon-pos][data-balloon-po*=-left][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-po*=-left][data-balloon-visible]:before,[aria-label][data-balloon-pos][data-balloon-pos*=-right]:hover:after,[aria-label][data-balloon-pos][data-balloon-pos*=-right]:hover:before,[aria-label][data-balloon-pos][data-balloon-pos*=-right][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-pos*=-right][data-balloon-visible]:before{transform:translate(0)}[aria-label][data-balloon-pos][data-balloon-pos^=up]:after,[aria-label][data-balloon-pos][data-balloon-pos^=up]:before{bottom:100%;transform:translateY(var(--balloon-move));transform-origin:top}[aria-label][data-balloon-pos][data-balloon-pos^=up]:after{margin-bottom:10px}[aria-label][data-balloon-pos][data-balloon-pos=up]:after,[aria-label][data-balloon-pos][data-balloon-pos=up]:before{left:50%;transform:translate(-50%,var(--balloon-move))}[aria-label][data-balloon-pos][data-balloon-pos^=down]:after,[aria-label][data-balloon-pos][data-balloon-pos^=down]:before{top:100%;transform:translateY(calc(var(--balloon-move)*-1))}[aria-label][data-balloon-pos][data-balloon-pos^=down]:after{margin-top:10px}[aria-label][data-balloon-pos][data-balloon-pos^=down]:before{border:5px solid #0000;border-bottom:5px solid var(--balloon-color);height:0;width:0}[aria-label][data-balloon-pos][data-balloon-pos=down]:after,[aria-label][data-balloon-pos][data-balloon-pos=down]:before{left:50%;transform:translate(-50%,calc(var(--balloon-move)*-1))}[aria-label][data-balloon-pos][data-balloon-pos=left]:hover:after,[aria-label][data-balloon-pos][data-balloon-pos=left]:hover:before,[aria-label][data-balloon-pos][data-balloon-pos=left][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-pos=left][data-balloon-visible]:before,[aria-label][data-balloon-pos][data-balloon-pos=right]:hover:after,[aria-label][data-balloon-pos][data-balloon-pos=right]:hover:before,[aria-label][data-balloon-pos][data-balloon-pos=right][data-balloon-visible]:after,[aria-label][data-balloon-pos][data-balloon-pos=right][data-balloon-visible]:before{transform:translateY(-50%)}[aria-label][data-balloon-pos][data-balloon-pos=left]:after,[aria-label][data-balloon-pos][data-balloon-pos=left]:before{right:100%;top:50%;transform:translate(var(--balloon-move),-50%)}[aria-label][data-balloon-pos][data-balloon-pos=left]:after{margin-right:10px}[aria-label][data-balloon-pos][data-balloon-pos=left]:before{border:5px solid #0000;border-left:5px solid var(--balloon-color);height:0;width:0}[aria-label][data-balloon-pos][data-balloon-pos=right]:after,[aria-label][data-balloon-pos][data-balloon-pos=right]:before{left:100%;top:50%;transform:translate(calc(var(--balloon-move)*-1),-50%)}[aria-label][data-balloon-pos][data-balloon-pos=right]:after{margin-left:10px}[aria-label][data-balloon-pos][data-balloon-pos=right]:before{border:5px solid #0000;border-right:5px solid var(--balloon-color);height:0;width:0}[aria-label][data-balloon-pos][data-balloon-length]:after{white-space:normal}[aria-label][data-balloon-pos][data-balloon-length=small]:after{width:80px}[aria-label][data-balloon-pos][data-balloon-length=medium]:after{width:150px}[aria-label][data-balloon-pos][data-balloon-length=large]:after{width:260px}[aria-label][data-balloon-pos][data-balloon-length=xlarge]:after{width:380px}@media screen and (max-width:768px){[aria-label][data-balloon-pos][data-balloon-length=xlarge]:after{width:90vw}}[aria-label][data-balloon-pos][data-balloon-length=fit]:after{width:100%}',"",{version:3,sources:["webpack://./node_modules/balloon-css/balloon.css"],names:[],mappings:"AAAA,MACE,2BAA4B,CAC5B,yBAAuC,CACvC,yBAA0B,CAC1B,wBAAyB,CACzB,kBAAqB,CAEvB,qCACE,gBAAmB,CAErB,+BAEE,cAAe,CADf,iBACiB,CACjB,qCAUE,+BAAgC,CAChC,iBAAkB,CAElB,0CAA2C,CAD3C,+BAAgC,CAEhC,wBAAyB,CATzB,wHAAwI,CAIxI,kCAAmC,CAFnC,iBAAkB,CADlB,eAAmB,CASnB,gBAAiB,CAXjB,aAAc,CAId,gBAAiB,CASjB,kBACa,CACf,2EAlBE,SAAU,CACV,mBAAoB,CAcpB,iBAAkB,CAblB,iCAAoC,CAepC,UAWa,CAVf,sCAIE,sBAAsC,CAAtC,yCAAsC,CAItC,UAAW,CANX,QAAS,CADT,OASa,CACf,6VACE,SAAU,CACV,mBAAsB,CACxB,kDACE,oIAAuJ,CACzJ,yDACE,eAAkB,CACpB,8EACE,oBAAqB,CACrB,qBAAwB,CAC1B,mHACE,eAAkB,CAGpB,4kBACE,yBAA+B,CACjC,8DACE,MAAS,CACX,+DACE,QAAW,CACb,+DACE,OAAU,CACZ,gEACE,SAAY,CAGd,omBACE,sBAA4B,CAC9B,uHACE,WAAY,CAEZ,yCAA4C,CAD5C,oBAC8C,CAChD,2DACE,kBAAqB,CACvB,qHACE,QAAS,CACT,6CAAiD,CACnD,2HACE,QAAS,CACT,kDAAyD,CAC3D,6DACE,eAAkB,CACpB,8DAIE,sBAAyC,CAAzC,4CAAyC,CAFzC,QAAS,CADT,OAG2C,CAC7C,yHACE,QAAS,CACT,sDAA4D,CAG9D,wlBACE,0BAA+B,CACjC,yHACE,UAAW,CACX,OAAQ,CACR,6CAAiD,CACnD,4DACE,iBAAoB,CACtB,6DAIE,sBAAuC,CAAvC,0CAAuC,CAFvC,QAAS,CADT,OAGyC,CAC3C,2HACE,SAAU,CACV,OAAQ,CACR,sDAA4D,CAC9D,6DACE,gBAAmB,CACrB,8DAIE,sBAAwC,CAAxC,2CAAwC,CAFxC,QAAS,CADT,OAG0C,CAC5C,0DACE,kBAAqB,CACvB,gEACE,UAAa,CACf,iEACE,WAAc,CAChB,gEACE,WAAc,CAChB,iEACE,WAAc,CACd,oCACE,iEACE,UAAa,CAAE,CACrB,8DACE,UAAa",sourcesContent:[`:root {
  --balloon-border-radius: 2px;
  --balloon-color: rgba(16, 16, 16, 0.95);
  --balloon-text-color: #fff;
  --balloon-font-size: 12px;
  --balloon-move: 4px; }

button[aria-label][data-balloon-pos] {
  overflow: visible; }

[aria-label][data-balloon-pos] {
  position: relative;
  cursor: pointer; }
  [aria-label][data-balloon-pos]:after {
    opacity: 0;
    pointer-events: none;
    transition: all 0.18s ease-out 0.18s;
    text-indent: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    font-weight: normal;
    font-style: normal;
    text-shadow: none;
    font-size: var(--balloon-font-size);
    background: var(--balloon-color);
    border-radius: 2px;
    color: var(--balloon-text-color);
    border-radius: var(--balloon-border-radius);
    content: attr(aria-label);
    padding: .5em 1em;
    position: absolute;
    white-space: nowrap;
    z-index: 10; }
  [aria-label][data-balloon-pos]:before {
    width: 0;
    height: 0;
    border: 5px solid transparent;
    border-top-color: var(--balloon-color);
    opacity: 0;
    pointer-events: none;
    transition: all 0.18s ease-out 0.18s;
    content: "";
    position: absolute;
    z-index: 10; }
  [aria-label][data-balloon-pos]:hover:before, [aria-label][data-balloon-pos]:hover:after, [aria-label][data-balloon-pos][data-balloon-visible]:before, [aria-label][data-balloon-pos][data-balloon-visible]:after, [aria-label][data-balloon-pos]:not([data-balloon-nofocus]):focus:before, [aria-label][data-balloon-pos]:not([data-balloon-nofocus]):focus:after {
    opacity: 1;
    pointer-events: none; }
  [aria-label][data-balloon-pos].font-awesome:after {
    font-family: FontAwesome, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; }
  [aria-label][data-balloon-pos][data-balloon-break]:after {
    white-space: pre; }
  [aria-label][data-balloon-pos][data-balloon-break][data-balloon-length]:after {
    white-space: pre-line;
    word-break: break-word; }
  [aria-label][data-balloon-pos][data-balloon-blunt]:before, [aria-label][data-balloon-pos][data-balloon-blunt]:after {
    transition: none; }
  [aria-label][data-balloon-pos][data-balloon-pos="up"]:hover:after, [aria-label][data-balloon-pos][data-balloon-pos="up"][data-balloon-visible]:after, [aria-label][data-balloon-pos][data-balloon-pos="down"]:hover:after, [aria-label][data-balloon-pos][data-balloon-pos="down"][data-balloon-visible]:after {
    transform: translate(-50%, 0); }
  [aria-label][data-balloon-pos][data-balloon-pos="up"]:hover:before, [aria-label][data-balloon-pos][data-balloon-pos="up"][data-balloon-visible]:before, [aria-label][data-balloon-pos][data-balloon-pos="down"]:hover:before, [aria-label][data-balloon-pos][data-balloon-pos="down"][data-balloon-visible]:before {
    transform: translate(-50%, 0); }
  [aria-label][data-balloon-pos][data-balloon-pos*="-left"]:after {
    left: 0; }
  [aria-label][data-balloon-pos][data-balloon-pos*="-left"]:before {
    left: 5px; }
  [aria-label][data-balloon-pos][data-balloon-pos*="-right"]:after {
    right: 0; }
  [aria-label][data-balloon-pos][data-balloon-pos*="-right"]:before {
    right: 5px; }
  [aria-label][data-balloon-pos][data-balloon-po*="-left"]:hover:after, [aria-label][data-balloon-pos][data-balloon-po*="-left"][data-balloon-visible]:after, [aria-label][data-balloon-pos][data-balloon-pos*="-right"]:hover:after, [aria-label][data-balloon-pos][data-balloon-pos*="-right"][data-balloon-visible]:after {
    transform: translate(0, 0); }
  [aria-label][data-balloon-pos][data-balloon-po*="-left"]:hover:before, [aria-label][data-balloon-pos][data-balloon-po*="-left"][data-balloon-visible]:before, [aria-label][data-balloon-pos][data-balloon-pos*="-right"]:hover:before, [aria-label][data-balloon-pos][data-balloon-pos*="-right"][data-balloon-visible]:before {
    transform: translate(0, 0); }
  [aria-label][data-balloon-pos][data-balloon-pos^="up"]:before, [aria-label][data-balloon-pos][data-balloon-pos^="up"]:after {
    bottom: 100%;
    transform-origin: top;
    transform: translate(0, var(--balloon-move)); }
  [aria-label][data-balloon-pos][data-balloon-pos^="up"]:after {
    margin-bottom: 10px; }
  [aria-label][data-balloon-pos][data-balloon-pos="up"]:before, [aria-label][data-balloon-pos][data-balloon-pos="up"]:after {
    left: 50%;
    transform: translate(-50%, var(--balloon-move)); }
  [aria-label][data-balloon-pos][data-balloon-pos^="down"]:before, [aria-label][data-balloon-pos][data-balloon-pos^="down"]:after {
    top: 100%;
    transform: translate(0, calc(var(--balloon-move) * -1)); }
  [aria-label][data-balloon-pos][data-balloon-pos^="down"]:after {
    margin-top: 10px; }
  [aria-label][data-balloon-pos][data-balloon-pos^="down"]:before {
    width: 0;
    height: 0;
    border: 5px solid transparent;
    border-bottom-color: var(--balloon-color); }
  [aria-label][data-balloon-pos][data-balloon-pos="down"]:after, [aria-label][data-balloon-pos][data-balloon-pos="down"]:before {
    left: 50%;
    transform: translate(-50%, calc(var(--balloon-move) * -1)); }
  [aria-label][data-balloon-pos][data-balloon-pos="left"]:hover:after, [aria-label][data-balloon-pos][data-balloon-pos="left"][data-balloon-visible]:after, [aria-label][data-balloon-pos][data-balloon-pos="right"]:hover:after, [aria-label][data-balloon-pos][data-balloon-pos="right"][data-balloon-visible]:after {
    transform: translate(0, -50%); }
  [aria-label][data-balloon-pos][data-balloon-pos="left"]:hover:before, [aria-label][data-balloon-pos][data-balloon-pos="left"][data-balloon-visible]:before, [aria-label][data-balloon-pos][data-balloon-pos="right"]:hover:before, [aria-label][data-balloon-pos][data-balloon-pos="right"][data-balloon-visible]:before {
    transform: translate(0, -50%); }
  [aria-label][data-balloon-pos][data-balloon-pos="left"]:after, [aria-label][data-balloon-pos][data-balloon-pos="left"]:before {
    right: 100%;
    top: 50%;
    transform: translate(var(--balloon-move), -50%); }
  [aria-label][data-balloon-pos][data-balloon-pos="left"]:after {
    margin-right: 10px; }
  [aria-label][data-balloon-pos][data-balloon-pos="left"]:before {
    width: 0;
    height: 0;
    border: 5px solid transparent;
    border-left-color: var(--balloon-color); }
  [aria-label][data-balloon-pos][data-balloon-pos="right"]:after, [aria-label][data-balloon-pos][data-balloon-pos="right"]:before {
    left: 100%;
    top: 50%;
    transform: translate(calc(var(--balloon-move) * -1), -50%); }
  [aria-label][data-balloon-pos][data-balloon-pos="right"]:after {
    margin-left: 10px; }
  [aria-label][data-balloon-pos][data-balloon-pos="right"]:before {
    width: 0;
    height: 0;
    border: 5px solid transparent;
    border-right-color: var(--balloon-color); }
  [aria-label][data-balloon-pos][data-balloon-length]:after {
    white-space: normal; }
  [aria-label][data-balloon-pos][data-balloon-length="small"]:after {
    width: 80px; }
  [aria-label][data-balloon-pos][data-balloon-length="medium"]:after {
    width: 150px; }
  [aria-label][data-balloon-pos][data-balloon-length="large"]:after {
    width: 260px; }
  [aria-label][data-balloon-pos][data-balloon-length="xlarge"]:after {
    width: 380px; }
    @media screen and (max-width: 768px) {
      [aria-label][data-balloon-pos][data-balloon-length="xlarge"]:after {
        width: 90vw; } }
  [aria-label][data-balloon-pos][data-balloon-length="fit"]:after {
    width: 100%; }
`],sourceRoot:""}]);const f=o},420:(r,d,u)=>{u.d(d,{A:()=>m});var c=u(34),l=u.n(c),h=u(122),o=u.n(h),f=u(880),p=o()(l());p.i(f.A),p.push([r.id,'@keyframes my-face{2%{transform:translateY(1.5px) rotate(1.5deg)}4%{transform:translateY(-1.5px) rotate(-.5deg)}6%{transform:translateY(1.5px) rotate(-1.5deg)}8%{transform:translateY(-1.5px) rotate(-1.5deg)}10%{transform:translateY(2.5px) rotate(1.5deg)}12%{transform:translateY(-.5px) rotate(1.5deg)}14%{transform:translateY(-1.5px) rotate(1.5deg)}16%{transform:translateY(-.5px) rotate(-1.5deg)}18%{transform:translateY(.5px) rotate(-1.5deg)}20%{transform:translateY(-1.5px) rotate(2.5deg)}22%{transform:translateY(.5px) rotate(-1.5deg)}24%{transform:translateY(1.5px) rotate(1.5deg)}26%{transform:translateY(.5px) rotate(.5deg)}28%{transform:translateY(.5px) rotate(1.5deg)}30%{transform:translateY(-.5px) rotate(2.5deg)}32%{transform:translateY(1.5px) rotate(-.5deg)}34%{transform:translateY(1.5px) rotate(-.5deg)}36%{transform:translateY(-1.5px) rotate(2.5deg)}38%{transform:translateY(1.5px) rotate(-1.5deg)}40%{transform:translateY(-.5px) rotate(2.5deg)}42%{transform:translateY(2.5px) rotate(-1.5deg)}44%{transform:translateY(1.5px) rotate(.5deg)}46%{transform:translateY(-1.5px) rotate(2.5deg)}48%{transform:translateY(-.5px) rotate(.5deg)}50%{transform:translateY(.5px) rotate(.5deg)}52%{transform:translateY(2.5px) rotate(2.5deg)}54%{transform:translateY(-1.5px) rotate(1.5deg)}56%{transform:translateY(2.5px) rotate(2.5deg)}58%{transform:translateY(.5px) rotate(2.5deg)}60%{transform:translateY(2.5px) rotate(2.5deg)}62%{transform:translateY(-.5px) rotate(2.5deg)}64%{transform:translateY(-.5px) rotate(1.5deg)}66%{transform:translateY(1.5px) rotate(-.5deg)}68%{transform:translateY(-1.5px) rotate(-.5deg)}70%{transform:translateY(1.5px) rotate(.5deg)}72%{transform:translateY(2.5px) rotate(1.5deg)}74%{transform:translateY(-.5px) rotate(.5deg)}76%{transform:translateY(-.5px) rotate(2.5deg)}78%{transform:translateY(-.5px) rotate(1.5deg)}80%{transform:translateY(1.5px) rotate(1.5deg)}82%{transform:translateY(-.5px) rotate(.5deg)}84%{transform:translateY(1.5px) rotate(2.5deg)}86%{transform:translateY(-1.5px) rotate(-1.5deg)}88%{transform:translateY(-.5px) rotate(2.5deg)}90%{transform:translateY(2.5px) rotate(-.5deg)}92%{transform:translateY(.5px) rotate(-.5deg)}94%{transform:translateY(2.5px) rotate(.5deg)}96%{transform:translateY(-.5px) rotate(1.5deg)}98%{transform:translateY(-1.5px) rotate(-.5deg)}0%,to{transform:translate(0) rotate(0deg)}}.dplayer{line-height:1;overflow:hidden;position:relative;user-select:none;-webkit-user-select:none}.dplayer *{box-sizing:initial}.dplayer svg{height:100%;width:100%}.dplayer svg circle,.dplayer svg path{fill:#fff}.dplayer.dplayer-fulled,.dplayer.dplayer-fulled-browser{background:#000;height:100%!important;left:0;margin:0;padding:0;position:fixed;top:0;transform:translate(0);width:100%!important;z-index:100000}.dplayer.dplayer-live .dplayer-bar-wrap,.dplayer.dplayer-live .dplayer-time,.dplayer.dplayer-no-audio-switching .dplayer-setting-box .dplayer-setting-audio,.dplayer.dplayer-no-danmaku .dplayer-controller .dplayer-icons .dplayer-comment,.dplayer.dplayer-no-danmaku .dplayer-danmaku,.dplayer.dplayer-no-danmaku .dplayer-setting-box .dplayer-setting-danmaku,.dplayer.dplayer-no-danmaku .dplayer-setting-box .dplayer-setting-danunlimit,.dplayer.dplayer-no-danmaku .dplayer-setting-box .dplayer-setting-showdan{display:none}.dplayer.dplayer-live .dplayer-notice{bottom:56px}.dplayer.dplayer-live .dplayer-setting-loop,.dplayer.dplayer-live .dplayer-setting-speed{display:none}.dplayer.dplayer-live .dplayer-controller .dplayer-icons .dplayer-setting-box{height:auto;overflow-y:hidden}.dplayer.dplayer-live .dplayer-mobile-icon-backward,.dplayer.dplayer-live .dplayer-mobile-icon-forward{display:none}.dplayer.dplayer-live .dplayer-comment-setting-box,.dplayer.dplayer-live .dplayer-setting-box{bottom:58px;max-height:calc(100% - 66px)}.dplayer.dplayer-live.dplayer-mobile .dplayer-comment-setting-box,.dplayer.dplayer-live.dplayer-mobile .dplayer-setting-box{bottom:52px;max-height:calc(100% - 60px)}.dplayer.dplayer-narrow .dplayer-danmaku{font-size:18px}.dplayer.dplayer-narrow .dplayer-icon{margin:0 -3px}.dplayer.dplayer-playing .dplayer-danmaku .dplayer-danmaku-move{animation-play-state:running}.dplayer.dplayer-playing .dplayer-controller,.dplayer.dplayer-playing .dplayer-controller-mask{opacity:0}.dplayer.dplayer-playing:hover .dplayer-controller,.dplayer.dplayer-playing:hover .dplayer-controller-mask{opacity:1}.dplayer.dplayer-loading .dplayer-bezel .dplayer-loading-icon{display:block}.dplayer.dplayer-loading .dplayer-danmaku,.dplayer.dplayer-loading .dplayer-danmaku-move,.dplayer.dplayer-paused .dplayer-danmaku,.dplayer.dplayer-paused .dplayer-danmaku-move{animation-play-state:paused}.dplayer.dplayer-show-controller .dplayer-controller,.dplayer.dplayer-show-controller .dplayer-controller-mask{opacity:1}.dplayer.dplayer-fulled{height:100%!important;left:0;position:fixed!important;top:0;width:100%!important;z-index:100000}.dplayer.dplayer-fulled.dplayer-hide-controller{cursor:none}.dplayer.dplayer-fulled.dplayer-hide-controller .dplayer-controller,.dplayer.dplayer-fulled.dplayer-hide-controller .dplayer-controller-mask{opacity:0!important}.dplayer.dplayer-fulled-browser.dplayer-hide-controller{cursor:none}.dplayer.dplayer-fulled-browser.dplayer-hide-controller .dplayer-controller,.dplayer.dplayer-fulled-browser.dplayer-hide-controller .dplayer-controller-mask{opacity:0!important}.dplayer.dplayer-mobile .dplayer-controller{height:44px}.dplayer.dplayer-mobile .dplayer-controller .dplayer-icons{padding-bottom:3px;padding-top:3px}.dplayer.dplayer-mobile .dplayer-controller .dplayer-icons .dplayer-airplay-icon,.dplayer.dplayer-mobile .dplayer-controller .dplayer-icons .dplayer-play-icon,.dplayer.dplayer-mobile .dplayer-controller .dplayer-icons .dplayer-volume{display:none}.dplayer.dplayer-mobile .dplayer-controller .dplayer-icons .dplayer-full .dplayer-full-in-icon,.dplayer.dplayer-mobile .dplayer-controller .dplayer-icons .dplayer-full .dplayer-pip-icon{display:inline-block;position:static}.dplayer.dplayer-mobile .dplayer-controller-mask{background:linear-gradient(#0000008c 78%,#000c);height:100%}.dplayer.dplayer-mobile.dplayer-playing .dplayer-controller,.dplayer.dplayer-mobile.dplayer-playing .dplayer-controller-mask{opacity:1}.dplayer.dplayer-mobile.dplayer-hide-controller .dplayer-controller-mask{opacity:0}.dplayer.dplayer-mobile.dplayer-hide-controller .dplayer-controller{opacity:0;transform:translateY(100%)}.dplayer.dplayer-mobile .dplayer-bar-wrap{bottom:40px}.dplayer.dplayer-mobile .dplayer-bar-wrap .dplayer-bar-time{display:none}.dplayer.dplayer-mobile .dplayer-comment-setting-box,.dplayer.dplayer-mobile .dplayer-setting-box{bottom:58px;max-height:calc(100% - 66px)}.dplayer.dplayer-mobile.dplayer-hide-controller .dplayer-mobile-icon-wrap{opacity:0;visibility:hidden}.dplayer.dplayer-mobile .dplayer-mobile-icon-wrap{opacity:.7;visibility:visible}.dplayer-web-fullscreen-fix{left:0;margin:0;padding:0;position:fixed;top:0}.dplayer [aria-label]{--balloon-font-size:11.5px}.dplayer [aria-label]:before{display:none}.dplayer [aria-label]:after{background:#111111b3!important;font-family:inherit!important;padding:.3em .8em!important}.dplayer [aria-label][data-balloon-pos=up]:after{margin-bottom:0!important}.dplayer-bezel{bottom:0;color:#fff;font-size:22px;left:0;pointer-events:none;position:absolute;right:0;top:0}.dplayer-bezel .dplayer-bezel-icon{background:#00000080;border-radius:50%;box-sizing:border-box;height:52px;left:50%;margin:-26px 0 0 -26px;opacity:0;padding:12px;pointer-events:none;position:absolute;top:50%;width:52px;will-change:transform}.dplayer-bezel .dplayer-bezel-icon.dplayer-bezel-transition{animation:bezel-hide .5s linear}@keyframes bezel-hide{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(2)}}.dplayer-bezel .dplayer-danloading{animation:my-face 5s ease-in-out infinite;font-size:14px;line-height:14px;margin-top:-7px;position:absolute;text-align:center;top:50%;width:100%}.dplayer-bezel .dplayer-loading-icon{display:none;height:36px;left:50%;margin:-18px 0 0 -18px;pointer-events:none;position:absolute;top:50%;width:36px}.dplayer-bezel .dplayer-loading-icon .dplayer-loading-hide{display:none}.dplayer-bezel .dplayer-loading-icon .dplayer-loading-dot{animation:dplayer-loading-dot-fade .8s ease infinite;opacity:0;transform-origin:4px 4px;will-change:transform}.dplayer-bezel .dplayer-loading-icon .dplayer-loading-dot.dplayer-loading-dot-7{animation-delay:.7s}.dplayer-bezel .dplayer-loading-icon .dplayer-loading-dot.dplayer-loading-dot-6{animation-delay:.6s}.dplayer-bezel .dplayer-loading-icon .dplayer-loading-dot.dplayer-loading-dot-5{animation-delay:.5s}.dplayer-bezel .dplayer-loading-icon .dplayer-loading-dot.dplayer-loading-dot-4{animation-delay:.4s}.dplayer-bezel .dplayer-loading-icon .dplayer-loading-dot.dplayer-loading-dot-3{animation-delay:.3s}.dplayer-bezel .dplayer-loading-icon .dplayer-loading-dot.dplayer-loading-dot-2{animation-delay:.2s}.dplayer-bezel .dplayer-loading-icon .dplayer-loading-dot.dplayer-loading-dot-1{animation-delay:.1s}@keyframes dplayer-loading-dot-fade{0%{opacity:.7;transform:scale(1.2)}50%{opacity:.25;transform:scale(.9)}to{opacity:.25;transform:scale(.85)}}.dplayer-controller-mask{background:linear-gradient(#0000 15%,#000000b3);height:98px;width:100%}.dplayer-controller,.dplayer-controller-mask{bottom:0;position:absolute;transition:all .3s ease}.dplayer-controller{height:50px;left:0;padding:0 20px;right:0;user-select:none;-webkit-user-select:none}.dplayer-controller.dplayer-controller-comment .dplayer-icons{display:none}.dplayer-controller.dplayer-controller-comment .dplayer-icons.dplayer-comment-box{display:block}.dplayer-controller .dplayer-bar-wrap{bottom:46px;cursor:pointer;height:3px;padding:5px 0;position:absolute;width:calc(100% - 40px)}.dplayer-controller .dplayer-bar-wrap:hover .dplayer-bar .dplayer-played .dplayer-thumb{transform:scale(1)}.dplayer-controller .dplayer-bar-wrap:hover .dplayer-highlight{display:block;height:40%;top:4px;transform:translateX(-4px);width:8px}.dplayer-controller .dplayer-bar-wrap .dplayer-highlight{background-color:#fff;border-radius:6px;height:20%;position:absolute;text-align:center;top:5px;transform:translateX(-3px);transition:all .2s ease-in-out;width:6px;z-index:12}.dplayer-controller .dplayer-bar-wrap .dplayer-highlight:hover .dplayer-highlight-text{display:block}.dplayer-controller .dplayer-bar-wrap .dplayer-highlight:hover~.dplayer-bar-preview,.dplayer-controller .dplayer-bar-wrap .dplayer-highlight:hover~.dplayer-bar-time{opacity:0}.dplayer-controller .dplayer-bar-wrap .dplayer-highlight .dplayer-highlight-text{background-color:#0000009e;border-radius:4px;color:#fff;display:none;font-size:12px;left:50%;padding:5px 8px;position:absolute;top:-24px;transform:translateX(-50%);white-space:nowrap}.dplayer-controller .dplayer-bar-wrap .dplayer-bar-preview{background:#fff;background-size:16000px 100%;border-radius:6px;display:none;pointer-events:none;position:absolute}.dplayer-controller .dplayer-bar-wrap .dplayer-bar-preview-canvas{height:100%;pointer-events:none;position:absolute;width:100%;z-index:1}.dplayer-controller .dplayer-bar-wrap .dplayer-bar-time{word-wrap:normal;background-color:#0000009e;border-radius:4px;color:#fff;font-size:12px;left:0;opacity:1;padding:5px 7px;pointer-events:none;position:absolute;text-align:center;top:-20px;transition:opacity .1s ease-in-out;word-break:normal;z-index:2}.dplayer-controller .dplayer-bar-wrap .dplayer-bar-time.hidden{opacity:0}.dplayer-controller .dplayer-bar-wrap .dplayer-bar{background:#fff3;cursor:pointer;height:4px;position:relative;width:100%}.dplayer-controller .dplayer-bar-wrap .dplayer-bar .dplayer-loaded{background:#fff;transition:all .5s ease}.dplayer-controller .dplayer-bar-wrap .dplayer-bar .dplayer-loaded,.dplayer-controller .dplayer-bar-wrap .dplayer-bar .dplayer-played{bottom:0;height:4px;left:0;position:absolute;top:0;will-change:width}.dplayer-controller .dplayer-bar-wrap .dplayer-bar .dplayer-played .dplayer-thumb{border-radius:50%;cursor:pointer;height:11px;margin-right:-10px;margin-top:-4px;position:absolute;right:5px;top:0;transform:scale(0);transition:all .3s ease-in-out;width:11px}.dplayer-controller .dplayer-icons{-webkit-tap-highlight-color:rgba(0,0,0,0);bottom:0;height:38px;padding-bottom:6px;padding-top:6px;position:absolute}.dplayer-controller .dplayer-icons.dplayer-comment-box{bottom:0;color:#fff;display:none;height:38px;left:20px;position:absolute;right:20px;transition:all .3s ease-in-out;z-index:2}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-icon{padding:7px}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-icon{left:0;position:absolute;top:0}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-send-icon{position:absolute;right:0;top:0}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-send-icon[aria-label]:after{left:14%}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-input{background:none;border:none;border-radius:4px;box-sizing:border-box;color:#fff;font-family:inherit;font-size:14px;height:100%;line-height:18px;margin:0;outline:none;padding:8px 0;text-align:center;width:100%}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-input::placeholder{color:#fff;opacity:.8}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-input::-moz-focus-inner{border:0}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-input::-ms-clear{display:none}@media(max-width:350px){.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box{padding:9px 10px 15px}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-setting-box .dplayer-comment-setting-title{font-size:12px;line-height:24px}.dplayer-controller .dplayer-icons.dplayer-comment-box .dplayer-comment-input{font-size:12px}}.dplayer-controller .dplayer-icons.dplayer-icons-left .dplayer-icon{padding:7px}@media(max-width:500px){.dplayer-controller .dplayer-icons.dplayer-icons-left .dplayer-icon{padding-top:6px}}@media(max-width:350px){.dplayer-controller .dplayer-icons.dplayer-icons-left .dplayer-icon{padding-top:7px}}.dplayer-controller .dplayer-icons.dplayer-icons-right{right:20px}.dplayer-controller .dplayer-icons.dplayer-icons-right .dplayer-icon{padding:8px}@media(max-width:500px){.dplayer-controller .dplayer-icons.dplayer-icons-right .dplayer-icon{padding:7px;width:38px}}@media(max-width:350px){.dplayer-controller .dplayer-icons.dplayer-icons-right .dplayer-icon{padding:5px;width:31px}}.dplayer-controller .dplayer-icons .dplayer-time{color:#eee;font-family:inherit;font-size:13px;line-height:38px;text-shadow:0 0 2px #00000080;vertical-align:middle}@media(max-width:350px){.dplayer-controller .dplayer-icons .dplayer-time{font-size:12px}}.dplayer-controller .dplayer-icons .dplayer-live-badge{align-items:center;color:#eee;cursor:pointer;display:inline-flex;font-family:inherit;font-size:13px;height:100%;line-height:18px;text-shadow:0 0 2px #00000080;vertical-align:middle}.dplayer-controller .dplayer-icons .dplayer-live-dot{border-radius:6px;content:"";display:inline-block;height:6px;margin-right:5px;vertical-align:4%;width:6px}.dplayer-controller .dplayer-icons .dplayer-icon{background-color:#0000;border:none;box-sizing:border-box;cursor:pointer;display:inline-block;height:100%;line-height:18px;outline:none;vertical-align:middle;width:40px}.dplayer-controller .dplayer-icons .dplayer-icon .dplayer-icon-content{opacity:.8;transition:all .2s ease-in-out}.dplayer-controller .dplayer-icons .dplayer-icon:hover .dplayer-icon-content{opacity:1}.dplayer-controller .dplayer-icons .dplayer-icon::-moz-focus-inner{border:0}.dplayer-controller .dplayer-icons .dplayer-icon.dplayer-comment-icon{padding:10.5px 9.5px 8px}@media(max-width:500px){.dplayer-controller .dplayer-icons .dplayer-icon.dplayer-comment-icon{padding:9px 9px 8px}}@media(max-width:350px){.dplayer-controller .dplayer-icons .dplayer-icon.dplayer-comment-icon{padding:6.5px 6.5px 6px}}.dplayer-controller .dplayer-icons .dplayer-icon.dplayer-volume-icon{width:43px}.dplayer-controller .dplayer-icons .dplayer-icon.dplayer-full-icon[aria-label]:after{left:1%}@media(max-width:350px){.dplayer-controller .dplayer-icons .dplayer-icon{width:35px}}.dplayer-controller .dplayer-icons .dplayer-volume{cursor:pointer;display:inline-block;height:100%;position:relative}.dplayer-controller .dplayer-icons .dplayer-volume:hover .dplayer-volume-bar-wrap .dplayer-volume-bar{width:45px}.dplayer-controller .dplayer-icons .dplayer-volume:hover .dplayer-volume-bar-wrap .dplayer-volume-bar .dplayer-volume-bar-inner .dplayer-thumb{transform:scale(1)}.dplayer-controller .dplayer-icons .dplayer-volume.dplayer-volume-active .dplayer-volume-bar-wrap .dplayer-volume-bar{width:45px}.dplayer-controller .dplayer-icons .dplayer-volume.dplayer-volume-active .dplayer-volume-bar-wrap .dplayer-volume-bar .dplayer-volume-bar-inner .dplayer-thumb{transform:scale(1)}.dplayer-controller .dplayer-icons .dplayer-volume .dplayer-volume-bar-wrap{display:inline-block;height:100%;margin:0 10px 0 -5px;vertical-align:middle}.dplayer-controller .dplayer-icons .dplayer-volume .dplayer-volume-bar-wrap .dplayer-volume-bar{background:#fff;height:4px;position:relative;top:17px;transition:all .3s ease-in-out;width:0}.dplayer-controller .dplayer-icons .dplayer-volume .dplayer-volume-bar-wrap .dplayer-volume-bar .dplayer-volume-bar-inner{bottom:0;height:100%;left:0;position:absolute;transition:all .1s ease;will-change:width}.dplayer-controller .dplayer-icons .dplayer-volume .dplayer-volume-bar-wrap .dplayer-volume-bar .dplayer-volume-bar-inner .dplayer-thumb{border-radius:50%;cursor:pointer;height:11px;margin-right:-10px;margin-top:-4px;position:absolute;right:5px;top:0;transform:scale(0);transition:all .3s ease-in-out;width:11px}.dplayer-controller .dplayer-icons .dplayer-setting,.dplayer-controller .dplayer-icons .dplayer-subtitle-btn{display:inline-block;height:100%}.dplayer-controller .dplayer-icons .dplayer-full{display:inline-block;height:100%;position:relative}.dplayer-controller .dplayer-icons .dplayer-comment{display:inline-block;height:100%}.dplayer-mobile-icon-wrap{align-items:center;display:flex;height:50px;justify-content:space-evenly;left:50%;opacity:0;pointer-events:none;position:absolute;top:50%;transform:translate(-50%,-50%);transition:all .28s ease;visibility:hidden;width:100%}.dplayer-mobile-icon-wrap .dplayer-mobile-icon{-webkit-tap-highlight-color:rgba(0,0,0,0);background-color:#0000;border:none;box-sizing:border-box;cursor:pointer;filter:drop-shadow(0 0 7px rgba(0,0,0,.5));height:50px;outline:none;pointer-events:auto;width:50px}.dplayer-mobile-icon-wrap .dplayer-mobile-icon-backward,.dplayer-mobile-icon-wrap .dplayer-mobile-icon-forward{padding:12px}.dplayer-setting-box{-webkit-tap-highlight-color:rgba(0,0,0,0);background:#1c1c1ce6;border-radius:7px;bottom:64px;box-sizing:border-box;display:flex;height:calc(100% - 72px);opacity:0;overflow-x:hidden;overflow-y:hidden;position:absolute;right:20px;transition:all .25s ease;visibility:hidden;width:210px;z-index:2}.dplayer-setting-box>div{overflow-x:hidden}.dplayer-setting-box>div.dplayer-setting-origin-panel{display:block}.dplayer-setting-box.dplayer-setting-box-open{opacity:1;visibility:visible}.dplayer-setting-box.dplayer-setting-box-quality{clip-path:inset(calc(100% - 30px*var(--quality-length) - 54px) 0 0 round 7px)!important}.dplayer-setting-box.dplayer-setting-box-quality .dplayer-setting-origin-panel{transform:translateX(-100%)}.dplayer-setting-box.dplayer-setting-box-quality .dplayer-setting-quality-panel{display:block;transform:translateX(0)}.dplayer-setting-box.dplayer-setting-box-speed{clip-path:inset(calc(100% - 294px) 0 0 round 7px)!important}.dplayer-setting-box.dplayer-setting-box-speed .dplayer-setting-origin-panel{transform:translateX(-100%)}.dplayer-setting-box.dplayer-setting-box-speed .dplayer-setting-speed-panel{display:block;transform:translateX(0)}.dplayer-setting-box.dplayer-setting-box-audio{clip-path:inset(calc(100% - 114px) 0 0 round 7px)!important}.dplayer-setting-box.dplayer-setting-box-audio .dplayer-setting-origin-panel{transform:translateX(-100%)}.dplayer-setting-box.dplayer-setting-box-audio .dplayer-setting-audio-panel{display:block;transform:translateX(0)}.dplayer-setting-box .dplayer-label{color:#eee;display:inline-block;font-size:13px;vertical-align:middle;white-space:nowrap}.dplayer-setting-box .dplayer-label-value{color:#e0e0e0;display:inline-block;font-size:12px;margin-left:auto;margin-right:23px;vertical-align:middle;white-space:nowrap}.dplayer-setting-box .dplayer-toggle{font-size:0;height:20px;position:absolute;right:7px;text-align:center;top:5px;vertical-align:middle;width:20px}.dplayer-setting-box .dplayer-toggle input{display:none;max-height:0;max-width:0}.dplayer-setting-box .dplayer-toggle input+label{border:1px solid #dfdfdf;border-radius:10px;box-shadow:inset 0 0 0 0 #dfdfdf;box-sizing:border-box;cursor:pointer;display:inline-block;height:20px;position:relative;right:15px;transition:.25s ease;width:32px}.dplayer-setting-box .dplayer-toggle input+label:before{border-radius:15px;content:"";display:block;height:19px;left:-.5px;position:absolute;top:-.5px;transition:.25s ease;width:19px}.dplayer-setting-box .dplayer-toggle input+label:after{background:#fff;border-radius:15px;box-shadow:0 1px 3px #0006;content:"";display:block;height:18.1px;left:0;position:absolute;top:-.1px;transition:.25s ease;width:18.1px}.dplayer-setting-box .dplayer-toggle input:checked+label{border-color:var(--theme-color)}.dplayer-setting-box .dplayer-toggle input:checked+label:before{background:var(--theme-color);width:31px}.dplayer-setting-box .dplayer-toggle input:checked+label:after{left:12px}.dplayer-setting-box .dplayer-setting-audio-panel,.dplayer-setting-box .dplayer-setting-origin-panel,.dplayer-setting-box .dplayer-setting-quality-panel,.dplayer-setting-box .dplayer-setting-speed-panel{bottom:0;box-sizing:border-box;max-height:100%;overflow-y:auto;padding:7px 0;position:absolute;scrollbar-width:thin;transition:transform .25s ease;width:100%}.dplayer-setting-box .dplayer-setting-audio-panel::-webkit-scrollbar,.dplayer-setting-box .dplayer-setting-origin-panel::-webkit-scrollbar,.dplayer-setting-box .dplayer-setting-quality-panel::-webkit-scrollbar,.dplayer-setting-box .dplayer-setting-speed-panel::-webkit-scrollbar{width:6px}.dplayer-setting-box .dplayer-setting-audio-panel::-webkit-scrollbar-thumb,.dplayer-setting-box .dplayer-setting-origin-panel::-webkit-scrollbar-thumb,.dplayer-setting-box .dplayer-setting-quality-panel::-webkit-scrollbar-thumb,.dplayer-setting-box .dplayer-setting-speed-panel::-webkit-scrollbar-thumb{background:#ffffff26}.dplayer-setting-box .dplayer-setting-origin-panel{transform:translateX(0)}.dplayer-setting-box .dplayer-setting-audio-panel,.dplayer-setting-box .dplayer-setting-quality-panel,.dplayer-setting-box .dplayer-setting-speed-panel{transform:translateX(100%)}.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-header,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-header,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-header{align-items:center;border-bottom:2px solid #ffffff26;box-sizing:border-box;cursor:pointer;display:flex;height:33px;margin-bottom:7px;padding-bottom:5px;padding-left:5px}.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-audio-item,.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-quality-item,.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-speed-item,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-audio-item,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-quality-item,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-speed-item,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-audio-item,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-quality-item,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-speed-item{padding:5px}.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-audio-item .dplayer-toggle,.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-quality-item .dplayer-toggle,.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-speed-item .dplayer-toggle,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-audio-item .dplayer-toggle,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-quality-item .dplayer-toggle,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-speed-item .dplayer-toggle,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-audio-item .dplayer-toggle,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-quality-item .dplayer-toggle,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-speed-item .dplayer-toggle{visibility:hidden}.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-audio-item.dplayer-setting-audio-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-audio-item.dplayer-setting-quality-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-audio-item.dplayer-setting-speed-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-quality-item.dplayer-setting-audio-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-quality-item.dplayer-setting-quality-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-quality-item.dplayer-setting-speed-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-speed-item.dplayer-setting-audio-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-speed-item.dplayer-setting-quality-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-setting-speed-item.dplayer-setting-speed-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-audio-item.dplayer-setting-audio-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-audio-item.dplayer-setting-quality-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-audio-item.dplayer-setting-speed-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-quality-item.dplayer-setting-audio-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-quality-item.dplayer-setting-quality-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-quality-item.dplayer-setting-speed-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-speed-item.dplayer-setting-audio-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-speed-item.dplayer-setting-quality-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-setting-speed-item.dplayer-setting-speed-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-audio-item.dplayer-setting-audio-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-audio-item.dplayer-setting-quality-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-audio-item.dplayer-setting-speed-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-quality-item.dplayer-setting-audio-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-quality-item.dplayer-setting-quality-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-quality-item.dplayer-setting-speed-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-speed-item.dplayer-setting-audio-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-speed-item.dplayer-setting-quality-current .dplayer-toggle,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-setting-speed-item.dplayer-setting-speed-current .dplayer-toggle{visibility:visible}.dplayer-setting-box .dplayer-setting-audio-panel .dplayer-toggle,.dplayer-setting-box .dplayer-setting-quality-panel .dplayer-toggle,.dplayer-setting-box .dplayer-setting-speed-panel .dplayer-toggle{display:inline-block;margin-right:6px;position:static;width:22px}.dplayer-setting-box .dplayer-setting-audio-item,.dplayer-setting-box .dplayer-setting-item,.dplayer-setting-box .dplayer-setting-quality-item,.dplayer-setting-box .dplayer-setting-speed-item{align-items:center;box-sizing:border-box;cursor:pointer;display:flex;height:30px;padding:5px 10px;position:relative}.dplayer-setting-box .dplayer-setting-audio-item:hover,.dplayer-setting-box .dplayer-setting-item:hover,.dplayer-setting-box .dplayer-setting-quality-item:hover,.dplayer-setting-box .dplayer-setting-speed-item:hover{background-color:#ffffff1a}.dplayer-setting-box .dplayer-setting-danmaku{padding:5px 0}.dplayer-setting-box .dplayer-setting-danmaku .dplayer-label{display:inline;padding:0 10px}.dplayer-setting-box .dplayer-setting-danmaku .dplayer-label-value{font-size:12.5px;margin-right:18px}.dplayer-setting-box .dplayer-setting-danmaku:hover .dplayer-label,.dplayer-setting-box .dplayer-setting-danmaku:hover .dplayer-label-value{display:none}.dplayer-setting-box .dplayer-setting-danmaku:hover .dplayer-danmaku-bar-wrap{display:inline-block}.dplayer-setting-box .dplayer-setting-danmaku.dplayer-setting-danmaku-active .dplayer-label,.dplayer-setting-box .dplayer-setting-danmaku.dplayer-setting-danmaku-active .dplayer-label-value{display:none}.dplayer-setting-box .dplayer-setting-danmaku.dplayer-setting-danmaku-active .dplayer-danmaku-bar-wrap{display:inline-block}.dplayer-setting-box .dplayer-setting-danmaku .dplayer-danmaku-bar-wrap{box-sizing:border-box;display:none;height:100%;padding:0 10px;vertical-align:middle;width:100%}.dplayer-setting-box .dplayer-setting-danmaku .dplayer-danmaku-bar-wrap .dplayer-danmaku-bar{background:#fff;height:3px;position:relative;top:8.5px;transition:all .3s ease-in-out;width:100%}.dplayer-setting-box .dplayer-setting-danmaku .dplayer-danmaku-bar-wrap .dplayer-danmaku-bar .dplayer-danmaku-bar-inner{bottom:0;height:100%;left:0;position:absolute;transition:all .05s ease;will-change:width}.dplayer-setting-box .dplayer-setting-danmaku .dplayer-danmaku-bar-wrap .dplayer-danmaku-bar .dplayer-danmaku-bar-inner .dplayer-thumb{border-radius:50%;cursor:pointer;height:11px;margin-right:-10px;margin-top:-4px;position:absolute;right:5px;top:0;transition:all .3s ease-in-out;width:11px}.dplayer-comment-setting-box{-webkit-tap-highlight-color:rgba(0,0,0,0);background:#1c1c1ce6;border-radius:7px;bottom:64px;box-sizing:border-box;clip-path:inset(0 0 0 round 7px);font-size:14px;left:20px;max-height:calc(100% - 72px);opacity:0;overflow-y:auto;padding:10px 10px 16px;position:absolute;scrollbar-width:thin;transition:all .25s ease;visibility:hidden;width:255px;z-index:2}.dplayer-comment-setting-box::-webkit-scrollbar{width:6px}.dplayer-comment-setting-box::-webkit-scrollbar-thumb{background:#ffffff26}.dplayer-comment-setting-box.dplayer-comment-setting-open{opacity:1;visibility:visible}.dplayer-comment-setting-box input[type=radio]{display:none}.dplayer-comment-setting-box label{cursor:pointer}.dplayer-comment-setting-box .dplayer-comment-setting-title{color:#fff;font-size:13px;line-height:30px}.dplayer-comment-setting-box .dplayer-comment-setting-size,.dplayer-comment-setting-box .dplayer-comment-setting-type{font-size:0}.dplayer-comment-setting-box .dplayer-comment-setting-size.dplayer-comment-setting-size,.dplayer-comment-setting-box .dplayer-comment-setting-type.dplayer-comment-setting-size{margin-top:8px}.dplayer-comment-setting-box .dplayer-comment-setting-size .dplayer-comment-setting-title,.dplayer-comment-setting-box .dplayer-comment-setting-type .dplayer-comment-setting-title{margin-bottom:6px}.dplayer-comment-setting-box .dplayer-comment-setting-size label:nth-child(2) span,.dplayer-comment-setting-box .dplayer-comment-setting-type label:nth-child(2) span{border-radius:4px 0 0 4px}.dplayer-comment-setting-box .dplayer-comment-setting-size label:nth-child(4) span,.dplayer-comment-setting-box .dplayer-comment-setting-type label:nth-child(4) span{border-radius:0 4px 4px 0}.dplayer-comment-setting-box .dplayer-comment-setting-size span,.dplayer-comment-setting-box .dplayer-comment-setting-type span{border:1px solid #fff;box-sizing:border-box;color:#fff;cursor:pointer;display:inline-block;font-size:12px;line-height:16px;margin-right:-1px;padding:4px 6px;text-align:center;width:33.6%}.dplayer-comment-setting-box .dplayer-comment-setting-size input:checked+span,.dplayer-comment-setting-box .dplayer-comment-setting-type input:checked+span{background:#e4e4e6;color:#1c1c1c}.dplayer-comment-setting-box .dplayer-comment-setting-color{font-size:0}.dplayer-comment-setting-box .dplayer-comment-setting-color .dplayer-comment-setting-color-list{display:flex;justify-content:space-between;padding:4px 0}.dplayer-comment-setting-box .dplayer-comment-setting-color .dplayer-comment-setting-color-list label{display:inline-block;font-size:0;padding:6px 0}.dplayer-comment-setting-box .dplayer-comment-setting-color .dplayer-comment-setting-color-list span{border-radius:50%;box-sizing:border-box;cursor:pointer;display:inline-block;height:22px;width:22px}.dplayer-comment-setting-box .dplayer-comment-setting-color .dplayer-comment-setting-color-list span:hover{animation:my-face 5s ease-in-out infinite}.dplayer-danmaku{aspect-ratio:16/9;bottom:0;color:#fff;font-family:inherit;font-size:29px;left:0;margin:auto;max-height:100%;max-width:100%;overflow:hidden;position:absolute;right:0;top:0}.dplayer-danmaku .dplayer-danmaku-item{cursor:default;display:inline-block;font-size:var(--dplayer-danmaku-font-size);font-weight:700;opacity:var(--dplayer-danmaku-opacity);pointer-events:none;text-shadow:1.2px 1.2px 4px #000000e6;user-select:none;-webkit-user-select:none;white-space:nowrap}.dplayer-danmaku .dplayer-danmaku-item--demo{position:absolute;visibility:hidden}.dplayer-danmaku .dplayer-danmaku-item span{box-decoration-break:clone;-webkit-box-decoration-break:clone}.dplayer-danmaku .dplayer-danmaku-item.dplayer-danmaku-size-big{font-size:calc(var(--dplayer-danmaku-font-size)*1.25)}.dplayer-danmaku .dplayer-danmaku-item.dplayer-danmaku-size-small{font-size:calc(var(--dplayer-danmaku-font-size)*.8)}.dplayer-danmaku .dplayer-danmaku-right{position:absolute;right:0;transform:translateX(100%)}.dplayer-danmaku .dplayer-danmaku-right.dplayer-danmaku-move{animation-name:danmaku;animation-play-state:paused;animation-timing-function:linear}@keyframes danmaku{0%{transform:translateX(100%)}}.dplayer-danmaku .dplayer-danmaku-bottom,.dplayer-danmaku .dplayer-danmaku-top{left:50%;position:absolute;transform:translateX(-50%);visibility:hidden}.dplayer-danmaku .dplayer-danmaku-bottom.dplayer-danmaku-move,.dplayer-danmaku .dplayer-danmaku-top.dplayer-danmaku-move{animation-name:danmaku-center;animation-play-state:paused;animation-timing-function:linear}@keyframes danmaku-center{0%{visibility:visible}to{visibility:visible}}.dplayer-logo{left:20px;max-height:50px;max-width:50px;pointer-events:none;position:absolute;top:20px}.dplayer-logo img{background:none;max-height:100%;max-width:100%}.dplayer-menu{background:#1c1c1cd9;border-radius:2px;display:none;overflow:hidden;padding:5px 0;position:absolute;width:170px;z-index:3}.dplayer-menu.dplayer-menu-show{display:block}.dplayer-menu .dplayer-menu-item{box-sizing:border-box;cursor:pointer;height:30px}.dplayer-menu .dplayer-menu-item:hover{background-color:#ffffff1a}.dplayer-menu .dplayer-menu-item a{box-sizing:border-box;color:#eee;display:inline-block;font-size:13px;line-height:30px;overflow:hidden;padding:0 10px;text-overflow:ellipsis;vertical-align:middle;white-space:nowrap;width:100%}.dplayer-menu .dplayer-menu-item a:hover{text-decoration:none}.dplayer-notice{background:#1c1c1ce6;border-radius:4px;bottom:68px;color:#fff;font-size:14px;left:20px;line-height:1.6;margin-right:20px;opacity:0;overflow:hidden;padding:12px 18px;pointer-events:none;position:absolute;transition:all .3s ease-in-out,color 0s}@media(max-width:500px){.dplayer-notice{bottom:auto!important;top:10px}}.dplayer-subtitle{bottom:40px;color:#fff;font-size:20px;left:5%;position:absolute;text-align:center;text-shadow:.5px .5px .5px #00000080;width:90%}.dplayer-subtitle.dplayer-subtitle-hide{display:none}.dplayer-mask{bottom:0;display:none;left:0;position:absolute;right:0;top:0;z-index:1}.dplayer-mask.dplayer-mask-show{display:block}.dplayer-video-wrap{align-items:center;background:#000;display:flex;font-size:0;height:100%;justify-content:center;position:relative;width:100%}.dplayer-video-wrap .dplayer-video-wrap-aspect{aspect-ratio:16/9;max-height:100%;max-width:100%;overflow:hidden;position:relative}.dplayer-video-wrap .dplayer-video-wrap-aspect .dplayer-video{display:none;max-height:100%;max-width:100%;width:99999px}.dplayer-video-wrap .dplayer-video-wrap-aspect .dplayer-video-current{display:block}.dplayer-video-wrap .dplayer-video-wrap-aspect .dplayer-video-prepare{display:none}.dplayer-info-panel{background:#1c1c1ccc;border-radius:2px;color:#fff;font-size:12px;left:10px;padding:10px;position:absolute;top:10px;width:450px}.dplayer-info-panel-hide{display:none}.dplayer-info-panel .dplayer-info-panel-close{cursor:pointer;position:absolute;right:10px;top:10px}.dplayer-info-panel .dplayer-info-panel-item>span{display:inline-block;line-height:15px;overflow:hidden;text-overflow:ellipsis;vertical-align:middle;white-space:nowrap}.dplayer-info-panel .dplayer-info-panel-item-title{margin-right:10px;text-align:right;width:100px}.dplayer-info-panel .dplayer-info-panel-item-data{width:320px}',"",{version:3,sources:["webpack://./src/css/balloon.scss","webpack://./src/css/global.scss","webpack://./src/css/player.scss","webpack://./src/css/bezel.scss","webpack://./src/css/controller.scss","webpack://./src/css/danmaku.scss","webpack://./src/css/logo.scss","webpack://./src/css/menu.scss","webpack://./src/css/notice.scss","webpack://./src/css/subtitle.scss","webpack://./src/css/video.scss","webpack://./src/css/info-panel.scss"],names:[],mappings:"AAAQ,mBCCJ,GACI,0CAAA,CAEJ,GACI,2CAAA,CAEJ,GACI,2CAAA,CAEJ,GACI,4CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,2CAAA,CAEJ,IACI,2CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,2CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,wCAAA,CAEJ,IACI,yCAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,2CAAA,CAEJ,IACI,2CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,2CAAA,CAEJ,IACI,yCAAA,CAEJ,IACI,2CAAA,CAEJ,IACI,yCAAA,CAEJ,IACI,wCAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,2CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,yCAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,2CAAA,CAEJ,IACI,yCAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,yCAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,yCAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,4CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,yCAAA,CAEJ,IACI,yCAAA,CAEJ,IACI,0CAAA,CAEJ,IACI,2CAAA,CAEJ,MAEI,mCAAA,CAAA,CCtJR,SAKI,aAAA,CAHA,eAAA,CADA,iBAAA,CAEA,gBAAA,CACA,wBACA,CAEA,WACI,kBAAA,CAGJ,aAEI,WAAA,CADA,UACA,CAEA,sCAEI,SAAA,CAIR,wDAGI,eAAA,CADA,qBAAA,CAIA,MAAA,CAEA,QAAA,CACA,SAAA,CALA,cAAA,CAGA,KAAA,CAGA,sBAAA,CATA,oBAAA,CAIA,cAKA,CAiCA,0fACI,YAAA,CAEJ,sCACI,WAAA,CAKJ,yFACI,YAAA,CAEJ,8EACI,WAAA,CACA,iBAAA,CAEJ,uGACI,YAAA,CAGJ,8FACI,WAAA,CACA,4BAAA,CAGA,4HACI,WAAA,CACA,4BAAA,CAMR,yCACI,cAAA,CAEJ,sCACI,aAAA,CAKJ,gEACI,4BAAA,CAMJ,+FACI,SAAA,CAOA,2GACI,SAAA,CAMR,8DACI,aAAA,CAMJ,gLAEI,2BAAA,CAQJ,+GACI,SAAA,CAIR,wBAMI,qBAAA,CAHA,MAAA,CAFA,wBAAA,CAGA,KAAA,CACA,oBAAA,CAHA,cAIA,CAEA,gDACI,WAAA,CAIA,6IACI,mBAAA,CAMR,wDACI,WAAA,CAIA,6JACI,mBAAA,CAMR,4CACI,WAAA,CACA,2DAEI,kBAAA,CADA,eACA,CACA,0OAGI,YAAA,CAMJ,0LAEI,oBAAA,CADA,eACA,CAKZ,iDACI,+CAAA,CACA,WAAA,CAOA,6HACI,SAAA,CAKJ,yEACI,SAAA,CAEJ,oEACI,SAAA,CACA,0BAAA,CAIR,0CACI,WAAA,CACA,4DACI,YAAA,CAIR,kGACI,WAAA,CACA,4BAAA,CAIA,0EAEI,SAAA,CADA,iBACA,CAIR,kDAEI,UAAA,CADA,kBACA,CAMZ,4BAGI,MAAA,CACA,QAAA,CACA,SAAA,CAJA,cAAA,CACA,KAGA,CFjQJ,sBACI,0BAAA,CAGJ,6BACI,YAAA,CAGJ,4BAEI,8BAAA,CACA,6BAAA,CAFA,2BAEA,CAGJ,iDACI,yBAAA,CGjBJ,eAKI,QAAA,CAEA,UAAA,CADA,cAAA,CAJA,MAAA,CAMA,mBAAA,CAPA,iBAAA,CAEA,OAAA,CACA,KAIA,CACA,mCASI,oBAAA,CACA,iBAAA,CAFA,qBAAA,CAHA,WAAA,CAFA,QAAA,CACA,sBAAA,CAOA,SAAA,CAJA,YAAA,CAKA,mBAAA,CAXA,iBAAA,CACA,OAAA,CAIA,UAAA,CAOA,qBAAA,CACA,4DACI,+BAAA,CAEJ,sBACI,GACI,SAAA,CACA,kBAAA,CAEJ,GACI,SAAA,CACA,kBAAA,CAAA,CAIZ,mCAQI,yCAAA,CAFA,cAAA,CACA,gBAAA,CAJA,eAAA,CAFA,iBAAA,CAIA,iBAAA,CAHA,OAAA,CAEA,UAIA,CAEJ,qCACI,YAAA,CAKA,WAAA,CAFA,QAAA,CACA,sBAAA,CAGA,mBAAA,CANA,iBAAA,CACA,OAAA,CAIA,UACA,CACA,2DACI,YAAA,CAEJ,0DACI,oDAAA,CACA,SAAA,CACA,wBAAA,CACA,qBAAA,CAEI,gFACI,mBAAA,CADJ,gFACI,mBAAA,CADJ,gFACI,mBAAA,CADJ,gFACI,mBAAA,CADJ,gFACI,mBAAA,CADJ,gFACI,mBAAA,CADJ,gFACI,mBAAA,CAIZ,oCACI,GACI,UAAA,CACA,oBAAA,CAEJ,IACI,WAAA,CACA,mBAAA,CAEJ,GACI,WAAA,CACA,oBAAA,CAAA,CChFhB,yBAKI,+CAAA,CAFA,WAAA,CADA,UAIA,CAGJ,6CALI,QAAA,CAHA,iBAAA,CAKA,uBAYA,CATJ,oBAKI,WAAA,CAFA,MAAA,CAGA,cAAA,CAFA,OAAA,CAGA,gBAAA,CACA,wBACA,CAEI,8DACI,YAAA,CAEJ,kFACI,aAAA,CAGR,sCAII,WAAA,CAEA,cAAA,CAHA,UAAA,CAEA,aAAA,CAJA,iBAAA,CACA,uBAIA,CAEI,wFACI,kBAAA,CAEJ,+DACI,aAAA,CAIA,UAAA,CADA,OAAA,CADA,0BAAA,CADA,SAGA,CAGR,yDAOI,qBAAA,CADA,iBAAA,CADA,UAAA,CAHA,iBAAA,CAMA,iBAAA,CALA,OAAA,CAMA,0BAAA,CACA,8BAAA,CANA,SAAA,CAHA,UASA,CAEI,uFACI,aAAA,CAKJ,qKACI,SAAA,CAGR,iFAMI,0BAAA,CAEA,iBAAA,CADA,UAAA,CANA,YAAA,CAQA,cAAA,CANA,QAAA,CAEA,eAAA,CAHA,iBAAA,CAEA,SAAA,CAOA,0BAAA,CADA,kBACA,CAGR,2DAII,eAAA,CAEA,4BAAA,CAHA,iBAAA,CAFA,YAAA,CAIA,mBAAA,CAHA,iBAIA,CAEJ,kEAGI,WAAA,CAEA,mBAAA,CAJA,iBAAA,CACA,UAAA,CAEA,SACA,CAEJ,wDAeI,gBAAA,CANA,0BAAA,CAFA,iBAAA,CAGA,UAAA,CACA,cAAA,CANA,MAAA,CAQA,SAAA,CALA,eAAA,CAUA,mBAAA,CAdA,iBAAA,CAQA,iBAAA,CANA,SAAA,CAQA,kCAAA,CAEA,iBAAA,CACA,SACA,CAjBA,+DACI,SAAA,CAkBR,mDAII,gBAAA,CACA,cAAA,CAHA,UAAA,CADA,iBAAA,CAEA,UAEA,CACA,mEAKI,eAAA,CAEA,uBACA,CAEJ,sIANI,QAAA,CAEA,UAAA,CAJA,MAAA,CADA,iBAAA,CAEA,KAAA,CAKA,iBAQA,CACA,kFAQI,iBAAA,CACA,cAAA,CAHA,WAAA,CADA,kBAAA,CADA,eAAA,CAHA,iBAAA,CAEA,SAAA,CADA,KAAA,CASA,kBAAA,CADA,8BAAA,CAHA,UAIA,CAKhB,mCAMI,yCAAA,CADA,QAAA,CAHA,WAAA,CAEA,kBAAA,CADA,eAAA,CAFA,iBAKA,CACA,uDAMI,QAAA,CAGA,UAAA,CARA,YAAA,CAIA,WAAA,CAEA,SAAA,CALA,iBAAA,CAMA,UAAA,CALA,8BAAA,CACA,SAKA,CACA,qEACI,WAAA,CAEJ,qFAEI,MAAA,CADA,iBAAA,CAEA,KAAA,CAEJ,0EACI,iBAAA,CACA,OAAA,CACA,KAAA,CACA,4FACI,QAAA,CAGR,8EASI,eAAA,CAPA,WAAA,CAMA,iBAAA,CAIA,qBAAA,CAEA,UAAA,CATA,mBAAA,CADA,cAAA,CAOA,WAAA,CALA,gBAAA,CAIA,QAAA,CATA,YAAA,CAEA,aAAA,CAIA,iBAAA,CAMA,UACA,CACA,2FACI,UAAA,CACA,UAAA,CAEJ,gGACI,QAAA,CAEJ,yFACI,YAAA,CAGR,wBACI,oFACI,qBAAA,CACA,mHACI,cAAA,CACA,gBAAA,CAGR,8EACI,cAAA,CAAA,CAKR,oEACI,WAAA,CAEJ,wBACI,oEACI,eAAA,CAAA,CAGR,wBACI,oEACI,eAAA,CAAA,CAIZ,uDACI,UAAA,CACA,qEACI,WAAA,CACA,wBACI,qEAEI,WAAA,CADA,UACA,CAAA,CAGR,wBACI,qEAEI,WAAA,CADA,UACA,CAAA,CAKhB,iDAEI,UAAA,CAIA,mBAAA,CADA,cAAA,CAJA,gBAAA,CAEA,6BAAA,CACA,qBAEA,CACA,wBACI,iDACI,cAAA,CAAA,CAIZ,uDAUI,kBAAA,CARA,UAAA,CAIA,cAAA,CAGA,mBAAA,CAFA,mBAAA,CAFA,cAAA,CAGA,WAAA,CAPA,gBAAA,CAEA,6BAAA,CACA,qBAMA,CAEJ,qDAOI,iBAAA,CADA,UAAA,CALA,oBAAA,CAEA,UAAA,CAEA,gBAAA,CADA,iBAAA,CAFA,SAKA,CAEJ,iDAII,sBAAA,CADA,WAAA,CAMA,qBAAA,CAFA,cAAA,CAGA,oBAAA,CARA,WAAA,CAGA,gBAAA,CACA,YAAA,CAEA,qBAAA,CAPA,UASA,CACA,uEAEI,UAAA,CADA,8BACA,CAGA,6EACI,SAAA,CAGR,mEACI,QAAA,CAEJ,sEACI,wBAAA,CACA,wBACI,sEACI,mBAAA,CAAA,CAGR,wBACI,sEACI,uBAAA,CAAA,CAIZ,qEACI,UAAA,CAEJ,qFACI,OAAA,CAEJ,wBACI,iDACI,UAAA,CAAA,CAIZ,mDAGI,cAAA,CADA,oBAAA,CAEA,WAAA,CAHA,iBAGA,CAEI,sGACI,UAAA,CAEJ,+IACI,kBAAA,CAIJ,sHACI,UAAA,CAEJ,+JACI,kBAAA,CAGR,4EACI,oBAAA,CAGA,WAAA,CAFA,oBAAA,CACA,qBACA,CACA,gGAKI,eAAA,CADA,UAAA,CAHA,iBAAA,CACA,QAAA,CAIA,8BAAA,CAHA,OAGA,CACA,0HAEI,QAAA,CAEA,WAAA,CADA,MAAA,CAFA,iBAAA,CAIA,uBAAA,CACA,iBAAA,CACA,yIAQI,iBAAA,CACA,cAAA,CAHA,WAAA,CADA,kBAAA,CADA,eAAA,CAHA,iBAAA,CAEA,SAAA,CADA,KAAA,CASA,kBAAA,CADA,8BAAA,CAHA,UAIA,CAUpB,6GACI,oBAAA,CACA,WAAA,CAEJ,iDACI,oBAAA,CACA,WAAA,CACA,iBAAA,CAEJ,oDACI,oBAAA,CACA,WAAA,CAKZ,0BAEI,kBAAA,CADA,YAAA,CAOA,WAAA,CALA,4BAAA,CAGA,QAAA,CAKA,SAAA,CAEA,mBAAA,CATA,iBAAA,CACA,OAAA,CAIA,8BAAA,CACA,wBAAA,CAEA,iBAAA,CALA,UAMA,CAEA,+CAKI,yCAAA,CADA,sBAAA,CADA,WAAA,CAIA,qBAAA,CACA,cAAA,CAFA,0CAAA,CAJA,WAAA,CAOA,YAAA,CACA,mBAAA,CATA,UASA,CAEA,+GACI,YAAA,CAKZ,qBAgBI,yCAAA,CARA,oBAAA,CADA,iBAAA,CAHA,WAAA,CAMA,qBAAA,CATA,YAAA,CAKA,wBAAA,CAQA,SAAA,CAHA,iBAAA,CACA,iBAAA,CAVA,iBAAA,CACA,UAAA,CAMA,wBAAA,CAIA,iBAAA,CARA,WAAA,CAUA,SACA,CACA,yBACI,iBAAA,CACA,sDACI,aAAA,CAGR,8CAEI,SAAA,CADA,kBACA,CAEJ,iDACI,uFAAA,CACA,+EACI,2BAAA,CAEJ,gFACI,aAAA,CACA,uBAAA,CAGR,+CACI,2DAAA,CACA,6EACI,2BAAA,CAEJ,4EACI,aAAA,CACA,uBAAA,CAGR,+CACI,2DAAA,CACA,6EACI,2BAAA,CAEJ,4EACI,aAAA,CACA,uBAAA,CAGR,oCAEI,UAAA,CADA,oBAAA,CAEA,cAAA,CACA,qBAAA,CACA,kBAAA,CAEJ,0CAII,aAAA,CAHA,oBAAA,CAIA,cAAA,CAHA,gBAAA,CACA,iBAAA,CAGA,qBAAA,CACA,kBAAA,CAEJ,qCAOI,WAAA,CAFA,WAAA,CAJA,iBAAA,CAEA,SAAA,CAGA,iBAAA,CAJA,OAAA,CAMA,qBAAA,CAJA,UAIA,CACA,2CAGI,YAAA,CAFA,YAAA,CACA,WACA,CAEJ,iDAUI,wBAAA,CAJA,kBAAA,CAGA,gCAAA,CAFA,qBAAA,CAIA,cAAA,CAVA,oBAAA,CAIA,WAAA,CAHA,iBAAA,CACA,UAAA,CAKA,oBAAA,CAJA,UAOA,CAEJ,wDAQI,kBAAA,CAPA,UAAA,CAEA,aAAA,CACA,WAAA,CAGA,UAAA,CALA,iBAAA,CAIA,SAAA,CAGA,oBAAA,CAJA,UAIA,CAEJ,uDASI,eAAA,CADA,kBAAA,CAGA,0BAAA,CAVA,UAAA,CACA,aAAA,CAEA,aAAA,CAGA,MAAA,CAJA,iBAAA,CAGA,SAAA,CAIA,oBAAA,CALA,YAMA,CAEJ,yDACI,+BAAA,CAEJ,gEAEI,6BAAA,CADA,UACA,CAEJ,+DACI,SAAA,CAGR,2MAKI,QAAA,CAKA,qBAAA,CAHA,eAAA,CAKA,eAAA,CAJA,aAAA,CAJA,iBAAA,CAOA,oBAAA,CAFA,8BAAA,CAHA,UAMA,CACA,uRACI,SAAA,CAEJ,+SACI,oBAAA,CAGR,mDACI,uBAAA,CAEJ,wJAGI,0BAAA,CACA,gOAEI,kBAAA,CAKA,iCAAA,CACA,qBAAA,CACA,cAAA,CARA,YAAA,CAEA,WAAA,CAGA,iBAAA,CADA,kBAAA,CADA,gBAKA,CAEJ,0sBAGI,WAAA,CACA,01BACI,iBAAA,CAEJ,00GAGI,kBAAA,CAGR,wMACI,oBAAA,CAGA,gBAAA,CAFA,eAAA,CACA,UACA,CAGR,gMAKI,kBAAA,CAGA,qBAAA,CACA,cAAA,CALA,YAAA,CAEA,WAAA,CACA,gBAAA,CAGA,iBAAA,CACA,wNACI,0BAAA,CAGR,8CACI,aAAA,CACA,6DAEI,cAAA,CADA,cACA,CAEJ,mEAEI,gBAAA,CADA,iBACA,CAGA,4IACI,YAAA,CAEJ,8EACI,oBAAA,CAIJ,8LACI,YAAA,CAEJ,uGACI,oBAAA,CAGR,wEAEI,qBAAA,CACA,YAAA,CAEA,WAAA,CAJA,cAAA,CAGA,qBAAA,CAEA,UAAA,CACA,6FAKI,eAAA,CADA,UAAA,CAHA,iBAAA,CACA,SAAA,CAIA,8BAAA,CAHA,UAGA,CACA,wHAEI,QAAA,CAEA,WAAA,CADA,MAAA,CAFA,iBAAA,CAIA,wBAAA,CACA,iBAAA,CACA,uIAQI,iBAAA,CACA,cAAA,CAHA,WAAA,CADA,kBAAA,CADA,eAAA,CAHA,iBAAA,CAEA,SAAA,CADA,KAAA,CAQA,8BAAA,CAHA,UAGA,CAQxB,6BAkBI,yCAAA,CAVA,oBAAA,CADA,iBAAA,CAJA,WAAA,CAYA,qBAAA,CATA,gCAAA,CAIA,cAAA,CARA,SAAA,CAGA,4BAAA,CASA,SAAA,CAEA,eAAA,CAPA,sBAAA,CARA,iBAAA,CAWA,oBAAA,CADA,wBAAA,CAEA,iBAAA,CATA,WAAA,CAaA,SACA,CACA,gDACI,SAAA,CAEJ,sDACI,oBAAA,CAEJ,0DAEI,SAAA,CADA,kBACA,CAEJ,+CACI,YAAA,CAEJ,mCACI,cAAA,CAEJ,4DAEI,UAAA,CADA,cAAA,CAEA,gBAAA,CAEJ,sHACI,WAAA,CACA,gLACI,cAAA,CAEJ,oLACI,iBAAA,CAII,sKACI,yBAAA,CAIJ,sKACI,yBAAA,CAIZ,gIAOI,qBAAA,CAEA,qBAAA,CAHA,UAAA,CAKA,cAAA,CAPA,oBAAA,CACA,cAAA,CAFA,gBAAA,CAKA,iBAAA,CANA,eAAA,CAQA,iBAAA,CATA,WAUA,CAEJ,4JACI,kBAAA,CACA,aAAA,CAGR,4DACI,WAAA,CACA,gGACI,YAAA,CACA,6BAAA,CACA,aAAA,CACA,sGACI,oBAAA,CACA,WAAA,CACA,aAAA,CAEJ,qGAII,iBAAA,CACA,qBAAA,CACA,cAAA,CALA,oBAAA,CAEA,WAAA,CADA,UAIA,CACA,2GACI,yCAAA,CCxzBpB,iBAQI,iBAAA,CAHA,QAAA,CAOA,UAAA,CADA,mBAAA,CADA,cAAA,CAPA,MAAA,CAMA,WAAA,CAFA,eAAA,CADA,cAAA,CAOA,eAAA,CAZA,iBAAA,CAGA,OAAA,CAFA,KAWA,CACA,uCAOI,cAAA,CANA,oBAAA,CAEA,0CAAA,CADA,eAAA,CAEA,sCAAA,CAMA,mBAAA,CAJA,qCAAA,CAEA,gBAAA,CACA,wBAAA,CAJA,kBAKA,CACA,6CACI,iBAAA,CACA,iBAAA,CAEJ,4CACI,0BAAA,CACA,kCAAA,CAEJ,gEACI,qDAAA,CAEJ,kEACI,mDAAA,CAGR,wCACI,iBAAA,CACA,OAAA,CACA,0BAAA,CACA,6DACI,sBAAA,CAEA,2BAAA,CADA,gCACA,CAGR,mBACI,GACI,0BAAA,CAAA,CAGR,+EAGI,QAAA,CADA,iBAAA,CAEA,0BAAA,CACA,iBAAA,CACA,yHACI,6BAAA,CAEA,2BAAA,CADA,gCACA,CAGR,0BACI,GACI,kBAAA,CAEJ,GACI,kBAAA,CAAA,CCxEZ,cAGI,SAAA,CAGA,eAAA,CADA,cAAA,CAJA,mBAAA,CACA,iBAAA,CAEA,QAEA,CACA,kBAGI,eAAA,CADA,eAAA,CADA,cAEA,CCVR,cAII,oBAAA,CADA,iBAAA,CAKA,YAAA,CAFA,eAAA,CADA,aAAA,CAJA,iBAAA,CACA,WAAA,CAKA,SACA,CACA,gCACI,aAAA,CAEJ,iCAEI,qBAAA,CACA,cAAA,CAFA,WAEA,CACA,uCACI,0BAAA,CAEJ,mCASI,qBAAA,CALA,UAAA,CAEA,oBAAA,CADA,cAAA,CAFA,gBAAA,CASA,eAAA,CAVA,cAAA,CASA,sBAAA,CAJA,qBAAA,CAGA,kBAAA,CAFA,UAIA,CACA,yCACI,oBAAA,CCjChB,gBAOI,oBAAA,CADA,iBAAA,CAJA,WAAA,CAMA,UAAA,CACA,cAAA,CANA,SAAA,CAOA,eAAA,CALA,iBAAA,CAOA,SAAA,CACA,eAAA,CATA,iBAAA,CAUA,mBAAA,CAbA,iBAAA,CAUA,uCAGA,CAEJ,wBACI,gBAEI,qBAAA,CADA,QACA,CAAA,CCnBR,kBAEI,WAAA,CAIA,UAAA,CAEA,cAAA,CAJA,OAAA,CAHA,iBAAA,CAIA,iBAAA,CAEA,oCAAA,CAJA,SAKA,CACA,wCACI,YAAA,CCVR,cAGI,QAAA,CAIA,YAAA,CAHA,MAAA,CAHA,iBAAA,CAIA,OAAA,CAHA,KAAA,CAIA,SACA,CACA,gCACI,aAAA,CAIR,oBAGI,kBAAA,CAEA,eAAA,CAJA,YAAA,CAKA,WAAA,CAEA,WAAA,CAJA,sBAAA,CAFA,iBAAA,CAKA,UACA,CAEA,+CAII,iBAAA,CADA,eAAA,CADA,cAAA,CAGA,eAAA,CAJA,iBAIA,CAEA,8DAII,YAAA,CADA,eAAA,CADA,cAAA,CADA,aAGA,CAEJ,sEACI,aAAA,CAEJ,sEACI,YAAA,CCxCZ,oBAKI,oBAAA,CAIA,iBAAA,CAFA,UAAA,CACA,cAAA,CALA,SAAA,CAGA,YAAA,CALA,iBAAA,CACA,QAAA,CAEA,WAKA,CAEA,yBACI,YAAA,CAGJ,8CACI,cAAA,CACA,iBAAA,CACA,UAAA,CACA,QAAA,CAIA,kDACI,oBAAA,CAEA,gBAAA,CAGA,eAAA,CADA,sBAAA,CAHA,qBAAA,CAEA,kBAEA,CAIR,mDAGI,iBAAA,CADA,gBAAA,CADA,WAEA,CAGJ,kDACI,WAAA",sourcesContent:[`@import '../../node_modules/balloon-css/balloon.css';

.dplayer [aria-label] {
    --balloon-font-size: 11.5px;
}

.dplayer [aria-label]:before {
    display: none;
}

.dplayer [aria-label]:after {
    padding: .3em .8em !important;
    background: rgba(17, 17, 17, 0.7) !important;
    font-family: inherit !important;
}

.dplayer [aria-label][data-balloon-pos="up"]:after {
    margin-bottom: 0 !important;
}
`,`@keyframes my-face {
    2% {
        transform: translate(0, 1.5px) rotate(1.5deg);
    }
    4% {
        transform: translate(0, -1.5px) rotate(-0.5deg);
    }
    6% {
        transform: translate(0, 1.5px) rotate(-1.5deg);
    }
    8% {
        transform: translate(0, -1.5px) rotate(-1.5deg);
    }
    10% {
        transform: translate(0, 2.5px) rotate(1.5deg);
    }
    12% {
        transform: translate(0, -0.5px) rotate(1.5deg);
    }
    14% {
        transform: translate(0, -1.5px) rotate(1.5deg);
    }
    16% {
        transform: translate(0, -0.5px) rotate(-1.5deg);
    }
    18% {
        transform: translate(0, 0.5px) rotate(-1.5deg);
    }
    20% {
        transform: translate(0, -1.5px) rotate(2.5deg);
    }
    22% {
        transform: translate(0, 0.5px) rotate(-1.5deg);
    }
    24% {
        transform: translate(0, 1.5px) rotate(1.5deg);
    }
    26% {
        transform: translate(0, 0.5px) rotate(0.5deg);
    }
    28% {
        transform: translate(0, 0.5px) rotate(1.5deg);
    }
    30% {
        transform: translate(0, -0.5px) rotate(2.5deg);
    }
    32% {
        transform: translate(0, 1.5px) rotate(-0.5deg);
    }
    34% {
        transform: translate(0, 1.5px) rotate(-0.5deg);
    }
    36% {
        transform: translate(0, -1.5px) rotate(2.5deg);
    }
    38% {
        transform: translate(0, 1.5px) rotate(-1.5deg);
    }
    40% {
        transform: translate(0, -0.5px) rotate(2.5deg);
    }
    42% {
        transform: translate(0, 2.5px) rotate(-1.5deg);
    }
    44% {
        transform: translate(0, 1.5px) rotate(0.5deg);
    }
    46% {
        transform: translate(0, -1.5px) rotate(2.5deg);
    }
    48% {
        transform: translate(0, -0.5px) rotate(0.5deg);
    }
    50% {
        transform: translate(0, 0.5px) rotate(0.5deg);
    }
    52% {
        transform: translate(0, 2.5px) rotate(2.5deg);
    }
    54% {
        transform: translate(0, -1.5px) rotate(1.5deg);
    }
    56% {
        transform: translate(0, 2.5px) rotate(2.5deg);
    }
    58% {
        transform: translate(0, 0.5px) rotate(2.5deg);
    }
    60% {
        transform: translate(0, 2.5px) rotate(2.5deg);
    }
    62% {
        transform: translate(0, -0.5px) rotate(2.5deg);
    }
    64% {
        transform: translate(0, -0.5px) rotate(1.5deg);
    }
    66% {
        transform: translate(0, 1.5px) rotate(-0.5deg);
    }
    68% {
        transform: translate(0, -1.5px) rotate(-0.5deg);
    }
    70% {
        transform: translate(0, 1.5px) rotate(0.5deg);
    }
    72% {
        transform: translate(0, 2.5px) rotate(1.5deg);
    }
    74% {
        transform: translate(0, -0.5px) rotate(0.5deg);
    }
    76% {
        transform: translate(0, -0.5px) rotate(2.5deg);
    }
    78% {
        transform: translate(0, -0.5px) rotate(1.5deg);
    }
    80% {
        transform: translate(0, 1.5px) rotate(1.5deg);
    }
    82% {
        transform: translate(0, -0.5px) rotate(0.5deg);
    }
    84% {
        transform: translate(0, 1.5px) rotate(2.5deg);
    }
    86% {
        transform: translate(0, -1.5px) rotate(-1.5deg);
    }
    88% {
        transform: translate(0, -0.5px) rotate(2.5deg);
    }
    90% {
        transform: translate(0, 2.5px) rotate(-0.5deg);
    }
    92% {
        transform: translate(0, 0.5px) rotate(-0.5deg);
    }
    94% {
        transform: translate(0, 2.5px) rotate(0.5deg);
    }
    96% {
        transform: translate(0, -0.5px) rotate(1.5deg);
    }
    98% {
        transform: translate(0, -1.5px) rotate(-0.5deg);
    }
    0%,
    100% {
        transform: translate(0, 0) rotate(0deg);
    }
}
`,`.dplayer {
    position: relative;
    overflow: hidden;
    user-select: none;
    -webkit-user-select: none;
    line-height: 1;

    * {
        box-sizing: content-box;
    }

    svg {
        width: 100%;
        height: 100%;

        path,
        circle {
            fill: #fff;
        }
    }

    &.dplayer-fulled, &.dplayer-fulled-browser {
        width: 100% !important;
        height: 100% !important;
        background: #000;
        position: fixed;
        z-index: 100000;
        left: 0;
        top: 0;
        margin: 0;
        padding: 0;
        transform: translate(0, 0);
    }

    &.dplayer-no-danmaku {
        .dplayer-setting-box {
            .dplayer-setting-showdan,
            .dplayer-setting-danmaku,
            .dplayer-setting-danunlimit {
                display: none;
            }
        }

        .dplayer-controller .dplayer-icons .dplayer-comment {
            display: none;
        }

        .dplayer-danmaku {
            display: none;
        }
    }

    &.dplayer-no-audio-switching {
        .dplayer-setting-box {
            .dplayer-setting-audio {
                display: none;
            }
        }
    }

    &.dplayer-live {
        .dplayer-time {
            display: none;
        }
        .dplayer-bar-wrap {
            display: none;
        }
        .dplayer-notice {
            bottom: 56px;
        }
        .dplayer-setting-speed {
            display: none;
        }
        .dplayer-setting-loop {
            display: none;
        }
        .dplayer-controller .dplayer-icons .dplayer-setting-box {
            height: auto;
            overflow-y: hidden;
        }
        .dplayer-mobile-icon-backward, .dplayer-mobile-icon-forward {
            display: none;
        }

        .dplayer-setting-box, .dplayer-comment-setting-box {
            bottom: 58px;
            max-height: calc(100% - 58px - 8px);
        }
        &.dplayer-mobile {
            .dplayer-setting-box, .dplayer-comment-setting-box {
                bottom: 52px;
                max-height: calc(100% - 52px - 8px);
            }
        }
    }

    &.dplayer-narrow {
        .dplayer-danmaku {
            font-size: 18px;
        }
        .dplayer-icon {
            margin: 0 -3px;
        }
    }

    &.dplayer-playing {
        .dplayer-danmaku .dplayer-danmaku-move {
            animation-play-state: running;
        }

        .dplayer-controller-mask {
            opacity: 0;
        }
        .dplayer-controller {
            opacity: 0;
        }

        &:hover {
            .dplayer-controller-mask {
                opacity: 1;
            }
            .dplayer-controller {
                opacity: 1;
            }
        }
    }

    &.dplayer-loading {
        .dplayer-bezel .dplayer-loading-icon {
            display: block;
        }
    }

    &.dplayer-loading,
    &.dplayer-paused {
        .dplayer-danmaku,
        .dplayer-danmaku-move {
            animation-play-state: paused;
        }
    }

    &.dplayer-show-controller {
        .dplayer-controller-mask {
            opacity: 1;
        }
        .dplayer-controller {
            opacity: 1;
        }
    }

    &.dplayer-fulled {
        position: fixed !important;
        z-index: 100000;
        left: 0;
        top: 0;
        width: 100% !important;
        height: 100% !important;

        &.dplayer-hide-controller {
            cursor: none;
            .dplayer-controller-mask {
                opacity: 0 !important;
            }
            .dplayer-controller {
                opacity: 0 !important;
            }
        }
    }

    &.dplayer-fulled-browser {
        &.dplayer-hide-controller {
            cursor: none;
            .dplayer-controller-mask {
                opacity: 0 !important;
            }
            .dplayer-controller {
                opacity: 0 !important;
            }
        }
    }

    &.dplayer-mobile {
        .dplayer-controller {
            height: 44px;
            .dplayer-icons {
                padding-top: 3px;
                padding-bottom: 3px;
                .dplayer-volume,
                .dplayer-airplay-icon,
                .dplayer-play-icon {
                    display: none;
                }
                .dplayer-full .dplayer-full-in-icon {
                    position: static;
                    display: inline-block;
                }
                .dplayer-full .dplayer-pip-icon {
                    position: static;
                    display: inline-block;
                }
            }
        }

        .dplayer-controller-mask {
            background: linear-gradient(rgba(0, 0, 0, 0.55) 78%, rgba(0, 0, 0, 0.8) 100%);
            height: 100%;
        }

        &.dplayer-playing {
            .dplayer-controller-mask {
                opacity: 1;
            }
            .dplayer-controller {
                opacity: 1;
            }
        }

        &.dplayer-hide-controller {
            .dplayer-controller-mask {
                opacity: 0;
            }
            .dplayer-controller {
                opacity: 0;
                transform: translateY(100%);
            }
        }

        .dplayer-bar-wrap {
            bottom: 40px;
            .dplayer-bar-time {
                display: none;
            }
        }

        .dplayer-setting-box, .dplayer-comment-setting-box {
            bottom: 58px;
            max-height: calc(100% - 58px - 8px);
        }

        &.dplayer-hide-controller {
            .dplayer-mobile-icon-wrap {
                visibility: hidden;
                opacity: 0;
            }
        }

        .dplayer-mobile-icon-wrap {
            visibility: visible;
            opacity: 0.7;
        }
    }
}

// To hide scroll bar, apply this class to <body>
.dplayer-web-fullscreen-fix {
    position: fixed;
    top: 0;
    left: 0;
    margin: 0;
    padding: 0;
}
`,`.dplayer-bezel {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    font-size: 22px;
    color: #fff;
    pointer-events: none;
    .dplayer-bezel-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        margin: -26px 0 0 -26px;
        height: 52px;
        width: 52px;
        padding: 12px;
        box-sizing: border-box;
        background: rgba(0, 0, 0, .5);
        border-radius: 50%;
        opacity: 0;
        pointer-events: none;
        will-change: transform;
        &.dplayer-bezel-transition {
            animation: bezel-hide .5s linear;
        }
        @keyframes bezel-hide {
            from {
                opacity: 1;
                transform: scale(1);
            }
            to {
                opacity: 0;
                transform: scale(2);
            }
        }
    }
    .dplayer-danloading {
        position: absolute;
        top: 50%;
        margin-top: -7px;
        width: 100%;
        text-align: center;
        font-size: 14px;
        line-height: 14px;
        animation: my-face 5s infinite ease-in-out;
    }
    .dplayer-loading-icon {
        display: none;
        position: absolute;
        top: 50%;
        left: 50%;
        margin: -18px 0 0 -18px;
        height: 36px;
        width: 36px;
        pointer-events: none;
        .dplayer-loading-hide {
            display: none;
        }
        .dplayer-loading-dot {
            animation: dplayer-loading-dot-fade .8s ease infinite;
            opacity: 0;
            transform-origin: 4px 4px;
            will-change: transform;
            @for $i from 7 through 1 {
                &.dplayer-loading-dot-#{$i} {
                    animation-delay: .1s * $i;
                }
            }
        }
        @keyframes dplayer-loading-dot-fade {
            0% {
                opacity: .7;
                transform: scale(1.2, 1.2);
            }
            50% {
                opacity: .25;
                transform: scale(.9, .9);
            }
            to {
                opacity: .25;
                transform: scale(.85, .85);
            }
        }
    }
}
`,`
.dplayer-controller-mask {
    position: absolute;
    width: 100%;
    height: 98px;
    bottom: 0;
    background: linear-gradient(rgba(0, 0, 0, 0.0) 15%, rgba(0, 0, 0, 0.7) 100%);
    transition: all 0.3s ease;
}

.dplayer-controller {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 50px;
    padding: 0 20px;
    user-select: none;
    -webkit-user-select: none;
    transition: all 0.3s ease;
    &.dplayer-controller-comment {
        .dplayer-icons {
            display: none;
        }
        .dplayer-icons.dplayer-comment-box {
            display: block;
        }
    }
    .dplayer-bar-wrap {
        position: absolute;
        width: calc(100% - 40px);
        height: 3px;
        bottom: 46px;
        padding: 5px 0;
        cursor: pointer;
        &:hover {
            .dplayer-bar .dplayer-played .dplayer-thumb {
                transform: scale(1);
            }
            .dplayer-highlight {
                display: block;
                width: 8px;
                transform: translateX(-4px);
                top: 4px;
                height: 40%;
            }
        }
        .dplayer-highlight {
            z-index: 12;
            position: absolute;
            top: 5px;
            width: 6px;
            height: 20%;
            border-radius: 6px;
            background-color: #fff;
            text-align: center;
            transform: translateX(-3px);
            transition: all .2s ease-in-out;
            &:hover {
                .dplayer-highlight-text {
                    display: block;
                }
                &~.dplayer-bar-preview {
                    opacity: 0;
                }
                &~.dplayer-bar-time {
                    opacity: 0;
                }
            }
            .dplayer-highlight-text {
                display: none;
                position: absolute;
                left: 50%;
                top: -24px;
                padding: 5px 8px;
                background-color: rgba(0, 0, 0, .62);
                color: #fff;
                border-radius: 4px;
                font-size: 12px;
                white-space: nowrap;
                transform: translateX(-50%);
            }
        }
        .dplayer-bar-preview {
            display: none;
            position: absolute;
            border-radius: 6px;
            background: #fff;
            pointer-events: none;
            background-size: 16000px 100%;
        }
        .dplayer-bar-preview-canvas {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }
        .dplayer-bar-time {
            &.hidden {
                opacity: 0;
            }
            position: absolute;
            left: 0px;
            top: -20px;
            border-radius: 4px;
            padding: 5px 7px;
            background-color: rgba(0, 0, 0, 0.62);
            color: #fff;
            font-size: 12px;
            text-align: center;
            opacity: 1;
            transition: opacity .1s ease-in-out;
            word-wrap: normal;
            word-break: normal;
            z-index: 2;
            pointer-events: none;
        }
        .dplayer-bar {
            position: relative;
            height: 4px;
            width: 100%;
            background: rgba(255, 255, 255, .2);
            cursor: pointer;
            .dplayer-loaded {
                position: absolute;
                left: 0;
                top: 0;
                bottom: 0;
                background: #fff;
                height: 4px;
                transition: all 0.5s ease;
                will-change: width;
            }
            .dplayer-played {
                position: absolute;
                left: 0;
                top: 0;
                bottom: 0;
                height: 4px;
                will-change: width;
                .dplayer-thumb {
                    position: absolute;
                    top: 0;
                    right: 5px;
                    margin-top: -4px;
                    margin-right: -10px;
                    height: 11px;
                    width: 11px;
                    border-radius: 50%;
                    cursor: pointer;
                    transition: all .3s ease-in-out;
                    transform: scale(0);
                }
            }
        }
    }
    .dplayer-icons {
        position: absolute;
        height: 38px;
        padding-top: 6px;
        padding-bottom: 6px;
        bottom: 0;
        -webkit-tap-highlight-color: transparent;
        &.dplayer-comment-box {
            display: none;
            position: absolute;
            transition: all .3s ease-in-out;
            z-index: 2;
            height: 38px;
            bottom: 0;
            left: 20px;
            right: 20px;
            color: #fff;
            .dplayer-icon {
                padding: 7px;
            }
            .dplayer-comment-setting-icon {
                position: absolute;
                left: 0;
                top: 0;
            }
            .dplayer-send-icon {
                position: absolute;
                right: 0;
                top: 0;
                &[aria-label]:after {
                    left: 14%;
                }
            }
            .dplayer-comment-input {
                outline: none;
                border: none;
                padding: 8px 0px;
                font-size: 14px;
                font-family: inherit;
                line-height: 18px;
                text-align: center;
                border-radius: 4px;
                background: none;
                margin: 0;
                height: 100%;
                box-sizing: border-box;
                width: 100%;
                color: #fff;
                &::placeholder {
                    color: #fff;
                    opacity: 0.8;
                }
                &::-moz-focus-inner {
                    border: 0;
                }
                &::-ms-clear {
                    display: none;
                }
            }
            @media (max-width: 350px){
                .dplayer-comment-setting-box {
                    padding: 9px 10px 15px;
                    .dplayer-comment-setting-title {
                        font-size: 12px;
                        line-height: 24px;
                    }
                }
                .dplayer-comment-input {
                    font-size: 12px;
                }
            }
        }
        &.dplayer-icons-left {
            .dplayer-icon {
                padding: 7px;
            }
            @media (max-width: 500px){
                .dplayer-icon {
                    padding-top: 6px;
                }
            }
            @media (max-width: 350px){
                .dplayer-icon {
                    padding-top: 7px;
                }
            }
        }
        &.dplayer-icons-right {
            right: 20px;
            .dplayer-icon {
                padding: 8px;
                @media (max-width: 500px){
                    & {
                        width: 38px;
                        padding: 7px;
                    }
                }
                @media (max-width: 350px){
                    & {
                        width: 31px;
                        padding: 5px;
                    }
                }
            }
        }
        .dplayer-time {
            line-height: 38px;
            color: #eee;
            text-shadow: 0 0 2px rgba(0, 0, 0, .5);
            vertical-align: middle;
            font-size: 13px;
            font-family: inherit;
            @media (max-width: 350px){
                & {
                    font-size: 12px;
                }
            }
        }
        .dplayer-live-badge {
            line-height: 18px;
            color: #eee;
            text-shadow: 0 0 2px rgba(0, 0, 0, .5);
            vertical-align: middle;
            font-size: 13px;
            cursor: pointer;
            font-family: inherit;
            height: 100%;
            display: inline-flex;
            align-items: center;
        }
        .dplayer-live-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            vertical-align: 4%;
            margin-right: 5px;
            content: '';
            border-radius: 6px;
        }
        .dplayer-icon {
            width: 40px;
            height: 100%;
            border: none;
            background-color: transparent;
            line-height: 18px;
            outline: none;
            cursor: pointer;
            vertical-align: middle;
            box-sizing: border-box;
            display: inline-block;
            .dplayer-icon-content {
                transition: all .2s ease-in-out;
                opacity: .8;
            }
            &:hover {
                .dplayer-icon-content {
                    opacity: 1;
                }
            }
            &::-moz-focus-inner {
                border: 0;
            }
            &.dplayer-comment-icon {
                padding: 10.5px 9.5px 8px;
                @media (max-width: 500px){
                    & {
                        padding: 9px 9px 8px;
                    }
                }
                @media (max-width: 350px){
                    & {
                        padding: 6.5px 6.5px 6px;
                    }
                }
            }
            &.dplayer-volume-icon {
                width: 43px;
            }
            &.dplayer-full-icon[aria-label]:after {
                left: 1%;
            }
            @media (max-width: 350px){
                & {
                    width: 35px;
                }
            }
        }
        .dplayer-volume {
            position: relative;
            display: inline-block;
            cursor: pointer;
            height: 100%;
            &:hover {
                .dplayer-volume-bar-wrap .dplayer-volume-bar {
                    width: 45px;
                }
                .dplayer-volume-bar-wrap .dplayer-volume-bar .dplayer-volume-bar-inner .dplayer-thumb {
                    transform: scale(1);
                }
            }
            &.dplayer-volume-active {
                .dplayer-volume-bar-wrap .dplayer-volume-bar {
                    width: 45px;
                }
                .dplayer-volume-bar-wrap .dplayer-volume-bar .dplayer-volume-bar-inner .dplayer-thumb {
                    transform: scale(1);
                }
            }
            .dplayer-volume-bar-wrap {
                display: inline-block;
                margin: 0 10px 0 -5px;
                vertical-align: middle;
                height: 100%;
                .dplayer-volume-bar {
                    position: relative;
                    top: 17px;
                    width: 0;
                    height: 4px;
                    background: #FFF;
                    transition: all 0.3s ease-in-out;
                    .dplayer-volume-bar-inner {
                        position: absolute;
                        bottom: 0;
                        left: 0;
                        height: 100%;
                        transition: all 0.1s ease;
                        will-change: width;
                        .dplayer-thumb {
                            position: absolute;
                            top: 0;
                            right: 5px;
                            margin-top: -4px;
                            margin-right: -10px;
                            height: 11px;
                            width: 11px;
                            border-radius: 50%;
                            cursor: pointer;
                            transition: all .3s ease-in-out;
                            transform: scale(0);
                        }
                    }
                }
            }
        }
        .dplayer-subtitle-btn {
            display: inline-block;
            height: 100%;
        }
        .dplayer-setting {
            display: inline-block;
            height: 100%;
        }
        .dplayer-full {
            display: inline-block;
            height: 100%;
            position: relative;
        }
        .dplayer-comment {
            display: inline-block;
            height: 100%;
        }
    }
}

.dplayer-mobile-icon-wrap {
    display: flex;
    align-items: center;
    justify-content: space-evenly;
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 50px;
    transform: translate(-50%, -50%);
    transition: all 0.28s ease;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;

    .dplayer-mobile-icon {
        width: 50px;
        height: 50px;
        border: none;
        background-color: transparent;
        -webkit-tap-highlight-color: transparent;
        filter: drop-shadow(0 0 7px rgba(0, 0, 0, 0.5));
        box-sizing: border-box;
        cursor: pointer;
        outline: none;
        pointer-events: auto;

        &-backward, &-forward {
            padding: 12px;
        }
    }
}

.dplayer-setting-box {
    display: flex;
    position: absolute;
    right: 20px;
    bottom: 64px;
    width: 210px;
    height: calc(100% - 64px - 8px);
    border-radius: 7px;
    background: rgba(28, 28, 28, 0.9);
    transition: all .25s ease;
    box-sizing: border-box;
    overflow-x: hidden;
    overflow-y: hidden;
    visibility: hidden;
    opacity: 0;
    z-index: 2;
    -webkit-tap-highlight-color: transparent;
    &>div {
        overflow-x: hidden;
        &.dplayer-setting-origin-panel {
            display: block;
        }
    }
    &.dplayer-setting-box-open {
        visibility: visible;
        opacity: 1;
    }
    &.dplayer-setting-box-quality {
        clip-path: inset(calc(100% - (30px * var(--quality-length)) - 54px) 0 0 round 7px) !important;
        .dplayer-setting-origin-panel {
            transform: translateX(-100%);
        }
        .dplayer-setting-quality-panel {
            display: block;
            transform: translateX(0%);
        }
    }
    &.dplayer-setting-box-speed {
        clip-path: inset(calc(100% - 294px) 0 0 round 7px) !important;
        .dplayer-setting-origin-panel {
            transform: translateX(-100%);
        }
        .dplayer-setting-speed-panel {
            display: block;
            transform: translateX(0%);
        }
    }
    &.dplayer-setting-box-audio {
        clip-path: inset(calc(100% - 114px) 0 0 round 7px) !important;
        .dplayer-setting-origin-panel {
            transform: translateX(-100%);
        }
        .dplayer-setting-audio-panel {
            display: block;
            transform: translateX(0%);
        }
    }
    .dplayer-label {
        display: inline-block;
        color: #eee;
        font-size: 13px;
        vertical-align: middle;
        white-space: nowrap;
    }
    .dplayer-label-value {
        display: inline-block;
        margin-left: auto;
        margin-right: 23px;
        color: #e0e0e0;
        font-size: 12px;
        vertical-align: middle;
        white-space: nowrap;
    }
    .dplayer-toggle {
        position: absolute;
        top: 5px;
        right: 7px;
        width: 20px;
        height: 20px;
        text-align: center;
        font-size: 0;
        vertical-align: middle;
        input {
            max-height: 0;
            max-width: 0;
            display: none;
        }
        input+label {
            display: inline-block;
            position: relative;
            right: 15px;
            width: 32px;
            height: 20px;
            border-radius: 10px;
            box-sizing: border-box;
            transition: .25s ease;
            box-shadow: rgb(223, 223, 223) 0 0 0 0 inset;
            border: 1px solid rgb(223, 223, 223);
            cursor: pointer;
        }
        input+label:before {
            content: "";
            position: absolute;
            display: block;
            height: 19px;
            width: 19px;
            top: -0.5px;
            left: -0.5px;
            border-radius: 15px;
            transition: .25s ease;
        }
        input+label:after {
            content: "";
            display: block;
            position: absolute;
            height: 18.1px;
            width: 18.1px;
            top: -0.1px;
            left: 0;
            border-radius: 15px;
            background: #fff;
            transition: .25s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
        }
        input:checked+label {
            border-color: var(--theme-color);
        }
        input:checked+label:before {
            width: 31px;
            background: var(--theme-color);
        }
        input:checked+label:after {
            left: 12px;
        }
    }
    .dplayer-setting-origin-panel,
    .dplayer-setting-quality-panel,
    .dplayer-setting-speed-panel,
    .dplayer-setting-audio-panel {
        position: absolute;
        bottom: 0px;
        width: 100%;
        max-height: 100%;
        padding: 7px 0;
        transition: transform .25s ease;
        box-sizing: border-box;
        scrollbar-width: thin;
        overflow-y: auto;
        &::-webkit-scrollbar {
            width: 6px;
        }
        &::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, .15);
        }
    }
    .dplayer-setting-origin-panel {
        transform: translateX(0%);
    }
    .dplayer-setting-quality-panel,
    .dplayer-setting-speed-panel,
    .dplayer-setting-audio-panel {
        transform: translateX(100%);
        .dplayer-setting-header {
            display: flex;
            align-items: center;
            height: 33px;
            padding-left: 5px;
            padding-bottom: 5px;
            margin-bottom: 7px;
            border-bottom: 2px solid rgba(255, 255, 255, .15);
            box-sizing: border-box;
            cursor: pointer;
        }
        .dplayer-setting-quality-item,
        .dplayer-setting-speed-item,
        .dplayer-setting-audio-item {
            padding: 5px;
            .dplayer-toggle {
                visibility: hidden;
            }
            &.dplayer-setting-quality-current .dplayer-toggle,
            &.dplayer-setting-speed-current .dplayer-toggle,
            &.dplayer-setting-audio-current .dplayer-toggle {
                visibility: visible;
            }
        }
        .dplayer-toggle {
            display: inline-block;
            position: static;
            width: 22px;
            margin-right: 6px;
        }
    }
    .dplayer-setting-item,
    .dplayer-setting-quality-item,
    .dplayer-setting-speed-item,
    .dplayer-setting-audio-item {
        display: flex;
        align-items: center;
        height: 30px;
        padding: 5px 10px;
        box-sizing: border-box;
        cursor: pointer;
        position: relative;
        &:hover {
            background-color: rgba(255, 255, 255, .1);
        }
    }
    .dplayer-setting-danmaku {
        padding: 5px 0;
        .dplayer-label {
            padding: 0 10px;
            display: inline;
        }
        .dplayer-label-value {
            margin-right: 18px;
            font-size: 12.5px;
        }
        &:hover {
            .dplayer-label, .dplayer-label-value {
                display: none;
            }
            .dplayer-danmaku-bar-wrap {
                display: inline-block;
            }
        }
        &.dplayer-setting-danmaku-active {
            .dplayer-label, .dplayer-label-value {
                display: none;
            }
            .dplayer-danmaku-bar-wrap {
                display: inline-block;
            }
        }
        .dplayer-danmaku-bar-wrap {
            padding: 0 10px;
            box-sizing: border-box;
            display: none;
            vertical-align: middle;
            height: 100%;
            width: 100%;
            .dplayer-danmaku-bar {
                position: relative;
                top: 8.5px;
                width: 100%;
                height: 3px;
                background: #fff;
                transition: all 0.3s ease-in-out;
                .dplayer-danmaku-bar-inner {
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    height: 100%;
                    transition: all 0.05s ease;
                    will-change: width;
                    .dplayer-thumb {
                        position: absolute;
                        top: 0;
                        right: 5px;
                        margin-top: -4px;
                        margin-right: -10px;
                        height: 11px;
                        width: 11px;
                        border-radius: 50%;
                        cursor: pointer;
                        transition: all .3s ease-in-out;
                    }
                }
            }
        }
    }
}

.dplayer-comment-setting-box {
    position: absolute;
    left: 20px;
    bottom: 64px;
    width: 255px;
    max-height: calc(100% - 64px - 8px);
    clip-path: inset(0 0 0 round 7px);
    border-radius: 7px;
    background: rgba(28, 28, 28, 0.9);
    padding: 10px 10px 16px;
    font-size: 14px;
    transition: all .25s ease;
    scrollbar-width: thin;
    visibility: hidden;
    opacity: 0;
    box-sizing: border-box;
    overflow-y: auto;
    z-index: 2;
    -webkit-tap-highlight-color: transparent;
    &::-webkit-scrollbar {
        width: 6px;
    }
    &::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, .15);
    }
    &.dplayer-comment-setting-open {
        visibility: visible;
        opacity: 1;
    }
    input[type=radio] {
        display: none;
    }
    label {
        cursor: pointer;
    }
    .dplayer-comment-setting-title {
        font-size: 13px;
        color: #fff;
        line-height: 30px;
    }
    .dplayer-comment-setting-type, .dplayer-comment-setting-size {
        font-size: 0;
        &.dplayer-comment-setting-size {
            margin-top: 8px;
        }
        .dplayer-comment-setting-title {
            margin-bottom: 6px;
        }
        label {
            &:nth-child(2) {
                span {
                    border-radius: 4px 0 0 4px;
                }
            }
            &:nth-child(4) {
                span {
                    border-radius: 0 4px 4px 0;
                }
            }
        }
        span {
            width: 33.6%;
            padding: 4px 6px;
            line-height: 16px;
            display: inline-block;
            font-size: 12px;
            color: #fff;
            border: 1px solid #fff;
            margin-right: -1px;
            box-sizing: border-box;
            text-align: center;
            cursor: pointer;
        }
        input:checked+span {
            background: #E4E4E6;
            color: #1c1c1c;
        }
    }
    .dplayer-comment-setting-color {
        font-size: 0;
        .dplayer-comment-setting-color-list {
            display: flex;
            justify-content: space-between;
            padding: 4px 0px;
            label {
                display: inline-block;
                font-size: 0;
                padding: 6px 0px;
            }
            span {
                display: inline-block;
                width: 22px;
                height: 22px;
                border-radius: 50%;
                box-sizing: border-box;
                cursor: pointer;
                &:hover {
                    animation: my-face 5s infinite ease-in-out;
                }
            }
        }
    }
}
`,`.dplayer-danmaku {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    max-width: 100%;
    max-height: 100%;
    aspect-ratio: 16/9;
    margin: auto;
    font-size: 29px;
    font-family: inherit;
    color: #fff;
    overflow: hidden;
    .dplayer-danmaku-item {
        display: inline-block;
        font-weight: bold;
        font-size: var(--dplayer-danmaku-font-size);
        opacity: var(--dplayer-danmaku-opacity);
        white-space: nowrap;
        text-shadow: 1.2px 1.2px 4px rgba(0, 0, 0, 0.9);
        cursor: default;
        user-select: none;
        -webkit-user-select: none;
        pointer-events: none;
        &--demo {
            position: absolute;
            visibility: hidden;
        }
        span {
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }
        &.dplayer-danmaku-size-big {
            font-size: calc(var(--dplayer-danmaku-font-size) * 1.25);
        }
        &.dplayer-danmaku-size-small {
            font-size: calc(var(--dplayer-danmaku-font-size) * 0.8);
        }
    }
    .dplayer-danmaku-right {
        position: absolute;
        right: 0;
        transform: translateX(100%);
        &.dplayer-danmaku-move {
            animation-name: danmaku;
            animation-timing-function: linear;
            animation-play-state: paused;
        }
    }
    @keyframes danmaku {
        from {
            transform: translateX(100%);
        }
    }
    .dplayer-danmaku-top,
    .dplayer-danmaku-bottom {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        visibility: hidden;
        &.dplayer-danmaku-move {
            animation-name: danmaku-center;
            animation-timing-function: linear;
            animation-play-state: paused;
        }
    }
    @keyframes danmaku-center {
        from {
            visibility: visible;
        }
        to {
            visibility: visible;
        }
    }
}
`,`.dplayer-logo {
    pointer-events: none;
    position: absolute;
    left: 20px;
    top: 20px;
    max-width: 50px;
    max-height: 50px;
    img {
        max-width: 100%;
        max-height: 100%;
        background: none;
    }
}
`,`.dplayer-menu {
    position: absolute;
    width: 170px;
    border-radius: 2px;
    background: rgba(28, 28, 28, 0.85);
    padding: 5px 0;
    overflow: hidden;
    z-index: 3;
    display: none;
    &.dplayer-menu-show {
        display: block;
    }
    .dplayer-menu-item {
        height: 30px;
        box-sizing: border-box;
        cursor: pointer;
        &:hover {
            background-color: rgba(255, 255, 255, .1);
        }
        a {
            display: inline-block;
            padding: 0 10px;
            line-height: 30px;
            color: #eee;
            font-size: 13px;
            display: inline-block;
            vertical-align: middle;
            width: 100%;
            box-sizing: border-box;
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
            &:hover {
                text-decoration: none;
            }
        }
    }
}
`,`.dplayer-notice {
    position: absolute;
    bottom: 68px;
    left: 20px;
    padding: 12px 18px;
    margin-right: 20px;
    border-radius: 4px;
    background: rgba(28, 28, 28, 0.9);
    color: #fff;
    font-size: 14px;
    line-height: 1.6;
    transition: all .3s ease-in-out, color 0s;
    opacity: 0;
    overflow: hidden;
    pointer-events: none;
}
@media (max-width: 500px){
    .dplayer-notice {
        top: 10px;
        bottom: auto !important;
    }
}
`,`.dplayer-subtitle {
    position: absolute;
    bottom: 40px;
    width: 90%;
    left: 5%;
    text-align: center;
    color: #fff;
    text-shadow: 0.5px 0.5px 0.5px rgba(0, 0, 0, 0.5);
    font-size: 20px;
    &.dplayer-subtitle-hide {
        display: none;
    }
}
`,`.dplayer-mask {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 1;
    display: none;
    &.dplayer-mask-show {
        display: block;
    }
}

.dplayer-video-wrap {
    display: flex;
    position: relative;
    align-items: center;
    justify-content: center;
    background: #000;
    font-size: 0;
    width: 100%;
    height: 100%;

    .dplayer-video-wrap-aspect {
        position: relative;
        max-width: 100%;
        max-height: 100%;
        aspect-ratio: 16 / 9;
        overflow: hidden;

        .dplayer-video {
            width: 99999px;  // magic!!
            max-width: 100%;
            max-height: 100%;
            display: none;
        }
        .dplayer-video-current {
            display: block;
        }
        .dplayer-video-prepare {
            display: none;
        }
    }
}
`,`.dplayer-info-panel {
    position: absolute;
    top: 10px;
    left: 10px;
    width: 450px;
    background: rgba(28, 28, 28, 0.8);
    padding: 10px;
    color: #fff;
    font-size: 12px;
    border-radius: 2px;

    &-hide {
        display: none;
    }

    .dplayer-info-panel-close {
        cursor: pointer;
        position: absolute;
        right: 10px;
        top: 10px;
    }

    .dplayer-info-panel-item {
        & > span {
            display: inline-block;
            vertical-align: middle;
            line-height: 15px;
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
        }
    }

    .dplayer-info-panel-item-title {
        width: 100px;
        text-align: right;
        margin-right: 10px;
    }

    .dplayer-info-panel-item-data {
        width: 320px;
    }
}
`],sourceRoot:""}]);const m=p},149:function(r){r.exports=function(){var d={9798:function(l,h,o){o.r(h),o.d(h,{CanvasProvider:function(){return R},CanvasRenderer:function(){return Je},HTMLProvider:function(){return Oe},HTMLRenderer:function(){return Yt},SVGProvider:function(){return K},SVGRenderer:function(){return Te}}),o(2526),o(1817),o(2222),o(6992),o(7042),o(5212),o(9575),o(9653),o(5192),o(4363),o(9494),o(1539),o(9714),o(2472),o(2990),o(8927),o(3105),o(5035),o(4345),o(7174),o(2846),o(4731),o(7209),o(6319),o(8867),o(7789),o(3739),o(9368),o(4483),o(2056),o(3462),o(678),o(7462),o(3824),o(5021),o(2974),o(5016),o(3290),o(6699),o(1532),o(9720),o(4916),o(2023),o(8783),o(3112),o(5306),o(3948);var f=new Map([[0,{bytes:2,alphabet:0}],[1,{bytes:1,alphabet:1}],[2,{bytes:1,alphabet:2}],[3,{bytes:1,alphabet:3}],[4,{bytes:1,alphabet:4}],[5,{bytes:1,alphabet:5}],[6,{bytes:1,alphabet:6}],[7,{bytes:1,alphabet:7}],[8,{bytes:1,alphabet:8}],[9,{bytes:1,alphabet:9}],[10,{bytes:1,alphabet:10}],[11,{bytes:1,alphabet:11}],[12,{bytes:2,alphabet:12}],[13,{bytes:2,alphabet:13}],[14,{bytes:2,alphabet:14}]]),p=new Map([[66,{bytes:2,alphabet:0}],[74,{bytes:1,alphabet:1}],[48,{bytes:1,alphabet:2}],[49,{bytes:1,alphabet:3}],[50,{bytes:1,alphabet:4}],[51,{bytes:1,alphabet:5}],[52,{bytes:1,alphabet:6}],[53,{bytes:1,alphabet:7}],[54,{bytes:1,alphabet:8}],[55,{bytes:1,alphabet:9}],[56,{bytes:1,alphabet:10}],[73,{bytes:1,alphabet:11}],[57,{bytes:2,alphabet:12}],[58,{bytes:2,alphabet:13}],[59,{bytes:2,alphabet:14}]]),m=new Map([[15,{bytes:2,alphabet:15}],[16,{bytes:1,alphabet:16}],[17,{bytes:1,alphabet:17}],[18,{bytes:1,alphabet:18}],[19,{bytes:1,alphabet:19}],[20,{bytes:1,alphabet:20}],[21,{bytes:1,alphabet:21}],[22,{bytes:1,alphabet:22}],[23,{bytes:1,alphabet:23}],[24,{bytes:1,alphabet:24}],[25,{bytes:1,alphabet:25}],[26,{bytes:1,alphabet:26}],[27,{bytes:1,alphabet:27}],[28,{bytes:1,alphabet:28}],[29,{bytes:1,alphabet:29}],[30,{bytes:1,alphabet:30}],[31,{bytes:1,alphabet:31}]]),y=new Map([[64,{bytes:2,alphabet:15}],[65,{bytes:1,alphabet:16}],[66,{bytes:1,alphabet:17}],[67,{bytes:1,alphabet:18}],[68,{bytes:1,alphabet:19}],[69,{bytes:1,alphabet:20}],[70,{bytes:1,alphabet:21}],[71,{bytes:1,alphabet:22}],[72,{bytes:1,alphabet:23}],[73,{bytes:1,alphabet:24}],[74,{bytes:1,alphabet:25}],[75,{bytes:1,alphabet:26}],[76,{bytes:1,alphabet:27}],[77,{bytes:1,alphabet:28}],[78,{bytes:1,alphabet:29}],[79,{bytes:1,alphabet:30}],[112,{bytes:1,alphabet:31}]]),_=[["#000000FF","#FF0000FF","#00FF00FF","#FFFF00FF","#0000FFFF","#FF00FFFF","#00FFFFFF","#FFFFFFFF","#00000000","#AA0000FF","#00AA00FF","#AAAA00FF","#0000AAFF","#AA00AAFF","#00AAAAFF","#AAAAAAFF"],["#000055FF","#005500FF","#005555FF","#0055AAFF","#0055FFFF","#00AA55FF","#00AAFFFF","#00FF55FF","#00FFAAFF","#550000FF","#550055FF","#5500AAFF","#5500FFFF","#555500FF","#555555FF","#5555AAFF"],["#5555FFFF","#55AA00FF","#55AA55FF","#55AAAAFF","#55AAFFFF","#55FF00FF","#55FF55FF","#55FFAAFF","#55FFFFFF","#AA0055FF","#AA00FFFF","#AA5500FF","#AA5555FF","#AA55AAFF","#AA55FFFF","#AAAA55FF"],["#AAAAFFFF","#AAFF00FF","#AAFF55FF","#AAFFAAFF","#AAFFFFFF","#FF0055FF","#FF00AAFF","#FF5500FF","#FF5555FF","#FF55AAFF","#FF55FFFF","#FFAA00FF","#FFAA55FF","#FFAAAAFF","#FFAAFFFF","#FFFF55FF"],["#FFFFAAFF","#00000080","#FF000080","#00FF0080","#FFFF0080","#0000FF80","#FF00FF80","#00FFFF80","#FFFFFF80","#AA000080","#00AA0080","#AAAA0080","#0000AA80","#AA00AA80","#00AAAA80","#AAAAAA80"],["#00005580","#00550080","#00555580","#0055AA80","#0055FF80","#00AA5580","#00AAFF80","#00FF5580","#00FFAA80","#55000080","#55005580","#5500AA80","#5500FF80","#55550080","#55555580","#5555AA80"],["#5555FF80","#55AA0080","#55AA5580","#55AAAA80","#55AAFF80","#55FF0080","#55FF5580","#55FFAA80","#55FFFF80","#AA005580","#AA00FF80","#AA550080","#AA555580","#AA55AA80","#AA55FF80","#AAAA5580"],["#AAAAFF80","#AAFF0080","#AAFF5580","#AAFFAA80","#AAFFFF80","#FF005580","#FF00AA80","#FF550080","#FF555580","#FF55AA80","#FF55FF80","#FFAA0080","#FFAA5580","#FFAAAA80","#FFAAFF80","#FFFF5580"]],S=["　","、","。","，","．","・","：","；","？","！","゛","゜","´","｀","¨","＾","￣","＿","ヽ","ヾ","ゝ","ゞ","〃","仝","々","〆","〇","ー","―","‐","／","＼","〜","‖","｜","…","‥","‘","’","“","”","（","）","〔","〕","［","］","｛","｝","〈","〉","《","》","「","」","『","』","【","】","＋","−","±","×","÷","＝","≠","＜","＞","≦","≧","∞","∴","♂","♀","°","′","″","℃","￥","＄","¢","£","％","＃","＆","＊","＠","§","☆","★","○","●","◎","◇","◆","□","■","△","▲","▽","▼","※","〒","→","←","↑","↓","〓","＇","＂","－","～","〳","〴","〵","〻","〼","ヿ","ゟ","∈","∋","⊆","⊇","⊂","⊃","∪","∩","⊄","⊅","⊊","⊋","∉","∅","⌅","⌆","∧","∨","¬","⇒","⇔","∀","∃","⊕","⊖","⊗","∥","∦","⦅","⦆","〘","〙","〖","〗","∠","⊥","⌒","∂","∇","≡","≒","≪","≫","√","∽","∝","∵","∫","∬","≢","≃","≅","≈","≶","≷","↔","Å","‰","♯","♭","♪","†","‡","¶","♮","♫","♬","♩","◯","▷","▶","◁","◀","↗","↘","↖","↙","⇄","⇨","⇦","⇧","⇩","⤴","⤵","０","１","２","３","４","５","６","７","８","９","⦿","◉","〽","﹆","﹅","◦","•","Ａ","Ｂ","Ｃ","Ｄ","Ｅ","Ｆ","Ｇ","Ｈ","Ｉ","Ｊ","Ｋ","Ｌ","Ｍ","Ｎ","Ｏ","Ｐ","Ｑ","Ｒ","Ｓ","Ｔ","Ｕ","Ｖ","Ｗ","Ｘ","Ｙ","Ｚ","∓","ℵ","ℏ","㏋","ℓ","℧","ａ","ｂ","ｃ","ｄ","ｅ","ｆ","ｇ","ｈ","ｉ","ｊ","ｋ","ｌ","ｍ","ｎ","ｏ","ｐ","ｑ","ｒ","ｓ","ｔ","ｕ","ｖ","ｗ","ｘ","ｙ","ｚ","゠","–","⧺","⧻","ぁ","あ","ぃ","い","ぅ","う","ぇ","え","ぉ","お","か","が","き","ぎ","く","ぐ","け","げ","こ","ご","さ","ざ","し","じ","す","ず","せ","ぜ","そ","ぞ","た","だ","ち","ぢ","っ","つ","づ","て","で","と","ど","な","に","ぬ","ね","の","は","ば","ぱ","ひ","び","ぴ","ふ","ぶ","ぷ","へ","べ","ぺ","ほ","ぼ","ぽ","ま","み","む","め","も","ゃ","や","ゅ","ゆ","ょ","よ","ら","り","る","れ","ろ","ゎ","わ","ゐ","ゑ","を","ん","ゔ","ゕ","ゖ","か゚","き゚","く゚","け゚","こ゚","","","","ァ","ア","ィ","イ","ゥ","ウ","ェ","エ","ォ","オ","カ","ガ","キ","ギ","ク","グ","ケ","ゲ","コ","ゴ","サ","ザ","シ","ジ","ス","ズ","セ","ゼ","ソ","ゾ","タ","ダ","チ","ヂ","ッ","ツ","ヅ","テ","デ","ト","ド","ナ","ニ","ヌ","ネ","ノ","ハ","バ","パ","ヒ","ビ","ピ","フ","ブ","プ","ヘ","ベ","ペ","ホ","ボ","ポ","マ","ミ","ム","メ","モ","ャ","ヤ","ュ","ユ","ョ","ヨ","ラ","リ","ル","レ","ロ","ヮ","ワ","ヰ","ヱ","ヲ","ン","ヴ","ヵ","ヶ","カ゚","キ゚","ク゚","ケ゚","コ゚","セ゚","ツ゚","ト゚","Α","Β","Γ","Δ","Ε","Ζ","Η","Θ","Ι","Κ","Λ","Μ","Ν","Ξ","Ο","Π","Ρ","Σ","Τ","Υ","Φ","Χ","Ψ","Ω","♤","♠","♢","♦","♡","♥","♧","♣","α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω","ς","⓵","⓶","⓷","⓸","⓹","⓺","⓻","⓼","⓽","⓾","☖","☗","〠","☎","☀","☁","☂","☃","♨","▱","ㇰ","ㇱ","ㇲ","ㇳ","ㇴ","ㇵ","ㇶ","ㇷ","ㇸ","ㇹ","ㇷ゚","ㇺ","ㇻ","ㇼ","ㇽ","ㇾ","ㇿ","А","Б","В","Г","Д","Е","Ё","Ж","З","И","Й","К","Л","М","Н","О","П","Р","С","Т","У","Ф","Х","Ц","Ч","Ш","Щ","Ъ","Ы","Ь","Э","Ю","Я","⎾","⎿","⏀","⏁","⏂","⏃","⏄","⏅","⏆","⏇","⏈","⏉","⏊","⏋","⏌","а","б","в","г","д","е","ё","ж","з","и","й","к","л","м","н","о","п","р","с","т","у","ф","х","ц","ч","ш","щ","ъ","ы","ь","э","ю","я","ヷ","ヸ","ヹ","ヺ","⋚","⋛","⅓","⅔","⅕","✓","⌘","␣","⏎","─","│","┌","┐","┘","└","├","┬","┤","┴","┼","━","┃","┏","┓","┛","┗","┣","┳","┫","┻","╋","┠","┯","┨","┷","┿","┝","┰","┥","┸","╂","㉑","㉒","㉓","㉔","㉕","㉖","㉗","㉘","㉙","㉚","㉛","㉜","㉝","㉞","㉟","㊱","㊲","㊳","㊴","㊵","㊶","㊷","㊸","㊹","㊺","㊻","㊼","㊽","㊾","㊿","","","","","","","","","◐","◑","◒","◓","‼","⁇","⁈","⁉","Ǎ","ǎ","ǐ","Ḿ","ḿ","Ǹ","ǹ","Ǒ","ǒ","ǔ","ǖ","ǘ","ǚ","ǜ","","","€"," ","¡","¤","¦","©","ª","«","­","®","¯","²","³","·","¸","¹","º","»","¼","½","¾","¿","À","Á","Â","Ã","Ä","Å","Æ","Ç","È","É","Ê","Ë","Ì","Í","Î","Ï","Ð","Ñ","Ò","Ó","Ô","Õ","Ö","Ø","Ù","Ú","Û","Ü","Ý","Þ","ß","à","á","â","ã","ä","å","æ","ç","è","é","ê","ë","ì","í","î","ï","ð","ñ","ò","ó","ô","õ","ö","ø","ù","ú","û","ü","ý","þ","ÿ","Ā","Ī","Ū","Ē","Ō","ā","ī","ū","ē","ō","Ą","˘","Ł","Ľ","Ś","Š","Ş","Ť","Ź","Ž","Ż","ą","˛","ł","ľ","ś","ˇ","š","ş","ť","ź","˝","ž","ż","Ŕ","Ă","Ĺ","Ć","Č","Ę","Ě","Ď","Ń","Ň","Ő","Ř","Ů","Ű","Ţ","ŕ","ă","ĺ","ć","č","ę","ě","ď","đ","ń","ň","ő","ř","ů","ű","ţ","˙","Ĉ","Ĝ","Ĥ","Ĵ","Ŝ","Ŭ","ĉ","ĝ","ĥ","ĵ","ŝ","ŭ","ɱ","ʋ","ɾ","ʃ","ʒ","ɬ","ɮ","ɹ","ʈ","ɖ","ɳ","ɽ","ʂ","ʐ","ɻ","ɭ","ɟ","ɲ","ʝ","ʎ","ɡ","ŋ","ɰ","ʁ","ħ","ʕ","ʔ","ɦ","ʘ","ǂ","ɓ","ɗ","ʄ","ɠ","Ɠ","œ","Œ","ɨ","ʉ","ɘ","ɵ","ə","ɜ","ɞ","ɐ","ɯ","ʊ","ɤ","ʌ","ɔ","ɑ","ɒ","ʍ","ɥ","ʢ","ʡ","ɕ","ʑ","ɺ","ɧ","ɚ","æ̀","ǽ","ὰ","ά","ɔ̀","ɔ́","ʌ̀","ʌ́","ə̀","ə́","ɚ̀","ɚ́","ὲ","έ","͡","ˈ","ˌ","ː","ˑ","̆","‿","̋","́","̄","̀","̏","̌","̂","˥","˦","˧","˨","˩","˩˥","˥˩","̥","̬","̹","̜","̟","̠","̈","̽","̩","̯","˞","̤","̰","̼","̴","̝","̞","̘","̙","̪","̺","̻","̃","̚","❶","❷","❸","❹","❺","❻","❼","❽","❾","❿","⓫","⓬","⓭","⓮","⓯","⓰","⓱","⓲","⓳","⓴","ⅰ","ⅱ","ⅲ","ⅳ","ⅴ","ⅵ","ⅶ","ⅷ","ⅸ","ⅹ","ⅺ","ⅻ","ⓐ","ⓑ","ⓒ","ⓓ","ⓔ","ⓕ","ⓖ","ⓗ","ⓘ","ⓙ","ⓚ","ⓛ","ⓜ","ⓝ","ⓞ","ⓟ","ⓠ","ⓡ","ⓢ","ⓣ","ⓤ","ⓥ","ⓦ","ⓧ","ⓨ","ⓩ","㋐","㋑","㋒","㋓","㋔","㋕","㋖","㋗","㋘","㋙","㋚","㋛","㋜","㋝","㋞","㋟","㋠","㋡","㋢","㋣","㋺","㋩","㋥","㋭","㋬","","","","","","","","","","⁑","⁂","①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩","⑪","⑫","⑬","⑭","⑮","⑯","⑰","⑱","⑲","⑳","Ⅰ","Ⅱ","Ⅲ","Ⅳ","Ⅴ","Ⅵ","Ⅶ","Ⅷ","Ⅸ","Ⅹ","Ⅺ","㍉","㌔","㌢","㍍","㌘","㌧","㌃","㌶","㍑","㍗","㌍","㌦","㌣","㌫","㍊","㌻","㎜","㎝","㎞","㎎","㎏","㏄","㎡","Ⅻ","","","","","","","","㍻","〝","〟","№","㏍","℡","㊤","㊥","㊦","㊧","㊨","㈱","㈲","㈹","㍾","㍽","㍼","","","","∮","","","","","∟","⊿","","","","❖","☞","俱","𠀋","㐂","丨","丯","丰","亍","仡","份","仿","伃","伋","你","佈","佉","佖","佟","佪","佬","佾","侊","侔","侗","侮","俉","俠","倁","倂","倎","倘","倧","倮","偀","倻","偁","傔","僌","僲","僐","僦","僧","儆","儃","儋","儞","儵","兊","免","兕","兗","㒵","冝","凃","凊","凞","凢","凮","刁","㓛","刓","刕","剉","剗","剡","劓","勈","勉","勌","勐","勖","勛","勤","勰","勻","匀","匇","匜","卑","卡","卣","卽","厓","厝","厲","吒","吧","呍","咜","呫","呴","呿","咈","咖","咡","咩","哆","哿","唎","唫","唵","啐","啞","喁","喆","喎","喝","喭","嗎","嘆","嘈","嘎","嘻","噉","噶","噦","器","噯","噱","噲","嚙","嚞","嚩","嚬","嚳","囉","囊","圊","𡈽","圡","圯","圳","圴","坰","坷","坼","垜","﨏","𡌛","垸","埇","埈","埏","埤","埭","埵","埶","埿","堉","塚","塡","塤","塀","塼","墉","增","墨","墩","𡑮","壒","壎","壔","壚","壠","壩","夌","虁","奝","奭","妋","妒","妤","姃","姒","姝","娓","娣","婧","婭","婷","婾","媄","媞","媧","嫄","𡢽","嬙","嬥","剝","亜","唖","娃","阿","哀","愛","挨","姶","逢","葵","茜","穐","悪","握","渥","旭","葦","芦","鯵","梓","圧","斡","扱","宛","姐","虻","飴","絢","綾","鮎","或","粟","袷","安","庵","按","暗","案","闇","鞍","杏","以","伊","位","依","偉","囲","夷","委","威","尉","惟","意","慰","易","椅","為","畏","異","移","維","緯","胃","萎","衣","謂","違","遺","医","井","亥","域","育","郁","磯","一","壱","溢","逸","稲","茨","芋","鰯","允","印","咽","員","因","姻","引","飲","淫","胤","蔭","院","陰","隠","韻","吋","右","宇","烏","羽","迂","雨","卯","鵜","窺","丑","碓","臼","渦","嘘","唄","欝","蔚","鰻","姥","厩","浦","瓜","閏","噂","云","運","雲","荏","餌","叡","営","嬰","影","映","曳","栄","永","泳","洩","瑛","盈","穎","頴","英","衛","詠","鋭","液","疫","益","駅","悦","謁","越","閲","榎","厭","円","園","堰","奄","宴","延","怨","掩","援","沿","演","炎","焔","煙","燕","猿","縁","艶","苑","薗","遠","鉛","鴛","塩","於","汚","甥","凹","央","奥","往","応","押","旺","横","欧","殴","王","翁","襖","鴬","鴎","黄","岡","沖","荻","億","屋","憶","臆","桶","牡","乙","俺","卸","恩","温","穏","音","下","化","仮","何","伽","価","佳","加","可","嘉","夏","嫁","家","寡","科","暇","果","架","歌","河","火","珂","禍","禾","稼","箇","花","苛","茄","荷","華","菓","蝦","課","嘩","貨","迦","過","霞","蚊","俄","峨","我","牙","画","臥","芽","蛾","賀","雅","餓","駕","介","会","解","回","塊","壊","廻","快","怪","悔","恢","懐","戒","拐","改","魁","晦","械","海","灰","界","皆","絵","芥","蟹","開","階","貝","凱","劾","外","咳","害","崖","慨","概","涯","碍","蓋","街","該","鎧","骸","浬","馨","蛙","垣","柿","蛎","鈎","劃","嚇","各","廓","拡","撹","格","核","殻","獲","確","穫","覚","角","赫","較","郭","閣","隔","革","学","岳","楽","額","顎","掛","笠","樫","橿","梶","鰍","潟","割","喝","恰","括","活","渇","滑","葛","褐","轄","且","鰹","叶","椛","樺","鞄","株","兜","竃","蒲","釜","鎌","噛","鴨","栢","茅","萱","粥","刈","苅","瓦","乾","侃","冠","寒","刊","勘","勧","巻","喚","堪","姦","完","官","寛","干","幹","患","感","慣","憾","換","敢","柑","桓","棺","款","歓","汗","漢","澗","潅","環","甘","監","看","竿","管","簡","緩","缶","翰","肝","艦","莞","観","諌","貫","還","鑑","間","閑","関","陥","韓","館","舘","丸","含","岸","巌","玩","癌","眼","岩","翫","贋","雁","頑","顔","願","企","伎","危","喜","器","基","奇","嬉","寄","岐","希","幾","忌","揮","机","旗","既","期","棋","棄","機","帰","毅","気","汽","畿","祈","季","稀","紀","徽","規","記","貴","起","軌","輝","飢","騎","鬼","亀","偽","儀","妓","宜","戯","技","擬","欺","犠","疑","祇","義","蟻","誼","議","掬","菊","鞠","吉","吃","喫","桔","橘","詰","砧","杵","黍","却","客","脚","虐","逆","丘","久","仇","休","及","吸","宮","弓","急","救","朽","求","汲","泣","灸","球","究","窮","笈","級","糾","給","旧","牛","去","居","巨","拒","拠","挙","渠","虚","許","距","鋸","漁","禦","魚","亨","享","京","供","侠","僑","兇","競","共","凶","協","匡","卿","叫","喬","境","峡","強","彊","怯","恐","恭","挟","教","橋","況","狂","狭","矯","胸","脅","興","蕎","郷","鏡","響","饗","驚","仰","凝","尭","暁","業","局","曲","極","玉","桐","粁","僅","勤","均","巾","錦","斤","欣","欽","琴","禁","禽","筋","緊","芹","菌","衿","襟","謹","近","金","吟","銀","九","倶","句","区","狗","玖","矩","苦","躯","駆","駈","駒","具","愚","虞","喰","空","偶","寓","遇","隅","串","櫛","釧","屑","屈","掘","窟","沓","靴","轡","窪","熊","隈","粂","栗","繰","桑","鍬","勲","君","薫","訓","群","軍","郡","卦","袈","祁","係","傾","刑","兄","啓","圭","珪","型","契","形","径","恵","慶","慧","憩","掲","携","敬","景","桂","渓","畦","稽","系","経","継","繋","罫","茎","荊","蛍","計","詣","警","軽","頚","鶏","芸","迎","鯨","劇","戟","撃","激","隙","桁","傑","欠","決","潔","穴","結","血","訣","月","件","倹","倦","健","兼","券","剣","喧","圏","堅","嫌","建","憲","懸","拳","捲","検","権","牽","犬","献","研","硯","絹","県","肩","見","謙","賢","軒","遣","鍵","険","顕","験","鹸","元","原","厳","幻","弦","減","源","玄","現","絃","舷","言","諺","限","乎","個","古","呼","固","姑","孤","己","庫","弧","戸","故","枯","湖","狐","糊","袴","股","胡","菰","虎","誇","跨","鈷","雇","顧","鼓","五","互","伍","午","呉","吾","娯","後","御","悟","梧","檎","瑚","碁","語","誤","護","醐","乞","鯉","交","佼","侯","候","倖","光","公","功","効","勾","厚","口","向","后","喉","坑","垢","好","孔","孝","宏","工","巧","巷","幸","広","庚","康","弘","恒","慌","抗","拘","控","攻","昂","晃","更","杭","校","梗","構","江","洪","浩","港","溝","甲","皇","硬","稿","糠","紅","紘","絞","綱","耕","考","肯","肱","腔","膏","航","荒","行","衡","講","貢","購","郊","酵","鉱","砿","鋼","閤","降","項","香","高","鴻","剛","劫","号","合","壕","拷","濠","豪","轟","麹","克","刻","告","国","穀","酷","鵠","黒","獄","漉","腰","甑","忽","惚","骨","狛","込","此","頃","今","困","坤","墾","婚","恨","懇","昏","昆","根","梱","混","痕","紺","艮","魂","些","佐","叉","唆","嵯","左","差","査","沙","瑳","砂","詐","鎖","裟","坐","座","挫","債","催","再","最","哉","塞","妻","宰","彩","才","採","栽","歳","済","災","采","犀","砕","砦","祭","斎","細","菜","裁","載","際","剤","在","材","罪","財","冴","坂","阪","堺","榊","肴","咲","崎","埼","碕","鷺","作","削","咋","搾","昨","朔","柵","窄","策","索","錯","桜","鮭","笹","匙","冊","刷","察","拶","撮","擦","札","殺","薩","雑","皐","鯖","捌","錆","鮫","皿","晒","三","傘","参","山","惨","撒","散","桟","燦","珊","産","算","纂","蚕","讃","賛","酸","餐","斬","暫","残","仕","仔","伺","使","刺","司","史","嗣","四","士","始","姉","姿","子","屍","市","師","志","思","指","支","孜","斯","施","旨","枝","止","死","氏","獅","祉","私","糸","紙","紫","肢","脂","至","視","詞","詩","試","誌","諮","資","賜","雌","飼","歯","事","似","侍","児","字","寺","慈","持","時","次","滋","治","爾","璽","痔","磁","示","而","耳","自","蒔","辞","汐","鹿","式","識","鴫","竺","軸","宍","雫","七","叱","執","失","嫉","室","悉","湿","漆","疾","質","実","蔀","篠","偲","柴","芝","屡","蕊","縞","舎","写","射","捨","赦","斜","煮","社","紗","者","謝","車","遮","蛇","邪","借","勺","尺","杓","灼","爵","酌","釈","錫","若","寂","弱","惹","主","取","守","手","朱","殊","狩","珠","種","腫","趣","酒","首","儒","受","呪","寿","授","樹","綬","需","囚","収","周","宗","就","州","修","愁","拾","洲","秀","秋","終","繍","習","臭","舟","蒐","衆","襲","讐","蹴","輯","週","酋","酬","集","醜","什","住","充","十","従","戎","柔","汁","渋","獣","縦","重","銃","叔","夙","宿","淑","祝","縮","粛","塾","熟","出","術","述","俊","峻","春","瞬","竣","舜","駿","准","循","旬","楯","殉","淳","準","潤","盾","純","巡","遵","醇","順","処","初","所","暑","曙","渚","庶","緒","署","書","薯","藷","諸","助","叙","女","序","徐","恕","鋤","除","傷","償","勝","匠","升","召","哨","商","唱","嘗","奨","妾","娼","宵","将","小","少","尚","庄","床","廠","彰","承","抄","招","掌","捷","昇","昌","昭","晶","松","梢","樟","樵","沼","消","渉","湘","焼","焦","照","症","省","硝","礁","祥","称","章","笑","粧","紹","肖","菖","蒋","蕉","衝","裳","訟","証","詔","詳","象","賞","醤","鉦","鍾","鐘","障","鞘","上","丈","丞","乗","冗","剰","城","場","壌","嬢","常","情","擾","条","杖","浄","状","畳","穣","蒸","譲","醸","錠","嘱","埴","飾","拭","植","殖","燭","織","職","色","触","食","蝕","辱","尻","伸","信","侵","唇","娠","寝","審","心","慎","振","新","晋","森","榛","浸","深","申","疹","真","神","秦","紳","臣","芯","薪","親","診","身","辛","進","針","震","人","仁","刃","塵","壬","尋","甚","尽","腎","訊","迅","陣","靭","笥","諏","須","酢","図","厨","逗","吹","垂","帥","推","水","炊","睡","粋","翠","衰","遂","酔","錐","錘","随","瑞","髄","崇","嵩","数","枢","趨","雛","据","杉","椙","菅","頗","雀","裾","澄","摺","寸","世","瀬","畝","是","凄","制","勢","姓","征","性","成","政","整","星","晴","棲","栖","正","清","牲","生","盛","精","聖","声","製","西","誠","誓","請","逝","醒","青","静","斉","税","脆","隻","席","惜","戚","斥","昔","析","石","積","籍","績","脊","責","赤","跡","蹟","碩","切","拙","接","摂","折","設","窃","節","説","雪","絶","舌","蝉","仙","先","千","占","宣","専","尖","川","戦","扇","撰","栓","栴","泉","浅","洗","染","潜","煎","煽","旋","穿","箭","線","繊","羨","腺","舛","船","薦","詮","賎","践","選","遷","銭","銑","閃","鮮","前","善","漸","然","全","禅","繕","膳","糎","噌","塑","岨","措","曾","曽","楚","狙","疏","疎","礎","祖","租","粗","素","組","蘇","訴","阻","遡","鼠","僧","創","双","叢","倉","喪","壮","奏","爽","宋","層","匝","惣","想","捜","掃","挿","掻","操","早","曹","巣","槍","槽","漕","燥","争","痩","相","窓","糟","総","綜","聡","草","荘","葬","蒼","藻","装","走","送","遭","鎗","霜","騒","像","増","憎","臓","蔵","贈","造","促","側","則","即","息","捉","束","測","足","速","俗","属","賊","族","続","卒","袖","其","揃","存","孫","尊","損","村","遜","他","多","太","汰","詑","唾","堕","妥","惰","打","柁","舵","楕","陀","駄","騨","体","堆","対","耐","岱","帯","待","怠","態","戴","替","泰","滞","胎","腿","苔","袋","貸","退","逮","隊","黛","鯛","代","台","大","第","醍","題","鷹","滝","瀧","卓","啄","宅","托","択","拓","沢","濯","琢","託","鐸","濁","諾","茸","凧","蛸","只","叩","但","達","辰","奪","脱","巽","竪","辿","棚","谷","狸","鱈","樽","誰","丹","単","嘆","坦","担","探","旦","歎","淡","湛","炭","短","端","箪","綻","耽","胆","蛋","誕","鍛","団","壇","弾","断","暖","檀","段","男","談","値","知","地","弛","恥","智","池","痴","稚","置","致","蜘","遅","馳","築","畜","竹","筑","蓄","逐","秩","窒","茶","嫡","着","中","仲","宙","忠","抽","昼","柱","注","虫","衷","註","酎","鋳","駐","樗","瀦","猪","苧","著","貯","丁","兆","凋","喋","寵","帖","帳","庁","弔","張","彫","徴","懲","挑","暢","朝","潮","牒","町","眺","聴","脹","腸","蝶","調","諜","超","跳","銚","長","頂","鳥","勅","捗","直","朕","沈","珍","賃","鎮","陳","津","墜","椎","槌","追","鎚","痛","通","塚","栂","掴","槻","佃","漬","柘","辻","蔦","綴","鍔","椿","潰","坪","壷","嬬","紬","爪","吊","釣","鶴","亭","低","停","偵","剃","貞","呈","堤","定","帝","底","庭","廷","弟","悌","抵","挺","提","梯","汀","碇","禎","程","締","艇","訂","諦","蹄","逓","邸","鄭","釘","鼎","泥","摘","擢","敵","滴","的","笛","適","鏑","溺","哲","徹","撤","轍","迭","鉄","典","填","天","展","店","添","纏","甜","貼","転","顛","点","伝","殿","澱","田","電","兎","吐","堵","塗","妬","屠","徒","斗","杜","渡","登","菟","賭","途","都","鍍","砥","砺","努","度","土","奴","怒","倒","党","冬","凍","刀","唐","塔","塘","套","宕","島","嶋","悼","投","搭","東","桃","梼","棟","盗","淘","湯","涛","灯","燈","当","痘","祷","等","答","筒","糖","統","到","董","蕩","藤","討","謄","豆","踏","逃","透","鐙","陶","頭","騰","闘","働","動","同","堂","導","憧","撞","洞","瞳","童","胴","萄","道","銅","峠","鴇","匿","得","徳","涜","特","督","禿","篤","毒","独","読","栃","橡","凸","突","椴","届","鳶","苫","寅","酉","瀞","噸","屯","惇","敦","沌","豚","遁","頓","呑","曇","鈍","奈","那","内","乍","凪","薙","謎","灘","捺","鍋","楢","馴","縄","畷","南","楠","軟","難","汝","二","尼","弐","迩","匂","賑","肉","虹","廿","日","乳","入","如","尿","韮","任","妊","忍","認","濡","禰","祢","寧","葱","猫","熱","年","念","捻","撚","燃","粘","乃","廼","之","埜","嚢","悩","濃","納","能","脳","膿","農","覗","蚤","巴","把","播","覇","杷","波","派","琶","破","婆","罵","芭","馬","俳","廃","拝","排","敗","杯","盃","牌","背","肺","輩","配","倍","培","媒","梅","楳","煤","狽","買","売","賠","陪","這","蝿","秤","矧","萩","伯","剥","博","拍","柏","泊","白","箔","粕","舶","薄","迫","曝","漠","爆","縛","莫","駁","麦","函","箱","硲","箸","肇","筈","櫨","幡","肌","畑","畠","八","鉢","溌","発","醗","髪","伐","罰","抜","筏","閥","鳩","噺","塙","蛤","隼","伴","判","半","反","叛","帆","搬","斑","板","氾","汎","版","犯","班","畔","繁","般","藩","販","範","釆","煩","頒","飯","挽","晩","番","盤","磐","蕃","蛮","匪","卑","否","妃","庇","彼","悲","扉","批","披","斐","比","泌","疲","皮","碑","秘","緋","罷","肥","被","誹","費","避","非","飛","樋","簸","備","尾","微","枇","毘","琵","眉","美","鼻","柊","稗","匹","疋","髭","彦","膝","菱","肘","弼","必","畢","筆","逼","桧","姫","媛","紐","百","謬","俵","彪","標","氷","漂","瓢","票","表","評","豹","廟","描","病","秒","苗","錨","鋲","蒜","蛭","鰭","品","彬","斌","浜","瀕","貧","賓","頻","敏","瓶","不","付","埠","夫","婦","富","冨","布","府","怖","扶","敷","斧","普","浮","父","符","腐","膚","芙","譜","負","賦","赴","阜","附","侮","撫","武","舞","葡","蕪","部","封","楓","風","葺","蕗","伏","副","復","幅","服","福","腹","複","覆","淵","弗","払","沸","仏","物","鮒","分","吻","噴","墳","憤","扮","焚","奮","粉","糞","紛","雰","文","聞","丙","併","兵","塀","幣","平","弊","柄","並","蔽","閉","陛","米","頁","僻","壁","癖","碧","別","瞥","蔑","箆","偏","変","片","篇","編","辺","返","遍","便","勉","娩","弁","鞭","保","舗","鋪","圃","捕","歩","甫","補","輔","穂","募","墓","慕","戊","暮","母","簿","菩","倣","俸","包","呆","報","奉","宝","峰","峯","崩","庖","抱","捧","放","方","朋","法","泡","烹","砲","縫","胞","芳","萌","蓬","蜂","褒","訪","豊","邦","鋒","飽","鳳","鵬","乏","亡","傍","剖","坊","妨","帽","忘","忙","房","暴","望","某","棒","冒","紡","肪","膨","謀","貌","貿","鉾","防","吠","頬","北","僕","卜","墨","撲","朴","牧","睦","穆","釦","勃","没","殆","堀","幌","奔","本","翻","凡","盆","摩","磨","魔","麻","埋","妹","昧","枚","毎","哩","槙","幕","膜","枕","鮪","柾","鱒","桝","亦","俣","又","抹","末","沫","迄","侭","繭","麿","万","慢","満","漫","蔓","味","未","魅","巳","箕","岬","密","蜜","湊","蓑","稔","脈","妙","粍","民","眠","務","夢","無","牟","矛","霧","鵡","椋","婿","娘","冥","名","命","明","盟","迷","銘","鳴","姪","牝","滅","免","棉","綿","緬","面","麺","摸","模","茂","妄","孟","毛","猛","盲","網","耗","蒙","儲","木","黙","目","杢","勿","餅","尤","戻","籾","貰","問","悶","紋","門","匁","也","冶","夜","爺","耶","野","弥","矢","厄","役","約","薬","訳","躍","靖","柳","薮","鑓","愉","愈","油","癒","諭","輸","唯","佑","優","勇","友","宥","幽","悠","憂","揖","有","柚","湧","涌","猶","猷","由","祐","裕","誘","遊","邑","郵","雄","融","夕","予","余","与","誉","輿","預","傭","幼","妖","容","庸","揚","揺","擁","曜","楊","様","洋","溶","熔","用","窯","羊","耀","葉","蓉","要","謡","踊","遥","陽","養","慾","抑","欲","沃","浴","翌","翼","淀","羅","螺","裸","来","莱","頼","雷","洛","絡","落","酪","乱","卵","嵐","欄","濫","藍","蘭","覧","利","吏","履","李","梨","理","璃","痢","裏","裡","里","離","陸","律","率","立","葎","掠","略","劉","流","溜","琉","留","硫","粒","隆","竜","龍","侶","慮","旅","虜","了","亮","僚","両","凌","寮","料","梁","涼","猟","療","瞭","稜","糧","良","諒","遼","量","陵","領","力","緑","倫","厘","林","淋","燐","琳","臨","輪","隣","鱗","麟","瑠","塁","涙","累","類","令","伶","例","冷","励","嶺","怜","玲","礼","苓","鈴","隷","零","霊","麗","齢","暦","歴","列","劣","烈","裂","廉","恋","憐","漣","煉","簾","練","聯","蓮","連","錬","呂","魯","櫓","炉","賂","路","露","労","婁","廊","弄","朗","楼","榔","浪","漏","牢","狼","篭","老","聾","蝋","郎","六","麓","禄","肋","録","論","倭","和","話","歪","賄","脇","惑","枠","鷲","亙","亘","鰐","詫","藁","蕨","椀","湾","碗","腕","𠮟","孁","孖","孽","宓","寘","寬","尒","尞","尣","尫","㞍","屢","層","屮","𡚴","屺","岏","岟","岣","岪","岺","峋","峐","峒","峴","𡸴","㟢","崍","崧","﨑","嵆","嵇","嵓","嵊","嵭","嶁","嶠","嶤","嶧","嶸","巋","吞","弌","丐","丕","个","丱","丶","丼","丿","乂","乖","乘","亂","亅","豫","亊","舒","弍","于","亞","亟","亠","亢","亰","亳","亶","从","仍","仄","仆","仂","仗","仞","仭","仟","价","伉","佚","估","佛","佝","佗","佇","佶","侈","侏","侘","佻","佩","佰","侑","佯","來","侖","儘","俔","俟","俎","俘","俛","俑","俚","俐","俤","俥","倚","倨","倔","倪","倥","倅","伜","俶","倡","倩","倬","俾","俯","們","倆","偃","假","會","偕","偐","偈","做","偖","偬","偸","傀","傚","傅","傴","傲","僉","僊","傳","僂","僖","僞","僥","僭","僣","僮","價","僵","儉","儁","儂","儖","儕","儔","儚","儡","儺","儷","儼","儻","儿","兀","兒","兌","兔","兢","竸","兩","兪","兮","冀","冂","囘","册","冉","冏","冑","冓","冕","冖","冤","冦","冢","冩","冪","冫","决","冱","冲","冰","况","冽","凅","凉","凛","几","處","凩","凭","凰","凵","凾","刄","刋","刔","刎","刧","刪","刮","刳","刹","剏","剄","剋","剌","剞","剔","剪","剴","剩","剳","剿","剽","劍","劔","劒","剱","劈","劑","辨","辧","劬","劭","劼","劵","勁","勍","勗","勞","勣","勦","飭","勠","勳","勵","勸","勹","匆","匈","甸","匍","匐","匏","匕","匚","匣","匯","匱","匳","匸","區","卆","卅","丗","卉","卍","凖","卞","卩","卮","夘","卻","卷","厂","厖","厠","厦","厥","厮","厰","厶","參","簒","雙","叟","曼","燮","叮","叨","叭","叺","吁","吽","呀","听","吭","吼","吮","吶","吩","吝","呎","咏","呵","咎","呟","呱","呷","呰","咒","呻","咀","呶","咄","咐","咆","哇","咢","咸","咥","咬","哄","哈","咨","咫","哂","咤","咾","咼","哘","哥","哦","唏","唔","哽","哮","哭","哺","哢","唹","啀","啣","啌","售","啜","啅","啖","啗","唸","唳","啝","喙","喀","咯","喊","喟","啻","啾","喘","喞","單","啼","喃","喩","喇","喨","嗚","嗅","嗟","嗄","嗜","嗤","嗔","嘔","嗷","嘖","嗾","嗽","嘛","嗹","噎","噐","營","嘴","嘶","嘲","嘸","噫","噤","嘯","噬","噪","嚆","嚀","嚊","嚠","嚔","嚏","嚥","嚮","嚶","嚴","囂","嚼","囁","囃","囀","囈","囎","囑","囓","囗","囮","囹","圀","囿","圄","圉","圈","國","圍","圓","團","圖","嗇","圜","圦","圷","圸","坎","圻","址","坏","坩","埀","垈","坡","坿","垉","垓","垠","垳","垤","垪","垰","埃","埆","埔","埒","埓","堊","埖","埣","堋","堙","堝","塲","堡","塢","塋","塰","毀","塒","堽","塹","墅","墹","墟","墫","墺","壞","墻","墸","墮","壅","壓","壑","壗","壙","壘","壥","壜","壤","壟","壯","壺","壹","壻","壼","壽","夂","夊","夐","夛","梦","夥","夬","夭","夲","夸","夾","竒","奕","奐","奎","奚","奘","奢","奠","奧","奬","奩","奸","妁","妝","佞","侫","妣","妲","姆","姨","姜","妍","姙","姚","娥","娟","娑","娜","娉","娚","婀","婬","婉","娵","娶","婢","婪","媚","媼","媾","嫋","嫂","媽","嫣","嫗","嫦","嫩","嫖","嫺","嫻","嬌","嬋","嬖","嬲","嫐","嬪","嬶","嬾","孃","孅","孀","孑","孕","孚","孛","孥","孩","孰","孳","孵","學","斈","孺","宀","它","宦","宸","寃","寇","寉","寔","寐","寤","實","寢","寞","寥","寫","寰","寶","寳","尅","將","專","對","尓","尠","尢","尨","尸","尹","屁","屆","屎","屓","屐","屏","孱","屬","屮","乢","屶","屹","岌","岑","岔","妛","岫","岻","岶","岼","岷","峅","岾","峇","峙","峩","峽","峺","峭","嶌","峪","崋","崕","崗","嵜","崟","崛","崑","崔","崢","崚","崙","崘","嵌","嵒","嵎","嵋","嵬","嵳","嵶","嶇","嶄","嶂","嶢","嶝","嶬","嶮","嶽","嶐","嶷","嶼","巉","巍","巓","巒","巖","巛","巫","已","巵","帋","帚","帙","帑","帛","帶","帷","幄","幃","幀","幎","幗","幔","幟","幢","幤","幇","幵","并","幺","麼","广","庠","廁","廂","廈","廐","廏","廖","廣","廝","廚","廛","廢","廡","廨","廩","廬","廱","廳","廰","廴","廸","廾","弃","弉","彝","彜","弋","弑","弖","弩","弭","弸","彁","彈","彌","彎","弯","彑","彖","彗","彙","彡","彭","彳","彷","徃","徂","彿","徊","很","徑","徇","從","徙","徘","徠","徨","徭","徼","忖","忻","忤","忸","忱","忝","悳","忿","怡","恠","怙","怐","怩","怎","怱","怛","怕","怫","怦","怏","怺","恚","恁","恪","恷","恟","恊","恆","恍","恣","恃","恤","恂","恬","恫","恙","悁","悍","惧","悃","悚","悄","悛","悖","悗","悒","悧","悋","惡","悸","惠","惓","悴","忰","悽","惆","悵","惘","慍","愕","愆","惶","惷","愀","惴","惺","愃","愡","惻","惱","愍","愎","慇","愾","愨","愧","慊","愿","愼","愬","愴","愽","慂","慄","慳","慷","慘","慙","慚","慫","慴","慯","慥","慱","慟","慝","慓","慵","憙","憖","憇","憬","憔","憚","憊","憑","憫","憮","懌","懊","應","懷","懈","懃","懆","憺","懋","罹","懍","懦","懣","懶","懺","懴","懿","懽","懼","懾","戀","戈","戉","戍","戌","戔","戛","戞","戡","截","戮","戰","戲","戳","扁","扎","扞","扣","扛","扠","扨","扼","抂","抉","找","抒","抓","抖","拔","抃","抔","拗","拑","抻","拏","拿","拆","擔","拈","拜","拌","拊","拂","拇","抛","拉","挌","拮","拱","挧","挂","挈","拯","拵","捐","挾","捍","搜","捏","掖","掎","掀","掫","捶","掣","掏","掉","掟","掵","捫","捩","掾","揩","揀","揆","揣","揉","插","揶","揄","搖","搴","搆","搓","搦","搶","攝","搗","搨","搏","摧","摯","摶","摎","攪","撕","撓","撥","撩","撈","撼","據","擒","擅","擇","撻","擘","擂","擱","擧","舉","擠","擡","抬","擣","擯","攬","擶","擴","擲","擺","攀","擽","攘","攜","攅","攤","攣","攫","攴","攵","攷","收","攸","畋","效","敖","敕","敍","敘","敞","敝","敲","數","斂","斃","變","斛","斟","斫","斷","旃","旆","旁","旄","旌","旒","旛","旙","无","旡","旱","杲","昊","昃","旻","杳","昵","昶","昴","昜","晏","晄","晉","晁","晞","晝","晤","晧","晨","晟","晢","晰","暃","暈","暎","暉","暄","暘","暝","曁","暹","曉","暾","暼","曄","暸","曖","曚","曠","昿","曦","曩","曰","曵","曷","朏","朖","朞","朦","朧","霸","朮","朿","朶","杁","朸","朷","杆","杞","杠","杙","杣","杤","枉","杰","枩","杼","杪","枌","枋","枦","枡","枅","枷","柯","枴","柬","枳","柩","枸","柤","柞","柝","柢","柮","枹","柎","柆","柧","檜","栞","框","栩","桀","桍","栲","桎","梳","栫","桙","档","桷","桿","梟","梏","梭","梔","條","梛","梃","檮","梹","桴","梵","梠","梺","椏","梍","桾","椁","棊","椈","棘","椢","椦","棡","椌","棍","棔","棧","棕","椶","椒","椄","棗","棣","椥","棹","棠","棯","椨","椪","椚","椣","椡","棆","楹","楷","楜","楸","楫","楔","楾","楮","椹","楴","椽","楙","椰","楡","楞","楝","榁","楪","榲","榮","槐","榿","槁","槓","榾","槎","寨","槊","槝","榻","槃","榧","樮","榑","榠","榜","榕","榴","槞","槨","樂","樛","槿","權","槹","槲","槧","樅","榱","樞","槭","樔","槫","樊","樒","櫁","樣","樓","橄","樌","橲","樶","橸","橇","橢","橙","橦","橈","樸","樢","檐","檍","檠","檄","檢","檣","檗","蘗","檻","櫃","櫂","檸","檳","檬","櫞","櫑","櫟","檪","櫚","櫪","櫻","欅","蘖","櫺","欒","欖","鬱","欟","欸","欷","盜","欹","飮","歇","歃","歉","歐","歙","歔","歛","歟","歡","歸","歹","歿","殀","殄","殃","殍","殘","殕","殞","殤","殪","殫","殯","殲","殱","殳","殷","殼","毆","毋","毓","毟","毬","毫","毳","毯","麾","氈","氓","气","氛","氤","氣","汞","汕","汢","汪","沂","沍","沚","沁","沛","汾","汨","汳","沒","沐","泄","泱","泓","沽","泗","泅","泝","沮","沱","沾","沺","泛","泯","泙","泪","洟","衍","洶","洫","洽","洸","洙","洵","洳","洒","洌","浣","涓","浤","浚","浹","浙","涎","涕","濤","涅","淹","渕","渊","涵","淇","淦","涸","淆","淬","淞","淌","淨","淒","淅","淺","淙","淤","淕","淪","淮","渭","湮","渮","渙","湲","湟","渾","渣","湫","渫","湶","湍","渟","湃","渺","湎","渤","滿","渝","游","溂","溪","溘","滉","溷","滓","溽","溯","滄","溲","滔","滕","溏","溥","滂","溟","潁","漑","灌","滬","滸","滾","漿","滲","漱","滯","漲","滌","漾","漓","滷","澆","潺","潸","澁","澀","潯","潛","濳","潭","澂","潼","潘","澎","澑","濂","潦","澳","澣","澡","澤","澹","濆","澪","濟","濕","濬","濔","濘","濱","濮","濛","瀉","瀋","濺","瀑","瀁","瀏","濾","瀛","瀚","潴","瀝","瀘","瀟","瀰","瀾","瀲","灑","灣","炙","炒","炯","烱","炬","炸","炳","炮","烟","烋","烝","烙","焉","烽","焜","焙","煥","煕","熈","煦","煢","煌","煖","煬","熏","燻","熄","熕","熨","熬","燗","熹","熾","燒","燉","燔","燎","燠","燬","燧","燵","燼","燹","燿","爍","爐","爛","爨","爭","爬","爰","爲","爻","爼","爿","牀","牆","牋","牘","牴","牾","犂","犁","犇","犒","犖","犢","犧","犹","犲","狃","狆","狄","狎","狒","狢","狠","狡","狹","狷","倏","猗","猊","猜","猖","猝","猴","猯","猩","猥","猾","獎","獏","默","獗","獪","獨","獰","獸","獵","獻","獺","珈","玳","珎","玻","珀","珥","珮","珞","璢","琅","瑯","琥","珸","琲","琺","瑕","琿","瑟","瑙","瑁","瑜","瑩","瑰","瑣","瑪","瑶","瑾","璋","璞","璧","瓊","瓏","瓔","珱","瓠","瓣","瓧","瓩","瓮","瓲","瓰","瓱","瓸","瓷","甄","甃","甅","甌","甎","甍","甕","甓","甞","甦","甬","甼","畄","畍","畊","畉","畛","畆","畚","畩","畤","畧","畫","畭","畸","當","疆","疇","畴","疊","疉","疂","疔","疚","疝","疥","疣","痂","疳","痃","疵","疽","疸","疼","疱","痍","痊","痒","痙","痣","痞","痾","痿","痼","瘁","痰","痺","痲","痳","瘋","瘍","瘉","瘟","瘧","瘠","瘡","瘢","瘤","瘴","瘰","瘻","癇","癈","癆","癜","癘","癡","癢","癨","癩","癪","癧","癬","癰","癲","癶","癸","發","皀","皃","皈","皋","皎","皖","皓","皙","皚","皰","皴","皸","皹","皺","盂","盍","盖","盒","盞","盡","盥","盧","盪","蘯","盻","眈","眇","眄","眩","眤","眞","眥","眦","眛","眷","眸","睇","睚","睨","睫","睛","睥","睿","睾","睹","瞎","瞋","瞑","瞠","瞞","瞰","瞶","瞹","瞿","瞼","瞽","瞻","矇","矍","矗","矚","矜","矣","矮","矼","砌","砒","礦","砠","礪","硅","碎","硴","碆","硼","碚","碌","碣","碵","碪","碯","磑","磆","磋","磔","碾","碼","磅","磊","磬","磧","磚","磽","磴","礇","礒","礑","礙","礬","礫","祀","祠","祗","祟","祚","祕","祓","祺","祿","禊","禝","禧","齋","禪","禮","禳","禹","禺","秉","秕","秧","秬","秡","秣","稈","稍","稘","稙","稠","稟","禀","稱","稻","稾","稷","穃","穗","穉","穡","穢","穩","龝","穰","穹","穽","窈","窗","窕","窘","窖","窩","竈","窰","窶","竅","竄","窿","邃","竇","竊","竍","竏","竕","竓","站","竚","竝","竡","竢","竦","竭","竰","笂","笏","笊","笆","笳","笘","笙","笞","笵","笨","笶","筐","筺","笄","筍","笋","筌","筅","筵","筥","筴","筧","筰","筱","筬","筮","箝","箘","箟","箍","箜","箚","箋","箒","箏","筝","箙","篋","篁","篌","篏","箴","篆","篝","篩","簑","簔","篦","篥","籠","簀","簇","簓","篳","篷","簗","簍","篶","簣","簧","簪","簟","簷","簫","簽","籌","籃","籔","籏","籀","籐","籘","籟","籤","籖","籥","籬","籵","粃","粐","粤","粭","粢","粫","粡","粨","粳","粲","粱","粮","粹","粽","糀","糅","糂","糘","糒","糜","糢","鬻","糯","糲","糴","糶","糺","紆","紂","紜","紕","紊","絅","絋","紮","紲","紿","紵","絆","絳","絖","絎","絲","絨","絮","絏","絣","經","綉","絛","綏","絽","綛","綺","綮","綣","綵","緇","綽","綫","總","綢","綯","緜","綸","綟","綰","緘","緝","緤","緞","緻","緲","緡","縅","縊","縣","縡","縒","縱","縟","縉","縋","縢","繆","繦","縻","縵","縹","繃","縷","縲","縺","繧","繝","繖","繞","繙","繚","繹","繪","繩","繼","繻","纃","緕","繽","辮","繿","纈","纉","續","纒","纐","纓","纔","纖","纎","纛","纜","缸","缺","罅","罌","罍","罎","罐","网","罕","罔","罘","罟","罠","罨","罩","罧","罸","羂","羆","羃","羈","羇","羌","羔","羞","羝","羚","羣","羯","羲","羹","羮","羶","羸","譱","翅","翆","翊","翕","翔","翡","翦","翩","翳","翹","飜","耆","耄","耋","耒","耘","耙","耜","耡","耨","耿","耻","聊","聆","聒","聘","聚","聟","聢","聨","聳","聲","聰","聶","聹","聽","聿","肄","肆","肅","肛","肓","肚","肭","冐","肬","胛","胥","胙","胝","胄","胚","胖","脉","胯","胱","脛","脩","脣","脯","腋","隋","腆","脾","腓","腑","胼","腱","腮","腥","腦","腴","膃","膈","膊","膀","膂","膠","膕","膤","膣","腟","膓","膩","膰","膵","膾","膸","膽","臀","臂","膺","臉","臍","臑","臙","臘","臈","臚","臟","臠","臧","臺","臻","臾","舁","舂","舅","與","舊","舍","舐","舖","舩","舫","舸","舳","艀","艙","艘","艝","艚","艟","艤","艢","艨","艪","艫","舮","艱","艷","艸","艾","芍","芒","芫","芟","芻","芬","苡","苣","苟","苒","苴","苳","苺","莓","范","苻","苹","苞","茆","苜","茉","苙","茵","茴","茖","茲","茱","荀","茹","荐","荅","茯","茫","茗","茘","莅","莚","莪","莟","莢","莖","茣","莎","莇","莊","荼","莵","荳","荵","莠","莉","莨","菴","萓","菫","菎","菽","萃","菘","萋","菁","菷","萇","菠","菲","萍","萢","萠","莽","萸","蔆","菻","葭","萪","萼","蕚","蒄","葷","葫","蒭","葮","蒂","葩","葆","萬","葯","葹","萵","蓊","葢","蒹","蒿","蒟","蓙","蓍","蒻","蓚","蓐","蓁","蓆","蓖","蒡","蔡","蓿","蓴","蔗","蔘","蔬","蔟","蔕","蔔","蓼","蕀","蕣","蕘","蕈","蕁","蘂","蕋","蕕","薀","薤","薈","薑","薊","薨","蕭","薔","薛","藪","薇","薜","蕷","蕾","薐","藉","薺","藏","薹","藐","藕","藝","藥","藜","藹","蘊","蘓","蘋","藾","藺","蘆","蘢","蘚","蘰","蘿","虍","乕","虔","號","虧","虱","蚓","蚣","蚩","蚪","蚋","蚌","蚶","蚯","蛄","蛆","蚰","蛉","蠣","蚫","蛔","蛞","蛩","蛬","蛟","蛛","蛯","蜒","蜆","蜈","蜀","蜃","蛻","蜑","蜉","蜍","蛹","蜊","蜴","蜿","蜷","蜻","蜥","蜩","蜚","蝠","蝟","蝸","蝌","蝎","蝴","蝗","蝨","蝮","蝙","蝓","蝣","蝪","蠅","螢","螟","螂","螯","蟋","螽","蟀","蟐","雖","螫","蟄","螳","蟇","蟆","螻","蟯","蟲","蟠","蠏","蠍","蟾","蟶","蟷","蠎","蟒","蠑","蠖","蠕","蠢","蠡","蠱","蠶","蠹","蠧","蠻","衄","衂","衒","衙","衞","衢","衫","袁","衾","袞","衵","衽","袵","衲","袂","袗","袒","袮","袙","袢","袍","袤","袰","袿","袱","裃","裄","裔","裘","裙","裝","裹","褂","裼","裴","裨","裲","褄","褌","褊","褓","襃","褞","褥","褪","褫","襁","襄","褻","褶","褸","襌","褝","襠","襞","襦","襤","襭","襪","襯","襴","襷","襾","覃","覈","覊","覓","覘","覡","覩","覦","覬","覯","覲","覺","覽","覿","觀","觚","觜","觝","觧","觴","觸","訃","訖","訐","訌","訛","訝","訥","訶","詁","詛","詒","詆","詈","詼","詭","詬","詢","誅","誂","誄","誨","誡","誑","誥","誦","誚","誣","諄","諍","諂","諚","諫","諳","諧","諤","諱","謔","諠","諢","諷","諞","諛","謌","謇","謚","諡","謖","謐","謗","謠","謳","鞫","謦","謫","謾","謨","譁","譌","譏","譎","證","譖","譛","譚","譫","譟","譬","譯","譴","譽","讀","讌","讎","讒","讓","讖","讙","讚","谺","豁","谿","豈","豌","豎","豐","豕","豢","豬","豸","豺","貂","貉","貅","貊","貍","貎","貔","豼","貘","戝","貭","貪","貽","貲","貳","貮","貶","賈","賁","賤","賣","賚","賽","賺","賻","贄","贅","贊","贇","贏","贍","贐","齎","贓","賍","贔","贖","赧","赭","赱","赳","趁","趙","跂","趾","趺","跏","跚","跖","跌","跛","跋","跪","跫","跟","跣","跼","踈","踉","跿","踝","踞","踐","踟","蹂","踵","踰","踴","蹊","蹇","蹉","蹌","蹐","蹈","蹙","蹤","蹠","踪","蹣","蹕","蹶","蹲","蹼","躁","躇","躅","躄","躋","躊","躓","躑","躔","躙","躪","躡","躬","躰","軆","躱","躾","軅","軈","軋","軛","軣","軼","軻","軫","軾","輊","輅","輕","輒","輙","輓","輜","輟","輛","輌","輦","輳","輻","輹","轅","轂","輾","轌","轉","轆","轎","轗","轜","轢","轣","轤","辜","辟","辣","辭","辯","辷","迚","迥","迢","迪","迯","邇","迴","逅","迹","迺","逑","逕","逡","逍","逞","逖","逋","逧","逶","逵","逹","迸","遏","遐","遑","遒","逎","遉","逾","遖","遘","遞","遨","遯","遶","隨","遲","邂","遽","邁","邀","邊","邉","邏","邨","邯","邱","邵","郢","郤","扈","郛","鄂","鄒","鄙","鄲","鄰","酊","酖","酘","酣","酥","酩","酳","酲","醋","醉","醂","醢","醫","醯","醪","醵","醴","醺","釀","釁","釉","釋","釐","釖","釟","釡","釛","釼","釵","釶","鈞","釿","鈔","鈬","鈕","鈑","鉞","鉗","鉅","鉉","鉤","鉈","銕","鈿","鉋","鉐","銜","銖","銓","銛","鉚","鋏","銹","銷","鋩","錏","鋺","鍄","錮","錙","錢","錚","錣","錺","錵","錻","鍜","鍠","鍼","鍮","鍖","鎰","鎬","鎭","鎔","鎹","鏖","鏗","鏨","鏥","鏘","鏃","鏝","鏐","鏈","鏤","鐚","鐔","鐓","鐃","鐇","鐐","鐶","鐫","鐵","鐡","鐺","鑁","鑒","鑄","鑛","鑠","鑢","鑞","鑪","鈩","鑰","鑵","鑷","鑽","鑚","鑼","鑾","钁","鑿","閂","閇","閊","閔","閖","閘","閙","閠","閨","閧","閭","閼","閻","閹","閾","闊","濶","闃","闍","闌","闕","闔","闖","關","闡","闥","闢","阡","阨","阮","阯","陂","陌","陏","陋","陷","陜","陞","陝","陟","陦","陲","陬","隍","隘","隕","隗","險","隧","隱","隲","隰","隴","隶","隸","隹","雎","雋","雉","雍","襍","雜","霍","雕","雹","霄","霆","霈","霓","霎","霑","霏","霖","霙","霤","霪","霰","霹","霽","霾","靄","靆","靈","靂","靉","靜","靠","靤","靦","靨","勒","靫","靱","靹","鞅","靼","鞁","靺","鞆","鞋","鞏","鞐","鞜","鞨","鞦","鞣","鞳","鞴","韃","韆","韈","韋","韜","韭","齏","韲","竟","韶","韵","頏","頌","頸","頤","頡","頷","頽","顆","顏","顋","顫","顯","顰","顱","顴","顳","颪","颯","颱","颶","飄","飃","飆","飩","飫","餃","餉","餒","餔","餘","餡","餝","餞","餤","餠","餬","餮","餽","餾","饂","饉","饅","饐","饋","饑","饒","饌","饕","馗","馘","馥","馭","馮","馼","駟","駛","駝","駘","駑","駭","駮","駱","駲","駻","駸","騁","騏","騅","駢","騙","騫","騷","驅","驂","驀","驃","騾","驕","驍","驛","驗","驟","驢","驥","驤","驩","驫","驪","骭","骰","骼","髀","髏","髑","髓","體","髞","髟","髢","髣","髦","髯","髫","髮","髴","髱","髷","髻","鬆","鬘","鬚","鬟","鬢","鬣","鬥","鬧","鬨","鬩","鬪","鬮","鬯","鬲","魄","魃","魏","魍","魎","魑","魘","魴","鮓","鮃","鮑","鮖","鮗","鮟","鮠","鮨","鮴","鯀","鯊","鮹","鯆","鯏","鯑","鯒","鯣","鯢","鯤","鯔","鯡","鰺","鯲","鯱","鯰","鰕","鰔","鰉","鰓","鰌","鰆","鰈","鰒","鰊","鰄","鰮","鰛","鰥","鰤","鰡","鰰","鱇","鰲","鱆","鰾","鱚","鱠","鱧","鱶","鱸","鳧","鳬","鳰","鴉","鴈","鳫","鴃","鴆","鴪","鴦","鶯","鴣","鴟","鵄","鴕","鴒","鵁","鴿","鴾","鵆","鵈","鵝","鵞","鵤","鵑","鵐","鵙","鵲","鶉","鶇","鶫","鵯","鵺","鶚","鶤","鶩","鶲","鷄","鷁","鶻","鶸","鶺","鷆","鷏","鷂","鷙","鷓","鷸","鷦","鷭","鷯","鷽","鸚","鸛","鸞","鹵","鹹","鹽","麁","麈","麋","麌","麒","麕","麑","麝","麥","麩","麸","麪","麭","靡","黌","黎","黏","黐","黔","黜","點","黝","黠","黥","黨","黯","黴","黶","黷","黹","黻","黼","黽","鼇","鼈","皷","鼕","鼡","鼬","鼾","齊","齒","齔","齣","齟","齠","齡","齦","齧","齬","齪","齷","齲","齶","龕","龜","龠","堯","槇","遙","瑤","凜","熙","噓","巢","帔","帘","幘","幞","庾","廊","廋","廹","开","异","弇","弝","弣","弴","弶","弽","彀","彅","彔","彘","彤","彧","彽","徉","徜","徧","徯","徵","德","忉","忞","忡","忩","怍","怔","怘","怳","怵","恇","悔","悝","悞","惋","惔","惕","惝","惸","愜","愫","愰","愷","慨","憍","憎","憼","憹","懲","戢","戾","扃","扖","扚","扯","抅","拄","拖","拼","挊","挘","挹","捃","捥","捼","揥","揭","揵","搐","搔","搢","摹","摑","摠","摭","擎","撾","撿","㐂","𠅘","份","仿","侚","俉","傜","儞","冼","㔟","匇","卡","卬","詹","𠮷","呍","咖","咜","咩","唎","啊","噲","囤","圳","圴","塚","墀","姤","娣","婕","寬","﨑","㟢","庬","弴","彅","德","怗","恵","愰","昤","曈","曙","曺","曻","桒","鿄","椑","椻","橅","檑","櫛","𣏌","𣏾","𣗄","毱","泠","洮","海","涿","淊","淸","渚","潞","濹","灤","𤋮","𤋮","煇","燁","爀","玟","玨","珉","珖","琛","琡","琢","琦","琪","琬","琹","瑋","㻚","畵","疁","睲","䂓","磈","磠","祇","禮","鿆","䄃","鿅","秚","稞","筿","簱","䉤","綋","羡","脘","脺","舘","芮","葛","蓜","蓬","蕙","藎","蝕","蟬","蠋","裵","角","諶","跎","辻","迶","郝","鄧","鄭","醲","鈳","銈","錡","鍈","閒","雞","餃","饀","髙","鯖","鷗","麴","麵","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","⛌","⛍","❗","⛏","⛐","⛑","","⛒","⛕","⛓","⛔","","","","","","","","","⛖","⛗","⛘","⛙","⛚","⛛","⛜","⛝","⛞","⛟","⛠","⛡","⭕","㉈","㉉","㉊","㉋","㉌","㉍","㉎","㉏","","","","","⒑","⒒","⒓","","","","","","","","","","","","","","","","","⬛","⬤","","","","","","⚿","","","","","","","","","","","","㊙","","","","","","","","","","","","⛣","⭖","⭗","⭘","⭙","☓","㊋","〒","⛨","㉆","㉅","⛩","࿖","⛪","⛫","⛬","♨","⛭","⛮","⛯","⚓","✈","⛰","⛱","⛲","⛳","⛴","⛵","","Ⓓ","Ⓢ","⛶","","","","","","⛷","⛸","⛹","⛺","","☎","⛻","⛼","⛽","⛾","","⛿","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","➡","⬅","⬆","⬇","⬯","⬮","年","月","日","円","㎡","㎥","㎝","㎠","㎤","","⒈","⒉","⒊","⒋","⒌","⒍","⒎","⒏","⒐","","","","","","","","","","","","","","","","","㈳","㈶","㈲","㈱","㈹","㉄","▶","◀","〖","〗","⟐","²","³","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","㉇","","","℻","","","","㈪","㈫","㈬","㈭","㈮","㈯","㈰","㈷","㍾","㍽","㍼","㍻","№","℡","〶","⚾","","","","","","","","","","","","","","","","","","","","","","","ℓ","㎏","㎐","㏊","㎞","㎢","㍱","","","½","↉","⅓","⅔","¼","¾","⅕","⅖","⅗","⅘","⅙","⅚","⅐","⅛","⅑","⅒","☀","☁","☂","⛄","☖","☗","⛉","⛊","♦","♥","♣","♠","⛋","⨀","‼","⁉","⛅","☔","⛆","☃","⛇","⚡","⛈","","⚞","⚟","♬","☎","","","","Ⅰ","Ⅱ","Ⅲ","Ⅳ","Ⅴ","Ⅵ","Ⅶ","Ⅷ","Ⅸ","Ⅹ","Ⅺ","Ⅻ","⑰","⑱","⑲","⑳","⑴","⑵","⑶","⑷","⑸","⑹","⑺","⑻","⑼","⑽","⑾","⑿","㉑","㉒","㉓","㉔","","","","","","","","","","","","","","","","","","","","","","","","","","","㉕","㉖","㉗","㉘","㉙","㉚","①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩","⑪","⑫","⑬","⑭","⑮","⑯","❶","❷","❸","❹","❺","❻","❼","❽","❾","❿","⓫","⓬","㉛",""],b=["㐂","","份","仿","侚","俉","傜","儞","冼","㔟","匇","卡","卬","詹","","呍","咖","咜","咩","唎","啊","噲","囤","圳","圴","塚","墀","姤","娣","婕","寬","﨑","㟢","庬","弴","彅","德","怗","恵","愰","昤","曈","曙","曺","曻","桒","鿄","椑","椻","橅","檑","櫛","","","","毱","泠","洮","海","涿","淊","淸","渚","潞","濹","灤","𤋮","","煇","燁","爀","玟","玨","珉","珖","琛","琡","琢","琦","琪","琬","琹","瑋","㻚","畵","疁","睲","䂓","磈","磠","祇","禮","鿆","䄃","鿅","秚","稞","筿","簱","䉤","綋","羡","脘","脺","舘","芮","葛","蓜","蓬","蕙","藎","蝕","蟬","蠋","裵","角","諶","跎","辻","迶","郝","鄧","鄭","醲","鈳","銈","錡","鍈","閒","雞","餃","饀","髙","鯖","鷗","麴","麵","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","⛌","⛍","❗","⛏","⛐","⛑","","⛒","⛕","⛓","⛔","","","","","","","","","⛖","⛗","⛘","⛙","⛚","⛛","⛜","⛝","⛞","⛟","⛠","⛡","⭕","㉈","㉉","㉊","㉋","㉌","㉍","㉎","㉏","","","","","⒑","⒒","⒓","","","","","","","","","","","","","","","","","⬛","⬤","","","","","","⚿","","","","","","","","","","","","㊙","","","","","","","","","","","","⛣","⭖","⭗","⭘","⭙","☓","㊋","〒","⛨","㉆","㉅","⛩","࿖","⛪","⛫","⛬","♨","⛭","⛮","⛯","⚓","✈","⛰","⛱","⛲","⛳","⛴","⛵","","Ⓓ","Ⓢ","⛶","","","","","","⛷","⛸","⛹","⛺","","☎","⛻","⛼","⛽","⛾","","⛿","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","➡","⬅","⬆","⬇","⬯","⬮","年","月","日","円","㎡","㎥","㎝","㎠","㎤","","⒈","⒉","⒊","⒋","⒌","⒍","⒎","⒏","⒐","","","","","","","","","","","","","","","","","㈳","㈶","㈲","㈱","㈹","㉄","▶","◀","〖","〗","⟐","²","³","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","㉇","","","℻","","","","㈪","㈫","㈬","㈭","㈮","㈯","㈰","㈷","㍾","㍽","㍼","㍻","№","℡","〶","⚾","","","","","","","","","","","","","","","","","","","","","","","ℓ","㎏","㎐","㏊","㎞","㎢","㍱","","","½","↉","⅓","⅔","¼","¾","⅕","⅖","⅗","⅘","⅙","⅚","⅐","⅛","⅑","⅒","☀","☁","☂","⛄","☖","☗","⛉","⛊","♦","♥","♣","♠","⛋","⨀","‼","⁉","⛅","☔","⛆","☃","⛇","⚡","⛈","","⚞","⚟","♬","☎","","","","Ⅰ","Ⅱ","Ⅲ","Ⅳ","Ⅴ","Ⅵ","Ⅶ","Ⅷ","Ⅸ","Ⅹ","Ⅺ","Ⅻ","⑰","⑱","⑲","⑳","⑴","⑵","⑶","⑷","⑸","⑹","⑺","⑻","⑼","⑽","⑾","⑿","㉑","㉒","㉓","㉔","","","","","","","","","","","","","","","","","","","","","","","","","","","㉕","㉖","㉗","㉘","㉙","㉚","①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩","⑪","⑫","⑬","⑭","⑮","⑯","❶","❷","❸","❹","❺","❻","❼","❽","❾","❿","⓫","⓬","㉛",""],x=["㐂","𠅘","份","仿","侚","俉","傜","儞","冼","㔟","匇","卡","卬","詹","𠮷","呍","咖","咜","咩","唎","啊","噲","囤","圳","圴","塚","墀","姤","娣","婕","寬","﨑","㟢","庬","弴","彅","德","怗","恵","愰","昤","曈","曙","曺","曻","桒","鿄","椑","椻","橅","檑","櫛","𣏌","𣏾","𣗄","毱","泠","洮","海","涿","淊","淸","渚","潞","濹","灤","𤋮","𤋮","煇","燁","爀","玟","玨","珉","珖","琛","琡","琢","琦","琪","琬","琹","瑋","㻚","畵","疁","睲","䂓","磈","磠","祇","禮","鿆","䄃","鿅","秚","稞","筿","簱","䉤","綋","羡","脘","脺","舘","芮","葛","蓜","蓬","蕙","藎","蝕","蟬","蠋","裵","角","諶","跎","辻","迶","郝","鄧","鄭","醲","鈳","銈","錡","鍈","閒","雞","餃","饀","髙","鯖","鷗","麴","麵","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","⛌","⛍","❗","⛏","⛐","⛑","","⛒","⛕","⛓","⛔","","","","","🅿","🆊","","","⛖","⛗","⛘","⛙","⛚","⛛","⛜","⛝","⛞","⛟","⛠","⛡","⭕","㉈","㉉","㉊","㉋","㉌","㉍","㉎","㉏","","","","","⒑","⒒","⒓","🅊","🅌","🄿","🅆","🅋","🈐","🈑","🈒","🈓","🅂","🈔","🈕","🈖","🅍","🄱","🄽","⬛","⬤","🈗","🈘","🈙","🈚","🈛","⚿","🈜","🈝","🈞","🈟","🈠","🈡","🈢","🈣","🈤","🈥","🅎","㊙","🈀","","","","","","","","","","","⛣","⭖","⭗","⭘","⭙","☓","㊋","〒","⛨","㉆","㉅","⛩","࿖","⛪","⛫","⛬","♨","⛭","⛮","⛯","⚓","✈","⛰","⛱","⛲","⛳","⛴","⛵","🅗","Ⓓ","Ⓢ","⛶","🅟","🆋","🆍","🆌","🅹","⛷","⛸","⛹","⛺","🅻","☎","⛻","⛼","⛽","⛾","🅼","⛿","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","➡","⬅","⬆","⬇","⬯","⬮","年","月","日","円","㎡","㎥","㎝","㎠","㎤","🄀","⒈","⒉","⒊","⒋","⒌","⒍","⒎","⒏","⒐","","","","","","","🄁","🄂","🄃","🄄","🄅","🄆","🄇","🄈","🄉","🄊","㈳","㈶","㈲","㈱","㈹","㉄","▶","◀","〖","〗","⟐","²","³","🄭","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","🄬","🄫","㉇","🆐","🈦","℻","","","","㈪","㈫","㈬","㈭","㈮","㈯","㈰","㈷","㍾","㍽","㍼","㍻","№","℡","〶","⚾","🉀","🉁","🉂","🉃","🉄","🉅","🉆","🉇","🉈","🄪","🈧","🈨","🈩","🈔","🈪","🈫","🈬","🈭","🈮","🈯","🈰","🈱","ℓ","㎏","㎐","㏊","㎞","㎢","㍱","","","½","↉","⅓","⅔","¼","¾","⅕","⅖","⅗","⅘","⅙","⅚","⅐","⅛","⅑","⅒","☀","☁","☂","⛄","☖","☗","⛉","⛊","♦","♥","♣","♠","⛋","⨀","‼","⁉","⛅","☔","⛆","☃","⛇","⚡","⛈","","⚞","⚟","♬","☎","","","","Ⅰ","Ⅱ","Ⅲ","Ⅳ","Ⅴ","Ⅵ","Ⅶ","Ⅷ","Ⅸ","Ⅹ","Ⅺ","Ⅻ","⑰","⑱","⑲","⑳","⑴","⑵","⑶","⑷","⑸","⑹","⑺","⑻","⑼","⑽","⑾","⑿","㉑","㉒","㉓","㉔","🄐","🄑","🄒","🄓","🄔","🄕","🄖","🄗","🄘","🄙","🄚","🄛","🄜","🄝","🄞","🄟","🄠","🄡","🄢","🄣","🄤","🄥","🄦","🄧","🄨","🄩","㉕","㉖","㉗","㉘","㉙","㉚","①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩","⑪","⑫","⑬","⑭","⑮","⑯","❶","❷","❸","❹","❺","❻","❼","❽","❾","❿","⓫","⓬","㉛",""],L=["！","＂","＃","＄","％","＆","＇","（","）","＊","＋","，","－","．","／","０","１","２","３","４","５","６","７","８","９","：","；","＜","＝","＞","？","＠","Ａ","Ｂ","Ｃ","Ｄ","Ｅ","Ｆ","Ｇ","Ｈ","Ｉ","Ｊ","Ｋ","Ｌ","Ｍ","Ｎ","Ｏ","Ｐ","Ｑ","Ｒ","Ｓ","Ｔ","Ｕ","Ｖ","Ｗ","Ｘ","Ｙ","Ｚ","［","￥","］","＾","＿","｀","ａ","ｂ","ｃ","ｄ","ｅ","ｆ","ｇ","ｈ","ｉ","ｊ","ｋ","ｌ","ｍ","ｎ","ｏ","ｐ","ｑ","ｒ","ｓ","ｔ","ｕ","ｖ","ｗ","ｘ","ｙ","ｚ","｛","｜","｝","～"],N=["ぁ","あ","ぃ","い","ぅ","う","ぇ","え","ぉ","お","か","が","き","ぎ","く","ぐ","け","げ","こ","ご","さ","ざ","し","じ","す","ず","せ","ぜ","そ","ぞ","た","だ","ち","ぢ","っ","つ","づ","て","で","と","ど","な","に","ぬ","ね","の","は","ば","ぱ","ひ","び","ぴ","ふ","ぶ","ぷ","へ","べ","ぺ","ほ","ぼ","ぽ","ま","み","む","め","も","ゃ","や","ゅ","ゆ","ょ","よ","ら","り","る","れ","ろ","ゎ","わ","ゐ","ゑ","を","ん","","","","ゝ","ゞ","ー","。","「","」","、","・"],P=["ァ","ア","ィ","イ","ゥ","ウ","ェ","エ","ォ","オ","カ","ガ","キ","ギ","ク","グ","ケ","ゲ","コ","ゴ","サ","ザ","シ","ジ","ス","ズ","セ","ゼ","ソ","ゾ","タ","ダ","チ","ヂ","ッ","ツ","ヅ","テ","デ","ト","ド","ナ","ニ","ヌ","ネ","ノ","ハ","バ","パ","ヒ","ビ","ピ","フ","ブ","プ","ヘ","ベ","ペ","ホ","ボ","ポ","マ","ミ","ム","メ","モ","ャ","ヤ","ュ","ユ","ョ","ヨ","ラ","リ","ル","レ","ロ","ヮ","ワ","ヰ","ヱ","ヲ","ン","ヴ","ヵ","ヶ","ヽ","ヾ","ー","。","「","」","、","・"],T=new Map([["022b6f43e2a414fd68f172da202bac9a","⚞"],["94fb7be756372db6b62e3e0a119083d5","⚞"],["12aecdea283e4d07f88b9f2b740e4f86","⚟"],["1a563501affbf7f5baec350a108d5505","⚟"],["556971570f40044fa4520df3289a1cf2","⚟"],["65b042886a563a771aa389b12af7bca7","⚟"],["bbda644d17efd3c020635ee3d90968a5","｟"],["5063561406195ca45f5992e3f7ad77d2","｟"],["9d15c0395a4738936af34308acf2d032","｟"],["2a063edc4770b3403f060b38166a0d4d","｟"],["54479aa90145b4713134b78d4fb98aa5","｟"],["12a2c7156da32fc972b5a451bb87b813","｟"],["c8d428ead557285b0b7088388b22519c","｟"],["7160f7419cba7acdacd23cbeb4834dbe","｟"],["3c49616fb9bf0b9052b30e118f8857ea","｟"],["71c94bb6d963e47443eac448a09d22ce","｟"],["7ec2179107ba4c58abb6ef92e7781365","｟"],["2eb49bd25d7eeada006afc0864350da4","｟"],["a341ee7fe8a368c9737a3341f016ac70","｟"],["f47048d669ac8d84eeb62477e8420f89","｟"],["38566b372f4c5a1aead4efa20decd079","｠"],["d84fc83615b75802ed422eda4ba39465","｠"],["5bb8b7731d9473ebd7c842334dfa24f2","｠"],["9ffa7e00cfc7e807a161ada460b8060c","｠"],["a58dc0e1271b03a5981b57a83271afa7","｠"],["e67210b0da0161d36b79e8c9be6a9d0c","｠"],["08de4be9569ebd6ac01709f552ae8a65","｠"],["e214599903c94c532684bdf54b62df61","｠"],["2a83209f8a7489081890c277397df425","｠"],["0294d50cea5197c8c4646d2cace3e78d","｠"],["0b808509e4d89a2b9d02252ca85f2e34","｠"],["2a74d4ad7292c858dc2bb559de67f2d9","｠"],["8c810b8cbe6159e837a88575bb4e6033","｠"],["dc66317cd6fff4f4221069a20f321fce","｠"],["563e1633d226c10ef4ec80638997e4a9","『"],["0993d5cdf910f481eeefa19e4f09d77c","『"],["7b80a8345c16e2d4f8ff2691e245c2b1","『"],["016669fa94786f9581342d47f317c02c","『"],["01d3eb52ab29f0eecc62ff74224fffd4","『"],["089aa1d87915ef8ad3c43982ac657c8c","『"],["30e8cb69cda3ad84e87943c4351c24b7","『"],["385927959c2621acf57f8d40140924f8","『"],["2c256506f406bac4c214318f196ad5db","『"],["2d3912e10113e5c7bef33df3249af4a7","『"],["8b6444be18f269ac615643b26f9e3041","『"],["9c8c1ff659b439f73c65cf4766ab2f14","『"],["e4caa1628ad6878f14be986761e06aaa","『"],["e702912587801d73d58cdb30e48debed","』"],["d70bb2b097f44c1ddefb93bf92bbb5cd","』"],["f2b927267947a75b891403f95db72005","』"],["4ec38a1d8d22e4df6c359f00f7ad8662","』"],["55c9ea9aa8eb630e5ecb793b2f85c927","』"],["70376e1ea05a3438a19c062ad49a7960","』"],["8fe7cb78ca24d1973419eecf99252a88","』"],["9ee59c7d2c202e0214836a0138f59e24","』"],["b56aaf7fc68c5e206ccbc2ee1442b3af","』"],["ba37f6b56d8fc8980c8236de9894fa61","』"],["cc9fde9238a2bf78fd1c13f65b098e77","』"],["f02e3e84dcd71c5d3bab2b7b4b99bd7e","』"],["f686e0b742abe806fccbd4d9b3fcc4cd","』"],["37f6ecf37a0a3ef8dff083ccc8754f81","♬"],["3336f18e849144658f212bd9399bec5f","♬"],["93efdc18683d8ecacb0a920d5f2fffb3","♬"],["9b8325b71aa6a000d24f88c4d7ec730d","♬"],["ab791ef796e6b5d66f13ed9aea3e8ab2","♬"],["6eb29f1917caea1cadf94f5496a4c374","↱"],["583134b86e7d90960f64c5b863196978","➡"],["4ba716a88c003ca0a069392be3b63951","➡"],["4e0fbe47e3ba0fd5949bda53f11b16a5","➡"],["61ec226a927ee80fffa12db219a43233","➡"],["8e5b873ac8e1bf84246b281b3548c2ff","↴"],["a78d9b65f46654601ce0145622164b47","↴"],["5d01e6804b9aaec0c276f77306888c54","↴"],["6168af1e81b6497fccb6b8d3226a8016","↴"],["4360c0b7364802b680f5a65fa415bdd6","↗"],["4dab788480bb9ac50d2454b58438e407","↗"],["bfb2d58ab8c469d2b8b5c42d81e4e3b7","↗"],["4c503a0873195bfe8d71c9d55669781b","→"],["caf36eff2cf3580cd66c5cd021ee4c09","→"],["f00be20caf0aaef3a6fbec90a0e71852","Ⅰ"],["e660e1e23a6ddc9a5d2e0e1ef7ac5b86","Ⅱ"],["a62583f621fb5405add08e8f0beb6db4","Ⅱ"],["0e761ebb18b9870383725b3712f5c8d4","Ⅱ"],["1f65debfbf9df96de52c6f80922b012b","Ⅱ"],["5c13facf2da9f38922a9419061771ed0","Ⅱ"],["75a65cc3171c4c7ca0141042846ab91a","Ⅱ"],["eae94a6301787ff7bf77786ae4424601","Ⅱ"],["f1add7809e18e064e4609783211c9815","Ⅲ"],["a7ee6f7f63d348e2b8fb7ee9503f3c5c","♡"],["9c8cfb5e9349b06f0939605638896f4e","♥"],["45ce7d6d5c779136d32d3e60e13e10cd","⅕"],["51f5fe58aaf460263b766e990fdbe979","⅕"],["db40b0a65939e462396822d5ab3c6d9c","⅕"],["d9e3a48d5a7c6ba6f8db18f56cf91f92","⅛"],["86586bcdf8f14883f846849e93ca274c","⅜"],["9d81f46e134081d56bc92f69eebfabd9","⅒"],["18dddb04a4fe9b3f5c7b79e68fb8ab4b","⅒"],["eff8659a150859b7b69682a023b283c1","⅒"],["6e5ccf08b2bc815b0923df83cf9fafa1","㎠"],["8a77e56517a074d3d2ba426b84a07bf4","㎠"],["2c381a0eab014487d50f6f8bae8f0b71","㎢"],["9d1a36a1bec1cd2b0b0765f93c1e4f3c","㎢"],["e03eb00c54de790d8cc9997527fde905","㎢"],["3bce2a06a6a8557082543a6c90a42fe0","〽"],["4898c7d9fe3a8a6f9859b0e6f85a4327","〽"],["98ab18764756c8ca7608e17f562b21ce","〽"],["3037aad230d8cdae3df6e0ebedc0db79","⁉"],["66e3474e6cbd8e817ba0a1f8920bf4e7","⁉"],["4360dd96063ce1a9660cc8437e8238e3","⁈"],["6ce68b7e389c5169309ee956ed0c98a8","⁈"],["737a19289d25d963e255f3692ded6536","⁈"],["14b18199bbc3f4bf65b72e316bc41d3c","！"],["6bf58c146b692aeb403ed1f7618a060a","！"],["7f12b67caaf7c8c5075b444bb2a16c70","！"],["bfd55f4031ad80cb7401d65937b1d5d9","〜"],["4a61f6f7da9e6c8e373f4112cbd453cf","〜"],["882ded8f0bb4cdfa4ce28a0b64056d2a","〜"],["7726ffbf3a6e953affe6353c24ffb085","〜"],["0e290ec6542b5d52c972775e3d7cfeaf","－"],["420f1d27972d7cc83929307fbbb6dd50","－"],["4aa0e459273a2fe3012d7b3d2e14e07e","－"],["030b487ae68da1f4da98046f4fed390f","一"],["21699fa18fd14735a312512dfea2bff4","一"],["559fc240f4efe5a1e64714ce09217a3e","一"],["b7352c3f33a77bc9d3fbf693efbb8095","一"],["fcdb30a244fb6aad5255ee2d32fdf7fc","一"],["15a0a0fb33aacd4ce730a9503c46df5f","㊙"],["9dad4982bd65fbf21525261a7efdf669","㊙"],["c3e68e6d08d5429e28ffd6592acf4519","ゔ"],["f022cfe594d6f6930d7a5b994e1a0b71","凜"],["407057c7b7b1a91d058d572d9a9d3aa5","凜"],["fc85b0622183795f89111219dfbc6281","凜"],["9707099e5828d97eb12ff2e6ba438558","凜"],["987c829b62eb31f467165827766c410d","凜"],["58371bb195aaa7a468c5c508351ac383","凜"],["32324012ed7274a15002b66ed1e464f8","蜻"],["0ffb731db8d4a6b711f97bbb08ed8819","蜻"],["d90aae9a752e9b61662a9cafa837961f","祓"],["23d6c6f231ac5d51f4cdaaaa26701956","祓"],["81cbedabd8f88d4494255b0631820dfd","祓"],["4185f93a5571e49433ca9c13ae588f96","魎"],["9ab74d6e8bda8723614017a7fce587fe","魎"],["e96a39a050b694e5f8aadb111420b698","𠮷"],["08c5eb5fac4f1d362b946689eb2e4edf","𠮷"],["2cef7e443c22f5835658e67749ae52d1","𠮷"],["4ab0dd1578c8c5fa25f45938ff0f8575","𠮷"],["4c392bb90a1f62796f8fba2c19b4a7de","𠮷"],["43856fd7c04a779e571fe24c47f02a6c","髙"],["265efc2a174c73ea229f9ffefa703f32","髙"],["5a7af09cce6b3005355e1c6c82df8858","髙"],["808e9b858294184933f8bf45d6291572","髙"],["27f0c69a76bf571d6dc25db389d20779","髙"],["46fb250f60436fd5f33808343893ca12","髙"],["8a8c4c67a6094d4dc6039e5fe931159c","髙"],["9257f3792fcfcd21b85524d5f86f624e","髙"],["d502a276d6f311449597ee9e576d9217","髙"],["eaa49075e50fbe1fa4b7f593dfd95620","髙"],["c01d2bafce469da1abbb612fdb16c1e3","元"],["e1ce03321fdb4eaca026a49a43e521a5","元"],["0cfa6c95283a90eff3733db1ac80f58a","元"],["52c1ad5b834821dc6b85ec27bdea1f76","元"],["ad088cffd260c1fccb655cae17b14803","元"],["a9ee52eaa5b4cc32d1891d540bfe93cc","塚"],["a00182f1de36aaee28cac80a3c89d067","塚"],["b03d44ca831a0c995116056ce23f82c5","塚"],["2d6b7d3b5ca6c02d94c5b48661045b7a","﨑"],["f5c6e02e235abd23a87f48ed6a64cdcc","﨑"],["e9a3b055bda7b9ae70bde4003a4c5885","﨑"],["cb17df533b4ebd698a038defeddecf8a","﨑"],["0ea39c05c35f96d5b5a48e9815974132","﨑"],["3f642f3778827e651c8b82a4e9f06fd3","﨑"],["447d8358f482a4e1d9495902ebe269b1","﨑"],["ca59a20f1e0ee55b74db34697f961385","﨑"],["d2eae5651260b39c4239bcf00c8a76c5","﨑"],["f55eb365a9ded45d1e620f83d9f9de26","﨑"],["2b385c2642704e44347f2f4db147c8fa","葛"],["5c3a8c3a891386a771ff8f00a239b4ba","葛"],["e8caa78518e2d690af54e2206c9538f8","彅"],["2e8659ae5e220240c5f8a97147d09df6","彅"],["7592e633260537c1dfa7e5af1000752a","彅"],["a57d3f7684c28d2a901fe6020145de32","彅"],["da3ab2d5da4d69c7d312c7d819e45856","彅"],["918e84ed41c2157aa5f5bbf9aa60514c","塡"],["b1e889986beb3a6518d8c2ea53547b7c","塡"],["d449ab392afa98c27eb817c40e2eb7ce","塡"],["e7158075f2976c353e4cf9247aae3abc","遁"],["f1a6fbb17f041cc15148163da34f541f","遁"],["a1779a3aaf215916fd0d8fbbb5bf5925","蟬"],["a3c09b57be535c0f5618d72f95884c50","蟬"],["4b9401a9f9a58c7d0f9c86120aa2dd23","鏢"],["fe00b640a48dd341573cafa94afeafa2","鏢"],["f4e1d8b42e3c49ea7c896049186d74bd","蟜"],["640130a634bd2a0f4347f933a8c5d6d6","蟜"],["62985aeebaec69314f03ff9d3080ada2","鷗"],["1bd027207977c585c5889a1e24cae94e","鷗"],["5c8022286d3bc941c12e9bbc475255dd","鷗"],["e4a837fe20dfa091e03afe4857e2482e","剝"],["bf2cccb40b985fe3af04281944beac1a","剝"],["d5451a035c4e516e5ccb9372cd533d81","剝"],["e13ae32f28d840df74a88432df9b122e","剝"],["41637d181cd99088e2120a4ec6fc18aa","嬴"],["de63abb1aaa44e6ab8a11470103377d5","嬴"],["3d32b12254e01c701c195412cb8ef37c","嬴"],["f67bc6318ccf43e7902df9a6f9622932","嬴"],["d4ce6847d78fc2f8241088b5c0be795c","嬴"],["c472e6ade04610e67904aca1b1fa1468","麃"],["db3d060943fbf888eb2fa7fd87340cba","麃"],["509cff0edcba46d5db30b2f2f45c49c9","瘣"],["4862270872e35184aab420c4d38169ad","瘣"],["def4d364d00d0f78577987eaebd42aef","齕"],["3cc113a87b49ce231a7b2ffbca4c1e18","齕"],["03dddff25be65f7c284ef8addb8a0a8b","驁"],["52aa815a5a57aff03085d31acd5afbc4","驁"],["4f0431c4c63a6a362646758e62521df8","煖"],["dbf1ab17c746c48d474b3730064ba6f2","煖"],["790c6b4da6a88f7f4fdb6fdab77fe045","煖"],["4d7ae77f2bbf9c8af03d49d466f74058","煖"],["0335ba124be8a9e0c501f4051ac5fcf5","龐"],["01d7892b430fd4362c8917ad921199b2","龐"],["e866fd7e605c8b7c8bf718c45a5438cf","龐"],["5df7d88e1e15018b3bce73e765ef72d6","槌"],["48478e1f69ea50c6f7709d47f15b4007","槌"],["4d7d276f23c92f94056b292e295ebd78","神"],["87d2b97034cf680cd86bc7fe7c500d93","神"],["f6300abbfcd6bd0db3abd41041499aaa","邂"],["26c476496eb73e15285527ab7c635f0b","邂"],["be33b9008a58bab485e17de9b2ab2626","逅"],["3a9b8b576fe8efca2dedc957732afa37","逅"],["b798637262a0c1a29c8de602d4b688c6","逅"],["a3785fd94f13646623554b180d08ac77","德"],["1f81885b0996be70410e5aa3e4aab3c6","德"],["88425dfcbd96fcb6d77ebb76f834d986","德"],["9f993f913cd0614a3a965d74e0f4c8d1","德"],["a8bb5f2f83d975edfc951a1e461befdc","德"],["cd2eadbb87d0aadf1d1cd71fed0ab02f","德"],["d22feeb00ace0a632e1a780682f937e8","德"],["c9f2fda15b722253c625aebe73f4b1d9","辻"],["04556b37bff1ccc2f3b395232e104934","辻"],["117bacaeb67e3508d23a650b98f3c143","辻"],["211d70374c1787c4bc62df15794a4692","辻"],["7ba50856c59d1de19cc9c88caaced915","辻"],["0d627ebf7693b13645336a88813fb7e3","祀"],["2c3c032660b20a485575c2d8c7d47956","祀"],["1aaec04e53f2978bdf0a127c01b34e9a","遼"],["e2c3bf09b755b0d59a8a25cba6dda273","遼"],["fb13879ba2f93a8b0a28b2cd5358d1ee","遼"],["20eff1fff8d986496b949efa604ec402","誾"],["8742940fcbdbd65aeff1566c1889ece7","誾"],["23e6ef0ecc7bbe8e9465b0b40e901c0d","厓"],["5a69785acb47d746fd1ae98bd511db81","厓"],["392b8afa18046fc06398b32a42641889","你"],["7ff2c821d31ef0ca7e9c430f3e659d46","你"],["44d8b7aacbfc1fc4c32d6526ab8012ee","祠"],["c9486b883ab870fc02e7a1f189454f49","祠"],["62e7447a02f797cf287a7a758d66563b","擲"],["7d767d2518431dd61e631941dea6bb5e","擲"],["914fa35485d5016adc8b799b0cb5e978","口"],["d50802fc331261feed1a140f3b70c4b3","口"],["eeff4833bdfc34b1cbfe6a9d98f38cb5","口"],["a6d6aaeaf5505676111390a52fa6be51","暲"],["bc534a1accc68d8876e9d47ad8d4b489","暲"],["b5e8cb114ccad281bcb4d86768d509df","銈"],["d2c0ab0242ae4ad8a08bffa71613a1a7","銈"],["f09031463933b2892be7ebbc501269d0","蕙"],["f1378529fe66a7f655031d7f5b8c4eb5","蕙"],["6b696a5ae7634c454aaa7dd833fdfaf9","眷"],["5012d099f110e5e7c0df78528686ae07","榮"],["bf27e95238dd789b05e38d56dc41cbf7","嵓"],["1d2eafa6be36dc6152cb1917cd2ac486","氏"],["8b1bd5636f709dfd6a95da9f463729c3","柀"],["0b49a77f459cf3783c5bac37a80518c5","份"],["8d1ba0e24b619cb4d377ddb7adb3e6fa","喼"],["dab4c329f3c540192f758a2e0008d275","鎚"],["5b6c90ad3012bfbbc2450b5ab930484d","翟"],["7eb78d5654f8335d0b1cf4cf78872097","鄭"],["c3852ea003683f2866abd56140fb5d84","錆"],["a78b8a79d8a32c925776c82955d168cc","郭"],["b6e773b060fdd575bc965369d509f4e0","煉"],["6d981a3b846347e2b3c9ca4d13794834","桒"],["d0ed8ffbc229f84dd796cdd6de36d2e4","䃯"],["d9aff359058ab474d552ce52e5a71ec8","卿"],["5417381484172c1607d7ca60765b62d2","蝕"],["b309cd2c649ce3ef6ea0ad2f5fc655cc","這"],["2a349ac3d6b94a8a64d904083fdd5c02","辿"],["0632283bfd909ef205b1f950e2b00f16","靑"],["d91c5a40619510b21610f523f9434269","淸"],["8dc47c6e65beb788da7ed9efd59f0934","買"],["e28d4c57d97fbe4a0d67aec2cc92e7c8","捥"],["9374173a2e4b7f1dcac75eccd5ee7e7f","榊"]]),k=(o(189),new Set(["⛌","⛍","❗","⛏","⛐","⛑","⛒","⛕","⛓","⛔","","","⛖","⛗","⛘","⛙","⛚","⛛","⛜","⛝","⛞","⛟","⛠","⛡","⭕","㉈","㉉","㉊","㉋","㉌","㉍","㉎","㉏","⒑","⒒","⒓","","","","","","","","","","","","","","","","","⬛","⬤","","","","","","⚿","","","","","","","","","","","","㊙","","⛣","⭖","⭗","⭘","⭙","☓","㊋","〒","⛨","㉆","㉅","⛩","࿖","⛪","⛫","⛬","♨","⛭","⛮","⛯","⚓","✈","⛰","⛱","⛲","⛳","⛴","⛵","","Ⓓ","Ⓢ","⛶","","","","","","⛷","⛸","⛹","⛺","","☎","⛻","⛼","⛽","⛾","","⛿","➡","⬅","⬆","⬇","⬯","⬮","","","","","㎡","㎥","㎝","㎠","㎤","","⒈","⒉","⒊","⒋","⒌","⒍","⒎","⒏","⒐","","","","","","","","","","","","","","","","","㈳","㈶","㈲","㈱","㈹","㉄","▶","◀","〖","〗","⟐","²","³","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","㉇","","","℻","㈪","㈫","㈬","㈭","㈮","㈯","㈰","㈷","㍾","㍽","㍼","㍻","№","℡","〶","⚾","","","","","","","","","","","","","","","","","","","","","","","ℓ","㎏","㎐","㏊","㎞","㎢","㍱","½","↉","⅓","⅔","¼","¾","⅕","⅖","⅗","⅘","⅙","⅚","⅐","⅛","⅑","⅒","☀","☁","☂","⛄","☖","☗","⛉","⛊","♦","♥","♣","♠","⛋","⨀","‼","⁉","⛅","☔","⛆","☃","⛇","⚡","⛈","⚞","⚟","♬","","Ⅰ","Ⅱ","Ⅲ","Ⅳ","Ⅴ","Ⅵ","Ⅶ","Ⅷ","Ⅸ","Ⅹ","Ⅺ","Ⅻ","⑰","⑱","⑲","⑳","⑴","⑵","⑶","⑷","⑸","⑹","⑺","⑻","⑼","⑽","⑾","⑿","㉑","㉒","㉓","㉔","","","","","","","","","","","","","","","","","","","","","","","","","","","㉕","㉖","㉗","㉘","㉙","㉚","①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩","⑪","⑫","⑬","⑭","⑮","⑯","❶","❷","❸","❹","❺","❻","❼","❽","❾","❿","⓫","⓬","㉛","☎","⛌","⛍","❗","⛏","⛐","⛑","⛒","⛕","⛓","⛔","🅿","🆊","⛖","⛗","⛘","⛙","⛚","⛛","⛜","⛝","⛞","⛟","⛠","⛡","⭕","㉈","㉉","㉊","㉋","㉌","㉍","㉎","㉏","⒑","⒒","⒓","🅊","🅌","🄿","🅆","🅋","🈐","🈑","🈒","🈓","🅂","🈔","🈕","🈖","🅍","🄱","🄽","⬛","⬤","🈗","🈘","🈙","🈚","🈛","⚿","🈜","🈝","🈞","🈟","🈠","🈡","🈢","🈣","🈤","🈥","🅎","㊙","🈀","⛣","⭖","⭗","⭘","⭙","☓","㊋","⛨","㉆","㉅","⛩","࿖","⛪","⛫","⛬","⛭","⛮","⛯","⚓","✈","⛰","⛱","⛲","⛳","⛴","⛵","🅗","Ⓓ","Ⓢ","⛶","🅟","🆋","🆍","🆌","🅹","⛷","⛸","⛹","⛺","🅻","⛻","⛼","⛽","⛾","🅼","⛿","➡","⬅","⬆","⬇","⬯","⬮","㎥","㎠","㎤","🄀","⒈","⒉","⒊","⒋","⒌","⒍","⒎","⒏","⒐","🄁","🄂","🄃","🄄","🄅","🄆","🄇","🄈","🄉","🄊","㈳","㈶","㉄","⟐","🄭","🄬","🄫","㉇","🆐","🈦","℻","㈪","㈫","㈬","㈭","㈮","㈯","㈰","㈷","〶","⚾","🉀","🉁","🉂","🉃","🉄","🉅","🉆","🉇","🉈","🄪","🈧","🈨","🈩","🈔","🈪","🈫","🈬","🈭","🈮","🈯","🈰","🈱","㎐","㏊","㎢","㍱","↉","⅖","⅗","⅘","⅙","⅚","⅐","⅛","⅑","⅒","⛄","⛉","⛊","⛋","⨀","⛅","☔","⛆","⛇","⚡","⛈","⚞","⚟","⑴","⑵","⑶","⑷","⑸","⑹","⑺","⑻","⑼","⑽","⑾","⑿","🄐","🄑","🄒","🄓","🄔","🄕","🄖","🄗","🄘","🄙","🄚","🄛","🄜","🄝","🄞","🄟","🄠","🄡","🄢","🄣","🄤","🄥","🄦","🄧","🄨","🄩"])),I=[0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920],F=function(ce){var me=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;H==null&&(H=ce.length);for(var B=0,g=me;g<H;g++)B=65535&(B<<8^I[255&(B>>8^ce[g])]);return B},V=function(ce,me,H,B,g,U,ee,J){return 0|((pe=me+ce(H,B,g)+U+ee|0)<<(le=J)|pe>>>32-le)+H;var pe,le},ne=function(ce,me,H){return ce&me|~ce&H},te=function(ce,me,H){return ce&H|me&~H},Z=function(ce,me,H){return ce^me^H},Q=function(ce,me,H){return me^(ce|~H)},he=function(ce){var me=15&ce;return"".concat(((240&ce)>>4).toString(16)).concat(me.toString(16))},de=function(ce){var me=64*Math.floor((ce.byteLength+8)/64+1),H=new Uint8Array(me);H.set(new Uint8Array(ce),0);var B=new DataView(H.buffer);B.setUint8(ce.byteLength,128),B.setUint32(me-8,8*ce.byteLength%Math.pow(2,32),!0),B.setUint32(me-4,8*ce.byteLength/Math.pow(2,32),!0);for(var g=1732584193,U=-271733879,ee=-1732584194,J=271733878,pe=0;pe<me;pe+=64){var le=g,ke=U,Fe=ee,Le=J;g=V(ne,g,U,ee,J,B.getUint32(pe+0,!0),3614090360,7),J=V(ne,J,g,U,ee,B.getUint32(pe+4,!0),3905402710,12),ee=V(ne,ee,J,g,U,B.getUint32(pe+8,!0),606105819,17),U=V(ne,U,ee,J,g,B.getUint32(pe+12,!0),3250441966,22),g=V(ne,g,U,ee,J,B.getUint32(pe+16,!0),4118548399,7),J=V(ne,J,g,U,ee,B.getUint32(pe+20,!0),1200080426,12),ee=V(ne,ee,J,g,U,B.getUint32(pe+24,!0),2821735955,17),U=V(ne,U,ee,J,g,B.getUint32(pe+28,!0),4249261313,22),g=V(ne,g,U,ee,J,B.getUint32(pe+32,!0),1770035416,7),J=V(ne,J,g,U,ee,B.getUint32(pe+36,!0),2336552879,12),ee=V(ne,ee,J,g,U,B.getUint32(pe+40,!0),4294925233,17),U=V(ne,U,ee,J,g,B.getUint32(pe+44,!0),2304563134,22),g=V(ne,g,U,ee,J,B.getUint32(pe+48,!0),1804603682,7),J=V(ne,J,g,U,ee,B.getUint32(pe+52,!0),4254626195,12),ee=V(ne,ee,J,g,U,B.getUint32(pe+56,!0),2792965006,17),U=V(ne,U,ee,J,g,B.getUint32(pe+60,!0),1236535329,22),g=V(te,g,U,ee,J,B.getUint32(pe+4,!0),4129170786,5),J=V(te,J,g,U,ee,B.getUint32(pe+24,!0),3225465664,9),ee=V(te,ee,J,g,U,B.getUint32(pe+44,!0),643717713,14),U=V(te,U,ee,J,g,B.getUint32(pe+0,!0),3921069994,20),g=V(te,g,U,ee,J,B.getUint32(pe+20,!0),3593408605,5),J=V(te,J,g,U,ee,B.getUint32(pe+40,!0),38016083,9),ee=V(te,ee,J,g,U,B.getUint32(pe+60,!0),3634488961,14),U=V(te,U,ee,J,g,B.getUint32(pe+16,!0),3889429448,20),g=V(te,g,U,ee,J,B.getUint32(pe+36,!0),568446438,5),J=V(te,J,g,U,ee,B.getUint32(pe+56,!0),3275163606,9),ee=V(te,ee,J,g,U,B.getUint32(pe+12,!0),4107603335,14),U=V(te,U,ee,J,g,B.getUint32(pe+32,!0),1163531501,20),g=V(te,g,U,ee,J,B.getUint32(pe+52,!0),2850285829,5),J=V(te,J,g,U,ee,B.getUint32(pe+8,!0),4243563512,9),ee=V(te,ee,J,g,U,B.getUint32(pe+28,!0),1735328473,14),U=V(te,U,ee,J,g,B.getUint32(pe+48,!0),2368359562,20),g=V(Z,g,U,ee,J,B.getUint32(pe+20,!0),4294588738,4),J=V(Z,J,g,U,ee,B.getUint32(pe+32,!0),2272392833,11),ee=V(Z,ee,J,g,U,B.getUint32(pe+44,!0),1839030562,16),U=V(Z,U,ee,J,g,B.getUint32(pe+56,!0),4259657740,23),g=V(Z,g,U,ee,J,B.getUint32(pe+4,!0),2763975236,4),J=V(Z,J,g,U,ee,B.getUint32(pe+16,!0),1272893353,11),ee=V(Z,ee,J,g,U,B.getUint32(pe+28,!0),4139469664,16),U=V(Z,U,ee,J,g,B.getUint32(pe+40,!0),3200236656,23),g=V(Z,g,U,ee,J,B.getUint32(pe+52,!0),681279174,4),J=V(Z,J,g,U,ee,B.getUint32(pe+0,!0),3936430074,11),ee=V(Z,ee,J,g,U,B.getUint32(pe+12,!0),3572445317,16),U=V(Z,U,ee,J,g,B.getUint32(pe+24,!0),76029189,23),g=V(Z,g,U,ee,J,B.getUint32(pe+36,!0),3654602809,4),J=V(Z,J,g,U,ee,B.getUint32(pe+48,!0),3873151461,11),ee=V(Z,ee,J,g,U,B.getUint32(pe+60,!0),530742520,16),U=V(Z,U,ee,J,g,B.getUint32(pe+8,!0),3299628645,23),g=V(Q,g,U,ee,J,B.getUint32(pe+0,!0),4096336452,6),J=V(Q,J,g,U,ee,B.getUint32(pe+28,!0),1126891415,10),ee=V(Q,ee,J,g,U,B.getUint32(pe+56,!0),2878612391,15),U=V(Q,U,ee,J,g,B.getUint32(pe+20,!0),4237533241,21),g=V(Q,g,U,ee,J,B.getUint32(pe+48,!0),1700485571,6),J=V(Q,J,g,U,ee,B.getUint32(pe+12,!0),2399980690,10),ee=V(Q,ee,J,g,U,B.getUint32(pe+40,!0),4293915773,15),U=V(Q,U,ee,J,g,B.getUint32(pe+4,!0),2240044497,21),g=V(Q,g,U,ee,J,B.getUint32(pe+32,!0),1873313359,6),J=V(Q,J,g,U,ee,B.getUint32(pe+60,!0),4264355552,10),ee=V(Q,ee,J,g,U,B.getUint32(pe+24,!0),2734768916,15),U=V(Q,U,ee,J,g,B.getUint32(pe+52,!0),1309151649,21),g=V(Q,g,U,ee,J,B.getUint32(pe+16,!0),4149444226,6),J=V(Q,J,g,U,ee,B.getUint32(pe+44,!0),3174756917,10),ee=V(Q,ee,J,g,U,B.getUint32(pe+8,!0),718787259,15),U=V(Q,U,ee,J,g,B.getUint32(pe+36,!0),3951481745,21),g=le+g|0,U=ke+U|0,ee=Fe+ee|0,J=Le+J|0}var Be="";return Be+=he((255&g)>>>0),Be+=he((65280&g)>>>8),Be+=he((16711680&g)>>>16),Be+=he((4278190080&g)>>>24),Be+=he((255&U)>>>0),Be+=he((65280&U)>>>8),Be+=he((16711680&U)>>>16),Be+=he((4278190080&U)>>>24),Be+=he((255&ee)>>>0),Be+=he((65280&ee)>>>8),Be+=he((16711680&ee)>>>16),Be+=he((4278190080&ee)>>>24),Be+=he((255&J)>>>0),Be+=he((65280&J)>>>8),(Be+=he((16711680&J)>>>16))+he((4278190080&J)>>>24)};function M(ce,me){return function(H){if(Array.isArray(H))return H}(ce)||function(H,B){if(typeof Symbol<"u"&&Symbol.iterator in Object(H)){var g=[],U=!0,ee=!1,J=void 0;try{for(var pe,le=H[Symbol.iterator]();!(U=(pe=le.next()).done)&&(g.push(pe.value),!B||g.length!==B);U=!0);}catch(ke){ee=!0,J=ke}finally{try{U||le.return==null||le.return()}finally{if(ee)throw J}}return g}}(ce,me)||function(H,B){if(H){if(typeof H=="string")return A(H,B);var g=Object.prototype.toString.call(H).slice(8,-1);return g==="Object"&&H.constructor&&(g=H.constructor.name),g==="Map"||g==="Set"?Array.from(H):g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g)?A(H,B):void 0}}(ce,me)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function A(ce,me){(me==null||me>ce.length)&&(me=ce.length);for(var H=0,B=new Array(me);H<me;H++)B[H]=ce[H];return B}function v(ce,me){for(var H=0;H<me.length;H++){var B=me[H];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(ce,B.key,B)}}var w=null,R=function(){function ce(g,U){(function(ee,J){if(!(ee instanceof J))throw new TypeError("Cannot call a class as a function")})(this,ce),this.option_canvas=null,this.render_canvas=null,this.render_text="",this.GL=0,this.GR=2,this.G_BACK=[f.get(0),f.get(1),f.get(2),m.get(31)],this.DRCS_mapping=new Map([[15,new Map],[16,new Map],[17,new Map],[18,new Map],[19,new Map],[20,new Map],[21,new Map],[22,new Map],[23,new Map],[24,new Map],[25,new Map],[26,new Map],[27,new Map],[28,new Map],[29,new Map],[30,new Map]]),this.purpose_width=1920,this.purpose_height=1080,this.swf_x=1920,this.swf_y=1080,this.sdf_x=1920,this.sdf_y=1080,this.sdp_x=0,this.sdp_y=0,this.ssm_x=72,this.ssm_y=72,this.shs=8,this.svs=48,this.text_size_x=1,this.text_size_y=1,this.position_x=-1,this.position_y=-1,this.pallet=0,this.fg_color=_[this.pallet][7],this.bg_color=_[this.pallet][8],this.force_bg_color=null,this.hlc=0,this.stl=!1,this.orn=null,this.force_orn=null,this.non_spacing="",this.timeElapsed=0,this.endTime=null,this.rendered=!1,this.PRA=null,this.normalFont="sans-serif",this.gaijiFont=this.normalFont,this.drcsReplacement=!1,this.drcsReplaceMapping=new Map,this.useStroke=!1,this.usePUA=!1,this.pes=g,this.startTime=U}var me,H,B;return me=ce,B=[{key:"setEmbeddedGlyph",value:function(g){w=g}},{key:"detect",value:function(g,U){var ee,J,pe=(ee=U==null?void 0:U.data_identifier)!==null&&ee!==void 0?ee:128,le=(J=U==null?void 0:U.data_group_id)!==null&&J!==void 0?J:1;if(g.length<=0||g[0]!==pe||g.length<=2)return!1;var ke=3+(15&g[2]);return!(g.length<=ke||(15&(252&g[ke+0])>>2)!==le||(F(g,ke),0))}},{key:"getRGBAColorCode",value:function(g){if(g==null)return null;var U=document.createElement("canvas");U.width=U.height=1;var ee=U.getContext("2d");if(!ee)return null;ee.fillStyle=g,ee.fillRect(0,0,U.width,U.height);var J=M(ee.getImageData(0,0,1,1).data,4),pe=J[0],le=J[1],ke=J[2],Fe=J[3],Le="#".concat(pe.toString(16).toUpperCase().padStart(2,"0")).concat(le.toString(16).toUpperCase().padStart(2,"0")).concat(ke.toString(16).toUpperCase().padStart(2,"0")).concat(Fe.toString(16).toUpperCase().padStart(2,"0"));return U.width=U.height=0,Le}},{key:"fillAlphaColorCode",value:function(g){if(g==null)return"";var U=Number.parseInt(g.substring(1,3),16),ee=Number.parseInt(g.substring(3,5),16),J=Number.parseInt(g.substring(5,7),16);return"#".concat(U.toString(16).toUpperCase().padStart(2,"0")).concat(ee.toString(16).toUpperCase().padStart(2,"0")).concat(J.toString(16).toUpperCase().padStart(2,"0"),"FF")}},{key:"getRGBAfromColorCode",value:function(g){if(g==null)return"";var U=Number.parseInt(g.substring(1,3),16),ee=Number.parseInt(g.substring(3,5),16),J=Number.parseInt(g.substring(5,7),16),pe=Number.parseInt(g.substring(7,9),16);return"rgba(".concat(U,", ").concat(ee,", ").concat(J,", ").concat(pe/255,")")}}],(H=[{key:"initialize",value:function(){this.render_canvas=null,this.option_canvas=null,this.render_text="",this.GL=0,this.GR=2,this.G_BACK=[f.get(0),f.get(1),f.get(2),m.get(31)],this.DRCS_mapping=new Map([[15,new Map],[16,new Map],[17,new Map],[18,new Map],[19,new Map],[20,new Map],[21,new Map],[22,new Map],[23,new Map],[24,new Map],[25,new Map],[26,new Map],[27,new Map],[28,new Map],[29,new Map],[30,new Map]]),this.purpose_width=1920,this.purpose_height=1080,this.swf_x=1920,this.swf_y=1080,this.sdf_x=1920,this.sdf_y=1080,this.sdp_x=0,this.sdp_y=0,this.ssm_x=72,this.ssm_y=72,this.shs=8,this.svs=48,this.text_size_x=1,this.text_size_y=1,this.position_x=-1,this.position_y=-1,this.pallet=0,this.fg_color=_[this.pallet][7],this.bg_color=_[this.pallet][8],this.force_bg_color=null,this.hlc=0,this.stl=!1,this.orn=null,this.force_orn=null,this.non_spacing="",this.timeElapsed=0,this.endTime=null,this.rendered=!1,this.PRA=null,this.normalFont="sans-serif",this.gaijiFont=this.normalFont,this.drcsReplacement=!1,this.drcsReplaceMapping=new Map,this.useStroke=!1,this.usePUA=!1}},{key:"width",value:function(){return Math.floor((this.shs+this.ssm_x)*this.text_size_x)}},{key:"height",value:function(){return Math.floor((this.svs+this.ssm_y)*this.text_size_y)}},{key:"width_magnification",value:function(){return Math.ceil(this.purpose_width/this.swf_x)}},{key:"height_magnification",value:function(){return Math.ceil(this.purpose_height/this.swf_y)}},{key:"canvas_width",value:function(){return this.swf_x*this.width_magnification()}},{key:"canvas_height",value:function(){return this.swf_y*this.height_magnification()}},{key:"move_absolute_dot",value:function(g,U){this.position_x=g,this.position_y=U}},{key:"move_absolute_pos",value:function(g,U){this.position_x=this.sdp_x+g*this.width(),this.position_y=this.sdp_y+(U+1)*this.height()}},{key:"move_relative_pos",value:function(g,U){for((this.position_x<0||this.position_y<0)&&this.move_absolute_dot(this.sdp_x,this.sdp_y+(this.ssm_y+this.svs));g<0;)this.position_x-=this.width(),g++,this.position_x<this.sdp_x&&(this.position_x=this.sdp_x+this.sdf_x-this.width(),U--);for(;g>0;)this.position_x+=this.width(),g--,this.position_x>=this.sdp_x+this.sdf_x&&(this.position_x=this.sdp_x,U++);for(;U<0;)this.position_y-=this.height(),U++;for(;U>0;)this.position_y+=this.height(),U--}},{key:"move_newline",value:function(){(this.position_x<0||this.position_y<0)&&this.move_absolute_dot(this.sdp_x,this.sdp_y+(this.ssm_y+this.svs)),this.position_x=this.sdp_x,this.position_y=this.position_y+this.height()}},{key:"render",value:function(g){var U,ee,J,pe,le,ke,Fe,Le,Be,Xe,He,Ze,Ye,ot,nt;this.initialize(),this.option_canvas=(U=g==null?void 0:g.canvas)!==null&&U!==void 0?U:null,this.force_orn=(ee=typeof(g==null?void 0:g.forceStrokeColor)=="boolean"?g==null?void 0:g.forceStrokeColor:ce.getRGBAColorCode(g==null?void 0:g.forceStrokeColor))!==null&&ee!==void 0?ee:null,this.force_bg_color=(J=ce.getRGBAColorCode(g==null?void 0:g.forceBackgroundColor))!==null&&J!==void 0?J:null,this.purpose_width=(pe=(le=g==null?void 0:g.width)!==null&&le!==void 0?le:g==null||(ke=g.canvas)===null||ke===void 0?void 0:ke.width)!==null&&pe!==void 0?pe:this.purpose_width,this.purpose_height=(Fe=(Le=g==null?void 0:g.height)!==null&&Le!==void 0?Le:g==null||(Be=g.canvas)===null||Be===void 0?void 0:Be.height)!==null&&Fe!==void 0?Fe:this.purpose_height,this.normalFont=(Xe=g==null?void 0:g.normalFont)!==null&&Xe!==void 0?Xe:"sans-serif",this.gaijiFont=(He=g==null?void 0:g.gaijiFont)!==null&&He!==void 0?He:this.normalFont,this.drcsReplacement=(Ze=g==null?void 0:g.drcsReplacement)!==null&&Ze!==void 0&&Ze,this.drcsReplaceMapping=new Map(T);for(var Ct,At=Object.entries((Ct=g==null?void 0:g.drcsReplaceMapping)!==null&&Ct!==void 0?Ct:{}),vt=0;vt<At.length;vt++){var Rt=At[vt];this.drcsReplaceMapping.set(Rt[0],Rt[1])}if(this.useStroke=(Ye=g==null?void 0:g.useStroke)!==null&&Ye!==void 0&&Ye,this.usePUA=(ot=g==null?void 0:g.usePUA)!==null&&ot!==void 0&&ot,!ce.detect(this.pes,g))return null;for(var Tt=3+(15&this.pes[2]),Gt=(this.pes[Tt+0],(this.pes[Tt+3]<<8)+this.pes[Tt+4]),kt=Tt+9;kt<Tt+(5+Gt);){this.pes[kt+0];var yt=this.pes[kt+1],Qe=this.pes[kt+2]<<16|this.pes[kt+3]<<8|this.pes[kt+4];yt===32?this.parseText(kt+5,kt+5+Qe):yt==48?this.parseDRCS(1,kt+5,kt+5+Qe):yt==49&&this.parseDRCS(2,kt+5,kt+5+Qe),kt+=5+Qe}if(this.option_canvas){var Et=this.option_canvas.getContext("2d");if(Et&&(Et.clearRect(0,0,this.option_canvas.width,this.option_canvas.height),this.render_canvas))if(g!=null&&g.keepAspectRatio){var Ut=this.option_canvas.width/this.swf_x,$t=this.option_canvas.height/this.swf_y,Bt=Math.min(Ut,$t),Mt=this.swf_x*Bt,Ht=this.swf_y*Bt,Qt=(this.option_canvas.width-Mt)/2,qt=(this.option_canvas.height-Ht)/2;Et.drawImage(this.render_canvas,0,0,this.render_canvas.width,this.render_canvas.height,Qt,qt,Mt,Ht)}else Et.drawImage(this.render_canvas,0,0,this.render_canvas.width,this.render_canvas.height,0,0,this.option_canvas.width,this.option_canvas.height)}return this.render_canvas&&(this.render_canvas.width=this.render_canvas.height=0,this.render_canvas=null),this.option_canvas=null,{startTime:this.startTime,endTime:(nt=this.endTime)!==null&&nt!==void 0?nt:Number.POSITIVE_INFINITY,rendered:this.rendered,textContent:this.rendered?this.render_text:null,PRA:this.PRA}}},{key:"parseText",value:function(g,U){for(;g<U;)if(32<this.pes[g]&&this.pes[g]<127){var ee=0,J=this.G_BACK[this.GL];if(!J)return;for(var pe=0;pe<J.bytes;pe++)ee<<=8,ee|=127&this.pes[g+pe];this.renderCharacter(ee,J),g+=J.bytes}else if(160<this.pes[g]&&this.pes[g]<255){var le=0,ke=this.G_BACK[this.GR];if(!ke)return;for(var Fe=0;Fe<ke.bytes;Fe++)le<<=8,le|=127&this.pes[g+Fe];this.renderCharacter(le,ke),g+=ke.bytes}else if(this.pes[g]===0)g+=1;else if(this.pes[g]===7)g+=1;else if(this.pes[g]===8)this.move_relative_pos(-1,0),g+=1;else if(this.pes[g]===9)this.move_relative_pos(1,0),g+=1;else if(this.pes[g]===10)this.move_relative_pos(0,1),g+=1;else if(this.pes[g]===11)this.move_relative_pos(0,-1),g+=1;else if(this.pes[g]===12)this.startTime!=null&&this.timeElapsed>0&&(this.endTime=this.startTime+this.timeElapsed),g+=1;else if(this.pes[g]===13)this.move_newline(),g+=1;else if(this.pes[g]===14)this.GL=1,g+=1;else if(this.pes[g]===15)this.GL=0,g+=1;else if(this.pes[g]===22){var Le=63&this.pes[g+1];this.move_relative_pos(Le,0),g+=2}else if(this.pes[g]===24)g+=1;else if(this.pes[g]===25){var Be=0,Xe=this.G_BACK[2];if(!Xe)return;for(var He=0;He<Xe.bytes;He++)Be<<=8,Be|=127&this.pes[g+1+He];this.renderCharacter(Be,Xe),g+=1+Xe.bytes}else if(this.pes[g]===27)if(this.pes[g+1]===110)this.GL=2,g+=2;else if(this.pes[g+1]==111)this.GL=3,g+=2;else if(this.pes[g+1]==126)this.GR=1,g+=2;else if(this.pes[g+1]==125)this.GR=2,g+=2;else if(this.pes[g+1]==124)this.GR=3,g+=2;else if(40<=this.pes[g+1]&&this.pes[g+1]<=43){var Ze=this.pes[g+1]-40;this.pes[g+2]===32?(this.G_BACK[Ze]=y.get(this.pes[g+3]),g+=4):(this.G_BACK[Ze]=p.get(this.pes[g+2]),g+=3)}else{if(this.pes[g+1]!==36)return;if(40<=this.pes[g+2]&&this.pes[g+2]<=43){var Ye=this.pes[g+2]-40;this.pes[g+3]===32?(this.G_BACK[Ye]=y.get(this.pes[g+4]),g+=5):(this.G_BACK[Ye]=p.get(this.pes[g+3]),g+=4)}else this.G_BACK[0]=p.get(this.pes[g+2]),g+=3}else if(this.pes[g]===28){var ot=63&this.pes[g+1],nt=63&this.pes[g+2];this.move_absolute_pos(nt,ot),g+=3}else if(this.pes[g]===29){var Ct=0,At=this.G_BACK[3];if(!At)return;for(var vt=0;vt<At.bytes;vt++)Ct<<=8,Ct|=127&this.pes[g+1+vt];this.renderCharacter(Ct,At),g+=1+At.bytes}else if(this.pes[g]===30)g+=1;else if(this.pes[g]===31)g+=1;else if(this.pes[g]===32){var Rt=f.get(0);if(!Rt)return;this.renderCharacter(8481,Rt),g+=1}else if(this.pes[g]===127)g+=1;else if(this.pes[g]===128)this.fg_color=_[this.pallet][0],g+=1;else if(this.pes[g]===129)this.fg_color=_[this.pallet][1],g+=1;else if(this.pes[g]===130)this.fg_color=_[this.pallet][2],g+=1;else if(this.pes[g]===131)this.fg_color=_[this.pallet][3],g+=1;else if(this.pes[g]===132)this.fg_color=_[this.pallet][4],g+=1;else if(this.pes[g]===133)this.fg_color=_[this.pallet][5],g+=1;else if(this.pes[g]===134)this.fg_color=_[this.pallet][6],g+=1;else if(this.pes[g]===135)this.fg_color=_[this.pallet][7],g+=1;else if(this.pes[g]===136)this.text_size_x=.5,this.text_size_y=.5,g+=1;else if(this.pes[g]===137)this.text_size_x=.5,this.text_size_y=1,g+=1;else if(this.pes[g]===138)this.text_size_x=1,this.text_size_y=1,g+=1;else{if(this.pes[g]===139)return;if(this.pes[g]===144){var Tt=this.pes[g+1];if(Tt==32){var Gt=15&this.pes[g+2];this.pallet=Gt,g+=3}else{var kt=15&Tt;(112&Tt)==64?this.fg_color=_[this.pallet][kt]:(112&Tt)==80&&(this.bg_color=_[this.pallet][kt]),g+=2}}else if(this.pes[g]===145)g+=2;else{if(this.pes[g]===146||this.pes[g]===147||this.pes[g]===148||this.pes[g]===149)return;if(this.pes[g]===151)this.hlc=15&this.pes[g+1],g+=2;else{if(this.pes[g]===152)return;if(this.pes[g]===153)this.stl=!1,g+=1;else if(this.pes[g]===154)this.stl=!0,g+=1;else if(this.pes[g]===155){for(var yt=g,Qe=-1,Et=-1;yt+1<U;)if(yt+=1,this.pes[yt]===32)Qe<0&&(Qe=yt);else if(this.pes[yt]===59)Qe<0&&Et<0&&(Et=yt);else{if(this.pes[yt]===66)break;if(this.pes[yt]===83){var Ut=g+1,$t=0;if(Et>=0||Qe<0)return;for(;Ut<Qe;)$t*=10,$t+=15&this.pes[Ut],Ut++;if($t===5)this.swf_x=3840,this.swf_y=2160;else if($t===7)this.swf_x=1920,this.swf_y=1080;else{if($t!=9)return;this.swf_x=1440,this.swf_y=960}break}if(this.pes[yt]===84)break;if(this.pes[yt]===86){for(var Bt=g+1,Mt=0,Ht=0;Bt<Et;)Mt*=10,Mt+=15&this.pes[Bt],Bt++;for(Bt++;Bt<Qe;)Ht*=10,Ht+=15&this.pes[Bt],Bt++;this.sdf_x=2*Mt,this.sdf_y=2*Ht;break}if(this.pes[yt]===87){for(var Qt=g+1,qt=0,rn=0;Qt<Et;)qt*=10,qt+=15&this.pes[Qt],Qt++;for(Qt++;Qt<Qe;)rn*=10,rn+=15&this.pes[Qt],Qt++;this.ssm_x=2*qt,this.ssm_y=2*rn;break}if(this.pes[yt]===88){for(var dn=g+1,vn=0;dn<Qe;)vn*=10,vn+=15&this.pes[dn],dn++;this.shs=2*vn;break}if(this.pes[yt]===89){for(var En=g+1,cn=0;En<Qe;)cn*=10,cn+=15&this.pes[En],En++;this.svs=2*cn;break}if(this.pes[yt]===91||this.pes[yt]===92||this.pes[yt]===93||this.pes[yt]===94)break;if(this.pes[yt]===95){for(var sn=g+1,un=0,mn=0;sn<Et;)un*=10,un+=15&this.pes[sn],sn++;for(sn++;sn<Qe;)mn*=10,mn+=15&this.pes[sn],sn++;this.sdp_x=2*un,this.sdp_y=2*mn;break}if(this.pes[yt]===97){for(var hn=g+1,bn=0,fn=0;hn<Et;)bn*=10,bn+=15&this.pes[hn],hn++;for(hn++;hn<Qe;)fn*=10,fn+=15&this.pes[hn],hn++;this.move_absolute_dot(2*bn,2*fn);break}if(this.pes[yt]===98)break;if(this.pes[yt]===99){var gn=this.pes[g+1];if(gn==48)this.orn=null;else if(gn==49){var Zt=10*(15&this.pes[g+3])+(15&this.pes[g+4]),Nn=10*(15&this.pes[g+5])+(15&this.pes[g+6]);this.orn=_[Zt][Nn]}break}if(this.pes[yt]===100||this.pes[yt]===101||this.pes[yt]===102||this.pes[yt]===103)break;if(this.pes[yt]===104){for(var Xt=g+1,Un=0;Xt<Qe;)Un*=10,Un+=15&this.pes[Xt],Xt++;this.PRA=Un;break}if(this.pes[yt]===105||this.pes[yt]===106||this.pes[yt]===110||this.pes[yt]===111)break}g=yt+1}else{if(this.pes[g]!==157)return;if(this.pes[g+1]!=32)return void this.pes[g+1];var ni=63&this.pes[g+2];this.timeElapsed+=ni/10,g+=3}}}}}},{key:"parseDRCS",value:function(g,U,ee){for(this.pes[U+0],U+=1;U<ee;){var J=this.pes[U+0]<<8|this.pes[U+1],pe=this.pes[U+2];U+=3;for(var le=0;le<pe;le++){this.pes[U+0];var ke=15&this.pes[U+0];if(ke===0||ke===1){var Fe=this.pes[U+1]+2,Le=this.pes[U+2],Be=this.pes[U+3],Xe=Fe.toString(2).length-Fe.toString(2).replace(/0*$/,"").length,He=Math.floor(Le*Be*Xe/8),Ze=new Uint8Array(Array.prototype.slice.call(this.pes,U+4,U+4+He));if(g===1){var Ye,ot,nt=64+((3840&J)>>8),Ct=127&J,At=(Ye=y.get(nt))===null||Ye===void 0?void 0:Ye.alphabet;At&&((ot=this.DRCS_mapping.get(At))===null||ot===void 0||ot.set(Ct,Ze))}else{var vt,Rt=32639&J;(vt=this.DRCS_mapping.get(15))===null||vt===void 0||vt.set(Rt,Ze)}U+=4+He}}}}},{key:"renderCharacter",value:function(g,U){var ee;if((this.position_x<0||this.position_y<0)&&this.move_absolute_dot(this.sdp_x,this.sdp_y+(this.ssm_y+this.svs)),this.option_canvas){this.option_canvas&&!this.render_canvas&&(this.render_canvas=document.createElement("canvas"),this.render_canvas.width=this.canvas_width(),this.render_canvas.height=this.canvas_height());var J=(ee=this.render_canvas)===null||ee===void 0?void 0:ee.getContext("2d");if(J){if(U.alphabet===0){var pe=((65280&g)>>8)-33,le=(255&g)-33;if(pe===0&&12<=le&&le<=17)return void(this.non_spacing=["́","　","̈","̂","̅","̲"][le-12]);if(pe===1&&le===93)return void(this.non_spacing+="⃝")}var ke;if(U.alphabet!==31&&(this.rendered=!0,J.fillStyle=ce.getRGBAfromColorCode((ke=this.force_bg_color)!==null&&ke!==void 0?ke:this.bg_color),J.fillRect(this.position_x*this.width_magnification(),(this.position_y-this.height())*this.height_magnification(),this.width()*this.width_magnification(),this.height()*this.height_magnification()),1&this.hlc&&(J.fillStyle=ce.getRGBAfromColorCode(this.fg_color),J.fillRect(this.position_x*this.width_magnification(),(this.position_y-1)*this.height_magnification(),this.width()*this.width_magnification(),1*this.height_magnification())),2&this.hlc&&(J.fillStyle=ce.getRGBAfromColorCode(this.fg_color),J.fillRect((this.position_x+this.width()-1)*this.width_magnification(),(this.position_y-this.height())*this.height_magnification(),1*this.width_magnification(),this.height()*this.height_magnification())),4&this.hlc&&(J.fillStyle=ce.getRGBAfromColorCode(this.fg_color),J.fillRect(this.position_x*this.width_magnification(),(this.position_y-this.height())*this.height_magnification(),this.width()*this.width_magnification(),1*this.height_magnification())),8&this.hlc&&(J.fillStyle=ce.getRGBAfromColorCode(this.fg_color),J.fillRect(this.position_x*this.width_magnification(),(this.position_y-this.height())*this.height_magnification(),1*this.width_magnification(),this.height()*this.height_magnification())),this.stl&&(J.fillStyle=ce.getRGBAfromColorCode(this.fg_color),J.fillRect(this.position_x*this.width_magnification(),(this.position_y-1)*this.height_magnification(),this.width()*this.width_magnification(),1*this.height_magnification()))),U.alphabet===0){var Fe=94*(((65280&g)>>8)-33)+((255&g)-33),Le=7896;if(Fe<Le){var Be=S[Fe];this.renderFont(Be)}else if(this.usePUA){var Xe=b[Fe-Le];this.renderFont(Xe)}else{var He=x[Fe-Le];this.renderFont(He)}this.move_relative_pos(1,0)}else if(U.alphabet===1){var Ze=L[g-33];this.renderFont(Ze),this.move_relative_pos(1,0)}else if(U.alphabet===2){var Ye=N[g-33];this.renderFont(Ye),this.move_relative_pos(1,0)}else if(U.alphabet===3){var ot=P[g-33];this.renderFont(ot),this.move_relative_pos(1,0)}else{if(U.alphabet===31)return void(g===96?(this.G_BACK=[f.get(0),f.get(1),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===97?(this.G_BACK=[f.get(0),f.get(3),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===98?(this.G_BACK=[f.get(0),m.get(16),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===99?(this.G_BACK=[f.get(4),f.get(6),f.get(7),m.get(31)],this.GL=0,this.GR=2):g===100?(this.G_BACK=[f.get(4),f.get(5),f.get(7),m.get(31)],this.GL=0,this.GR=2):g===101?(this.G_BACK=[f.get(4),m.get(16),f.get(7),m.get(31)],this.GL=0,this.GR=2):g===102?(this.G_BACK=[m.get(16),m.get(17),m.get(18),m.get(31)],this.GL=0,this.GR=2):g===103?(this.G_BACK=[m.get(19),m.get(20),m.get(21),m.get(31)],this.GL=0,this.GR=2):g===104?(this.G_BACK=[m.get(22),m.get(23),m.get(24),m.get(31)],this.GL=0,this.GR=2):g===105?(this.G_BACK=[m.get(25),m.get(26),m.get(27),m.get(31)],this.GL=0,this.GR=2):g===106?(this.G_BACK=[m.get(28),m.get(29),m.get(30),m.get(31)],this.GL=0,this.GR=2):g===107?(this.G_BACK=[f.get(0),m.get(17),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===108?(this.G_BACK=[f.get(0),m.get(18),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===109?(this.G_BACK=[f.get(0),m.get(19),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===110?(this.G_BACK=[f.get(3),f.get(2),f.get(1),m.get(31)],this.GL=0,this.GR=2):g===111&&(this.G_BACK=[f.get(1),f.get(4),m.get(16),m.get(31)],this.GL=0,this.GR=2));var nt,Ct=(nt=this.DRCS_mapping.get(U.alphabet))===null||nt===void 0?void 0:nt.get(32639&g);if(!Ct)return;var At=de(Ct.buffer);if(this.drcsReplacement&&this.drcsReplaceMapping.has(At.toLowerCase()))this.renderFont(this.drcsReplaceMapping.get(At.toLowerCase()));else if(this.drcsReplacement&&this.drcsReplaceMapping.has(At.toUpperCase()))this.renderFont(this.drcsReplaceMapping.get(At.toUpperCase()));else{var vt=Math.floor(this.ssm_x*this.text_size_x/2),Rt=Math.floor(this.ssm_y*this.text_size_y/2),Tt=Math.floor(8*Ct.length/(vt*Rt)),Gt=this.getOrnColorCode();if(Gt&&(!this.force_orn||this.force_orn===!0||this.force_orn!==this.fg_color)){J.fillStyle=ce.getRGBAfromColorCode(Gt);for(var kt=-2*this.height_magnification();kt<=2*this.height_magnification();kt++)for(var yt=-2*this.width_magnification();yt<=2*this.width_magnification();yt++)for(var Qe=0;Qe<Rt;Qe++)for(var Et=0;Et<vt;Et++){for(var Ut=0,$t=0;$t<Tt;$t++){var Bt=7-((Qe*vt+Et)*Tt+$t)%8;Ut*=2,Ut+=(Ct[Math.floor(((Qe*vt+Et)*Tt+$t)/8)]&1<<Bt)>>Bt}Ut>0&&J.fillRect((this.position_x-0+Math.floor(this.shs*this.text_size_x/2)+2*Et)*this.width_magnification()+2*yt,(this.position_y-this.height()+Math.floor(this.svs*this.text_size_y/2)+2*Qe)*this.height_magnification()+2*kt,2*this.width_magnification(),2*this.height_magnification())}}J.fillStyle=ce.getRGBAfromColorCode(this.fg_color);for(var Mt=0;Mt<Rt;Mt++)for(var Ht=0;Ht<vt;Ht++){for(var Qt=0,qt=0;qt<Tt;qt++){var rn=7-((Mt*vt+Ht)*Tt+qt)%8;Qt*=2,Qt+=(Ct[Math.floor(((Mt*vt+Ht)*Tt+qt)/8)]&1<<rn)>>rn}Qt>0&&J.fillRect((this.position_x-0+Math.floor(this.shs*this.text_size_x/2)+2*Ht)*this.width_magnification(),(this.position_y-this.height()+Math.floor(this.svs*this.text_size_y/2)+2*Mt)*this.height_magnification(),2*this.width_magnification(),2*this.height_magnification())}}this.move_relative_pos(1,0)}}}}},{key:"renderFont",value:function(g){var U;if(g+=this.non_spacing,this.non_spacing="",this.text_size_x===.5&&this.text_size_y===.5&&(N.includes(g)||P.includes(g))||(this.render_text+=g),this.render_canvas)if(w!=null&&w.has(g)){var ee=w.get(g),J=ee.viewBox,pe=ee.path;this.renderPath(J,pe)}else{var le=k.has(g);le&&(g+="︎");var ke=(U=this.render_canvas)===null||U===void 0?void 0:U.getContext("2d");if(ke){var Fe=(this.position_x+this.width()/2)*this.width_magnification(),Le=(this.position_y-this.height()/2)*this.height_magnification();ke.translate(Fe,Le),ke.scale(this.text_size_x*this.width_magnification(),this.text_size_y*this.height_magnification());var Be=this.getOrnColorCode();if(Be&&(!this.force_orn||this.force_orn===!0||this.force_orn!==this.fg_color))if(this.useStroke)ke.font="".concat(this.ssm_x,"px ").concat(le?this.gaijiFont:this.normalFont),ke.strokeStyle=ce.getRGBAfromColorCode(Be),ke.lineJoin="round",ke.textBaseline="middle",ke.textAlign="center",ke.lineWidth=8,ke.strokeText(g,0,0);else{ke.setTransform(1,0,0,1,0,0),ke.translate(Fe,Le),ke.scale(this.text_size_x,this.text_size_y*this.height_magnification()/this.width_magnification());for(var Xe=-4*this.width_magnification();Xe<=4*this.width_magnification();Xe++)for(var He=-4*this.width_magnification();He<=4*this.width_magnification();He++)ke.font="".concat(this.ssm_x*this.width_magnification(),"px ").concat(le?this.gaijiFont:this.normalFont),ke.fillStyle=ce.getRGBAfromColorCode(Be),ke.textBaseline="middle",ke.textAlign="center",ke.fillText(g,0+He,0+Xe);ke.setTransform(1,0,0,1,0,0),ke.translate(Fe,Le),ke.scale(this.text_size_x*this.width_magnification(),this.text_size_y*this.height_magnification())}ke.font="".concat(this.ssm_x,"px ").concat(le?this.gaijiFont:this.normalFont),ke.fillStyle=ce.getRGBAfromColorCode(this.fg_color),ke.textBaseline="middle",ke.textAlign="center",ke.fillText(g,0,0),ke.setTransform(1,0,0,1,0,0)}}}},{key:"renderPath",value:function(g,U){var ee;if(this.render_canvas){var J=(ee=this.render_canvas)===null||ee===void 0?void 0:ee.getContext("2d");if(J){var pe=(this.position_x+this.shs/2)*this.width_magnification(),le=(this.position_y-this.height()+this.svs/2)*this.height_magnification();J.translate(pe,le);var ke=M(g,4),Fe=ke[0],Le=ke[1],Be=ke[2]-Fe,Xe=ke[3]-Le;J.scale(this.ssm_y/Be,this.ssm_y/Xe),J.translate(Fe,Le);var He=this.getOrnColorCode();if(He&&(!this.force_orn||this.force_orn===!0||this.force_orn!==this.fg_color))if(this.useStroke)J.strokeStyle=ce.getRGBAfromColorCode(He),J.lineJoin="round",J.lineWidth=4*Math.max(Be/this.ssm_y,Xe/this.ssm_y)*2,J.stroke(new Path2D(U));else for(var Ze=-4*this.width_magnification();Ze<=4*this.width_magnification();Ze++)for(var Ye=-4*this.width_magnification();Ye<=4*this.width_magnification();Ye++)J.translate(Ye,Ze),J.fillStyle=ce.getRGBAfromColorCode(He),J.fill(new Path2D(U)),J.translate(-Ye,-Ze);J.fillStyle=ce.getRGBAfromColorCode(this.fg_color),J.fill(new Path2D(U)),J.setTransform(1,0,0,1,0,0)}}}},{key:"getOrnColorCode",value:function(){return this.force_orn===!0?ce.fillAlphaColorCode(this.bg_color):this.force_orn===!1?this.orn:(g=this.force_orn)!==null&&g!==void 0?g:this.orn;var g}}])&&v(me.prototype,H),B&&v(me,B),ce}();function C(ce){return(C=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(me){return typeof me}:function(me){return me&&typeof Symbol=="function"&&me.constructor===Symbol&&me!==Symbol.prototype?"symbol":typeof me})(ce)}function O(ce,me){(me==null||me>ce.length)&&(me=ce.length);for(var H=0,B=new Array(me);H<me;H++)B[H]=ce[H];return B}function G(ce,me){if(!(ce instanceof me))throw new TypeError("Cannot call a class as a function")}function z(ce,me){for(var H=0;H<me.length;H++){var B=me[H];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(ce,B.key,B)}}function Y(ce,me,H){return me&&z(ce.prototype,me),ce}function ie(ce,me){return!me||C(me)!=="object"&&typeof me!="function"?function(H){if(H===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return H}(ce):me}function se(ce){var me=typeof Map=="function"?new Map:void 0;return(se=function(H){if(H===null||(B=H,Function.toString.call(B).indexOf("[native code]")===-1))return H;var B;if(typeof H!="function")throw new TypeError("Super expression must either be null or a function");if(me!==void 0){if(me.has(H))return me.get(H);me.set(H,g)}function g(){return Se(H,arguments,Ge(this).constructor)}return g.prototype=Object.create(H.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),Pe(g,H)})(ce)}function Se(ce,me,H){return(Se=we()?Reflect.construct:function(B,g,U){var ee=[null];ee.push.apply(ee,g);var J=new(Function.bind.apply(B,ee));return U&&Pe(J,U.prototype),J}).apply(null,arguments)}function we(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Pe(ce,me){return(Pe=Object.setPrototypeOf||function(H,B){return H.__proto__=B,H})(ce,me)}function Ge(ce){return(Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(me){return me.__proto__||Object.getPrototypeOf(me)})(ce)}o(7327),o(9826),o(4553),o(9554),o(2707),o(561),o(489),o(8304),o(4747);var it=function(ce){(function(U,ee){if(typeof ee!="function"&&ee!==null)throw new TypeError("Super expression must either be null or a function");U.prototype=Object.create(ee&&ee.prototype,{constructor:{value:U,writable:!0,configurable:!0}}),ee&&Pe(U,ee)})(g,ce);var me,H,B=(me=g,H=we(),function(){var U,ee=Ge(me);if(H){var J=Ge(this).constructor;U=Reflect.construct(ee,arguments,J)}else U=ee.apply(this,arguments);return ie(this,U)});function g(){return G(this,g),B.apply(this,arguments)}return Y(g,[{key:"addCue",value:function(U){this.push(U)}},{key:"removeCue",value:function(U){var ee=this.findIndex(function(J){return J===U});ee<0||this.splice(ee,1)}},{key:"getCueById",value:function(U){var ee;return(ee=this.find(function(J){return J.id===U}))!==null&&ee!==void 0?ee:null}}]),g}(se(Array)),Ie=function(){function ce(me){G(this,ce),this.all=new it,this.active=new it,this.polling_handler=this.polling.bind(this),this.polling_id=null,this.cues=this.all,this.oncuechange=null,this.id="",this.kind="metadata",this.label="",this.language="ja-JP",this.mode="hidden",this.inBandMetadataTrackDispatchType="",this.sourceBuffer=null,this.listeners=[],this.media=me}return Y(ce,[{key:"startPolling",value:function(){this.polling_id=window.requestAnimationFrame(this.polling_handler)}},{key:"stopPolling",value:function(){this.polling_id!=null&&(window.cancelAnimationFrame(this.polling_id),this.polling_id=null)}},{key:"polling",value:function(){var me=this.active,H=this.activeCues;if(me.length!==H.length){var B=null;try{B=new CustomEvent("cuechange")}catch{(B=document.createEvent("CustomEvent")).initCustomEvent("cuechange",!1,!1,{})}B!=null&&(this.dispatchEvent(B),this.oncuechange&&this.oncuechange.call(this,B))}else for(var g=0;g<H.length;g++)if(me[g]!==H[g]){var U=null;try{U=new CustomEvent("cuechange")}catch{(U=document.createEvent("CustomEvent")).initCustomEvent("cuechange",!1,!1,{})}if(U!=null){this.dispatchEvent(U),this.oncuechange&&this.oncuechange.call(this,U);break}}this.polling_id=window.requestAnimationFrame(this.polling_handler)}},{key:"getCueById",value:function(me){return this.all.getCueById(me)}},{key:"addCue",value:function(me){this.all.addCue(me)}},{key:"removeCue",value:function(me){this.all.removeCue(me)}},{key:"addEventListener",value:function(me,H){this.listeners.push(H)}},{key:"removeEventListener",value:function(me,H){var B=this.listeners.findIndex(function(g){return g===H});B<0||this.listeners.splice(B,1)}},{key:"dispatchEvent",value:function(me){var H=this;return me.type!=="cuechange"||this.listeners.forEach(function(B){return B.call(H,me)}),!0}},{key:"activeCues",get:function(){var me,H=this,B=Se(it,function(g){if(Array.isArray(g))return O(g)}(me=this.all.filter(function(g){return g.startTime<=H.media.currentTime&&H.media.currentTime<=g.endTime}))||function(g){if(typeof Symbol<"u"&&Symbol.iterator in Object(g))return Array.from(g)}(me)||function(g,U){if(g){if(typeof g=="string")return O(g,U);var ee=Object.prototype.toString.call(g).slice(8,-1);return ee==="Object"&&g.constructor&&(ee=g.constructor.name),ee==="Map"||ee==="Set"?Array.from(g):ee==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ee)?O(g,U):void 0}}(me)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}());return B.sort(function(g,U){return g.startTime===U.startTime?-(g.endTime-U.endTime):g.startTime-U.startTime}),this.active=B,this.active}}]),ce}();function rt(ce,me){for(var H=0;H<me.length;H++){var B=me[H];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(ce,B.key,B)}}var tt=function(){function ce(H,B){(function(g,U){if(!(g instanceof U))throw new TypeError("Cannot call a class as a function")})(this,ce),this.id="",this.pauseOnExit=!1,this.onenter=null,this.onexit=null,this.track=null,this.startTime=H,this.endTime=B}var me;return(me=[{key:"addEventListener",value:function(H,B,g){}},{key:"removeEventListener",value:function(H,B,g){}},{key:"dispatchEvent",value:function(H){return!1}}])&&rt(ce.prototype,me),ce}();function xe(ce,me,H){for(var B=0,g=me;g<H;g++)B<<=7,B|=127&ce[g];return B}function ht(ce,me,H){for(var B="",g=me;g<H;g++)B+="%".concat(ce[g].toString(16).padStart(2,"0"));return B}function _t(ce,me,H){if(window.TextDecoder){var B=new TextDecoder("utf-8"),g=new Uint8Array(Array.prototype.slice.call(ce,me,H));return B.decode(g)}return window.decodeURIComponent(ht(ce,me,H))}function et(ce,me,H){if(window.TextDecoder){var B=new TextDecoder("iso-8859-1"),g=new Uint8Array(Array.prototype.slice.call(ce,me,H));return B.decode(g)}return window.unescape(ht(ce,me,H))}function Ve(ce){for(var me=window.atob(ce),H=new Uint8Array(me.length),B=0;B<me.length;B++)H[B]=me.charCodeAt(B);return H}function fe(ce,me){var H=Object.keys(ce);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ce);me&&(B=B.filter(function(g){return Object.getOwnPropertyDescriptor(ce,g).enumerable})),H.push.apply(H,B)}return H}function be(ce){for(var me=1;me<arguments.length;me++){var H=arguments[me]!=null?arguments[me]:{};me%2?fe(Object(H),!0).forEach(function(B){Ue(ce,B,H[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ce,Object.getOwnPropertyDescriptors(H)):fe(Object(H)).forEach(function(B){Object.defineProperty(ce,B,Object.getOwnPropertyDescriptor(H,B))})}return ce}function Ue(ce,me,H){return me in ce?Object.defineProperty(ce,me,{value:H,enumerable:!0,configurable:!0,writable:!0}):ce[me]=H,ce}function ge(ce,me){for(var H=0;H<me.length;H++){var B=me[H];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(ce,B.key,B)}}var Je=function(){function ce(H){var B,g,U,ee,J;(function(pe,le){if(!(pe instanceof le))throw new TypeError("Cannot call a class as a function")})(this,ce),this.media=null,this.id3Track=null,this.b24Track=null,this.subtitleElement=null,this.viewCanvas=null,this.rawCanvas=null,this.textContent=null,this.resizeObserver=null,this.mutationObserver=null,this.prevCurrentTime=null,this.highResTimeupdatePollingId=null,this.isShowing=!0,this.isOnSeeking=!1,this.onB24CueChangeDrawed=!1,this.onID3AddtrackHandler=this.onID3Addtrack.bind(this),this.onID3CueChangeHandler=this.onID3CueChange.bind(this),this.onB24CueChangeHandler=this.onB24CueChange.bind(this),this.onHighResTimeupdateHandler=this.onHighResTimeupdate.bind(this),this.onTimeupdateHandler=this.onTimeupdate.bind(this),this.onCanplayHandler=this.onCanplay.bind(this),this.onPlayHandler=this.onPlay.bind(this),this.onPauseHandler=this.onPause.bind(this),this.onSeekingHandler=this.onSeeking.bind(this),this.onSeekedHandler=this.onSeeked.bind(this),this.onResizeHandler=this.onResize.bind(this),this.data_identifier=(B=H==null?void 0:H.data_identifier)!==null&&B!==void 0?B:128,this.data_group_id=(g=H==null?void 0:H.data_group_id)!==null&&g!==void 0?g:1,this.rendererOption=be(be({},H),{},{data_identifier:this.data_identifier,data_group_id:this.data_group_id,keepAspectRatio:(U=H==null?void 0:H.keepAspectRatio)===null||U===void 0||U,enableAutoInBandMetadataTextTrackDetection:(ee=H==null?void 0:H.enableAutoInBandMetadataTextTrackDetection)===null||ee===void 0||ee,useStroke:(J=H==null?void 0:H.useStroke)===null||J===void 0||J})}var me;return(me=[{key:"attachMedia",value:function(H,B){var g;this.detachMedia(),this.media=H,this.subtitleElement=B??H.parentElement,this.media.addEventListener("canplay",this.onCanplayHandler),(g=this.rendererOption)!==null&&g!==void 0&&g.useHighResTimeupdate?(this.media.addEventListener("play",this.onPlayHandler),this.media.addEventListener("pause",this.onPauseHandler)):this.media.addEventListener("timeupdate",this.onTimeupdateHandler),this.prevCurrentTime=null,this.setupTrack(),this.setupCanvas()}},{key:"detachMedia",value:function(){var H,B,g,U;this.cleanupCanvas(),this.cleanupTrack(),(H=this.media)===null||H===void 0||H.removeEventListener("canplay",this.onCanplayHandler),(B=this.media)===null||B===void 0||B.removeEventListener("play",this.onPlayHandler),(g=this.media)===null||g===void 0||g.removeEventListener("pause",this.onPauseHandler),this.onPause(),(U=this.media)===null||U===void 0||U.removeEventListener("timeupdate",this.onTimeupdateHandler),this.prevCurrentTime=null,this.media=this.subtitleElement=null}},{key:"dispose",value:function(){this.detachMedia()}},{key:"getViewCanvas",value:function(){return this.viewCanvas}},{key:"getRawCanvas",value:function(){return this.rawCanvas}},{key:"getTextContent",value:function(){return this.textContent}},{key:"refresh",value:function(){this.onResize()}},{key:"show",value:function(){this.isShowing=!0,this.onResize()}},{key:"hide",value:function(){if(this.isShowing=!1,this.viewCanvas){var H=this.viewCanvas.getContext("2d");H&&H.clearRect(0,0,this.viewCanvas.width,this.viewCanvas.height)}if(this.rawCanvas){var B=this.rawCanvas.getContext("2d");B&&B.clearRect(0,0,this.rawCanvas.width,this.rawCanvas.height)}}},{key:"isPresent",value:function(){return this.onB24CueChangeDrawed}},{key:"pushRawData",value:function(H,B){var g=new R(B,H).render(be(be({},this.rendererOption),{},{width:void 0,height:void 0}));if(g==null)return!1;var U=Number.isFinite(g.endTime)?g.endTime:Number.MAX_SAFE_INTEGER;return this.addB24Cue(H,U,B)}},{key:"pushBase64Data",value:function(H,B){var g=Ve(B);return this.pushRawData(H,g)}},{key:"pushData",value:function(H,B,g){return this.pushRawData(g,B)}},{key:"pushID3v2PRIVData",value:function(H,B,g){return B==="aribb24.js"&&this.pushRawData(H,g)}},{key:"pushID3v2TXXXData",value:function(H,B,g){return B==="aribb24.js"&&this.pushBase64Data(H,g)}},{key:"pushID3v2Data",value:function(H,B){for(var g=!1,U=0;U<B.length;){var ee=U;if(U+3>B.length)break;if(B[U+0]!==73||B[U+1]!==68||B[U+2]!==51){if(U===0){U+=5;continue}break}if((U+=6)+4>B.length)break;var J=xe(B,U+0,U+4);U+=4;var pe=ee+3+2+1+4+J;if(pe>B.length)break;for(var le=U;le<pe;){var ke=le;if(le+4>B.length)break;var Fe=et(B,le+0,le+4);if((le+=4)+4>B.length)break;var Le=xe(B,le+0,le+4);le+=6;var Be=ke+4+4+2+Le;if(Be>B.length)break;if(Fe==="PRIV"){for(var Xe=le,He=Be;B[le]!==0&&le<Be;)le++;var Ze=et(B,Xe,le),Ye=new Uint8Array(Array.prototype.slice.call(B,le+1,He));this.pushID3v2PRIVData(H,Ze,Ye)&&(g=!0)}else if(Fe==="TXXX"){var ot=B[le+0],nt=le+1;if(ot===3){for(;B[le]!==0&&le<Be;)le++;for(var Ct=le,At=le+=1;B[le]!==0&&le<Be;)le++;var vt=le,Rt=_t(B,nt,Ct),Tt=_t(B,At,vt);this.pushID3v2TXXXData(H,Rt,Tt)&&(g=!0)}else if(ot===0){for(;B[le]!==0&&le<Be;)le++;for(var Gt=le,kt=le+=1;B[le]!==0&&le<Be;)le++;var yt=le,Qe=et(B,nt,Gt),Et=et(B,kt,yt);this.pushID3v2TXXXData(H,Qe,Et)&&(g=!0)}}le=Be}(U=ee+3+2+1+4+J)+3>B.length||B[U+0]===51&&B[U+1]===68&&B[U+2]===73&&(U+=10)}return g}},{key:"setInBandMetadataTextTrack",value:function(H){var B;(B=this.id3Track)===null||B===void 0||B.removeEventListener("cuechange",this.onID3CueChangeHandler),this.id3Track=H,this.id3Track.mode="hidden",this.id3Track.addEventListener("cuechange",this.onID3CueChangeHandler)}},{key:"pushID3v2Cue",value:function(H){if(!this.id3Track)return!1;var B=H.startTime,g=H;if(this.id3Track.inBandMetadataTrackDispatchType==="15260DFFFF49443320FF49443320000F")return this.pushID3v2Data(B,new Uint8Array(g.data));if(this.id3Track.inBandMetadataTrackDispatchType==="com.apple.streaming"){if(g.value.key==="PRIV")return this.pushID3v2PRIVData(B,g.value.info,new Uint8Array(g.value.data));if(g.value.key==="TXXX")return this.pushID3v2TXXXData(B,g.value.info,g.value.data)}else if(this.id3Track.label==="id3"){if(g.value.key==="PRIV")return this.pushID3v2PRIVData(B,g.value.info,new Uint8Array(g.value.data));if(g.value.key==="TXXX")return this.pushID3v2TXXXData(B,g.value.info,g.value.data)}else if(this.id3Track.label==="Timed Metadata"){if(g.frame.key==="PRIV")return this.pushID3v2PRIVData(B,g.frame.owner,new Uint8Array(g.frame.data));if(g.frame.key==="TXXX")return this.pushID3v2TXXXData(B,g.frame.description,g.frame.data)}return!1}},{key:"onID3CueChange",value:function(){this.id3Track&&(this.isOnSeeking||this.onTimeupdate())}},{key:"addB24Cue",value:function(H,B,g){var U;if(!this.b24Track||!R.detect(g,this.rendererOption))return!1;var ee=new((U=window.VTTCue)!==null&&U!==void 0?U:window.TextTrackCue)(H,B,"");if(ee.data=g,window.VTTCue)this.b24Track.addCue(ee);else if(window.TextTrackCue){var J;if(Array.prototype.some.call((J=this.b24Track.cues)!==null&&J!==void 0?J:[],function(Fe){return Fe.startTime===H}))return!1;if(this.b24Track.cues){for(var pe=[],le=this.b24Track.cues.length-1;le>=0;le--)this.b24Track.cues[le].startTime>=H&&(pe.push(this.b24Track.cues[le]),this.b24Track.removeCue(this.b24Track.cues[le]));this.b24Track.addCue(ee);for(var ke=pe.length-1;ke>=0;ke--)this.b24Track.addCue(pe[ke])}}return!0}},{key:"onB24CueChange",value:function(){if(this.media&&this.b24Track){if(this.viewCanvas){var H=this.viewCanvas.getContext("2d");H&&H.clearRect(0,0,this.viewCanvas.width,this.viewCanvas.height)}if(this.rawCanvas){var B=this.rawCanvas.getContext("2d");B&&B.clearRect(0,0,this.rawCanvas.width,this.rawCanvas.height)}if(this.b24Track.activeCues&&this.b24Track.activeCues.length>0){var g=this.b24Track.activeCues[this.b24Track.activeCues.length-1];if(g.startTime<=this.media.currentTime&&this.media.currentTime<=g.endTime&&!this.isOnSeeking){var U=new R(g.data,g.startTime),ee=!1;if(this.isShowing&&this.viewCanvas){var J,pe,le,ke,Fe,Le,Be,Xe,He=U.render(be(be({},this.rendererOption),{},{canvas:this.viewCanvas,width:(J=(pe=this.rendererOption)===null||pe===void 0?void 0:pe.width)!==null&&J!==void 0?J:this.viewCanvas.width,height:(le=(ke=this.rendererOption)===null||ke===void 0?void 0:ke.height)!==null&&le!==void 0?le:this.viewCanvas.height}));(He==null?void 0:He.PRA)!=null&&((Be=this.rendererOption)===null||Be===void 0||(Xe=Be.PRACallback)===null||Xe===void 0||Xe.call(Be,He.PRA)),ee=(Fe=He==null?void 0:He.rendered)!==null&&Fe!==void 0&&Fe,this.textContent=(Le=He==null?void 0:He.textContent)!==null&&Le!==void 0?Le:null}this.isShowing&&this.rawCanvas&&U.render(be(be({},this.rendererOption),{},{canvas:this.rawCanvas,width:this.rawCanvas.width,height:this.rawCanvas.height,keepAspectRatio:!0})),this.onB24CueChangeDrawed=ee}else this.onB24CueChangeDrawed=!1,this.textContent=null;for(var Ze=this.b24Track.activeCues.length-2;Ze>=0;Ze--){var Ye=this.b24Track.activeCues[Ze];Ye.endTime=Math.min(Ye.endTime,g.startTime),Ye.startTime===Ye.endTime&&this.b24Track.removeCue(Ye)}}else this.onB24CueChangeDrawed=!1,this.textContent=null}else this.onB24CueChangeDrawed=!1}},{key:"onHighResTimeupdate",value:function(){this.onTimeupdate(),this.highResTimeupdatePollingId=window.requestAnimationFrame(this.onHighResTimeupdateHandler)}},{key:"onTimeupdate",value:function(){if(this.media)if(this.prevCurrentTime!=null)if(this.id3Track&&this.id3Track.cues&&this.id3Track.cues.length!==0)if(this.isOnSeeking)this.prevCurrentTime=this.media.currentTime;else if(Math.abs(this.media.currentTime-this.prevCurrentTime)>1)this.prevCurrentTime=this.media.currentTime;else{for(var H,B,g=new tt(Number.NEGATIVE_INFINITY,this.id3Track.cues[0].startTime),U=[g],ee=0;ee<this.id3Track.cues.length;ee++)U.push(this.id3Track.cues[ee]);for(var J=0,pe=U.length;J+1<pe;){var le=this.prevCurrentTime,ke=Math.floor((J+pe)/2);le<U[ke].startTime?pe=ke:J=ke}H=J;for(var Fe=0,Le=U.length;Fe+1<Le;){var Be=this.media.currentTime,Xe=Math.floor((Fe+Le)/2);Be<U[Xe].startTime?Le=Xe:Fe=Xe}if(B=Fe,H!==null&&B!==null&&H!==B){if(H<B)for(var He=B;He>H;He--){var Ze=U[He];if(Ze!==g&&this.pushID3v2Cue(Ze))break}else for(var Ye=H;Ye<B;Ye++){var ot=U[Ye];if(ot!==g&&this.pushID3v2Cue(ot))break}this.prevCurrentTime=this.media.currentTime}else this.prevCurrentTime=this.media.currentTime}else this.prevCurrentTime=this.media.currentTime;else this.prevCurrentTime=this.media.currentTime}},{key:"onCanplay",value:function(){this.id3Track&&(this.id3Track.mode="hidden"),this.b24Track&&(this.b24Track.mode="hidden"),this.media!=null&&this.prevCurrentTime==null&&(this.prevCurrentTime=this.media.currentTime-Number.MIN_VALUE)}},{key:"onPlay",value:function(){this.highResTimeupdatePollingId==null&&this.onHighResTimeupdate()}},{key:"onPause",value:function(){this.highResTimeupdatePollingId!=null&&(window.cancelAnimationFrame(this.highResTimeupdatePollingId),this.highResTimeupdatePollingId=null)}},{key:"onSeeking",value:function(){this.isOnSeeking=!0,this.onB24CueChange()}},{key:"onSeeked",value:function(){this.isOnSeeking=!1}},{key:"onResize",value:function(){if(this.media){var H=window.getComputedStyle(this.media),B=Number.parseInt(H.width)*window.devicePixelRatio,g=Number.parseInt(H.height)*window.devicePixelRatio,U=this.media.videoWidth,ee=this.media.videoHeight;if(this.viewCanvas&&(this.viewCanvas.width=Math.round(B),this.viewCanvas.height=Math.round(g)),this.rawCanvas&&(this.rawCanvas.width=U,this.rawCanvas.height=ee),this.b24Track){if(this.viewCanvas){var J=this.viewCanvas.getContext("2d");J&&J.clearRect(0,0,this.viewCanvas.width,this.viewCanvas.height)}if(this.rawCanvas){var pe=this.rawCanvas.getContext("2d");pe&&pe.clearRect(0,0,this.rawCanvas.width,this.rawCanvas.height)}if(this.onB24CueChangeDrawed&&this.b24Track.activeCues&&this.b24Track.activeCues.length>0){var le=this.b24Track.activeCues[this.b24Track.activeCues.length-1];if(le.startTime<=this.media.currentTime&&this.media.currentTime<=le.endTime&&!this.isOnSeeking){var ke,Fe,Le,Be,Xe=new R(le.data,le.startTime);this.isShowing&&this.viewCanvas&&Xe.render(be(be({},this.rendererOption),{},{canvas:this.viewCanvas,width:(ke=(Fe=this.rendererOption)===null||Fe===void 0?void 0:Fe.width)!==null&&ke!==void 0?ke:this.viewCanvas.width,height:(Le=(Be=this.rendererOption)===null||Be===void 0?void 0:Be.height)!==null&&Le!==void 0?Le:this.viewCanvas.height})),this.isShowing&&this.rawCanvas&&Xe.render(be(be({},this.rendererOption),{},{canvas:this.rawCanvas,width:this.rawCanvas.width,height:this.rawCanvas.height,keepAspectRatio:!0}))}}}}}},{key:"onID3Addtrack",value:function(H){if(this.media){var B=H.track;B.kind==="metadata"&&(B.inBandMetadataTrackDispatchType!=="15260DFFFF49443320FF49443320000F"&&B.inBandMetadataTrackDispatchType!=="com.apple.streaming"&&B.label!=="id3"||this.setInBandMetadataTextTrack(B))}}},{key:"setupTrack",value:function(){var H,B;if(this.media){if((H=this.rendererOption)!==null&&H!==void 0&&H.useHighResTextTrack)this.b24Track=new Ie(this.media),this.b24Track.startPolling();else{for(var g="ARIB B24 Japanese (data_identifier=0x".concat(this.data_identifier.toString(16),", data_group_id=").concat(this.data_group_id,")"),U=0;U<this.media.textTracks.length;U++){var ee=this.media.textTracks[U];if(ee.label===g){this.b24Track=ee;break}}this.b24Track||(this.b24Track=this.media.addTextTrack("metadata",g,"ja"),this.b24Track.mode="hidden")}if(this.b24Track.addEventListener("cuechange",this.onB24CueChangeHandler),(B=this.rendererOption)!==null&&B!==void 0&&B.enableAutoInBandMetadataTextTrackDetection){for(var J=0;J<this.media.textTracks.length;J++){var pe=this.media.textTracks[J];if(pe.kind==="metadata"&&(pe.inBandMetadataTrackDispatchType==="15260DFFFF49443320FF49443320000F"||pe.inBandMetadataTrackDispatchType==="com.apple.streaming"||pe.label==="id3")){this.setInBandMetadataTextTrack(pe);break}}this.media.textTracks.addEventListener("addtrack",this.onID3AddtrackHandler)}this.media.addEventListener("seeking",this.onSeekingHandler),this.media.addEventListener("seeked",this.onSeekedHandler)}}},{key:"setupCanvas",value:function(){var H,B=this;this.media&&this.subtitleElement&&(this.viewCanvas=document.createElement("canvas"),this.viewCanvas.style.position="absolute",this.viewCanvas.style.top=this.viewCanvas.style.left="0",this.viewCanvas.style.pointerEvents="none",this.viewCanvas.style.width="100%",this.viewCanvas.style.height="100%",(H=this.rendererOption)!==null&&H!==void 0&&H.enableRawCanvas&&(this.rawCanvas=document.createElement("canvas")),this.onResize(),this.subtitleElement.appendChild(this.viewCanvas),this.media.addEventListener("resize",this.onResizeHandler),window.ResizeObserver?(this.resizeObserver=new ResizeObserver(function(){B.onResize()}),this.resizeObserver.observe(this.media)):(window.addEventListener("resize",this.onResizeHandler),window.MutationObserver&&(this.mutationObserver=new MutationObserver(function(){B.onResize()}),this.mutationObserver.observe(this.media,{attributes:!0,attributeFilter:["class","style"]}))))}},{key:"cleanupTrack",value:function(){var H,B,g,U,ee,J;if(this.b24Track){if((J=this.rendererOption)!==null&&J!==void 0&&J.useHighResTextTrack)this.b24Track.stopPolling();else if(this.b24Track.cues)for(var pe=this.b24Track.cues.length-1;pe>=0;pe--)this.b24Track.removeCue(this.b24Track.cues[pe])}(H=this.b24Track)===null||H===void 0||H.removeEventListener("cuechange",this.onB24CueChangeHandler),(B=this.id3Track)===null||B===void 0||B.removeEventListener("cuechange",this.onID3CueChangeHandler),(g=this.media)===null||g===void 0||g.removeEventListener("seeking",this.onSeekingHandler),(U=this.media)===null||U===void 0||U.removeEventListener("seeked",this.onSeekedHandler),(ee=this.media)===null||ee===void 0||ee.textTracks.removeEventListener("addtrack",this.onID3AddtrackHandler),this.b24Track=this.id3Track=null}},{key:"cleanupCanvas",value:function(){var H;window.removeEventListener("resize",this.onResizeHandler),(H=this.media)===null||H===void 0||H.removeEventListener("resize",this.onResizeHandler),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.viewCanvas&&this.subtitleElement&&this.subtitleElement.removeChild(this.viewCanvas),this.viewCanvas&&(this.viewCanvas.width=this.viewCanvas.height=0),this.rawCanvas&&(this.rawCanvas.width=this.rawCanvas.height=0),this.viewCanvas=this.rawCanvas=null}}])&&ge(ce.prototype,me),ce}();function ut(ce,me,H){for(var B=-1,g=me;g<H;g++){B^=ce[g];for(var U=0;U<8;U++)1&B?B=B>>>1^3988292384:B>>>=1}return~B}function st(ce){return function(me){if(Array.isArray(me))return gt(me)}(ce)||function(me){if(typeof Symbol<"u"&&Symbol.iterator in Object(me))return Array.from(me)}(ce)||We(ce)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function We(ce,me){if(ce){if(typeof ce=="string")return gt(ce,me);var H=Object.prototype.toString.call(ce).slice(8,-1);return H==="Object"&&ce.constructor&&(H=ce.constructor.name),H==="Map"||H==="Set"?Array.from(ce):H==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(H)?gt(ce,me):void 0}}function gt(ce,me){(me==null||me>ce.length)&&(me=ce.length);for(var H=0,B=new Array(me);H<me;H++)B[H]=ce[H];return B}function X(ce,me){for(var H=0;H<me.length;H++){var B=me[H];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(ce,B.key,B)}}var re=null,K=function(){function ce(g,U){(function(ee,J){if(!(ee instanceof J))throw new TypeError("Cannot call a class as a function")})(this,ce),this.text="",this.svg=null,this.groups=new Map,this.GL=0,this.GR=2,this.G_BACK=[f.get(0),f.get(1),f.get(2),m.get(31)],this.DRCS_mapping=new Map([[15,new Map],[16,new Map],[17,new Map],[18,new Map],[19,new Map],[20,new Map],[21,new Map],[22,new Map],[23,new Map],[24,new Map],[25,new Map],[26,new Map],[27,new Map],[28,new Map],[29,new Map],[30,new Map]]),this.swf_x=1920,this.swf_y=1080,this.sdf_x=1920,this.sdf_y=1080,this.sdp_x=0,this.sdp_y=0,this.ssm_x=72,this.ssm_y=72,this.shs=8,this.svs=48,this.text_size_x=1,this.text_size_y=1,this.text_type="NSZ",this.position_x=-1,this.position_y=-1,this.pallet=0,this.fg_color=_[this.pallet][7],this.bg_color=_[this.pallet][8],this.force_bg_color=null,this.hlc=0,this.prev_hlc=0,this.stl=!1,this.orn=null,this.force_orn=null,this.flc=15,this.non_spacing="",this.timeElapsed=0,this.endTime=null,this.rendered=!1,this.PRA=null,this.normalFont="monospace",this.gaijiFont=this.normalFont,this.drcsReplacement=!1,this.drcsReplaceMapping=new Map,this.usePUA=!1,this.pes=g,this.startTime=U}var me,H,B;return me=ce,B=[{key:"setEmbeddedGlyph",value:function(g){re=g}},{key:"detect",value:function(g,U){var ee,J,pe=(ee=U==null?void 0:U.data_identifier)!==null&&ee!==void 0?ee:128,le=(J=U==null?void 0:U.data_group_id)!==null&&J!==void 0?J:1;if(g.length<=0||g[0]!==pe||g.length<=2)return!1;var ke=3+(15&g[2]);return!(g.length<=ke||(15&(252&g[ke+0])>>2)!==le||(F(g,ke),0))}},{key:"getRGBAColorCode",value:function(g){if(g==null)return null;var U=document.createElement("canvas");U.width=U.height=1;var ee=U.getContext("2d");if(!ee)return null;ee.fillStyle=g,ee.fillRect(0,0,U.width,U.height);var J,pe,le=(pe=4,function(He){if(Array.isArray(He))return He}(J=ee.getImageData(0,0,1,1).data)||function(He,Ze){if(typeof Symbol<"u"&&Symbol.iterator in Object(He)){var Ye=[],ot=!0,nt=!1,Ct=void 0;try{for(var At,vt=He[Symbol.iterator]();!(ot=(At=vt.next()).done)&&(Ye.push(At.value),!Ze||Ye.length!==Ze);ot=!0);}catch(Rt){nt=!0,Ct=Rt}finally{try{ot||vt.return==null||vt.return()}finally{if(nt)throw Ct}}return Ye}}(J,pe)||We(J,pe)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()),ke=le[0],Fe=le[1],Le=le[2],Be=le[3],Xe="#".concat(ke.toString(16).toUpperCase().padStart(2,"0")).concat(Fe.toString(16).toUpperCase().padStart(2,"0")).concat(Le.toString(16).toUpperCase().padStart(2,"0")).concat(Be.toString(16).toUpperCase().padStart(2,"0"));return U.width=U.height=0,Xe}},{key:"fillAlphaColorCode",value:function(g){if(g==null)return"";var U=Number.parseInt(g.substring(1,3),16),ee=Number.parseInt(g.substring(3,5),16),J=Number.parseInt(g.substring(5,7),16);return"#".concat(U.toString(16).toUpperCase().padStart(2,"0")).concat(ee.toString(16).toUpperCase().padStart(2,"0")).concat(J.toString(16).toUpperCase().padStart(2,"0"),"FF")}},{key:"getRGBAfromColorCode",value:function(g){if(g==null)return"";var U=Number.parseInt(g.substring(1,3),16),ee=Number.parseInt(g.substring(3,5),16),J=Number.parseInt(g.substring(5,7),16),pe=Number.parseInt(g.substring(7,9),16);return"rgba(".concat(U,", ").concat(ee,", ").concat(J,", ").concat(pe/255,")")}},{key:"getRGBfromColorCode",value:function(g){if(g==null)return"";var U=Number.parseInt(g.substring(1,3),16),ee=Number.parseInt(g.substring(3,5),16),J=Number.parseInt(g.substring(5,7),16);return"rgb(".concat(U,", ").concat(ee,", ").concat(J,")")}},{key:"getAlphaFromColorCode",value:function(g){return g==null?Number.NaN:Number.parseInt(g.substring(7,9),16)}}],(H=[{key:"width",value:function(){return Math.floor((this.shs+this.ssm_x)*this.text_size_x)}},{key:"height",value:function(){return Math.floor((this.svs+this.ssm_y)*this.text_size_y)}},{key:"move_absolute_dot",value:function(g,U){this.position_x=g,this.position_y=U}},{key:"move_absolute_pos",value:function(g,U){this.position_x=this.sdp_x+g*this.width(),this.position_y=this.sdp_y+(U+1)*this.height()}},{key:"move_relative_pos",value:function(g,U){for((this.position_x<0||this.position_y<0)&&this.move_absolute_dot(this.sdp_x,this.sdp_y+(this.ssm_y+this.svs));g<0;)this.position_x-=this.width(),g++,this.position_x<this.sdp_x&&(this.position_x=this.sdp_x+this.sdf_x-this.width(),U--);for(;g>0;)this.position_x+=this.width(),g--,this.position_x>=this.sdp_x+this.sdf_x&&(this.position_x=this.sdp_x,U++);for(;U<0;)this.position_y-=this.height(),U++;for(;U>0;)this.position_y+=this.height(),U--}},{key:"move_newline",value:function(){(this.position_x<0||this.position_y<0)&&this.move_absolute_dot(this.sdp_x,this.sdp_y+(this.ssm_y+this.svs)),this.position_x=this.sdp_x,this.position_y=this.position_y+this.height()}},{key:"render",value:function(g){var U,ee,J,pe,le,ke,Fe,Le;this.svg=(U=g==null?void 0:g.svg)!==null&&U!==void 0?U:null,this.force_orn=(ee=typeof(g==null?void 0:g.forceStrokeColor)=="boolean"?g==null?void 0:g.forceStrokeColor:ce.getRGBAColorCode(g==null?void 0:g.forceStrokeColor))!==null&&ee!==void 0?ee:null,this.force_bg_color=(J=ce.getRGBAColorCode(g==null?void 0:g.forceBackgroundColor))!==null&&J!==void 0?J:null,this.normalFont=(pe=g==null?void 0:g.normalFont)!==null&&pe!==void 0?pe:this.normalFont,this.gaijiFont=(le=g==null?void 0:g.gaijiFont)!==null&&le!==void 0?le:this.normalFont,this.drcsReplacement=(ke=g==null?void 0:g.drcsReplacement)!==null&&ke!==void 0&&ke,this.drcsReplaceMapping=new Map(T);for(var Be,Xe=Object.entries((Be=g==null?void 0:g.drcsReplaceMapping)!==null&&Be!==void 0?Be:{}),He=0;He<Xe.length;He++){var Ze=Xe[He];this.drcsReplaceMapping.set(Ze[0],Ze[1])}if(this.usePUA=(Fe=g==null?void 0:g.usePUA)!==null&&Fe!==void 0&&Fe,!ce.detect(this.pes,g))return null;if(this.svg)for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);for(var Ye=3+(15&this.pes[2]),ot=(this.pes[Ye+0],(this.pes[Ye+3]<<8)+this.pes[Ye+4]),nt=Ye+9;nt<Ye+(5+ot);){this.pes[nt+0];var Ct=this.pes[nt+1],At=this.pes[nt+2]<<16|this.pes[nt+3]<<8|this.pes[nt+4];Ct===32?this.parseText(nt+5,nt+5+At):Ct==48?this.parseDRCS(1,nt+5,nt+5+At):Ct==49?this.parseDRCS(2,nt+5,nt+5+At):Ct==53&&this.parseBitmap(nt+5,nt+5+At),nt+=5+At}return{startTime:this.startTime,endTime:(Le=this.endTime)!==null&&Le!==void 0?Le:Number.POSITIVE_INFINITY,rendered:this.rendered,textContent:this.rendered?this.text:null,PRA:this.PRA}}},{key:"parseText",value:function(g,U){for(;g<U;)if(32<this.pes[g]&&this.pes[g]<127){var ee=0,J=this.G_BACK[this.GL];if(!J)return;for(var pe=0;pe<J.bytes;pe++)ee<<=8,ee|=127&this.pes[g+pe];this.renderCharacter(ee,J),g+=J.bytes}else if(160<this.pes[g]&&this.pes[g]<255){var le=0,ke=this.G_BACK[this.GR];if(!ke)return;for(var Fe=0;Fe<ke.bytes;Fe++)le<<=8,le|=127&this.pes[g+Fe];this.renderCharacter(le,ke),g+=ke.bytes}else if(this.pes[g]===0)g+=1;else if(this.pes[g]===7)g+=1;else if(this.pes[g]===8)this.move_relative_pos(-1,0),g+=1;else if(this.pes[g]===9)this.move_relative_pos(1,0),g+=1;else if(this.pes[g]===10)this.move_relative_pos(0,1),g+=1;else if(this.pes[g]===11)this.move_relative_pos(0,-1),g+=1;else if(this.pes[g]===12)this.startTime!=null&&this.timeElapsed>0&&(this.endTime=this.startTime+this.timeElapsed),g+=1;else if(this.pes[g]===13)this.move_newline(),g+=1;else if(this.pes[g]===14)this.GL=1,g+=1;else if(this.pes[g]===15)this.GL=0,g+=1;else if(this.pes[g]===22){var Le=63&this.pes[g+1];this.move_relative_pos(Le,0),g+=2}else if(this.pes[g]===24)g+=1;else if(this.pes[g]===25){var Be=0,Xe=this.G_BACK[2];if(!Xe)return;for(var He=0;He<Xe.bytes;He++)Be<<=8,Be|=127&this.pes[g+1+He];this.renderCharacter(Be,Xe),g+=1+Xe.bytes}else if(this.pes[g]===27)if(this.pes[g+1]===110)this.GL=2,g+=2;else if(this.pes[g+1]==111)this.GL=3,g+=2;else if(this.pes[g+1]==126)this.GR=1,g+=2;else if(this.pes[g+1]==125)this.GR=2,g+=2;else if(this.pes[g+1]==124)this.GR=3,g+=2;else if(40<=this.pes[g+1]&&this.pes[g+1]<=43){var Ze=this.pes[g+1]-40;this.pes[g+2]===32?(this.G_BACK[Ze]=y.get(this.pes[g+3]),g+=4):(this.G_BACK[Ze]=p.get(this.pes[g+2]),g+=3)}else{if(this.pes[g+1]!==36)return;if(40<=this.pes[g+2]&&this.pes[g+2]<=43){var Ye=this.pes[g+2]-40;this.pes[g+3]===32?(this.G_BACK[Ye]=y.get(this.pes[g+4]),g+=5):(this.G_BACK[Ye]=p.get(this.pes[g+3]),g+=4)}else this.G_BACK[0]=p.get(this.pes[g+2]),g+=3}else if(this.pes[g]===28){var ot=63&this.pes[g+1],nt=63&this.pes[g+2];this.move_absolute_pos(nt,ot),g+=3}else if(this.pes[g]===29){var Ct=0,At=this.G_BACK[3];if(!At)return;for(var vt=0;vt<At.bytes;vt++)Ct<<=8,Ct|=127&this.pes[g+1+vt];this.renderCharacter(Ct,At),g+=1+At.bytes}else if(this.pes[g]===30)g+=1;else if(this.pes[g]===31)g+=1;else if(this.pes[g]===32){var Rt=f.get(0);if(!Rt)return;this.renderCharacter(8481,Rt),g+=1}else if(this.pes[g]===127)g+=1;else if(this.pes[g]===128)this.fg_color=_[this.pallet][0],g+=1;else if(this.pes[g]===129)this.fg_color=_[this.pallet][1],g+=1;else if(this.pes[g]===130)this.fg_color=_[this.pallet][2],g+=1;else if(this.pes[g]===131)this.fg_color=_[this.pallet][3],g+=1;else if(this.pes[g]===132)this.fg_color=_[this.pallet][4],g+=1;else if(this.pes[g]===133)this.fg_color=_[this.pallet][5],g+=1;else if(this.pes[g]===134)this.fg_color=_[this.pallet][6],g+=1;else if(this.pes[g]===135)this.fg_color=_[this.pallet][7],g+=1;else if(this.pes[g]===136)this.text_size_x=.5,this.text_size_y=.5,this.text_type="SSZ",g+=1;else if(this.pes[g]===137)this.text_size_x=.5,this.text_size_y=1,this.text_type="MSZ",g+=1;else if(this.pes[g]===138)this.text_size_x=1,this.text_size_y=1,this.text_type="NSZ",g+=1;else{if(this.pes[g]===139)return;if(this.pes[g]===144){var Tt=this.pes[g+1];if(Tt==32){var Gt=15&this.pes[g+2];this.pallet=Gt,g+=3}else{var kt=15&Tt;(112&Tt)==64?this.fg_color=_[this.pallet][kt]:(112&Tt)==80&&(this.bg_color=_[this.pallet][kt]),g+=2}}else if(this.pes[g]===145){var yt=15&this.pes[g+1];this.flc=yt,g+=2}else{if(this.pes[g]===146||this.pes[g]===147||this.pes[g]===148||this.pes[g]===149)return;if(this.pes[g]===151)this.prev_hlc=this.hlc,this.hlc=15&this.pes[g+1],g+=2;else{if(this.pes[g]===152)return;if(this.pes[g]===153)this.stl=!1,g+=1;else if(this.pes[g]===154)this.stl=!0,g+=1;else if(this.pes[g]===155){for(var Qe=g,Et=-1,Ut=-1;Qe+1<U;)if(Qe+=1,this.pes[Qe]===32)Et<0&&(Et=Qe);else if(this.pes[Qe]===59)Et<0&&Ut<0&&(Ut=Qe);else{if(this.pes[Qe]===66)break;if(this.pes[Qe]===83){var $t=g+1,Bt=0;if(Ut>=0||Et<0)return;for(;$t<Et;)Bt*=10,Bt+=15&this.pes[$t],$t++;if(Bt===5)this.swf_x=3840,this.swf_y=2160;else if(Bt===7)this.swf_x=1920,this.swf_y=1080;else{if(Bt!=9)return;this.swf_x=1440,this.swf_y=960}break}if(this.pes[Qe]===84)break;if(this.pes[Qe]===86){for(var Mt=g+1,Ht=0,Qt=0;Mt<Ut;)Ht*=10,Ht+=15&this.pes[Mt],Mt++;for(Mt++;Mt<Et;)Qt*=10,Qt+=15&this.pes[Mt],Mt++;this.sdf_x=2*Ht,this.sdf_y=2*Qt;break}if(this.pes[Qe]===87){for(var qt=g+1,rn=0,dn=0;qt<Ut;)rn*=10,rn+=15&this.pes[qt],qt++;for(qt++;qt<Et;)dn*=10,dn+=15&this.pes[qt],qt++;this.ssm_x=2*rn,this.ssm_y=2*dn;break}if(this.pes[Qe]===88){for(var vn=g+1,En=0;vn<Et;)En*=10,En+=15&this.pes[vn],vn++;this.shs=2*En;break}if(this.pes[Qe]===89){for(var cn=g+1,sn=0;cn<Et;)sn*=10,sn+=15&this.pes[cn],cn++;this.svs=2*sn;break}if(this.pes[Qe]===91||this.pes[Qe]===92||this.pes[Qe]===93||this.pes[Qe]===94)break;if(this.pes[Qe]===95){for(var un=g+1,mn=0,hn=0;un<Ut;)mn*=10,mn+=15&this.pes[un],un++;for(un++;un<Et;)hn*=10,hn+=15&this.pes[un],un++;this.sdp_x=2*mn,this.sdp_y=2*hn;break}if(this.pes[Qe]===97){for(var bn=g+1,fn=0,gn=0;bn<Ut;)fn*=10,fn+=15&this.pes[bn],bn++;for(bn++;bn<Et;)gn*=10,gn+=15&this.pes[bn],bn++;this.move_absolute_dot(2*fn,2*gn);break}if(this.pes[Qe]===98)break;if(this.pes[Qe]===99){var Zt=this.pes[g+1];if(Zt==48)this.orn=null;else if(Zt==49){var Nn=10*(15&this.pes[g+3])+(15&this.pes[g+4]),Xt=10*(15&this.pes[g+5])+(15&this.pes[g+6]);this.orn=_[Nn][Xt]}break}if(this.pes[Qe]===100||this.pes[Qe]===101||this.pes[Qe]===102||this.pes[Qe]===103)break;if(this.pes[Qe]===104){for(var Un=g+1,ni=0;Un<Et;)ni*=10,ni+=15&this.pes[Un],Un++;this.PRA=ni;break}if(this.pes[Qe]===105||this.pes[Qe]===106||this.pes[Qe]===110||this.pes[Qe]===111)break}g=Qe+1}else{if(this.pes[g]!==157)return;if(this.pes[g+1]!=32)return void this.pes[g+1];var cr=63&this.pes[g+2];this.timeElapsed+=cr/10,g+=3}}}}}},{key:"parseDRCS",value:function(g,U,ee){for(this.pes[U+0],U+=1;U<ee;){var J=this.pes[U+0]<<8|this.pes[U+1],pe=this.pes[U+2];U+=3;for(var le=0;le<pe;le++){this.pes[U+0];var ke=15&this.pes[U+0];if(ke===0||ke===1){var Fe=this.pes[U+1]+2,Le=this.pes[U+2],Be=this.pes[U+3],Xe=Fe.toString(2).length-Fe.toString(2).replace(/0*$/,"").length,He=Math.floor(Le*Be*Xe/8),Ze=new Uint8Array(Array.prototype.slice.call(this.pes,U+4,U+4+He));if(g===1){var Ye,ot,nt=64+((3840&J)>>8),Ct=127&J,At=(Ye=y.get(nt))===null||Ye===void 0?void 0:Ye.alphabet;At&&((ot=this.DRCS_mapping.get(At))===null||ot===void 0||ot.set(Ct,Ze))}else{var vt,Rt=32639&J;(vt=this.DRCS_mapping.get(15))===null||vt===void 0||vt.set(Rt,Ze)}U+=4+He}}}}},{key:"renderCharacter",value:function(g,U){if((this.position_x<0||this.position_y<0)&&this.move_absolute_dot(this.sdp_x,this.sdp_y+(this.ssm_y+this.svs)),this.svg!==null){if(U.alphabet===0){var ee=((65280&g)>>8)-33,J=(255&g)-33;if(ee===0&&12<=J&&J<=17)return void(this.non_spacing=["́","　","̈","̂","̅","̲"][J-12]);if(ee===1&&J===93)return void(this.non_spacing+="⃝")}if(U.alphabet!==31){this.rendered||this.svg.setAttribute("viewBox","0 0 ".concat(this.swf_x," ").concat(this.swf_y)),this.rendered=!0;var pe=this.force_bg_color||this.bg_color,le=ce.getAlphaFromColorCode(pe);if(!this.groups.has(le)){var ke=document.createElementNS("http://www.w3.org/2000/svg","g");ke.setAttribute("opacity","".concat(le/255)),this.groups.set(le,ke),this.svg.appendChild(ke)}var Fe=this.groups.get(le),Le=document.createElementNS("http://www.w3.org/2000/svg","rect");if(Le.setAttribute("shape-rendering","crispEdges"),Le.setAttribute("x","".concat(this.position_x)),Le.setAttribute("y","".concat(this.position_y-this.height())),Le.setAttribute("width","".concat(this.width()+1)),Le.setAttribute("height","".concat(this.height()+1)),Le.setAttribute("fill","".concat(ce.getRGBfromColorCode(pe))),Fe.appendChild(Le),1&this.hlc){var Be=document.createElementNS("http://www.w3.org/2000/svg","line");Be.setAttribute("shape-rendering","crispEdges"),Be.setAttribute("x1","".concat(this.position_x)),Be.setAttribute("y1","".concat(this.position_y-1)),Be.setAttribute("x2","".concat(this.position_x+this.width())),Be.setAttribute("y2","".concat(this.position_y-1)),Be.setAttribute("stroke","".concat(ce.getRGBAfromColorCode(this.fg_color))),Be.setAttribute("stroke-width","".concat(2)),this.svg.appendChild(Be)}if(2&this.hlc){var Xe=document.createElementNS("http://www.w3.org/2000/svg","line");Xe.setAttribute("shape-rendering","crispEdges"),Xe.setAttribute("x1","".concat(this.position_x+this.width()-1)),Xe.setAttribute("y1","".concat(this.position_y-this.height())),Xe.setAttribute("x2","".concat(this.position_x+this.width()-1)),Xe.setAttribute("y2","".concat(this.position_y)),Xe.setAttribute("stroke","".concat(ce.getRGBAfromColorCode(this.fg_color))),Xe.setAttribute("stroke-width","".concat(2)),this.svg.appendChild(Xe)}if(4&this.hlc){var He=document.createElementNS("http://www.w3.org/2000/svg","line");He.setAttribute("shape-rendering","crispEdges"),He.setAttribute("x1","".concat(this.position_x)),He.setAttribute("y1","".concat(this.position_y-this.height()+1)),He.setAttribute("x2","".concat(this.position_x+this.width())),He.setAttribute("y2","".concat(this.position_y-this.height()+1)),He.setAttribute("stroke","".concat(ce.getRGBAfromColorCode(this.fg_color))),He.setAttribute("stroke-width","".concat(2)),this.svg.appendChild(He)}if(8&this.hlc){var Ze=document.createElementNS("http://www.w3.org/2000/svg","line");Ze.setAttribute("shape-rendering","crispEdges"),Ze.setAttribute("x1","".concat(this.position_x+1)),Ze.setAttribute("y1","".concat(this.position_y-this.height())),Ze.setAttribute("x2","".concat(this.position_x+1)),Ze.setAttribute("y2","".concat(this.position_y)),Ze.setAttribute("stroke","".concat(ce.getRGBAfromColorCode(this.fg_color))),Ze.setAttribute("stroke-width","".concat(2)),this.svg.appendChild(Ze)}if(this.stl){var Ye=document.createElementNS("http://www.w3.org/2000/svg","line");Ye.setAttribute("shape-rendering","crispEdges"),Ye.setAttribute("x1","".concat(this.position_x)),Ye.setAttribute("y1","".concat(this.position_y-1)),Ye.setAttribute("x2","".concat(this.position_x+this.width())),Ye.setAttribute("y2","".concat(this.position_y-1)),Ye.setAttribute("stroke","".concat(ce.getRGBAfromColorCode(this.fg_color))),Ye.setAttribute("stroke-width","".concat(2)),this.svg.appendChild(Ye)}}if(U.alphabet===0){var ot=94*(((65280&g)>>8)-33)+((255&g)-33),nt=7896;if(ot<nt){var Ct=S[ot];this.renderFont(Ct)}else if(this.usePUA){var At=b[ot-nt];this.renderFont(At)}else{var vt=x[ot-nt];this.renderFont(vt)}this.move_relative_pos(1,0)}else if(U.alphabet===1){var Rt=L[g-33];this.renderFont(Rt),this.move_relative_pos(1,0)}else if(U.alphabet===2){var Tt=N[g-33];this.renderFont(Tt),this.move_relative_pos(1,0)}else if(U.alphabet===3){var Gt=P[g-33];this.renderFont(Gt),this.move_relative_pos(1,0)}else{if(U.alphabet===31)return void(g===96?(this.G_BACK=[f.get(0),f.get(1),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===97?(this.G_BACK=[f.get(0),f.get(3),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===98?(this.G_BACK=[f.get(0),m.get(16),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===99?(this.G_BACK=[f.get(4),f.get(6),f.get(7),m.get(31)],this.GL=0,this.GR=2):g===100?(this.G_BACK=[f.get(4),f.get(5),f.get(7),m.get(31)],this.GL=0,this.GR=2):g===101?(this.G_BACK=[f.get(4),m.get(16),f.get(7),m.get(31)],this.GL=0,this.GR=2):g===102?(this.G_BACK=[m.get(16),m.get(17),m.get(18),m.get(31)],this.GL=0,this.GR=2):g===103?(this.G_BACK=[m.get(19),m.get(20),m.get(21),m.get(31)],this.GL=0,this.GR=2):g===104?(this.G_BACK=[m.get(22),m.get(23),m.get(24),m.get(31)],this.GL=0,this.GR=2):g===105?(this.G_BACK=[m.get(25),m.get(26),m.get(27),m.get(31)],this.GL=0,this.GR=2):g===106?(this.G_BACK=[m.get(28),m.get(29),m.get(30),m.get(31)],this.GL=0,this.GR=2):g===107?(this.G_BACK=[f.get(0),m.get(17),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===108?(this.G_BACK=[f.get(0),m.get(18),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===109?(this.G_BACK=[f.get(0),m.get(19),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===110?(this.G_BACK=[f.get(3),f.get(2),f.get(1),m.get(31)],this.GL=0,this.GR=2):g===111&&(this.G_BACK=[f.get(1),f.get(4),m.get(16),m.get(31)],this.GL=0,this.GR=2));var kt,yt=(kt=this.DRCS_mapping.get(U.alphabet))===null||kt===void 0?void 0:kt.get(32639&g);if(!yt)return;var Qe=de(yt.buffer);if(this.drcsReplacement&&this.drcsReplaceMapping.has(Qe.toLowerCase()))this.renderFont(this.drcsReplaceMapping.get(Qe.toLowerCase()));else if(this.drcsReplacement&&this.drcsReplaceMapping.has(Qe.toUpperCase()))this.renderFont(this.drcsReplaceMapping.get(Qe.toUpperCase()));else{var Et=document.createElement("canvas"),Ut=Math.floor(this.ssm_x*this.text_size_x/2),$t=Math.floor(this.ssm_y*this.text_size_y/2),Bt=Math.floor(8*yt.length/(Ut*$t));Et.width=2*(Ut+4),Et.height=2*($t+4);var Mt=Et.getContext("2d");if(!Mt)return;var Ht=this.getOrnColorCode();if(Ht&&(!this.force_orn||this.force_orn===!0||this.force_orn!==this.fg_color)){Mt.fillStyle=ce.getRGBAfromColorCode(Ht);for(var Qt=-2;Qt<=2;Qt++)for(var qt=-2;qt<=2;qt++)for(var rn=0;rn<$t;rn++)for(var dn=0;dn<Ut;dn++){for(var vn=0,En=0;En<Bt;En++){var cn=7-((rn*Ut+dn)*Bt+En)%8;vn*=2,vn+=(yt[Math.floor(((rn*Ut+dn)*Bt+En)/8)]&1<<cn)>>cn}vn>0&&Mt.fillRect(2*(2+dn+qt),2*(2+rn+Qt),2,2)}}Mt.fillStyle=ce.getRGBAfromColorCode(this.fg_color);for(var sn=0;sn<$t;sn++)for(var un=0;un<Ut;un++){for(var mn=0,hn=0;hn<Bt;hn++){var bn=7-((sn*Ut+un)*Bt+hn)%8;mn*=2,mn+=(yt[Math.floor(((sn*Ut+un)*Bt+hn)/8)]&1<<bn)>>bn}mn>0&&Mt.fillRect(2*(2+un),2*(2+sn),2,2)}var fn=document.createElementNS("http://www.w3.org/2000/svg","image");if(fn.setAttribute("href",Et.toDataURL()),fn.setAttribute("x","".concat(this.position_x+Math.floor(this.shs*this.text_size_x/2)-4)),fn.setAttribute("y","".concat(this.position_y+Math.floor(this.svs*this.text_size_y/2)-this.height()-4)),fn.setAttribute("width","".concat(Et.width/2*2)),fn.setAttribute("height","".concat(Et.height/2*2)),this.flc===0){var gn=document.createElementNS("http://www.w3.org/2000/svg","animate");gn.setAttribute("attributeName","opacity"),gn.setAttribute("values","1;0"),gn.setAttribute("dur","1s"),gn.setAttribute("calcMode","discrete"),gn.setAttribute("repeatCount","indefinite"),fn.appendChild(gn)}else if(this.flc===7){var Zt=document.createElementNS("http://www.w3.org/2000/svg","animate");Zt.setAttribute("attributeName","opacity"),Zt.setAttribute("values","0;1"),Zt.setAttribute("dur","1s"),Zt.setAttribute("calcMode","discrete"),Zt.setAttribute("repeatCount","indefinite"),fn.appendChild(Zt)}this.svg.appendChild(fn)}this.move_relative_pos(1,0)}}}},{key:"renderFont",value:function(g){var U,ee;g+=this.non_spacing,this.non_spacing="",this.text_size_x===.5&&this.text_size_y===.5&&(N.includes(g)||P.includes(g))||(this.text+=g);var J=k.has(g),pe=J?this.gaijiFont:this.normalFont;if(re!=null&&(U=re)!==null&&U!==void 0&&U.has(g)){var le=re.get(g),ke=le.viewBox,Fe=le.path;this.renderPath(ke,Fe)}else{J&&(g+="︎");var Le=document.createElementNS("http://www.w3.org/2000/svg","text");if(Le.setAttribute("x","0"),Le.setAttribute("y","0"),Le.setAttribute("transform","scale(".concat(this.text_size_x," ").concat(this.text_size_y,") translate(").concat((this.position_x+this.width()/2)/this.text_size_x," ").concat((this.position_y-this.height()/2)/this.text_size_y,")")),Le.setAttribute("transform-origin","0 0"),Le.setAttribute("font-size","".concat(this.ssm_x)),Le.setAttribute("font-family",pe),Le.setAttribute("dominant-baseline","central"),Le.setAttribute("text-anchor","middle"),Le.setAttribute("fill",ce.getRGBAfromColorCode(this.fg_color)),Le.setAttribute("paint-order","stroke"),Le.setAttribute("stroke-linejoin","round"),Le.setAttribute("stroke-width",this.getOrnColorCode()?"".concat(8):"0"),Le.setAttribute("stroke",this.getOrnColorCode()?ce.getRGBAfromColorCode(this.getOrnColorCode()):"transparent"),Le.appendChild(document.createTextNode(g)),this.flc===0){var Be=document.createElementNS("http://www.w3.org/2000/svg","animate");Be.setAttribute("attributeName","opacity"),Be.setAttribute("values","1;0"),Be.setAttribute("dur","1s"),Be.setAttribute("calcMode","discrete"),Be.setAttribute("repeatCount","indefinite"),Le.appendChild(Be)}else if(this.flc===7){var Xe=document.createElementNS("http://www.w3.org/2000/svg","animate");Xe.setAttribute("attributeName","opacity"),Xe.setAttribute("values","0;1"),Xe.setAttribute("dur","1s"),Xe.setAttribute("calcMode","discrete"),Xe.setAttribute("repeatCount","indefinite"),Le.appendChild(Xe)}(ee=this.svg)===null||ee===void 0||ee.appendChild(Le)}}},{key:"renderPath",value:function(g,U){var ee;document.createElementNS("http://www.w3.org/2000/svg","svg").setAttribute("viewBox","".concat(g[0]," ").concat(g[1]," ").concat(g[2]," ").concat(g[3]));var J=this.ssm_x*this.text_size_x/(g[2]-g[0]),pe=this.ssm_y*this.text_size_y/(g[3]-g[1]),le=this.shs*this.text_size_x/2,ke=this.svs*this.text_size_y/2,Fe=document.createElementNS("http://www.w3.org/2000/svg","path");if(Fe.setAttribute("d",U),Fe.setAttribute("x","0"),Fe.setAttribute("y","0"),Fe.setAttribute("transform","scale(".concat(J," ").concat(pe,") translate(").concat((this.position_x+le)/J," ").concat((this.position_y+ke-this.height())/pe,")")),Fe.setAttribute("transform-origin","0 0"),Fe.setAttribute("fill",ce.getRGBAfromColorCode(this.fg_color)),Fe.setAttribute("paint-order","stroke"),Fe.setAttribute("stroke-linejoin","round"),Fe.setAttribute("stroke-width",this.getOrnColorCode()?"".concat(4/Math.min(J,pe)):"0"),Fe.setAttribute("stroke",this.getOrnColorCode()?ce.getRGBAfromColorCode(this.getOrnColorCode()):"transparent"),this.flc===0){var Le=document.createElementNS("http://www.w3.org/2000/svg","animate");Le.setAttribute("attributeName","opacity"),Le.setAttribute("values","1;0"),Le.setAttribute("dur","1s"),Le.setAttribute("calcMode","discrete"),Le.setAttribute("repeatCount","indefinite"),Fe.appendChild(Le)}else if(this.flc===7){var Be=document.createElementNS("http://www.w3.org/2000/svg","animate");Be.setAttribute("attributeName","opacity"),Be.setAttribute("values","0;1"),Be.setAttribute("dur","1s"),Be.setAttribute("calcMode","discrete"),Be.setAttribute("repeatCount","indefinite"),Fe.appendChild(Be)}(ee=this.svg)===null||ee===void 0||ee.appendChild(Fe)}},{key:"parseBitmap",value:function(g,U){if(this.svg!==null){this.rendered||this.svg.setAttribute("viewBox","0 0 ".concat(this.swf_x," ").concat(this.swf_y)),this.rendered=!0;var ee=this.pes[g]<<8|this.pes[g+1];g+=2;var J=this.pes[g]<<8|this.pes[g+1];g+=2;var pe=this.pes[g];g+=1;var le=new Set(this.pes.subarray(g,g+pe));if(!((g+=pe)+33>U)){var ke=this.pes.subarray(g,g+33),Fe=this.pes.subarray(g+33,U),Le=new Uint8Array(ke.byteLength+Fe.byteLength+396+140),Be=new DataView(Le.buffer);Le.set(ke,0),Le.set(Fe,569);for(var Xe=0;Xe<8;Xe++)for(var He=0;He<16;He++)if(!le.has(16*Xe+He)){var Ze=_[Xe][He],Ye=Number.parseInt(Ze.substring(1,3),16),ot=Number.parseInt(Ze.substring(3,5),16),nt=Number.parseInt(Ze.substring(5,7),16),Ct=Number.parseInt(Ze.substring(7,9),16);Le[41+3*(16*Xe+He)]=Ye,Le[41+3*(16*Xe+He)+1]=ot,Le[41+3*(16*Xe+He)+2]=nt,Le[437+(16*Xe+He)]=Ct}Be.setInt32(33,384,!1),Le[37]=80,Le[38]=76,Le[39]=84,Le[40]=69,Be.setInt32(429,128,!1),Le[433]=116,Le[434]=82,Le[435]=78,Le[436]=83,Be.setInt32(425,ut(Le,37,425),!1),Be.setInt32(565,ut(Le,433,565),!1);var At=Be.getInt32(16,!1),vt=Be.getInt32(20,!1),Rt=document.createElementNS("http://www.w3.org/2000/svg","svg");Rt.setAttribute("x","".concat(this.sdp_x)),Rt.setAttribute("y","".concat(this.sdp_y)),Rt.setAttribute("width","".concat(this.sdf_x)),Rt.setAttribute("height","".concat(this.sdf_y)),Rt.setAttribute("viewBox","0 0 ".concat(this.sdf_x," ").concat(this.sdf_y));var Tt=document.createElementNS("http://www.w3.org/2000/svg","image");if(Tt.setAttribute("href","data:image/png;base64,"+window.btoa(String.fromCharCode.apply(String,st(Le)))),Tt.setAttribute("x","".concat(2*ee)),Tt.setAttribute("y","".concat(2*J)),Tt.setAttribute("width","".concat(2*At)),Tt.setAttribute("height","".concat(2*vt)),Rt.appendChild(Tt),le.size>0){for(var Gt=0;Gt<8;Gt++)for(var kt=0;kt<16;kt++)if(le.has(16*Gt+kt)){var yt=_[Gt][kt],Qe=Number.parseInt(yt.substring(1,3),16),Et=Number.parseInt(yt.substring(3,5),16),Ut=Number.parseInt(yt.substring(5,7),16),$t=Number.parseInt(yt.substring(7,9),16);Le[41+3*(16*Gt+kt)]=Qe,Le[41+3*(16*Gt+kt)+1]=Et,Le[41+3*(16*Gt+kt)+2]=Ut,Le[437+(16*Gt+kt)]=$t}else Le[437+(16*Gt+kt)]=0;Be.setInt32(425,ut(Le,37,425),!1),Be.setInt32(565,ut(Le,433,565),!1);var Bt=document.createElementNS("http://www.w3.org/2000/svg","image");Bt.setAttribute("href","data:image/png;base64,"+window.btoa(String.fromCharCode.apply(String,st(Le)))),Bt.setAttribute("x","".concat(2*ee)),Bt.setAttribute("y","".concat(2*J)),Bt.setAttribute("width","".concat(2*At)),Bt.setAttribute("height","".concat(2*vt));var Mt=document.createElementNS("http://www.w3.org/2000/svg","animate");Mt.setAttribute("attributeName","opacity"),Mt.setAttribute("values","1;0"),Mt.setAttribute("dur","1s"),Mt.setAttribute("calcMode","discrete"),Mt.setAttribute("repeatCount","indefinite"),Bt.appendChild(Mt),Rt.appendChild(Bt)}this.svg.appendChild(Rt)}}}},{key:"getOrnColorCode",value:function(){return this.force_orn===!0?ce.fillAlphaColorCode(this.bg_color):this.force_orn===!1?this.orn:(g=this.force_orn)!==null&&g!==void 0?g:this.orn;var g}}])&&X(me.prototype,H),B&&X(me,B),ce}();function j(ce,me){var H=Object.keys(ce);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ce);me&&(B=B.filter(function(g){return Object.getOwnPropertyDescriptor(ce,g).enumerable})),H.push.apply(H,B)}return H}function oe(ce){for(var me=1;me<arguments.length;me++){var H=arguments[me]!=null?arguments[me]:{};me%2?j(Object(H),!0).forEach(function(B){_e(ce,B,H[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ce,Object.getOwnPropertyDescriptors(H)):j(Object(H)).forEach(function(B){Object.defineProperty(ce,B,Object.getOwnPropertyDescriptor(H,B))})}return ce}function _e(ce,me,H){return me in ce?Object.defineProperty(ce,me,{value:H,enumerable:!0,configurable:!0,writable:!0}):ce[me]=H,ce}function ae(ce,me){for(var H=0;H<me.length;H++){var B=me[H];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(ce,B.key,B)}}var Te=function(){function ce(H){var B,g,U,ee;(function(J,pe){if(!(J instanceof pe))throw new TypeError("Cannot call a class as a function")})(this,ce),this.media=null,this.id3Track=null,this.b24Track=null,this.subtitleElement=null,this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.textContent=null,this.prevCurrentTime=null,this.highResTimeupdatePollingId=null,this.isShowing=!0,this.isOnSeeking=!1,this.onB24CueChangeDrawed=!1,this.onID3AddtrackHandler=this.onID3Addtrack.bind(this),this.onID3CueChangeHandler=this.onID3CueChange.bind(this),this.onB24CueChangeHandler=this.onB24CueChange.bind(this),this.onHighResTimeupdateHandler=this.onHighResTimeupdate.bind(this),this.onTimeupdateHandler=this.onTimeupdate.bind(this),this.onCanplayHandler=this.onCanplay.bind(this),this.onPlayHandler=this.onPlay.bind(this),this.onPauseHandler=this.onPause.bind(this),this.onPauseAnimationHandler=this.onPauseAnimation.bind(this),this.onResumeAnimationHandler=this.onResumeAnimation.bind(this),this.onSeekingHandler=this.onSeeking.bind(this),this.onSeekedHandler=this.onSeeked.bind(this),this.data_identifier=(B=H==null?void 0:H.data_identifier)!==null&&B!==void 0?B:128,this.data_group_id=(g=H==null?void 0:H.data_group_id)!==null&&g!==void 0?g:1,this.rendererOption=oe(oe({},H),{},{data_identifier:this.data_identifier,data_group_id:this.data_group_id,keepAspectRatio:(U=H==null?void 0:H.keepAspectRatio)===null||U===void 0||U,enableAutoInBandMetadataTextTrackDetection:(ee=H==null?void 0:H.enableAutoInBandMetadataTextTrackDetection)===null||ee===void 0||ee})}var me;return(me=[{key:"attachMedia",value:function(H,B){var g;this.detachMedia(),this.media=H,this.subtitleElement=B??H.parentElement,this.media.addEventListener("canplay",this.onCanplayHandler),this.media.addEventListener("play",this.onResumeAnimationHandler),this.media.addEventListener("pause",this.onPauseAnimationHandler),(g=this.rendererOption)!==null&&g!==void 0&&g.useHighResTimeupdate?(this.media.addEventListener("play",this.onPlayHandler),this.media.addEventListener("pause",this.onPauseHandler)):this.media.addEventListener("timeupdate",this.onTimeupdateHandler),this.prevCurrentTime=null,this.setupTrack(),this.setupSVG()}},{key:"detachMedia",value:function(){var H,B,g,U,ee,J;this.cleanupSVG(),this.cleanupTrack(),(H=this.media)===null||H===void 0||H.removeEventListener("canplay",this.onCanplayHandler),(B=this.media)===null||B===void 0||B.removeEventListener("play",this.onPlayHandler),(g=this.media)===null||g===void 0||g.removeEventListener("pause",this.onPauseHandler),(U=this.media)===null||U===void 0||U.removeEventListener("play",this.onResumeAnimationHandler),(ee=this.media)===null||ee===void 0||ee.removeEventListener("pause",this.onPauseAnimationHandler),this.onPause(),(J=this.media)===null||J===void 0||J.removeEventListener("timeupdate",this.onTimeupdateHandler),this.prevCurrentTime=null,this.media=this.subtitleElement=null}},{key:"dispose",value:function(){this.detachMedia()}},{key:"getSVG",value:function(){return this.svg}},{key:"getTextContent",value:function(){return this.textContent}},{key:"show",value:function(){this.isShowing=!0,this.svg.style.visibility="visible"}},{key:"hide",value:function(){this.isShowing=!1,this.svg.style.visibility="hidden"}},{key:"isPresent",value:function(){return this.onB24CueChangeDrawed}},{key:"pushRawData",value:function(H,B){var g=new K(B,H).render(oe({},this.rendererOption));if(g==null)return!1;var U=Number.isFinite(g.endTime)?g.endTime:Number.MAX_SAFE_INTEGER;return this.addB24Cue(H,U,B)}},{key:"pushBase64Data",value:function(H,B){var g=Ve(B);return this.pushRawData(H,g)}},{key:"pushData",value:function(H,B,g){return this.pushRawData(g,B)}},{key:"pushID3v2PRIVData",value:function(H,B,g){return B==="aribb24.js"&&this.pushRawData(H,g)}},{key:"pushID3v2TXXXData",value:function(H,B,g){return B==="aribb24.js"&&this.pushBase64Data(H,g)}},{key:"pushID3v2Data",value:function(H,B){for(var g=!1,U=0;U<B.length;){var ee=U;if(U+3>B.length)break;if(B[U+0]!==73||B[U+1]!==68||B[U+2]!==51){if(U===0){U+=5;continue}break}if((U+=6)+4>B.length)break;var J=xe(B,U+0,U+4);U+=4;var pe=ee+3+2+1+4+J;if(pe>B.length)break;for(var le=U;le<pe;){var ke=le;if(le+4>B.length)break;var Fe=et(B,le+0,le+4);if((le+=4)+4>B.length)break;var Le=xe(B,le+0,le+4);le+=6;var Be=ke+4+4+2+Le;if(Be>B.length)break;if(Fe==="PRIV"){for(var Xe=le,He=Be;B[le]!==0&&le<Be;)le++;var Ze=et(B,Xe,le),Ye=new Uint8Array(Array.prototype.slice.call(B,le+1,He));this.pushID3v2PRIVData(H,Ze,Ye)&&(g=!0)}else if(Fe==="TXXX"){var ot=B[le+0],nt=le+1;if(ot===3){for(;B[le]!==0&&le<Be;)le++;for(var Ct=le,At=le+=1;B[le]!==0&&le<Be;)le++;var vt=le,Rt=_t(B,nt,Ct),Tt=_t(B,At,vt);this.pushID3v2TXXXData(H,Rt,Tt)&&(g=!0)}else if(ot===0){for(;B[le]!==0&&le<Be;)le++;for(var Gt=le,kt=le+=1;B[le]!==0&&le<Be;)le++;var yt=le,Qe=et(B,nt,Gt),Et=et(B,kt,yt);this.pushID3v2TXXXData(H,Qe,Et)&&(g=!0)}}le=Be}(U=ee+3+2+1+4+J)+3>B.length||B[U+0]===51&&B[U+1]===68&&B[U+2]===73&&(U+=10)}return g}},{key:"setInBandMetadataTextTrack",value:function(H){var B;(B=this.id3Track)===null||B===void 0||B.removeEventListener("cuechange",this.onID3CueChangeHandler),this.id3Track=H,this.id3Track.mode="hidden",this.id3Track.addEventListener("cuechange",this.onID3CueChangeHandler)}},{key:"pushID3v2Cue",value:function(H){if(!this.id3Track)return!1;var B=H.startTime,g=H;if(this.id3Track.inBandMetadataTrackDispatchType==="15260DFFFF49443320FF49443320000F")return this.pushID3v2Data(B,new Uint8Array(g.data));if(this.id3Track.inBandMetadataTrackDispatchType==="com.apple.streaming"){if(g.value.key==="PRIV")return this.pushID3v2PRIVData(B,g.value.info,new Uint8Array(g.value.data));if(g.value.key==="TXXX")return this.pushID3v2TXXXData(B,g.value.info,g.value.data)}else if(this.id3Track.label==="id3"){if(g.value.key==="PRIV")return this.pushID3v2PRIVData(B,g.value.info,new Uint8Array(g.value.data));if(g.value.key==="TXXX")return this.pushID3v2TXXXData(B,g.value.info,g.value.data)}else if(this.id3Track.label==="Timed Metadata"){if(g.frame.key==="PRIV")return this.pushID3v2PRIVData(B,g.frame.owner,new Uint8Array(g.frame.data));if(g.frame.key==="TXXX")return this.pushID3v2TXXXData(B,g.frame.description,g.frame.data)}return!1}},{key:"onID3CueChange",value:function(){this.id3Track&&(this.isOnSeeking||this.onTimeupdate())}},{key:"addB24Cue",value:function(H,B,g){var U;if(!this.b24Track||!K.detect(g,this.rendererOption))return!1;var ee=new((U=window.VTTCue)!==null&&U!==void 0?U:window.TextTrackCue)(H,B,"");if(ee.data=g,window.VTTCue)this.b24Track.addCue(ee);else if(window.TextTrackCue){var J;if(Array.prototype.some.call((J=this.b24Track.cues)!==null&&J!==void 0?J:[],function(Fe){return Fe.startTime===H}))return!1;if(this.b24Track.cues){for(var pe=[],le=this.b24Track.cues.length-1;le>=0;le--)this.b24Track.cues[le].startTime>=H&&(pe.push(this.b24Track.cues[le]),this.b24Track.removeCue(this.b24Track.cues[le]));this.b24Track.addCue(ee);for(var ke=pe.length-1;ke>=0;ke--)this.b24Track.addCue(pe[ke])}}return!0}},{key:"onB24CueChange",value:function(){if(this.media&&this.b24Track){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);if(this.b24Track.activeCues&&this.b24Track.activeCues.length>0){var H=this.b24Track.activeCues[this.b24Track.activeCues.length-1];if(H.startTime<=this.media.currentTime&&this.media.currentTime<=H.endTime&&!this.isOnSeeking){var B=new K(H.data,H.startTime);if(this.isShowing){var g,U,ee,J=B.render(oe(oe({},this.rendererOption),{},{svg:this.svg}));(J==null?void 0:J.PRA)!=null&&((U=this.rendererOption)===null||U===void 0||(ee=U.PRACallback)===null||ee===void 0||ee.call(U,J.PRA)),J==null||J.rendered,this.textContent=(g=J==null?void 0:J.textContent)!==null&&g!==void 0?g:null}this.onB24CueChangeDrawed=!0}else this.onB24CueChangeDrawed=!1,this.textContent=null;for(var pe=this.b24Track.activeCues.length-2;pe>=0;pe--){var le=this.b24Track.activeCues[pe];le.endTime=Math.min(le.endTime,H.startTime),le.startTime===le.endTime&&this.b24Track.removeCue(le)}}else this.onB24CueChangeDrawed=!1,this.textContent=null}else this.onB24CueChangeDrawed=!1}},{key:"onHighResTimeupdate",value:function(){this.onTimeupdate(),this.highResTimeupdatePollingId=window.requestAnimationFrame(this.onHighResTimeupdateHandler)}},{key:"onTimeupdate",value:function(){if(this.media)if(this.prevCurrentTime!=null)if(this.id3Track&&this.id3Track.cues&&this.id3Track.cues.length!==0)if(this.isOnSeeking)this.prevCurrentTime=this.media.currentTime;else if(Math.abs(this.media.currentTime-this.prevCurrentTime)>1)this.prevCurrentTime=this.media.currentTime;else{for(var H,B,g=new tt(Number.NEGATIVE_INFINITY,this.id3Track.cues[0].startTime),U=[g],ee=0;ee<this.id3Track.cues.length;ee++)U.push(this.id3Track.cues[ee]);for(var J=0,pe=U.length;J+1<pe;){var le=this.prevCurrentTime,ke=Math.floor((J+pe)/2);le<U[ke].startTime?pe=ke:J=ke}H=J;for(var Fe=0,Le=U.length;Fe+1<Le;){var Be=this.media.currentTime,Xe=Math.floor((Fe+Le)/2);Be<U[Xe].startTime?Le=Xe:Fe=Xe}if(B=Fe,H!==null&&B!==null&&H!==B){if(H<B)for(var He=B;He>H;He--){var Ze=U[He];if(Ze!==g&&this.pushID3v2Cue(Ze))break}else for(var Ye=H;Ye<B;Ye++){var ot=U[Ye];if(ot!==g&&this.pushID3v2Cue(ot))break}this.prevCurrentTime=this.media.currentTime}else this.prevCurrentTime=this.media.currentTime}else this.prevCurrentTime=this.media.currentTime;else this.prevCurrentTime=this.media.currentTime}},{key:"onCanplay",value:function(){this.id3Track&&(this.id3Track.mode="hidden"),this.b24Track&&(this.b24Track.mode="hidden"),this.media!=null&&this.prevCurrentTime==null&&(this.prevCurrentTime=this.media.currentTime-Number.MIN_VALUE)}},{key:"onPlay",value:function(){this.highResTimeupdatePollingId==null&&this.onHighResTimeupdate()}},{key:"onPause",value:function(){this.highResTimeupdatePollingId!=null&&(window.cancelAnimationFrame(this.highResTimeupdatePollingId),this.highResTimeupdatePollingId=null)}},{key:"onPauseAnimation",value:function(){this.svg.pauseAnimations()}},{key:"onResumeAnimation",value:function(){this.svg.unpauseAnimations()}},{key:"onSeeking",value:function(){this.isOnSeeking=!0,this.onB24CueChange()}},{key:"onSeeked",value:function(){this.isOnSeeking=!1}},{key:"onID3Addtrack",value:function(H){if(this.media){var B=H.track;B.kind==="metadata"&&(B.inBandMetadataTrackDispatchType!=="15260DFFFF49443320FF49443320000F"&&B.inBandMetadataTrackDispatchType!=="com.apple.streaming"&&B.label!=="id3"||this.setInBandMetadataTextTrack(B))}}},{key:"setupTrack",value:function(){var H,B;if(this.media){if((H=this.rendererOption)!==null&&H!==void 0&&H.useHighResTextTrack)this.b24Track=new Ie(this.media),this.b24Track.startPolling();else{for(var g="ARIB B24 Japanese SVG (data_identifier=0x".concat(this.data_identifier.toString(16),", data_group_id=").concat(this.data_group_id,")"),U=0;U<this.media.textTracks.length;U++){var ee=this.media.textTracks[U];if(ee.label===g){this.b24Track=ee;break}}this.b24Track||(this.b24Track=this.media.addTextTrack("metadata",g,"ja"),this.b24Track.mode="hidden")}if(this.b24Track.addEventListener("cuechange",this.onB24CueChangeHandler),(B=this.rendererOption)!==null&&B!==void 0&&B.enableAutoInBandMetadataTextTrackDetection){for(var J=0;J<this.media.textTracks.length;J++){var pe=this.media.textTracks[J];if(pe.kind==="metadata"&&(pe.inBandMetadataTrackDispatchType==="15260DFFFF49443320FF49443320000F"||pe.inBandMetadataTrackDispatchType==="com.apple.streaming"||pe.label==="id3")){this.setInBandMetadataTextTrack(pe);break}}this.media.textTracks.addEventListener("addtrack",this.onID3AddtrackHandler)}this.media.addEventListener("seeking",this.onSeekingHandler),this.media.addEventListener("seeked",this.onSeekedHandler)}}},{key:"setupSVG",value:function(){this.media&&this.subtitleElement&&(this.svg.style.position="absolute",this.svg.style.top=this.svg.style.left="0",this.svg.style.pointerEvents="none",this.svg.style.width="100%",this.svg.style.height="100%",this.subtitleElement.appendChild(this.svg))}},{key:"cleanupTrack",value:function(){var H,B,g,U,ee,J;if(this.b24Track){if((J=this.rendererOption)!==null&&J!==void 0&&J.useHighResTextTrack)this.b24Track.stopPolling();else if(this.b24Track.cues)for(var pe=this.b24Track.cues.length-1;pe>=0;pe--)this.b24Track.removeCue(this.b24Track.cues[pe])}(H=this.b24Track)===null||H===void 0||H.removeEventListener("cuechange",this.onB24CueChangeHandler),(B=this.id3Track)===null||B===void 0||B.removeEventListener("cuechange",this.onID3CueChangeHandler),(g=this.media)===null||g===void 0||g.removeEventListener("seeking",this.onSeekingHandler),(U=this.media)===null||U===void 0||U.removeEventListener("seeked",this.onSeekedHandler),(ee=this.media)===null||ee===void 0||ee.textTracks.removeEventListener("addtrack",this.onID3AddtrackHandler),this.b24Track=this.id3Track=null}},{key:"cleanupSVG",value:function(){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild)}}])&&ae(ce.prototype,me),ce}();function Ee(ce,me){(me==null||me>ce.length)&&(me=ce.length);for(var H=0,B=new Array(me);H<me;H++)B[H]=ce[H];return B}function ye(ce,me){for(var H=0;H<me.length;H++){var B=me[H];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(ce,B.key,B)}}var Re=null,Oe=function(){function ce(g,U){(function(ee,J){if(!(ee instanceof J))throw new TypeError("Cannot call a class as a function")})(this,ce),this.text="",this.table=null,this.cells=null,this.GL=0,this.GR=2,this.G_BACK=[f.get(0),f.get(1),f.get(2),m.get(31)],this.DRCS_mapping=new Map([[15,new Map],[16,new Map],[17,new Map],[18,new Map],[19,new Map],[20,new Map],[21,new Map],[22,new Map],[23,new Map],[24,new Map],[25,new Map],[26,new Map],[27,new Map],[28,new Map],[29,new Map],[30,new Map]]),this.swf_x=1920,this.swf_y=1080,this.sdf_x=1920,this.sdf_y=1080,this.sdp_x=0,this.sdp_y=0,this.ssm_x=72,this.ssm_y=72,this.shs=8,this.svs=48,this.text_size_x=1,this.text_size_y=1,this.text_type="NSZ",this.position_x=-1,this.position_y=-1,this.pallet=0,this.fg_color=_[this.pallet][7],this.bg_color=_[this.pallet][8],this.force_bg_color=null,this.hlc=0,this.prev_hlc=0,this.stl=!1,this.orn=null,this.force_orn=null,this.flc=15,this.non_spacing="",this.timeElapsed=0,this.endTime=null,this.rendered=!1,this.PRA=null,this.normalFont="monospace",this.gaijiFont=this.normalFont,this.drcsReplacement=!1,this.drcsReplaceMapping=new Map,this.usePUA=!1,this.pes=g,this.startTime=U}var me,H,B;return me=ce,B=[{key:"setEmbeddedGlyph",value:function(g){Re=g}},{key:"detect",value:function(g,U){var ee,J,pe=(ee=U==null?void 0:U.data_identifier)!==null&&ee!==void 0?ee:128,le=(J=U==null?void 0:U.data_group_id)!==null&&J!==void 0?J:1;if(g.length<=0||g[0]!==pe||g.length<=2)return!1;var ke=3+(15&g[2]);return!(g.length<=ke||(15&(252&g[ke+0])>>2)!==le||(F(g,ke),0))}},{key:"getRGBAColorCode",value:function(g){if(g==null)return null;var U=document.createElement("canvas");U.width=U.height=1;var ee=U.getContext("2d");if(!ee)return null;ee.fillStyle=g,ee.fillRect(0,0,U.width,U.height);var J,pe,le=(pe=4,function(He){if(Array.isArray(He))return He}(J=ee.getImageData(0,0,1,1).data)||function(He,Ze){if(typeof Symbol<"u"&&Symbol.iterator in Object(He)){var Ye=[],ot=!0,nt=!1,Ct=void 0;try{for(var At,vt=He[Symbol.iterator]();!(ot=(At=vt.next()).done)&&(Ye.push(At.value),!Ze||Ye.length!==Ze);ot=!0);}catch(Rt){nt=!0,Ct=Rt}finally{try{ot||vt.return==null||vt.return()}finally{if(nt)throw Ct}}return Ye}}(J,pe)||function(He,Ze){if(He){if(typeof He=="string")return Ee(He,Ze);var Ye=Object.prototype.toString.call(He).slice(8,-1);return Ye==="Object"&&He.constructor&&(Ye=He.constructor.name),Ye==="Map"||Ye==="Set"?Array.from(He):Ye==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ye)?Ee(He,Ze):void 0}}(J,pe)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()),ke=le[0],Fe=le[1],Le=le[2],Be=le[3],Xe="#".concat(ke.toString(16).toUpperCase().padStart(2,"0")).concat(Fe.toString(16).toUpperCase().padStart(2,"0")).concat(Le.toString(16).toUpperCase().padStart(2,"0")).concat(Be.toString(16).toUpperCase().padStart(2,"0"));return U.width=U.height=0,Xe}},{key:"fillAlphaColorCode",value:function(g){if(g==null)return"";var U=Number.parseInt(g.substring(1,3),16),ee=Number.parseInt(g.substring(3,5),16),J=Number.parseInt(g.substring(5,7),16);return"#".concat(U.toString(16).toUpperCase().padStart(2,"0")).concat(ee.toString(16).toUpperCase().padStart(2,"0")).concat(J.toString(16).toUpperCase().padStart(2,"0"),"FF")}},{key:"getRGBAfromColorCode",value:function(g){if(g==null)return"";var U=Number.parseInt(g.substring(1,3),16),ee=Number.parseInt(g.substring(3,5),16),J=Number.parseInt(g.substring(5,7),16),pe=Number.parseInt(g.substring(7,9),16);return"rgba(".concat(U,", ").concat(ee,", ").concat(J,", ").concat(pe/255,")")}}],(H=[{key:"width",value:function(){return Math.floor((this.shs+this.ssm_x)*this.text_size_x)}},{key:"height",value:function(){return Math.floor((this.svs+this.ssm_y)*this.text_size_y)}},{key:"move_absolute_dot",value:function(g,U){this.position_x=g,this.position_y=U}},{key:"move_absolute_pos",value:function(g,U){this.position_x=this.sdp_x+g*this.width(),this.position_y=this.sdp_y+(U+1)*this.height()}},{key:"move_relative_pos",value:function(g,U){for((this.position_x<0||this.position_y<0)&&this.move_absolute_dot(this.sdp_x,this.sdp_y+(this.ssm_y+this.svs));g<0;)this.position_x-=this.width(),g++,this.position_x<this.sdp_x&&(this.position_x=this.sdp_x+this.sdf_x-this.width(),U--);for(;g>0;)this.position_x+=this.width(),g--,this.position_x>=this.sdp_x+this.sdf_x&&(this.position_x=this.sdp_x,U++);for(;U<0;)this.position_y-=this.height(),U++;for(;U>0;)this.position_y+=this.height(),U--}},{key:"move_newline",value:function(){(this.position_x<0||this.position_y<0)&&this.move_absolute_dot(this.sdp_x,this.sdp_y+(this.ssm_y+this.svs)),this.position_x=this.sdp_x,this.position_y=this.position_y+this.height()}},{key:"render",value:function(g){var U,ee,J,pe,le,ke,Fe,Le;this.table=(U=g==null?void 0:g.table)!==null&&U!==void 0?U:null,this.force_orn=(ee=typeof(g==null?void 0:g.forceStrokeColor)=="boolean"?g==null?void 0:g.forceStrokeColor:ce.getRGBAColorCode(g==null?void 0:g.forceStrokeColor))!==null&&ee!==void 0?ee:null,this.force_bg_color=(J=ce.getRGBAColorCode(g==null?void 0:g.forceBackgroundColor))!==null&&J!==void 0?J:null,this.normalFont=(pe=g==null?void 0:g.normalFont)!==null&&pe!==void 0?pe:this.normalFont,this.gaijiFont=(le=g==null?void 0:g.gaijiFont)!==null&&le!==void 0?le:this.normalFont,this.drcsReplacement=(ke=g==null?void 0:g.drcsReplacement)!==null&&ke!==void 0&&ke,this.drcsReplaceMapping=new Map(T);for(var Be,Xe=Object.entries((Be=g==null?void 0:g.drcsReplaceMapping)!==null&&Be!==void 0?Be:{}),He=0;He<Xe.length;He++){var Ze=Xe[He];this.drcsReplaceMapping.set(Ze[0],Ze[1])}if(this.usePUA=(Fe=g==null?void 0:g.usePUA)!==null&&Fe!==void 0&&Fe,!ce.detect(this.pes,g))return null;if(this.table)for(;this.table.firstChild;)this.table.removeChild(this.table.firstChild);for(var Ye=3+(15&this.pes[2]),ot=(this.pes[Ye+0],(this.pes[Ye+3]<<8)+this.pes[Ye+4]),nt=Ye+9;nt<Ye+(5+ot);){this.pes[nt+0];var Ct=this.pes[nt+1],At=this.pes[nt+2]<<16|this.pes[nt+3]<<8|this.pes[nt+4];Ct===32?this.parseText(nt+5,nt+5+At):Ct==48?this.parseDRCS(1,nt+5,nt+5+At):Ct==49&&this.parseDRCS(2,nt+5,nt+5+At),nt+=5+At}return{startTime:this.startTime,endTime:(Le=this.endTime)!==null&&Le!==void 0?Le:Number.POSITIVE_INFINITY,rendered:this.rendered,textContent:this.rendered?this.text:null,PRA:this.PRA}}},{key:"parseText",value:function(g,U){for(;g<U;)if(32<this.pes[g]&&this.pes[g]<127){var ee=0,J=this.G_BACK[this.GL];if(!J)return;for(var pe=0;pe<J.bytes;pe++)ee<<=8,ee|=127&this.pes[g+pe];this.renderCharacter(ee,J),g+=J.bytes}else if(160<this.pes[g]&&this.pes[g]<255){var le=0,ke=this.G_BACK[this.GR];if(!ke)return;for(var Fe=0;Fe<ke.bytes;Fe++)le<<=8,le|=127&this.pes[g+Fe];this.renderCharacter(le,ke),g+=ke.bytes}else if(this.pes[g]===0)g+=1;else if(this.pes[g]===7)g+=1;else if(this.pes[g]===8)this.move_relative_pos(-1,0),g+=1;else if(this.pes[g]===9)this.move_relative_pos(1,0),g+=1;else if(this.pes[g]===10)this.move_relative_pos(0,1),g+=1;else if(this.pes[g]===11)this.move_relative_pos(0,-1),g+=1;else if(this.pes[g]===12)this.startTime!=null&&this.timeElapsed>0&&(this.endTime=this.startTime+this.timeElapsed),g+=1;else if(this.pes[g]===13)this.move_newline(),g+=1;else if(this.pes[g]===14)this.GL=1,g+=1;else if(this.pes[g]===15)this.GL=0,g+=1;else if(this.pes[g]===22){var Le=63&this.pes[g+1];this.move_relative_pos(Le,0),g+=2}else if(this.pes[g]===24)g+=1;else if(this.pes[g]===25){var Be=0,Xe=this.G_BACK[2];if(!Xe)return;for(var He=0;He<Xe.bytes;He++)Be<<=8,Be|=127&this.pes[g+1+He];this.renderCharacter(Be,Xe),g+=1+Xe.bytes}else if(this.pes[g]===27)if(this.pes[g+1]===110)this.GL=2,g+=2;else if(this.pes[g+1]==111)this.GL=3,g+=2;else if(this.pes[g+1]==126)this.GR=1,g+=2;else if(this.pes[g+1]==125)this.GR=2,g+=2;else if(this.pes[g+1]==124)this.GR=3,g+=2;else if(40<=this.pes[g+1]&&this.pes[g+1]<=43){var Ze=this.pes[g+1]-40;this.pes[g+2]===32?(this.G_BACK[Ze]=y.get(this.pes[g+3]),g+=4):(this.G_BACK[Ze]=p.get(this.pes[g+2]),g+=3)}else{if(this.pes[g+1]!==36)return;if(40<=this.pes[g+2]&&this.pes[g+2]<=43){var Ye=this.pes[g+2]-40;this.pes[g+3]===32?(this.G_BACK[Ye]=y.get(this.pes[g+4]),g+=5):(this.G_BACK[Ye]=p.get(this.pes[g+3]),g+=4)}else this.G_BACK[0]=p.get(this.pes[g+2]),g+=3}else if(this.pes[g]===28){var ot=63&this.pes[g+1],nt=63&this.pes[g+2];this.move_absolute_pos(nt,ot),g+=3}else if(this.pes[g]===29){var Ct=0,At=this.G_BACK[3];if(!At)return;for(var vt=0;vt<At.bytes;vt++)Ct<<=8,Ct|=127&this.pes[g+1+vt];this.renderCharacter(Ct,At),g+=1+At.bytes}else if(this.pes[g]===30)g+=1;else if(this.pes[g]===31)g+=1;else if(this.pes[g]===32){var Rt=f.get(0);if(!Rt)return;this.renderCharacter(8481,Rt),g+=1}else if(this.pes[g]===127)g+=1;else if(this.pes[g]===128)this.fg_color=_[this.pallet][0],g+=1;else if(this.pes[g]===129)this.fg_color=_[this.pallet][1],g+=1;else if(this.pes[g]===130)this.fg_color=_[this.pallet][2],g+=1;else if(this.pes[g]===131)this.fg_color=_[this.pallet][3],g+=1;else if(this.pes[g]===132)this.fg_color=_[this.pallet][4],g+=1;else if(this.pes[g]===133)this.fg_color=_[this.pallet][5],g+=1;else if(this.pes[g]===134)this.fg_color=_[this.pallet][6],g+=1;else if(this.pes[g]===135)this.fg_color=_[this.pallet][7],g+=1;else if(this.pes[g]===136)this.text_size_x=.5,this.text_size_y=.5,this.text_type="SSZ",g+=1;else if(this.pes[g]===137)this.text_size_x=.5,this.text_size_y=1,this.text_type="MSZ",g+=1;else if(this.pes[g]===138)this.text_size_x=1,this.text_size_y=1,this.text_type="NSZ",g+=1;else{if(this.pes[g]===139)return;if(this.pes[g]===144){var Tt=this.pes[g+1];if(Tt==32){var Gt=15&this.pes[g+2];this.pallet=Gt,g+=3}else{var kt=15&Tt;(112&Tt)==64?this.fg_color=_[this.pallet][kt]:(112&Tt)==80&&(this.bg_color=_[this.pallet][kt]),g+=2}}else if(this.pes[g]===145){var yt=15&this.pes[g];this.flc=yt,g+=2}else{if(this.pes[g]===146||this.pes[g]===147||this.pes[g]===148||this.pes[g]===149)return;if(this.pes[g]===151)this.prev_hlc=this.hlc,this.hlc=15&this.pes[g+1],g+=2;else{if(this.pes[g]===152)return;if(this.pes[g]===153)this.stl=!1,g+=1;else if(this.pes[g]===154)this.stl=!0,g+=1;else if(this.pes[g]===155){for(var Qe=g+1;this.pes[Qe]!==66;){if(this.pes[Qe]===83){for(var Et=g+1,Ut=0;this.pes[Et]!=59&&this.pes[Et]!=32;)Ut*=10,Ut+=15&this.pes[Et],Et++;if(this.pes[Et]!==32)return;if(Ut===5)this.swf_x=3840,this.swf_y=2160;else if(Ut===7)this.swf_x=1920,this.swf_y=1080;else{if(Ut!=9)return;this.swf_x=1440,this.swf_y=960}break}if(this.pes[Qe]===84)break;if(this.pes[Qe]===86){for(var $t=g+1,Bt=0,Mt=0;this.pes[$t]!=59;)Bt*=10,Bt+=15&this.pes[$t],$t++;for($t++;this.pes[$t]!=32;)Mt*=10,Mt+=15&this.pes[$t],$t++;this.sdf_x=2*Bt,this.sdf_y=2*Mt;break}if(this.pes[Qe]===87){for(var Ht=g+1,Qt=0,qt=0;this.pes[Ht]!=59;)Qt*=10,Qt+=15&this.pes[Ht],Ht++;for(Ht++;this.pes[Ht]!=32;)qt*=10,qt+=15&this.pes[Ht],Ht++;this.ssm_x=2*Qt,this.ssm_y=2*qt;break}if(this.pes[Qe]===88){for(var rn=g+1,dn=0;this.pes[rn]!=32;)dn*=10,dn+=15&this.pes[rn],rn++;this.shs=2*dn;break}if(this.pes[Qe]===89){for(var vn=g+1,En=0;this.pes[vn]!=32;)En*=10,En+=15&this.pes[vn],vn++;this.svs=2*En;break}if(this.pes[Qe]===91||this.pes[Qe]===92||this.pes[Qe]===93||this.pes[Qe]===94)break;if(this.pes[Qe]===95){for(var cn=g+1,sn=0,un=0;this.pes[cn]!=59;)sn*=10,sn+=15&this.pes[cn],cn++;for(cn++;this.pes[cn]!=32;)un*=10,un+=15&this.pes[cn],cn++;this.sdp_x=2*sn,this.sdp_y=2*un;break}if(this.pes[Qe]===97){for(var mn=g+1,hn=0,bn=0;this.pes[mn]!=59;)hn*=10,hn+=15&this.pes[mn],mn++;for(mn++;this.pes[mn]!=32;)bn*=10,bn+=15&this.pes[mn],mn++;this.move_absolute_dot(2*hn,2*bn);break}if(this.pes[Qe]===98)break;if(this.pes[Qe]===99){var fn=this.pes[g+1];if(fn==48)this.orn=null;else if(fn==49){var gn=10*(15&this.pes[g+3])+(15&this.pes[g+4]),Zt=10*(15&this.pes[g+5])+(15&this.pes[g+6]);this.orn=_[gn][Zt]}break}if(this.pes[Qe]===100||this.pes[Qe]===101||this.pes[Qe]===102||this.pes[Qe]===103)break;if(this.pes[Qe]===104){for(var Nn=g+1,Xt=0;this.pes[Nn]!=32;)Xt*=10,Xt+=15&this.pes[Nn],Nn++;this.PRA=Xt;break}if(this.pes[Qe]===105||this.pes[Qe]===106||this.pes[Qe]===110||this.pes[Qe]===111)break;Qe+=1}g=Qe+1}else{if(this.pes[g]!==157)return;if(this.pes[g+1]!=32)return void this.pes[g+1];var Un=63&this.pes[g+2];this.timeElapsed+=Un/10,g+=3}}}}}},{key:"parseDRCS",value:function(g,U,ee){for(this.pes[U+0],U+=1;U<ee;){var J=this.pes[U+0]<<8|this.pes[U+1],pe=this.pes[U+2];U+=3;for(var le=0;le<pe;le++){this.pes[U+0];var ke=15&this.pes[U+0];if(ke===0||ke===1){var Fe=this.pes[U+1]+2,Le=this.pes[U+2],Be=this.pes[U+3],Xe=Fe.toString(2).length-Fe.toString(2).replace(/0*$/,"").length,He=Math.floor(Le*Be*Xe/8),Ze=new Uint8Array(Array.prototype.slice.call(this.pes,U+4,U+4+He));if(g===1){var Ye,ot,nt=64+((3840&J)>>8),Ct=127&J,At=(Ye=y.get(nt))===null||Ye===void 0?void 0:Ye.alphabet;At&&((ot=this.DRCS_mapping.get(At))===null||ot===void 0||ot.set(Ct,Ze))}else{var vt,Rt=32639&J;(vt=this.DRCS_mapping.get(15))===null||vt===void 0||vt.set(Rt,Ze)}U+=4+He}}}}},{key:"renderCharacter",value:function(g,U){if((this.position_x<0||this.position_y<0)&&this.move_absolute_dot(this.sdp_x,this.sdp_y+(this.ssm_y+this.svs)),U.alphabet===0){var ee=((65280&g)>>8)-33,J=(255&g)-33;if(ee===0&&12<=J&&J<=17)return void(this.non_spacing=["́","　","̈","̂","̅","̲"][J-12]);if(ee===1&&J===93)return void(this.non_spacing+="⃝")}if(this.table!==null){if(this.cells===null){this.table.parentElement&&(this.table.parentElement.style.position="absolute",this.table.parentElement.style.width="".concat(this.swf_x,"px"),this.table.parentElement.style.height="".concat(this.swf_y,"px")),this.table.style.willChange="transform",this.table.style.position="absolute",this.table.style.left="".concat(this.sdp_x,"px"),this.table.style.top="".concat(this.sdp_y,"px"),this.table.style.width="".concat(this.sdf_x,"px"),this.table.style.height="".concat(this.sdf_y,"px"),this.table.style.boxSizing="border-box",this.table.style.border="none",this.table.style.borderCollapse="collapse";for(var pe=[],le=0,ke=0;le<this.sdf_y;le+=Math.floor((this.ssm_y+this.svs)/2),ke+=1){var Fe=document.createElement("tr");pe.push([]),Fe.style.position="relative",Fe.style.height="".concat(Math.floor((this.ssm_y+this.svs)/2),"px"),Fe.style.width="100%",Fe.style.boxSizing="border-box",Fe.style.border="none";for(var Le=0;Le<this.sdf_x;Le+=Math.floor((this.ssm_x+this.shs)/2)){var Be=document.createElement("td");Be.style.height="".concat(Math.floor((this.ssm_y+this.svs)/2),"px"),Be.style.width="".concat(Math.floor((this.ssm_x+this.shs)/2),"px"),Be.style.padding="0px",Be.style.boxSizing="border-box",Be.style.border="none",Fe.appendChild(Be),pe[ke].push(Be)}this.table.appendChild(Fe)}this.cells=pe}if(U.alphabet!==31&&(this.rendered=!0),U.alphabet===0){var Xe=94*(((65280&g)>>8)-33)+((255&g)-33),He=7896;if(Xe<He){var Ze=S[Xe];this.renderFont(Ze)}else if(this.usePUA){var Ye=b[Xe-He];this.renderFont(Ye)}else{var ot=x[Xe-He];this.renderFont(ot)}this.move_relative_pos(1,0)}else if(U.alphabet===1){var nt=L[g-33];this.renderFont(nt),this.move_relative_pos(1,0)}else if(U.alphabet===2){var Ct=N[g-33];this.renderFont(Ct),this.move_relative_pos(1,0)}else if(U.alphabet===3){var At=P[g-33];this.renderFont(At),this.move_relative_pos(1,0)}else{if(U.alphabet===31)return void(g===96?(this.G_BACK=[f.get(0),f.get(1),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===97?(this.G_BACK=[f.get(0),f.get(3),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===98?(this.G_BACK=[f.get(0),m.get(16),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===99?(this.G_BACK=[f.get(4),f.get(6),f.get(7),m.get(31)],this.GL=0,this.GR=2):g===100?(this.G_BACK=[f.get(4),f.get(5),f.get(7),m.get(31)],this.GL=0,this.GR=2):g===101?(this.G_BACK=[f.get(4),m.get(16),f.get(7),m.get(31)],this.GL=0,this.GR=2):g===102?(this.G_BACK=[m.get(16),m.get(17),m.get(18),m.get(31)],this.GL=0,this.GR=2):g===103?(this.G_BACK=[m.get(19),m.get(20),m.get(21),m.get(31)],this.GL=0,this.GR=2):g===104?(this.G_BACK=[m.get(22),m.get(23),m.get(24),m.get(31)],this.GL=0,this.GR=2):g===105?(this.G_BACK=[m.get(25),m.get(26),m.get(27),m.get(31)],this.GL=0,this.GR=2):g===106?(this.G_BACK=[m.get(28),m.get(29),m.get(30),m.get(31)],this.GL=0,this.GR=2):g===107?(this.G_BACK=[f.get(0),m.get(17),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===108?(this.G_BACK=[f.get(0),m.get(18),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===109?(this.G_BACK=[f.get(0),m.get(19),f.get(2),m.get(31)],this.GL=0,this.GR=2):g===110?(this.G_BACK=[f.get(3),f.get(2),f.get(1),m.get(31)],this.GL=0,this.GR=2):g===111&&(this.G_BACK=[f.get(1),f.get(4),m.get(16),m.get(31)],this.GL=0,this.GR=2));var vt,Rt=(vt=this.DRCS_mapping.get(U.alphabet))===null||vt===void 0?void 0:vt.get(32639&g);if(!Rt)return;var Tt=de(Rt.buffer);if(this.drcsReplacement&&this.drcsReplaceMapping.has(Tt.toLowerCase()))this.renderFont(this.drcsReplaceMapping.get(Tt.toLowerCase()));else if(this.drcsReplacement&&this.drcsReplaceMapping.has(Tt.toUpperCase()))this.renderFont(this.drcsReplaceMapping.get(Tt.toUpperCase()));else{var Gt=document.createElement("canvas"),kt=Math.floor(this.ssm_x/2),yt=Math.floor(this.ssm_y/2),Qe=Math.floor(8*Rt.length/(kt*yt));Gt.width=kt+4/this.text_size_x,Gt.height=yt+4/this.text_size_y,Gt.style.width="".concat(this.ssm_x+4/this.text_size_x*2,"px"),Gt.style.height="".concat(this.ssm_y+4/this.text_size_y*2,"px");var Et=Gt.getContext("2d");if(!Et)return;var Ut=this.getOrnColorCode();if(Ut&&(!this.force_orn||this.force_orn===!0||this.force_orn!==this.fg_color)){Et.fillStyle=ce.getRGBAfromColorCode(Ut);for(var $t=-2/this.text_size_y;$t<=2/this.text_size_y;$t++)for(var Bt=-2/this.text_size_x;Bt<=2/this.text_size_x;Bt++)for(var Mt=0;Mt<yt;Mt++)for(var Ht=0;Ht<kt;Ht++){for(var Qt=0,qt=0;qt<Qe;qt++){var rn=7-((Mt*kt+Ht)*Qe+qt)%8;Qt*=2,Qt+=(Rt[Math.floor(((Mt*kt+Ht)*Qe+qt)/8)]&1<<rn)>>rn}Qt>0&&Et.fillRect(2/this.text_size_x+Ht+Bt,2/this.text_size_y+Mt+$t,1,1)}}Et.fillStyle=ce.getRGBAfromColorCode(this.fg_color);for(var dn=0;dn<yt;dn++)for(var vn=0;vn<kt;vn++){for(var En=0,cn=0;cn<Qe;cn++){var sn=7-((dn*kt+vn)*Qe+cn)%8;En*=2,En+=(Rt[Math.floor(((dn*kt+vn)*Qe+cn)/8)]&1<<sn)>>sn}En>0&&Et.fillRect(2/this.text_size_x+vn,2/this.text_size_y+dn,1,1)}for(var un=Math.floor(2*this.text_size_x),mn=Math.floor(2*this.text_size_y),hn=Math.round((this.position_x-this.sdp_x)/(this.ssm_x+this.shs)*2),bn=Math.round((this.position_y-this.height()-this.sdp_y)/(this.ssm_y+this.svs)*2),fn=0;fn<mn;fn++)for(var gn=0;gn<un;gn++){var Zt=this.cells[bn+fn][hn+gn];if(fn===0&&gn===0){var Nn;Zt.setAttribute("rowspan","".concat(mn)),Zt.setAttribute("colspan","".concat(un)),Zt.style.textAlign="center",Zt.style.verticalAlign="top";var Xt=document.createElement("div");Xt.appendChild(Gt),Xt.style.display="flex",Xt.style.alignItems="center",Xt.style.justifyContent="middle",Xt.style.width="".concat(this.ssm_x+this.shs,"px"),Xt.style.height="".concat(this.ssm_y+this.svs,"px"),Xt.style.lineHeight="".concat(this.height(),"px"),Xt.style.fontSize="".concat(this.ssm_x,"px"),Xt.style.transform="scale(".concat(this.text_size_x,", ").concat(this.text_size_y,")"),Xt.style.transformOrigin="0 0",Xt.style.marginRight="-".concat(this.ssm_x+this.shs-this.width(),"px"),Xt.style.marginBottom="-".concat(this.ssm_y+this.svs-this.height(),"px"),Xt.style.color=ce.getRGBAfromColorCode(this.fg_color),1&this.hlc&&(Zt.style.borderBottom="1px solid ".concat(ce.getRGBAColorCode(this.fg_color))),2&this.hlc&&(Zt.style.borderRight="1px solid ".concat(ce.getRGBAColorCode(this.fg_color))),4&this.hlc&&(Zt.style.borderTop="1px solid ".concat(ce.getRGBAColorCode(this.fg_color))),8&this.hlc&&(Zt.style.borderLeft="1px solid ".concat(ce.getRGBAColorCode(this.fg_color))),this.stl&&(Zt.style.borderBottom="1px solid ".concat(ce.getRGBAColorCode(this.fg_color))),Zt.style.backgroundColor=ce.getRGBAfromColorCode((Nn=this.force_bg_color)!==null&&Nn!==void 0?Nn:this.bg_color),Zt.appendChild(Xt)}else Zt.parentNode!=null&&Zt.parentNode.removeChild(Zt)}}this.move_relative_pos(1,0)}}}},{key:"renderFont",value:function(g){var U;if(g+=this.non_spacing,this.non_spacing="",this.text_size_x===.5&&this.text_size_y===.5&&(N.includes(g)||P.includes(g))||(this.text+=g),this.cells!==null){var ee=k.has(g),J=ee?this.gaijiFont:this.normalFont;if(Re!=null&&(U=Re)!==null&&U!==void 0&&U.has(g)){var pe=Re.get(g),le=pe.viewBox,ke=pe.path;this.renderPath(le,ke)}else{ee&&(g+="︎");for(var Fe=Math.floor(2*this.text_size_x),Le=Math.floor(2*this.text_size_y),Be=Math.round((this.position_x-this.sdp_x)/(this.ssm_x+this.shs)*2),Xe=Math.round((this.position_y-this.height()-this.sdp_y)/(this.ssm_y+this.svs)*2),He=0;He<Le;He++)for(var Ze=0;Ze<Fe;Ze++){var Ye=this.cells[Xe+He][Be+Ze];if(He===0&&Ze===0){var ot;Ye.setAttribute("rowspan","".concat(Le)),Ye.setAttribute("colspan","".concat(Fe)),Ye.style.textAlign="center",Ye.style.verticalAlign="top";var nt=document.createElement("div");nt.textContent=g,nt.style.display="flex",nt.style.alignItems="center",nt.style.justifyContent="middle",nt.style.width="".concat(this.ssm_x+this.shs,"px"),nt.style.height="".concat(this.ssm_y+this.svs,"px"),nt.style.fontFamily="".concat(J),nt.style.lineHeight="".concat(this.height(),"px"),nt.style.fontSize="".concat(this.ssm_x,"px"),nt.style.transform="scale(".concat(this.text_size_x,", ").concat(this.text_size_y,")"),nt.style.transformOrigin="0 0",nt.style.marginRight="-".concat(this.ssm_x+this.shs-this.width(),"px"),nt.style.marginBottom="-".concat(this.ssm_y+this.svs-this.height(),"px"),nt.style.color=ce.getRGBAfromColorCode(this.fg_color);var Ct=this.getOrnColorCode();if(Ct&&(!this.force_orn||this.force_orn===!0||this.force_orn!==this.fg_color)){for(var At="",vt=!0,Rt=-4;Rt<=4;Rt++)for(var Tt=-4;Tt<=4;Tt++)Rt===0&&Tt===0||(At+="".concat(vt?"":",").concat(Tt,"px ").concat(Rt,"px 0 ").concat(ce.getRGBAfromColorCode(Ct)),vt=!1);nt.style.textShadow=At}1&this.hlc&&(Ye.style.borderBottom="1px solid ".concat(ce.getRGBAColorCode(this.fg_color))),2&this.hlc&&(Ye.style.borderRight="1px solid ".concat(ce.getRGBAColorCode(this.fg_color))),4&this.hlc&&(Ye.style.borderTop="1px solid ".concat(ce.getRGBAColorCode(this.fg_color))),8&this.hlc&&(Ye.style.borderLeft="1px solid ".concat(ce.getRGBAColorCode(this.fg_color))),this.stl&&(Ye.style.borderBottom="1px solid ".concat(ce.getRGBAColorCode(this.fg_color))),Ye.style.backgroundColor=ce.getRGBAfromColorCode((ot=this.force_bg_color)!==null&&ot!==void 0?ot:this.bg_color),Ye.appendChild(nt)}else Ye.parentNode!=null&&Ye.parentNode.removeChild(Ye)}}}}},{key:"renderPath",value:function(g,U){if(this.cells!==null){var ee=document.createElementNS("http://www.w3.org/2000/svg","svg");ee.setAttribute("viewBox","".concat(g[0]," ").concat(g[1]," ").concat(g[2]," ").concat(g[3])),ee.style.width="".concat(this.ssm_x+this.shs,"px"),ee.style.height="".concat(this.ssm_y,"px");var J=document.createElementNS("http://www.w3.org/2000/svg","path");J.setAttribute("d",U),J.setAttribute("fill","".concat(ce.getRGBAfromColorCode(this.fg_color)));var pe=this.getOrnColorCode();if(!pe||this.force_orn&&this.force_orn!==!0&&this.force_orn===this.fg_color)J.setAttribute("stroke","transparent");else{var le=4*Math.max((g[2]-g[0])/this.ssm_x,(g[3]-g[1])/this.ssm_y);J.setAttribute("stroke","".concat(ce.getRGBAfromColorCode(pe))),J.setAttribute("stroke-width","".concat(le))}ee.appendChild(J);for(var ke=Math.floor(2*this.text_size_x),Fe=Math.floor(2*this.text_size_y),Le=Math.round((this.position_x-this.sdp_x)/(this.ssm_x+this.shs)*2),Be=Math.round((this.position_y-this.height()-this.sdp_y)/(this.ssm_y+this.svs)*2),Xe=0;Xe<Fe;Xe++)for(var He=0;He<ke;He++){var Ze=this.cells[Be+Xe][Le+He];if(Xe===0&&He===0){var Ye;Ze.setAttribute("rowspan","".concat(Fe)),Ze.setAttribute("colspan","".concat(ke)),Ze.style.textAlign="center",Ze.style.verticalAlign="top";var ot=document.createElement("div");ot.appendChild(ee),ot.style.display="flex",ot.style.alignItems="center",ot.style.justifyContent="middle",ot.style.width="".concat(this.ssm_x+this.shs,"px"),ot.style.height="".concat(this.ssm_y+this.svs,"px"),ot.style.lineHeight="".concat(this.height(),"px"),ot.style.fontSize="".concat(this.ssm_x,"px"),ot.style.transform="scale(".concat(this.text_size_x,", ").concat(this.text_size_y,")"),ot.style.transformOrigin="0 0",ot.style.marginRight="-".concat(this.ssm_x+this.shs-this.width(),"px"),ot.style.marginBottom="-".concat(this.ssm_y+this.svs-this.height(),"px"),ot.style.color=ce.getRGBAfromColorCode(this.fg_color),1&this.hlc&&(Ze.style.borderBottom="1px solid ".concat(ce.getRGBAColorCode(this.fg_color))),2&this.hlc&&(Ze.style.borderRight="1px solid ".concat(ce.getRGBAColorCode(this.fg_color))),4&this.hlc&&(Ze.style.borderTop="1px solid ".concat(ce.getRGBAColorCode(this.fg_color))),8&this.hlc&&(Ze.style.borderLeft="1px solid ".concat(ce.getRGBAColorCode(this.fg_color))),this.stl&&(Ze.style.borderBottom="1px solid ".concat(ce.getRGBAColorCode(this.fg_color))),Ze.style.backgroundColor=ce.getRGBAfromColorCode((Ye=this.force_bg_color)!==null&&Ye!==void 0?Ye:this.bg_color),Ze.appendChild(ot)}else Ze.parentNode!=null&&Ze.parentNode.removeChild(Ze)}}}},{key:"getOrnColorCode",value:function(){return this.force_orn===!0?ce.fillAlphaColorCode(this.bg_color):this.force_orn===!1?this.orn:(g=this.force_orn)!==null&&g!==void 0?g:this.orn;var g}}])&&ye(me.prototype,H),B&&ye(me,B),ce}();function Ne(ce,me){var H=Object.keys(ce);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ce);me&&(B=B.filter(function(g){return Object.getOwnPropertyDescriptor(ce,g).enumerable})),H.push.apply(H,B)}return H}function qe(ce){for(var me=1;me<arguments.length;me++){var H=arguments[me]!=null?arguments[me]:{};me%2?Ne(Object(H),!0).forEach(function(B){ft(ce,B,H[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ce,Object.getOwnPropertyDescriptors(H)):Ne(Object(H)).forEach(function(B){Object.defineProperty(ce,B,Object.getOwnPropertyDescriptor(H,B))})}return ce}function ft(ce,me,H){return me in ce?Object.defineProperty(ce,me,{value:H,enumerable:!0,configurable:!0,writable:!0}):ce[me]=H,ce}function St(ce,me){for(var H=0;H<me.length;H++){var B=me[H];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(ce,B.key,B)}}var Yt=function(){function ce(H){var B,g,U,ee,J;(function(pe,le){if(!(pe instanceof le))throw new TypeError("Cannot call a class as a function")})(this,ce),this.media=null,this.id3Track=null,this.b24Track=null,this.subtitleElement=null,this.table=null,this.textContent=null,this.wrapper=null,this.resizeObserver=null,this.mutationObserver=null,this.prevCurrentTime=null,this.highResTimeupdatePollingId=null,this.isShowing=!0,this.isOnSeeking=!1,this.onB24CueChangeDrawed=!1,this.onID3AddtrackHandler=this.onID3Addtrack.bind(this),this.onID3CueChangeHandler=this.onID3CueChange.bind(this),this.onB24CueChangeHandler=this.onB24CueChange.bind(this),this.onHighResTimeupdateHandler=this.onHighResTimeupdate.bind(this),this.onTimeupdateHandler=this.onTimeupdate.bind(this),this.onCanplayHandler=this.onCanplay.bind(this),this.onPlayHandler=this.onPlay.bind(this),this.onPauseHandler=this.onPause.bind(this),this.onSeekingHandler=this.onSeeking.bind(this),this.onSeekedHandler=this.onSeeked.bind(this),this.onResizeHandler=this.onResize.bind(this),this.data_identifier=(B=H==null?void 0:H.data_identifier)!==null&&B!==void 0?B:128,this.data_group_id=(g=H==null?void 0:H.data_group_id)!==null&&g!==void 0?g:1,this.rendererOption=qe(qe({},H),{},{data_identifier:this.data_identifier,data_group_id:this.data_group_id,keepAspectRatio:(U=H==null?void 0:H.keepAspectRatio)===null||U===void 0||U,enableAutoInBandMetadataTextTrackDetection:(ee=H==null?void 0:H.enableAutoInBandMetadataTextTrackDetection)===null||ee===void 0||ee,useStroke:(J=H==null?void 0:H.useStroke)===null||J===void 0||J})}var me;return(me=[{key:"attachMedia",value:function(H,B){var g;this.detachMedia(),this.media=H,this.subtitleElement=B??H.parentElement,this.media.addEventListener("canplay",this.onCanplayHandler),(g=this.rendererOption)!==null&&g!==void 0&&g.useHighResTimeupdate?(this.media.addEventListener("play",this.onPlayHandler),this.media.addEventListener("pause",this.onPauseHandler)):this.media.addEventListener("timeupdate",this.onTimeupdateHandler),this.prevCurrentTime=null,this.setupTrack(),this.setupTable()}},{key:"detachMedia",value:function(){var H,B,g,U;this.cleanupTable(),this.cleanupTrack(),(H=this.media)===null||H===void 0||H.removeEventListener("canplay",this.onCanplayHandler),(B=this.media)===null||B===void 0||B.removeEventListener("play",this.onPlayHandler),(g=this.media)===null||g===void 0||g.removeEventListener("pause",this.onPauseHandler),this.onPause(),(U=this.media)===null||U===void 0||U.removeEventListener("timeupdate",this.onTimeupdateHandler),this.prevCurrentTime=null,this.media=this.subtitleElement=null}},{key:"dispose",value:function(){this.detachMedia()}},{key:"getTextContent",value:function(){return this.textContent}},{key:"refresh",value:function(){this.onResize()}},{key:"show",value:function(){this.isShowing=!0,this.table&&(this.table.style.visibility="visible")}},{key:"hide",value:function(){this.isShowing=!1,this.table&&(this.table.style.visibility="hidden")}},{key:"isPresent",value:function(){return this.onB24CueChangeDrawed}},{key:"pushRawData",value:function(H,B){var g=new Oe(B,H).render(this.rendererOption);if(g==null)return!1;var U=Number.isFinite(g.endTime)?g.endTime:Number.MAX_SAFE_INTEGER;return this.addB24Cue(H,U,B)}},{key:"pushBase64Data",value:function(H,B){var g=Ve(B);return this.pushRawData(H,g)}},{key:"pushData",value:function(H,B,g){return this.pushRawData(g,B)}},{key:"pushID3v2PRIVData",value:function(H,B,g){return B==="aribb24.js"&&this.pushRawData(H,g)}},{key:"pushID3v2TXXXData",value:function(H,B,g){return B==="aribb24.js"&&this.pushBase64Data(H,g)}},{key:"pushID3v2Data",value:function(H,B){for(var g=!1,U=0;U<B.length;){var ee=U;if(U+3>B.length)break;if(B[U+0]!==73||B[U+1]!==68||B[U+2]!==51){if(U===0){U+=5;continue}break}if((U+=6)+4>B.length)break;var J=xe(B,U+0,U+4);U+=4;var pe=ee+3+2+1+4+J;if(pe>B.length)break;for(var le=U;le<pe;){var ke=le;if(le+4>B.length)break;var Fe=et(B,le+0,le+4);if((le+=4)+4>B.length)break;var Le=xe(B,le+0,le+4);le+=6;var Be=ke+4+4+2+Le;if(Be>B.length)break;if(Fe==="PRIV"){for(var Xe=le,He=Be;B[le]!==0&&le<Be;)le++;var Ze=et(B,Xe,le),Ye=new Uint8Array(Array.prototype.slice.call(B,le+1,He));this.pushID3v2PRIVData(H,Ze,Ye)&&(g=!0)}else if(Fe==="TXXX"){var ot=B[le+0],nt=le+1;if(ot===3){for(;B[le]!==0&&le<Be;)le++;for(var Ct=le,At=le+=1;B[le]!==0&&le<Be;)le++;var vt=le,Rt=_t(B,nt,Ct),Tt=_t(B,At,vt);this.pushID3v2TXXXData(H,Rt,Tt)&&(g=!0)}else if(ot===0){for(;B[le]!==0&&le<Be;)le++;for(var Gt=le,kt=le+=1;B[le]!==0&&le<Be;)le++;var yt=le,Qe=et(B,nt,Gt),Et=et(B,kt,yt);this.pushID3v2TXXXData(H,Qe,Et)&&(g=!0)}}le=Be}(U=ee+3+2+1+4+J)+3>B.length||B[U+0]===51&&B[U+1]===68&&B[U+2]===73&&(U+=10)}return g}},{key:"setInBandMetadataTextTrack",value:function(H){var B;(B=this.id3Track)===null||B===void 0||B.removeEventListener("cuechange",this.onID3CueChangeHandler),this.id3Track=H,this.id3Track.mode="hidden",this.id3Track.addEventListener("cuechange",this.onID3CueChangeHandler)}},{key:"pushID3v2Cue",value:function(H){if(!this.id3Track)return!1;var B=H.startTime,g=H;if(this.id3Track.inBandMetadataTrackDispatchType==="15260DFFFF49443320FF49443320000F")return this.pushID3v2Data(B,new Uint8Array(g.data));if(this.id3Track.inBandMetadataTrackDispatchType==="com.apple.streaming"){if(g.value.key==="PRIV")return this.pushID3v2PRIVData(B,g.value.info,new Uint8Array(g.value.data));if(g.value.key==="TXXX")return this.pushID3v2TXXXData(B,g.value.info,g.value.data)}else if(this.id3Track.label==="id3"){if(g.value.key==="PRIV")return this.pushID3v2PRIVData(B,g.value.info,new Uint8Array(g.value.data));if(g.value.key==="TXXX")return this.pushID3v2TXXXData(B,g.value.info,g.value.data)}else if(this.id3Track.label==="Timed Metadata"){if(g.frame.key==="PRIV")return this.pushID3v2PRIVData(B,g.frame.owner,new Uint8Array(g.frame.data));if(g.frame.key==="TXXX")return this.pushID3v2TXXXData(B,g.frame.description,g.frame.data)}return!1}},{key:"onID3CueChange",value:function(){this.id3Track&&(this.isOnSeeking||this.onTimeupdate())}},{key:"addB24Cue",value:function(H,B,g){var U;if(!this.b24Track||!Oe.detect(g,this.rendererOption))return!1;var ee=new((U=window.VTTCue)!==null&&U!==void 0?U:window.TextTrackCue)(H,B,"");if(ee.data=g,window.VTTCue)this.b24Track.addCue(ee);else if(window.TextTrackCue){var J;if(Array.prototype.some.call((J=this.b24Track.cues)!==null&&J!==void 0?J:[],function(Fe){return Fe.startTime===H}))return!1;if(this.b24Track.cues){for(var pe=[],le=this.b24Track.cues.length-1;le>=0;le--)this.b24Track.cues[le].startTime>=H&&(pe.push(this.b24Track.cues[le]),this.b24Track.removeCue(this.b24Track.cues[le]));this.b24Track.addCue(ee);for(var ke=pe.length-1;ke>=0;ke--)this.b24Track.addCue(pe[ke])}}return!0}},{key:"onB24CueChange",value:function(){if(this.media&&this.b24Track){if(this.table)for(;this.table.firstChild;)this.table.removeChild(this.table.firstChild);if(this.b24Track.activeCues&&this.b24Track.activeCues.length>0){var H=this.b24Track.activeCues[this.b24Track.activeCues.length-1];if(H.startTime<=this.media.currentTime&&this.media.currentTime<=H.endTime&&!this.isOnSeeking){var B,g,U,ee,J,pe=new Oe(H.data,H.startTime).render(qe(qe({},this.rendererOption),{},{table:(B=this.table)!==null&&B!==void 0?B:void 0}));(pe==null?void 0:pe.PRA)!=null&&((ee=this.rendererOption)===null||ee===void 0||(J=ee.PRACallback)===null||J===void 0||J.call(ee,pe.PRA)),pe!=null&&pe.rendered&&this.onResize(),this.onB24CueChangeDrawed=(g=pe==null?void 0:pe.rendered)!==null&&g!==void 0&&g,this.textContent=(U=pe==null?void 0:pe.textContent)!==null&&U!==void 0?U:null}else this.onB24CueChangeDrawed=!1,this.textContent=null;for(var le=this.b24Track.activeCues.length-2;le>=0;le--){var ke=this.b24Track.activeCues[le];ke.endTime=Math.min(ke.endTime,H.startTime),ke.startTime===ke.endTime&&this.b24Track.removeCue(ke)}}else this.onB24CueChangeDrawed=!1,this.textContent=null}else this.onB24CueChangeDrawed=!1}},{key:"onHighResTimeupdate",value:function(){this.onTimeupdate(),this.highResTimeupdatePollingId=window.requestAnimationFrame(this.onHighResTimeupdateHandler)}},{key:"onTimeupdate",value:function(){if(this.media)if(this.prevCurrentTime!=null)if(this.id3Track&&this.id3Track.cues&&this.id3Track.cues.length!==0)if(this.isOnSeeking)this.prevCurrentTime=this.media.currentTime;else if(Math.abs(this.media.currentTime-this.prevCurrentTime)>1)this.prevCurrentTime=this.media.currentTime;else{for(var H,B,g=new tt(Number.NEGATIVE_INFINITY,this.id3Track.cues[0].startTime),U=[g],ee=0;ee<this.id3Track.cues.length;ee++)U.push(this.id3Track.cues[ee]);for(var J=0,pe=U.length;J+1<pe;){var le=this.prevCurrentTime,ke=Math.floor((J+pe)/2);le<U[ke].startTime?pe=ke:J=ke}H=J;for(var Fe=0,Le=U.length;Fe+1<Le;){var Be=this.media.currentTime,Xe=Math.floor((Fe+Le)/2);Be<U[Xe].startTime?Le=Xe:Fe=Xe}if(B=Fe,H!==null&&B!==null&&H!==B){if(H<B)for(var He=B;He>H;He--){var Ze=U[He];if(Ze!==g&&this.pushID3v2Cue(Ze))break}else for(var Ye=H;Ye<B;Ye++){var ot=U[Ye];if(ot!==g&&this.pushID3v2Cue(ot))break}this.prevCurrentTime=this.media.currentTime}else this.prevCurrentTime=this.media.currentTime}else this.prevCurrentTime=this.media.currentTime;else this.prevCurrentTime=this.media.currentTime}},{key:"onCanplay",value:function(){this.id3Track&&(this.id3Track.mode="hidden"),this.b24Track&&(this.b24Track.mode="hidden"),this.media!=null&&this.prevCurrentTime==null&&(this.prevCurrentTime=this.media.currentTime-Number.MIN_VALUE)}},{key:"onPlay",value:function(){this.highResTimeupdatePollingId==null&&this.onHighResTimeupdate()}},{key:"onPause",value:function(){this.highResTimeupdatePollingId!=null&&(window.cancelAnimationFrame(this.highResTimeupdatePollingId),this.highResTimeupdatePollingId=null)}},{key:"onSeeking",value:function(){this.isOnSeeking=!0,this.onB24CueChange()}},{key:"onSeeked",value:function(){this.isOnSeeking=!1}},{key:"onResize",value:function(){var H;if(this.media&&this.wrapper){var B=window.getComputedStyle(this.media),g=Number.parseInt(B.width),U=Number.parseInt(B.height),ee=this.wrapper.offsetWidth,J=this.wrapper.offsetHeight,pe=g/ee,le=U/J;if((H=this.rendererOption)!==null&&H!==void 0&&H.keepAspectRatio){var ke=Math.min(pe,le);this.wrapper.style.top="".concat((U-J*ke)/2,"px"),this.wrapper.style.left="".concat((g-ee*ke)/2,"px"),this.wrapper.style.transform="scale(".concat(ke,")"),this.wrapper.style.transformOrigin="0 0"}else this.wrapper.style.top="0px",this.wrapper.style.left="0px",this.wrapper.style.transform="scale(".concat(pe,", ").concat(le,")"),this.wrapper.style.transformOrigin="0 0"}}},{key:"onID3Addtrack",value:function(H){if(this.media){var B=H.track;B.kind==="metadata"&&(B.inBandMetadataTrackDispatchType!=="15260DFFFF49443320FF49443320000F"&&B.inBandMetadataTrackDispatchType!=="com.apple.streaming"&&B.label!=="id3"||this.setInBandMetadataTextTrack(B))}}},{key:"setupTrack",value:function(){var H,B;if(this.media){if((H=this.rendererOption)!==null&&H!==void 0&&H.useHighResTextTrack)this.b24Track=new Ie(this.media),this.b24Track.startPolling();else{for(var g="ARIB B24 Japanese (data_identifier=0x".concat(this.data_identifier.toString(16),", data_group_id=").concat(this.data_group_id,")"),U=0;U<this.media.textTracks.length;U++){var ee=this.media.textTracks[U];if(ee.label===g){this.b24Track=ee;break}}this.b24Track||(this.b24Track=this.media.addTextTrack("metadata",g,"ja"),this.b24Track.mode="hidden")}if(this.b24Track.addEventListener("cuechange",this.onB24CueChangeHandler),(B=this.rendererOption)!==null&&B!==void 0&&B.enableAutoInBandMetadataTextTrackDetection){for(var J=0;J<this.media.textTracks.length;J++){var pe=this.media.textTracks[J];if(pe.kind==="metadata"&&(pe.inBandMetadataTrackDispatchType==="15260DFFFF49443320FF49443320000F"||pe.inBandMetadataTrackDispatchType==="com.apple.streaming"||pe.label==="id3")){this.setInBandMetadataTextTrack(pe);break}}this.media.textTracks.addEventListener("addtrack",this.onID3AddtrackHandler)}this.media.addEventListener("seeking",this.onSeekingHandler),this.media.addEventListener("seeked",this.onSeekedHandler)}}},{key:"setupTable",value:function(){var H=this;this.media&&this.subtitleElement&&(this.wrapper=document.createElement("div"),this.table=document.createElement("table"),this.wrapper.style.pointerEvents="none",this.wrapper.appendChild(this.table),this.subtitleElement.appendChild(this.wrapper),this.media.addEventListener("resize",this.onResizeHandler),window.ResizeObserver?(this.resizeObserver=new ResizeObserver(function(){H.onResize()}),this.resizeObserver.observe(this.media)):(window.addEventListener("resize",this.onResizeHandler),window.MutationObserver&&(this.mutationObserver=new MutationObserver(function(){H.onResize()}),this.mutationObserver.observe(this.media,{attributes:!0,attributeFilter:["class","style"]}))))}},{key:"cleanupTrack",value:function(){var H,B,g,U,ee,J;if(this.b24Track){if((J=this.rendererOption)!==null&&J!==void 0&&J.useHighResTextTrack)this.b24Track.stopPolling();else if(this.b24Track.cues)for(var pe=this.b24Track.cues.length-1;pe>=0;pe--)this.b24Track.removeCue(this.b24Track.cues[pe])}(H=this.b24Track)===null||H===void 0||H.removeEventListener("cuechange",this.onB24CueChangeHandler),(B=this.id3Track)===null||B===void 0||B.removeEventListener("cuechange",this.onID3CueChangeHandler),(g=this.media)===null||g===void 0||g.removeEventListener("seeking",this.onSeekingHandler),(U=this.media)===null||U===void 0||U.removeEventListener("seeked",this.onSeekedHandler),(ee=this.media)===null||ee===void 0||ee.textTracks.removeEventListener("addtrack",this.onID3AddtrackHandler),this.b24Track=this.id3Track=null}},{key:"cleanupTable",value:function(){var H;window.removeEventListener("resize",this.onResizeHandler),(H=this.media)===null||H===void 0||H.removeEventListener("resize",this.onResizeHandler),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.table&&this.wrapper&&this.wrapper.removeChild(this.table),this.wrapper&&this.subtitleElement&&this.subtitleElement.removeChild(this.wrapper),this.wrapper=this.table=null}}])&&St(ce.prototype,me),ce}()},3099:function(l){l.exports=function(h){if(typeof h!="function")throw TypeError(String(h)+" is not a function");return h}},6077:function(l,h,o){var f=o(111);l.exports=function(p){if(!f(p)&&p!==null)throw TypeError("Can't set "+String(p)+" as a prototype");return p}},1223:function(l,h,o){var f=o(5112),p=o(30),m=o(3070),y=f("unscopables"),_=Array.prototype;_[y]==null&&m.f(_,y,{configurable:!0,value:p(null)}),l.exports=function(S){_[y][S]=!0}},1530:function(l,h,o){var f=o(8710).charAt;l.exports=function(p,m,y){return m+(y?f(p,m).length:1)}},5787:function(l){l.exports=function(h,o,f){if(!(h instanceof o))throw TypeError("Incorrect "+(f?f+" ":"")+"invocation");return h}},9670:function(l,h,o){var f=o(111);l.exports=function(p){if(!f(p))throw TypeError(String(p)+" is not an object");return p}},4019:function(l){l.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"},260:function(l,h,o){var f,p=o(4019),m=o(9781),y=o(7854),_=o(111),S=o(6656),b=o(648),x=o(8880),L=o(1320),N=o(3070).f,P=o(9518),T=o(7674),k=o(5112),I=o(9711),F=y.Int8Array,V=F&&F.prototype,ne=y.Uint8ClampedArray,te=ne&&ne.prototype,Z=F&&P(F),Q=V&&P(V),he=Object.prototype,de=he.isPrototypeOf,M=k("toStringTag"),A=I("TYPED_ARRAY_TAG"),v=p&&!!T&&b(y.opera)!=="Opera",w=!1,R={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},C={BigInt64Array:8,BigUint64Array:8},O=function(G){if(!_(G))return!1;var z=b(G);return S(R,z)||S(C,z)};for(f in R)y[f]||(v=!1);if((!v||typeof Z!="function"||Z===Function.prototype)&&(Z=function(){throw TypeError("Incorrect invocation")},v))for(f in R)y[f]&&T(y[f],Z);if((!v||!Q||Q===he)&&(Q=Z.prototype,v))for(f in R)y[f]&&T(y[f].prototype,Q);if(v&&P(te)!==Q&&T(te,Q),m&&!S(Q,M))for(f in w=!0,N(Q,M,{get:function(){return _(this)?this[A]:void 0}}),R)y[f]&&x(y[f],A,f);l.exports={NATIVE_ARRAY_BUFFER_VIEWS:v,TYPED_ARRAY_TAG:w&&A,aTypedArray:function(G){if(O(G))return G;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(G){if(T){if(de.call(Z,G))return G}else for(var z in R)if(S(R,f)){var Y=y[z];if(Y&&(G===Y||de.call(Y,G)))return G}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(G,z,Y){if(m){if(Y)for(var ie in R){var se=y[ie];se&&S(se.prototype,G)&&delete se.prototype[G]}Q[G]&&!Y||L(Q,G,Y?z:v&&V[G]||z)}},exportTypedArrayStaticMethod:function(G,z,Y){var ie,se;if(m){if(T){if(Y)for(ie in R)(se=y[ie])&&S(se,G)&&delete se[G];if(Z[G]&&!Y)return;try{return L(Z,G,Y?z:v&&F[G]||z)}catch{}}for(ie in R)!(se=y[ie])||se[G]&&!Y||L(se,G,z)}},isView:function(G){if(!_(G))return!1;var z=b(G);return z==="DataView"||S(R,z)||S(C,z)},isTypedArray:O,TypedArray:Z,TypedArrayPrototype:Q}},3331:function(l,h,o){var f=o(7854),p=o(9781),m=o(4019),y=o(8880),_=o(2248),S=o(7293),b=o(5787),x=o(9958),L=o(7466),N=o(7067),P=o(1179),T=o(9518),k=o(7674),I=o(8006).f,F=o(3070).f,V=o(1285),ne=o(8003),te=o(9909),Z=te.get,Q=te.set,he="ArrayBuffer",de="DataView",M="Wrong index",A=f.ArrayBuffer,v=A,w=f.DataView,R=w&&w.prototype,C=Object.prototype,O=f.RangeError,G=P.pack,z=P.unpack,Y=function(Ve){return[255&Ve]},ie=function(Ve){return[255&Ve,Ve>>8&255]},se=function(Ve){return[255&Ve,Ve>>8&255,Ve>>16&255,Ve>>24&255]},Se=function(Ve){return Ve[3]<<24|Ve[2]<<16|Ve[1]<<8|Ve[0]},we=function(Ve){return G(Ve,23,4)},Pe=function(Ve){return G(Ve,52,8)},Ge=function(Ve,fe){F(Ve.prototype,fe,{get:function(){return Z(this)[fe]}})},it=function(Ve,fe,be,Ue){var ge=N(be),Je=Z(Ve);if(ge+fe>Je.byteLength)throw O(M);var ut=Z(Je.buffer).bytes,st=ge+Je.byteOffset,We=ut.slice(st,st+fe);return Ue?We:We.reverse()},Ie=function(Ve,fe,be,Ue,ge,Je){var ut=N(be),st=Z(Ve);if(ut+fe>st.byteLength)throw O(M);for(var We=Z(st.buffer).bytes,gt=ut+st.byteOffset,X=Ue(+ge),re=0;re<fe;re++)We[gt+re]=X[Je?re:fe-re-1]};if(m){if(!S(function(){A(1)})||!S(function(){new A(-1)})||S(function(){return new A,new A(1.5),new A(NaN),A.name!=he})){for(var rt,tt=(v=function(Ve){return b(this,v),new A(N(Ve))}).prototype=A.prototype,xe=I(A),ht=0;xe.length>ht;)(rt=xe[ht++])in v||y(v,rt,A[rt]);tt.constructor=v}k&&T(R)!==C&&k(R,C);var _t=new w(new v(2)),et=R.setInt8;_t.setInt8(0,2147483648),_t.setInt8(1,2147483649),!_t.getInt8(0)&&_t.getInt8(1)||_(R,{setInt8:function(Ve,fe){et.call(this,Ve,fe<<24>>24)},setUint8:function(Ve,fe){et.call(this,Ve,fe<<24>>24)}},{unsafe:!0})}else v=function(Ve){b(this,v,he);var fe=N(Ve);Q(this,{bytes:V.call(new Array(fe),0),byteLength:fe}),p||(this.byteLength=fe)},w=function(Ve,fe,be){b(this,w,de),b(Ve,v,de);var Ue=Z(Ve).byteLength,ge=x(fe);if(ge<0||ge>Ue)throw O("Wrong offset");if(ge+(be=be===void 0?Ue-ge:L(be))>Ue)throw O("Wrong length");Q(this,{buffer:Ve,byteLength:be,byteOffset:ge}),p||(this.buffer=Ve,this.byteLength=be,this.byteOffset=ge)},p&&(Ge(v,"byteLength"),Ge(w,"buffer"),Ge(w,"byteLength"),Ge(w,"byteOffset")),_(w.prototype,{getInt8:function(Ve){return it(this,1,Ve)[0]<<24>>24},getUint8:function(Ve){return it(this,1,Ve)[0]},getInt16:function(Ve){var fe=it(this,2,Ve,arguments.length>1?arguments[1]:void 0);return(fe[1]<<8|fe[0])<<16>>16},getUint16:function(Ve){var fe=it(this,2,Ve,arguments.length>1?arguments[1]:void 0);return fe[1]<<8|fe[0]},getInt32:function(Ve){return Se(it(this,4,Ve,arguments.length>1?arguments[1]:void 0))},getUint32:function(Ve){return Se(it(this,4,Ve,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(Ve){return z(it(this,4,Ve,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(Ve){return z(it(this,8,Ve,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(Ve,fe){Ie(this,1,Ve,Y,fe)},setUint8:function(Ve,fe){Ie(this,1,Ve,Y,fe)},setInt16:function(Ve,fe){Ie(this,2,Ve,ie,fe,arguments.length>2?arguments[2]:void 0)},setUint16:function(Ve,fe){Ie(this,2,Ve,ie,fe,arguments.length>2?arguments[2]:void 0)},setInt32:function(Ve,fe){Ie(this,4,Ve,se,fe,arguments.length>2?arguments[2]:void 0)},setUint32:function(Ve,fe){Ie(this,4,Ve,se,fe,arguments.length>2?arguments[2]:void 0)},setFloat32:function(Ve,fe){Ie(this,4,Ve,we,fe,arguments.length>2?arguments[2]:void 0)},setFloat64:function(Ve,fe){Ie(this,8,Ve,Pe,fe,arguments.length>2?arguments[2]:void 0)}});ne(v,he),ne(w,de),l.exports={ArrayBuffer:v,DataView:w}},1048:function(l,h,o){var f=o(7908),p=o(1400),m=o(7466),y=Math.min;l.exports=[].copyWithin||function(_,S){var b=f(this),x=m(b.length),L=p(_,x),N=p(S,x),P=arguments.length>2?arguments[2]:void 0,T=y((P===void 0?x:p(P,x))-N,x-L),k=1;for(N<L&&L<N+T&&(k=-1,N+=T-1,L+=T-1);T-- >0;)N in b?b[L]=b[N]:delete b[L],L+=k,N+=k;return b}},1285:function(l,h,o){var f=o(7908),p=o(1400),m=o(7466);l.exports=function(y){for(var _=f(this),S=m(_.length),b=arguments.length,x=p(b>1?arguments[1]:void 0,S),L=b>2?arguments[2]:void 0,N=L===void 0?S:p(L,S);N>x;)_[x++]=y;return _}},8533:function(l,h,o){var f=o(2092).forEach,p=o(9341),m=o(9207),y=p("forEach"),_=m("forEach");l.exports=y&&_?[].forEach:function(S){return f(this,S,arguments.length>1?arguments[1]:void 0)}},1318:function(l,h,o){var f=o(5656),p=o(7466),m=o(1400),y=function(_){return function(S,b,x){var L,N=f(S),P=p(N.length),T=m(x,P);if(_&&b!=b){for(;P>T;)if((L=N[T++])!=L)return!0}else for(;P>T;T++)if((_||T in N)&&N[T]===b)return _||T||0;return!_&&-1}};l.exports={includes:y(!0),indexOf:y(!1)}},2092:function(l,h,o){var f=o(9974),p=o(8361),m=o(7908),y=o(7466),_=o(5417),S=[].push,b=function(x){var L=x==1,N=x==2,P=x==3,T=x==4,k=x==6,I=x==7,F=x==5||k;return function(V,ne,te,Z){for(var Q,he,de=m(V),M=p(de),A=f(ne,te,3),v=y(M.length),w=0,R=Z||_,C=L?R(V,v):N||I?R(V,0):void 0;v>w;w++)if((F||w in M)&&(he=A(Q=M[w],w,de),x))if(L)C[w]=he;else if(he)switch(x){case 3:return!0;case 5:return Q;case 6:return w;case 2:S.call(C,Q)}else switch(x){case 4:return!1;case 7:S.call(C,Q)}return k?-1:P||T?T:C}};l.exports={forEach:b(0),map:b(1),filter:b(2),some:b(3),every:b(4),find:b(5),findIndex:b(6),filterOut:b(7)}},6583:function(l,h,o){var f=o(5656),p=o(9958),m=o(7466),y=o(9341),_=o(9207),S=Math.min,b=[].lastIndexOf,x=!!b&&1/[1].lastIndexOf(1,-0)<0,L=y("lastIndexOf"),N=_("indexOf",{ACCESSORS:!0,1:0}),P=x||!L||!N;l.exports=P?function(T){if(x)return b.apply(this,arguments)||0;var k=f(this),I=m(k.length),F=I-1;for(arguments.length>1&&(F=S(F,p(arguments[1]))),F<0&&(F=I+F);F>=0;F--)if(F in k&&k[F]===T)return F||0;return-1}:b},1194:function(l,h,o){var f=o(7293),p=o(5112),m=o(7392),y=p("species");l.exports=function(_){return m>=51||!f(function(){var S=[];return(S.constructor={})[y]=function(){return{foo:1}},S[_](Boolean).foo!==1})}},9341:function(l,h,o){var f=o(7293);l.exports=function(p,m){var y=[][p];return!!y&&f(function(){y.call(null,m||function(){throw 1},1)})}},9207:function(l,h,o){var f=o(9781),p=o(7293),m=o(6656),y=Object.defineProperty,_={},S=function(b){throw b};l.exports=function(b,x){if(m(_,b))return _[b];x||(x={});var L=[][b],N=!!m(x,"ACCESSORS")&&x.ACCESSORS,P=m(x,0)?x[0]:S,T=m(x,1)?x[1]:void 0;return _[b]=!!L&&!p(function(){if(N&&!f)return!0;var k={length:-1};N?y(k,1,{enumerable:!0,get:S}):k[1]=1,L.call(k,P,T)})}},3671:function(l,h,o){var f=o(3099),p=o(7908),m=o(8361),y=o(7466),_=function(S){return function(b,x,L,N){f(x);var P=p(b),T=m(P),k=y(P.length),I=S?k-1:0,F=S?-1:1;if(L<2)for(;;){if(I in T){N=T[I],I+=F;break}if(I+=F,S?I<0:k<=I)throw TypeError("Reduce of empty array with no initial value")}for(;S?I>=0:k>I;I+=F)I in T&&(N=x(N,T[I],I,P));return N}};l.exports={left:_(!1),right:_(!0)}},5417:function(l,h,o){var f=o(111),p=o(3157),m=o(5112)("species");l.exports=function(y,_){var S;return p(y)&&(typeof(S=y.constructor)!="function"||S!==Array&&!p(S.prototype)?f(S)&&(S=S[m])===null&&(S=void 0):S=void 0),new(S===void 0?Array:S)(_===0?0:_)}},7072:function(l,h,o){var f=o(5112)("iterator"),p=!1;try{var m=0,y={next:function(){return{done:!!m++}},return:function(){p=!0}};y[f]=function(){return this},Array.from(y,function(){throw 2})}catch{}l.exports=function(_,S){if(!S&&!p)return!1;var b=!1;try{var x={};x[f]=function(){return{next:function(){return{done:b=!0}}}},_(x)}catch{}return b}},4326:function(l){var h={}.toString;l.exports=function(o){return h.call(o).slice(8,-1)}},648:function(l,h,o){var f=o(1694),p=o(4326),m=o(5112)("toStringTag"),y=p(function(){return arguments}())=="Arguments";l.exports=f?p:function(_){var S,b,x;return _===void 0?"Undefined":_===null?"Null":typeof(b=function(L,N){try{return L[N]}catch{}}(S=Object(_),m))=="string"?b:y?p(S):(x=p(S))=="Object"&&typeof S.callee=="function"?"Arguments":x}},5631:function(l,h,o){var f=o(3070).f,p=o(30),m=o(2248),y=o(9974),_=o(5787),S=o(408),b=o(654),x=o(6340),L=o(9781),N=o(2423).fastKey,P=o(9909),T=P.set,k=P.getterFor;l.exports={getConstructor:function(I,F,V,ne){var te=I(function(de,M){_(de,te,F),T(de,{type:F,index:p(null),first:void 0,last:void 0,size:0}),L||(de.size=0),M!=null&&S(M,de[ne],{that:de,AS_ENTRIES:V})}),Z=k(F),Q=function(de,M,A){var v,w,R=Z(de),C=he(de,M);return C?C.value=A:(R.last=C={index:w=N(M,!0),key:M,value:A,previous:v=R.last,next:void 0,removed:!1},R.first||(R.first=C),v&&(v.next=C),L?R.size++:de.size++,w!=="F"&&(R.index[w]=C)),de},he=function(de,M){var A,v=Z(de),w=N(M);if(w!=="F")return v.index[w];for(A=v.first;A;A=A.next)if(A.key==M)return A};return m(te.prototype,{clear:function(){for(var de=Z(this),M=de.index,A=de.first;A;)A.removed=!0,A.previous&&(A.previous=A.previous.next=void 0),delete M[A.index],A=A.next;de.first=de.last=void 0,L?de.size=0:this.size=0},delete:function(de){var M=this,A=Z(M),v=he(M,de);if(v){var w=v.next,R=v.previous;delete A.index[v.index],v.removed=!0,R&&(R.next=w),w&&(w.previous=R),A.first==v&&(A.first=w),A.last==v&&(A.last=R),L?A.size--:M.size--}return!!v},forEach:function(de){for(var M,A=Z(this),v=y(de,arguments.length>1?arguments[1]:void 0,3);M=M?M.next:A.first;)for(v(M.value,M.key,this);M&&M.removed;)M=M.previous},has:function(de){return!!he(this,de)}}),m(te.prototype,V?{get:function(de){var M=he(this,de);return M&&M.value},set:function(de,M){return Q(this,de===0?0:de,M)}}:{add:function(de){return Q(this,de=de===0?0:de,de)}}),L&&f(te.prototype,"size",{get:function(){return Z(this).size}}),te},setStrong:function(I,F,V){var ne=F+" Iterator",te=k(F),Z=k(ne);b(I,F,function(Q,he){T(this,{type:ne,target:Q,state:te(Q),kind:he,last:void 0})},function(){for(var Q=Z(this),he=Q.kind,de=Q.last;de&&de.removed;)de=de.previous;return Q.target&&(Q.last=de=de?de.next:Q.state.first)?he=="keys"?{value:de.key,done:!1}:he=="values"?{value:de.value,done:!1}:{value:[de.key,de.value],done:!1}:(Q.target=void 0,{value:void 0,done:!0})},V?"entries":"values",!V,!0),x(F)}}},7710:function(l,h,o){var f=o(2109),p=o(7854),m=o(4705),y=o(1320),_=o(2423),S=o(408),b=o(5787),x=o(111),L=o(7293),N=o(7072),P=o(8003),T=o(9587);l.exports=function(k,I,F){var V=k.indexOf("Map")!==-1,ne=k.indexOf("Weak")!==-1,te=V?"set":"add",Z=p[k],Q=Z&&Z.prototype,he=Z,de={},M=function(O){var G=Q[O];y(Q,O,O=="add"?function(z){return G.call(this,z===0?0:z),this}:O=="delete"?function(z){return!(ne&&!x(z))&&G.call(this,z===0?0:z)}:O=="get"?function(z){return ne&&!x(z)?void 0:G.call(this,z===0?0:z)}:O=="has"?function(z){return!(ne&&!x(z))&&G.call(this,z===0?0:z)}:function(z,Y){return G.call(this,z===0?0:z,Y),this})};if(m(k,typeof Z!="function"||!(ne||Q.forEach&&!L(function(){new Z().entries().next()}))))he=F.getConstructor(I,k,V,te),_.REQUIRED=!0;else if(m(k,!0)){var A=new he,v=A[te](ne?{}:-0,1)!=A,w=L(function(){A.has(1)}),R=N(function(O){new Z(O)}),C=!ne&&L(function(){for(var O=new Z,G=5;G--;)O[te](G,G);return!O.has(-0)});R||((he=I(function(O,G){b(O,he,k);var z=T(new Z,O,he);return G!=null&&S(G,z[te],{that:z,AS_ENTRIES:V}),z})).prototype=Q,Q.constructor=he),(w||C)&&(M("delete"),M("has"),V&&M("get")),(C||v)&&M(te),ne&&Q.clear&&delete Q.clear}return de[k]=he,f({global:!0,forced:he!=Z},de),P(he,k),ne||F.setStrong(he,k,V),he}},9920:function(l,h,o){var f=o(6656),p=o(3887),m=o(1236),y=o(3070);l.exports=function(_,S){for(var b=p(S),x=y.f,L=m.f,N=0;N<b.length;N++){var P=b[N];f(_,P)||x(_,P,L(S,P))}}},4964:function(l,h,o){var f=o(5112)("match");l.exports=function(p){var m=/./;try{"/./"[p](m)}catch{try{return m[f]=!1,"/./"[p](m)}catch{}}return!1}},8544:function(l,h,o){var f=o(7293);l.exports=!f(function(){function p(){}return p.prototype.constructor=null,Object.getPrototypeOf(new p)!==p.prototype})},4994:function(l,h,o){var f=o(3383).IteratorPrototype,p=o(30),m=o(9114),y=o(8003),_=o(7497),S=function(){return this};l.exports=function(b,x,L){var N=x+" Iterator";return b.prototype=p(f,{next:m(1,L)}),y(b,N,!1,!0),_[N]=S,b}},8880:function(l,h,o){var f=o(9781),p=o(3070),m=o(9114);l.exports=f?function(y,_,S){return p.f(y,_,m(1,S))}:function(y,_,S){return y[_]=S,y}},9114:function(l){l.exports=function(h,o){return{enumerable:!(1&h),configurable:!(2&h),writable:!(4&h),value:o}}},6135:function(l,h,o){var f=o(7593),p=o(3070),m=o(9114);l.exports=function(y,_,S){var b=f(_);b in y?p.f(y,b,m(0,S)):y[b]=S}},654:function(l,h,o){var f=o(2109),p=o(4994),m=o(9518),y=o(7674),_=o(8003),S=o(8880),b=o(1320),x=o(5112),L=o(1913),N=o(7497),P=o(3383),T=P.IteratorPrototype,k=P.BUGGY_SAFARI_ITERATORS,I=x("iterator"),F="keys",V="values",ne="entries",te=function(){return this};l.exports=function(Z,Q,he,de,M,A,v){p(he,Q,de);var w,R,C,O=function(we){if(we===M&&se)return se;if(!k&&we in Y)return Y[we];switch(we){case F:case V:case ne:return function(){return new he(this,we)}}return function(){return new he(this)}},G=Q+" Iterator",z=!1,Y=Z.prototype,ie=Y[I]||Y["@@iterator"]||M&&Y[M],se=!k&&ie||O(M),Se=Q=="Array"&&Y.entries||ie;if(Se&&(w=m(Se.call(new Z)),T!==Object.prototype&&w.next&&(L||m(w)===T||(y?y(w,T):typeof w[I]!="function"&&S(w,I,te)),_(w,G,!0,!0),L&&(N[G]=te))),M==V&&ie&&ie.name!==V&&(z=!0,se=function(){return ie.call(this)}),L&&!v||Y[I]===se||S(Y,I,se),N[Q]=se,M)if(R={values:O(V),keys:A?se:O(F),entries:O(ne)},v)for(C in R)(k||z||!(C in Y))&&b(Y,C,R[C]);else f({target:Q,proto:!0,forced:k||z},R);return R}},7235:function(l,h,o){var f=o(857),p=o(6656),m=o(6061),y=o(3070).f;l.exports=function(_){var S=f.Symbol||(f.Symbol={});p(S,_)||y(S,_,{value:m.f(_)})}},9781:function(l,h,o){var f=o(7293);l.exports=!f(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},317:function(l,h,o){var f=o(7854),p=o(111),m=f.document,y=p(m)&&p(m.createElement);l.exports=function(_){return y?m.createElement(_):{}}},8324:function(l){l.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},8113:function(l,h,o){var f=o(5005);l.exports=f("navigator","userAgent")||""},7392:function(l,h,o){var f,p,m=o(7854),y=o(8113),_=m.process,S=_&&_.versions,b=S&&S.v8;b?p=(f=b.split("."))[0]+f[1]:y&&(!(f=y.match(/Edge\/(\d+)/))||f[1]>=74)&&(f=y.match(/Chrome\/(\d+)/))&&(p=f[1]),l.exports=p&&+p},748:function(l){l.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},2109:function(l,h,o){var f=o(7854),p=o(1236).f,m=o(8880),y=o(1320),_=o(3505),S=o(9920),b=o(4705);l.exports=function(x,L){var N,P,T,k,I,F=x.target,V=x.global,ne=x.stat;if(N=V?f:ne?f[F]||_(F,{}):(f[F]||{}).prototype)for(P in L){if(k=L[P],T=x.noTargetGet?(I=p(N,P))&&I.value:N[P],!b(V?P:F+(ne?".":"#")+P,x.forced)&&T!==void 0){if(typeof k==typeof T)continue;S(k,T)}(x.sham||T&&T.sham)&&m(k,"sham",!0),y(N,P,k,x)}}},7293:function(l){l.exports=function(h){try{return!!h()}catch{return!0}}},7007:function(l,h,o){o(4916);var f=o(1320),p=o(7293),m=o(5112),y=o(2261),_=o(8880),S=m("species"),b=!p(function(){var T=/./;return T.exec=function(){var k=[];return k.groups={a:"7"},k},"".replace(T,"$<a>")!=="7"}),x="a".replace(/./,"$0")==="$0",L=m("replace"),N=!!/./[L]&&/./[L]("a","$0")==="",P=!p(function(){var T=/(?:)/,k=T.exec;T.exec=function(){return k.apply(this,arguments)};var I="ab".split(T);return I.length!==2||I[0]!=="a"||I[1]!=="b"});l.exports=function(T,k,I,F){var V=m(T),ne=!p(function(){var M={};return M[V]=function(){return 7},""[T](M)!=7}),te=ne&&!p(function(){var M=!1,A=/a/;return T==="split"&&((A={}).constructor={},A.constructor[S]=function(){return A},A.flags="",A[V]=/./[V]),A.exec=function(){return M=!0,null},A[V](""),!M});if(!ne||!te||T==="replace"&&(!b||!x||N)||T==="split"&&!P){var Z=/./[V],Q=I(V,""[T],function(M,A,v,w,R){return A.exec===y?ne&&!R?{done:!0,value:Z.call(A,v,w)}:{done:!0,value:M.call(v,A,w)}:{done:!1}},{REPLACE_KEEPS_$0:x,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:N}),he=Q[0],de=Q[1];f(String.prototype,T,he),f(RegExp.prototype,V,k==2?function(M,A){return de.call(M,this,A)}:function(M){return de.call(M,this)})}F&&_(RegExp.prototype[V],"sham",!0)}},6677:function(l,h,o){var f=o(7293);l.exports=!f(function(){return Object.isExtensible(Object.preventExtensions({}))})},9974:function(l,h,o){var f=o(3099);l.exports=function(p,m,y){if(f(p),m===void 0)return p;switch(y){case 0:return function(){return p.call(m)};case 1:return function(_){return p.call(m,_)};case 2:return function(_,S){return p.call(m,_,S)};case 3:return function(_,S,b){return p.call(m,_,S,b)}}return function(){return p.apply(m,arguments)}}},5005:function(l,h,o){var f=o(857),p=o(7854),m=function(y){return typeof y=="function"?y:void 0};l.exports=function(y,_){return arguments.length<2?m(f[y])||m(p[y]):f[y]&&f[y][_]||p[y]&&p[y][_]}},1246:function(l,h,o){var f=o(648),p=o(7497),m=o(5112)("iterator");l.exports=function(y){if(y!=null)return y[m]||y["@@iterator"]||p[f(y)]}},647:function(l,h,o){var f=o(7908),p=Math.floor,m="".replace,y=/\$([$&'`]|\d\d?|<[^>]*>)/g,_=/\$([$&'`]|\d\d?)/g;l.exports=function(S,b,x,L,N,P){var T=x+S.length,k=L.length,I=_;return N!==void 0&&(N=f(N),I=y),m.call(P,I,function(F,V){var ne;switch(V.charAt(0)){case"$":return"$";case"&":return S;case"`":return b.slice(0,x);case"'":return b.slice(T);case"<":ne=N[V.slice(1,-1)];break;default:var te=+V;if(te===0)return F;if(te>k){var Z=p(te/10);return Z===0?F:Z<=k?L[Z-1]===void 0?V.charAt(1):L[Z-1]+V.charAt(1):F}ne=L[te-1]}return ne===void 0?"":ne})}},7854:function(l,h,o){var f=function(p){return p&&p.Math==Math&&p};l.exports=f(typeof globalThis=="object"&&globalThis)||f(typeof window=="object"&&window)||f(typeof self=="object"&&self)||f(typeof o.g=="object"&&o.g)||function(){return this}()||Function("return this")()},6656:function(l){var h={}.hasOwnProperty;l.exports=function(o,f){return h.call(o,f)}},3501:function(l){l.exports={}},490:function(l,h,o){var f=o(5005);l.exports=f("document","documentElement")},4664:function(l,h,o){var f=o(9781),p=o(7293),m=o(317);l.exports=!f&&!p(function(){return Object.defineProperty(m("div"),"a",{get:function(){return 7}}).a!=7})},1179:function(l){var h=1/0,o=Math.abs,f=Math.pow,p=Math.floor,m=Math.log,y=Math.LN2;l.exports={pack:function(_,S,b){var x,L,N,P=new Array(b),T=8*b-S-1,k=(1<<T)-1,I=k>>1,F=S===23?f(2,-24)-f(2,-77):0,V=_<0||_===0&&1/_<0?1:0,ne=0;for((_=o(_))!=_||_===h?(L=_!=_?1:0,x=k):(x=p(m(_)/y),_*(N=f(2,-x))<1&&(x--,N*=2),(_+=x+I>=1?F/N:F*f(2,1-I))*N>=2&&(x++,N/=2),x+I>=k?(L=0,x=k):x+I>=1?(L=(_*N-1)*f(2,S),x+=I):(L=_*f(2,I-1)*f(2,S),x=0));S>=8;P[ne++]=255&L,L/=256,S-=8);for(x=x<<S|L,T+=S;T>0;P[ne++]=255&x,x/=256,T-=8);return P[--ne]|=128*V,P},unpack:function(_,S){var b,x=_.length,L=8*x-S-1,N=(1<<L)-1,P=N>>1,T=L-7,k=x-1,I=_[k--],F=127&I;for(I>>=7;T>0;F=256*F+_[k],k--,T-=8);for(b=F&(1<<-T)-1,F>>=-T,T+=S;T>0;b=256*b+_[k],k--,T-=8);if(F===0)F=1-P;else{if(F===N)return b?NaN:I?-1/0:h;b+=f(2,S),F-=P}return(I?-1:1)*b*f(2,F-S)}}},8361:function(l,h,o){var f=o(7293),p=o(4326),m="".split;l.exports=f(function(){return!Object("z").propertyIsEnumerable(0)})?function(y){return p(y)=="String"?m.call(y,""):Object(y)}:Object},9587:function(l,h,o){var f=o(111),p=o(7674);l.exports=function(m,y,_){var S,b;return p&&typeof(S=y.constructor)=="function"&&S!==_&&f(b=S.prototype)&&b!==_.prototype&&p(m,b),m}},2788:function(l,h,o){var f=o(5465),p=Function.toString;typeof f.inspectSource!="function"&&(f.inspectSource=function(m){return p.call(m)}),l.exports=f.inspectSource},2423:function(l,h,o){var f=o(3501),p=o(111),m=o(6656),y=o(3070).f,_=o(9711),S=o(6677),b=_("meta"),x=0,L=Object.isExtensible||function(){return!0},N=function(T){y(T,b,{value:{objectID:"O"+ ++x,weakData:{}}})},P=l.exports={REQUIRED:!1,fastKey:function(T,k){if(!p(T))return typeof T=="symbol"?T:(typeof T=="string"?"S":"P")+T;if(!m(T,b)){if(!L(T))return"F";if(!k)return"E";N(T)}return T[b].objectID},getWeakData:function(T,k){if(!m(T,b)){if(!L(T))return!0;if(!k)return!1;N(T)}return T[b].weakData},onFreeze:function(T){return S&&P.REQUIRED&&L(T)&&!m(T,b)&&N(T),T}};f[b]=!0},9909:function(l,h,o){var f,p,m,y=o(8536),_=o(7854),S=o(111),b=o(8880),x=o(6656),L=o(5465),N=o(6200),P=o(3501),T=_.WeakMap;if(y){var k=L.state||(L.state=new T),I=k.get,F=k.has,V=k.set;f=function(te,Z){return Z.facade=te,V.call(k,te,Z),Z},p=function(te){return I.call(k,te)||{}},m=function(te){return F.call(k,te)}}else{var ne=N("state");P[ne]=!0,f=function(te,Z){return Z.facade=te,b(te,ne,Z),Z},p=function(te){return x(te,ne)?te[ne]:{}},m=function(te){return x(te,ne)}}l.exports={set:f,get:p,has:m,enforce:function(te){return m(te)?p(te):f(te,{})},getterFor:function(te){return function(Z){var Q;if(!S(Z)||(Q=p(Z)).type!==te)throw TypeError("Incompatible receiver, "+te+" required");return Q}}}},7659:function(l,h,o){var f=o(5112),p=o(7497),m=f("iterator"),y=Array.prototype;l.exports=function(_){return _!==void 0&&(p.Array===_||y[m]===_)}},3157:function(l,h,o){var f=o(4326);l.exports=Array.isArray||function(p){return f(p)=="Array"}},4705:function(l,h,o){var f=o(7293),p=/#|\.prototype\./,m=function(x,L){var N=_[y(x)];return N==b||N!=S&&(typeof L=="function"?f(L):!!L)},y=m.normalize=function(x){return String(x).replace(p,".").toLowerCase()},_=m.data={},S=m.NATIVE="N",b=m.POLYFILL="P";l.exports=m},111:function(l){l.exports=function(h){return typeof h=="object"?h!==null:typeof h=="function"}},1913:function(l){l.exports=!1},7850:function(l,h,o){var f=o(111),p=o(4326),m=o(5112)("match");l.exports=function(y){var _;return f(y)&&((_=y[m])!==void 0?!!_:p(y)=="RegExp")}},408:function(l,h,o){var f=o(9670),p=o(7659),m=o(7466),y=o(9974),_=o(1246),S=o(9212),b=function(x,L){this.stopped=x,this.result=L};l.exports=function(x,L,N){var P,T,k,I,F,V,ne,te=N&&N.that,Z=!(!N||!N.AS_ENTRIES),Q=!(!N||!N.IS_ITERATOR),he=!(!N||!N.INTERRUPTED),de=y(L,te,1+Z+he),M=function(v){return P&&S(P),new b(!0,v)},A=function(v){return Z?(f(v),he?de(v[0],v[1],M):de(v[0],v[1])):he?de(v,M):de(v)};if(Q)P=x;else{if(typeof(T=_(x))!="function")throw TypeError("Target is not iterable");if(p(T)){for(k=0,I=m(x.length);I>k;k++)if((F=A(x[k]))&&F instanceof b)return F;return new b(!1)}P=T.call(x)}for(V=P.next;!(ne=V.call(P)).done;){try{F=A(ne.value)}catch(v){throw S(P),v}if(typeof F=="object"&&F&&F instanceof b)return F}return new b(!1)}},9212:function(l,h,o){var f=o(9670);l.exports=function(p){var m=p.return;if(m!==void 0)return f(m.call(p)).value}},3383:function(l,h,o){var f,p,m,y=o(7293),_=o(9518),S=o(8880),b=o(6656),x=o(5112),L=o(1913),N=x("iterator"),P=!1;[].keys&&("next"in(m=[].keys())?(p=_(_(m)))!==Object.prototype&&(f=p):P=!0);var T=f==null||y(function(){var k={};return f[N].call(k)!==k});T&&(f={}),L&&!T||b(f,N)||S(f,N,function(){return this}),l.exports={IteratorPrototype:f,BUGGY_SAFARI_ITERATORS:P}},7497:function(l){l.exports={}},133:function(l,h,o){var f=o(7293);l.exports=!!Object.getOwnPropertySymbols&&!f(function(){return!String(Symbol())})},8536:function(l,h,o){var f=o(7854),p=o(2788),m=f.WeakMap;l.exports=typeof m=="function"&&/native code/.test(p(m))},3929:function(l,h,o){var f=o(7850);l.exports=function(p){if(f(p))throw TypeError("The method doesn't accept regular expressions");return p}},7023:function(l,h,o){var f=o(7854).isFinite;l.exports=Number.isFinite||function(p){return typeof p=="number"&&f(p)}},3009:function(l,h,o){var f=o(7854),p=o(3111).trim,m=o(1361),y=f.parseInt,_=/^[+-]?0[Xx]/,S=y(m+"08")!==8||y(m+"0x16")!==22;l.exports=S?function(b,x){var L=p(String(b));return y(L,x>>>0||(_.test(L)?16:10))}:y},30:function(l,h,o){var f,p=o(9670),m=o(6048),y=o(748),_=o(3501),S=o(490),b=o(317),x=o(6200)("IE_PROTO"),L=function(){},N=function(T){return"<script>"+T+"<\/script>"},P=function(){try{f=document.domain&&new ActiveXObject("htmlfile")}catch{}var T,k;P=f?function(F){F.write(N("")),F.close();var V=F.parentWindow.Object;return F=null,V}(f):((k=b("iframe")).style.display="none",S.appendChild(k),k.src="javascript:",(T=k.contentWindow.document).open(),T.write(N("document.F=Object")),T.close(),T.F);for(var I=y.length;I--;)delete P.prototype[y[I]];return P()};_[x]=!0,l.exports=Object.create||function(T,k){var I;return T!==null?(L.prototype=p(T),I=new L,L.prototype=null,I[x]=T):I=P(),k===void 0?I:m(I,k)}},6048:function(l,h,o){var f=o(9781),p=o(3070),m=o(9670),y=o(1956);l.exports=f?Object.defineProperties:function(_,S){m(_);for(var b,x=y(S),L=x.length,N=0;L>N;)p.f(_,b=x[N++],S[b]);return _}},3070:function(l,h,o){var f=o(9781),p=o(4664),m=o(9670),y=o(7593),_=Object.defineProperty;h.f=f?_:function(S,b,x){if(m(S),b=y(b,!0),m(x),p)try{return _(S,b,x)}catch{}if("get"in x||"set"in x)throw TypeError("Accessors not supported");return"value"in x&&(S[b]=x.value),S}},1236:function(l,h,o){var f=o(9781),p=o(5296),m=o(9114),y=o(5656),_=o(7593),S=o(6656),b=o(4664),x=Object.getOwnPropertyDescriptor;h.f=f?x:function(L,N){if(L=y(L),N=_(N,!0),b)try{return x(L,N)}catch{}if(S(L,N))return m(!p.f.call(L,N),L[N])}},1156:function(l,h,o){var f=o(5656),p=o(8006).f,m={}.toString,y=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];l.exports.f=function(_){return y&&m.call(_)=="[object Window]"?function(S){try{return p(S)}catch{return y.slice()}}(_):p(f(_))}},8006:function(l,h,o){var f=o(6324),p=o(748).concat("length","prototype");h.f=Object.getOwnPropertyNames||function(m){return f(m,p)}},5181:function(l,h){h.f=Object.getOwnPropertySymbols},9518:function(l,h,o){var f=o(6656),p=o(7908),m=o(6200),y=o(8544),_=m("IE_PROTO"),S=Object.prototype;l.exports=y?Object.getPrototypeOf:function(b){return b=p(b),f(b,_)?b[_]:typeof b.constructor=="function"&&b instanceof b.constructor?b.constructor.prototype:b instanceof Object?S:null}},6324:function(l,h,o){var f=o(6656),p=o(5656),m=o(1318).indexOf,y=o(3501);l.exports=function(_,S){var b,x=p(_),L=0,N=[];for(b in x)!f(y,b)&&f(x,b)&&N.push(b);for(;S.length>L;)f(x,b=S[L++])&&(~m(N,b)||N.push(b));return N}},1956:function(l,h,o){var f=o(6324),p=o(748);l.exports=Object.keys||function(m){return f(m,p)}},5296:function(l,h){var o={}.propertyIsEnumerable,f=Object.getOwnPropertyDescriptor,p=f&&!o.call({1:2},1);h.f=p?function(m){var y=f(this,m);return!!y&&y.enumerable}:o},7674:function(l,h,o){var f=o(9670),p=o(6077);l.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var m,y=!1,_={};try{(m=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(_,[]),y=_ instanceof Array}catch{}return function(S,b){return f(S),p(b),y?m.call(S,b):S.__proto__=b,S}}():void 0)},4699:function(l,h,o){var f=o(9781),p=o(1956),m=o(5656),y=o(5296).f,_=function(S){return function(b){for(var x,L=m(b),N=p(L),P=N.length,T=0,k=[];P>T;)x=N[T++],f&&!y.call(L,x)||k.push(S?[x,L[x]]:L[x]);return k}};l.exports={entries:_(!0),values:_(!1)}},288:function(l,h,o){var f=o(1694),p=o(648);l.exports=f?{}.toString:function(){return"[object "+p(this)+"]"}},3887:function(l,h,o){var f=o(5005),p=o(8006),m=o(5181),y=o(9670);l.exports=f("Reflect","ownKeys")||function(_){var S=p.f(y(_)),b=m.f;return b?S.concat(b(_)):S}},857:function(l,h,o){var f=o(7854);l.exports=f},2248:function(l,h,o){var f=o(1320);l.exports=function(p,m,y){for(var _ in m)f(p,_,m[_],y);return p}},1320:function(l,h,o){var f=o(7854),p=o(8880),m=o(6656),y=o(3505),_=o(2788),S=o(9909),b=S.get,x=S.enforce,L=String(String).split("String");(l.exports=function(N,P,T,k){var I,F=!!k&&!!k.unsafe,V=!!k&&!!k.enumerable,ne=!!k&&!!k.noTargetGet;typeof T=="function"&&(typeof P!="string"||m(T,"name")||p(T,"name",P),(I=x(T)).source||(I.source=L.join(typeof P=="string"?P:""))),N!==f?(F?!ne&&N[P]&&(V=!0):delete N[P],V?N[P]=T:p(N,P,T)):V?N[P]=T:y(P,T)})(Function.prototype,"toString",function(){return typeof this=="function"&&b(this).source||_(this)})},7651:function(l,h,o){var f=o(4326),p=o(2261);l.exports=function(m,y){var _=m.exec;if(typeof _=="function"){var S=_.call(m,y);if(typeof S!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return S}if(f(m)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return p.call(m,y)}},2261:function(l,h,o){var f,p,m=o(7066),y=o(2999),_=RegExp.prototype.exec,S=String.prototype.replace,b=_,x=(f=/a/,p=/b*/g,_.call(f,"a"),_.call(p,"a"),f.lastIndex!==0||p.lastIndex!==0),L=y.UNSUPPORTED_Y||y.BROKEN_CARET,N=/()??/.exec("")[1]!==void 0;(x||N||L)&&(b=function(P){var T,k,I,F,V=this,ne=L&&V.sticky,te=m.call(V),Z=V.source,Q=0,he=P;return ne&&((te=te.replace("y","")).indexOf("g")===-1&&(te+="g"),he=String(P).slice(V.lastIndex),V.lastIndex>0&&(!V.multiline||V.multiline&&P[V.lastIndex-1]!==`
`)&&(Z="(?: "+Z+")",he=" "+he,Q++),k=new RegExp("^(?:"+Z+")",te)),N&&(k=new RegExp("^"+Z+"$(?!\\s)",te)),x&&(T=V.lastIndex),I=_.call(ne?k:V,he),ne?I?(I.input=I.input.slice(Q),I[0]=I[0].slice(Q),I.index=V.lastIndex,V.lastIndex+=I[0].length):V.lastIndex=0:x&&I&&(V.lastIndex=V.global?I.index+I[0].length:T),N&&I&&I.length>1&&S.call(I[0],k,function(){for(F=1;F<arguments.length-2;F++)arguments[F]===void 0&&(I[F]=void 0)}),I}),l.exports=b},7066:function(l,h,o){var f=o(9670);l.exports=function(){var p=f(this),m="";return p.global&&(m+="g"),p.ignoreCase&&(m+="i"),p.multiline&&(m+="m"),p.dotAll&&(m+="s"),p.unicode&&(m+="u"),p.sticky&&(m+="y"),m}},2999:function(l,h,o){var f=o(7293);function p(m,y){return RegExp(m,y)}h.UNSUPPORTED_Y=f(function(){var m=p("a","y");return m.lastIndex=2,m.exec("abcd")!=null}),h.BROKEN_CARET=f(function(){var m=p("^r","gy");return m.lastIndex=2,m.exec("str")!=null})},4488:function(l){l.exports=function(h){if(h==null)throw TypeError("Can't call method on "+h);return h}},3505:function(l,h,o){var f=o(7854),p=o(8880);l.exports=function(m,y){try{p(f,m,y)}catch{f[m]=y}return y}},6340:function(l,h,o){var f=o(5005),p=o(3070),m=o(5112),y=o(9781),_=m("species");l.exports=function(S){var b=f(S),x=p.f;y&&b&&!b[_]&&x(b,_,{configurable:!0,get:function(){return this}})}},8003:function(l,h,o){var f=o(3070).f,p=o(6656),m=o(5112)("toStringTag");l.exports=function(y,_,S){y&&!p(y=S?y:y.prototype,m)&&f(y,m,{configurable:!0,value:_})}},6200:function(l,h,o){var f=o(2309),p=o(9711),m=f("keys");l.exports=function(y){return m[y]||(m[y]=p(y))}},5465:function(l,h,o){var f=o(7854),p=o(3505),m="__core-js_shared__",y=f[m]||p(m,{});l.exports=y},2309:function(l,h,o){var f=o(1913),p=o(5465);(l.exports=function(m,y){return p[m]||(p[m]=y!==void 0?y:{})})("versions",[]).push({version:"3.8.3",mode:f?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},6707:function(l,h,o){var f=o(9670),p=o(3099),m=o(5112)("species");l.exports=function(y,_){var S,b=f(y).constructor;return b===void 0||(S=f(b)[m])==null?_:p(S)}},8710:function(l,h,o){var f=o(9958),p=o(4488),m=function(y){return function(_,S){var b,x,L=String(p(_)),N=f(S),P=L.length;return N<0||N>=P?y?"":void 0:(b=L.charCodeAt(N))<55296||b>56319||N+1===P||(x=L.charCodeAt(N+1))<56320||x>57343?y?L.charAt(N):b:y?L.slice(N,N+2):x-56320+(b-55296<<10)+65536}};l.exports={codeAt:m(!1),charAt:m(!0)}},4986:function(l,h,o){var f=o(8113);l.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(f)},6650:function(l,h,o){var f=o(7466),p=o(8415),m=o(4488),y=Math.ceil,_=function(S){return function(b,x,L){var N,P,T=String(m(b)),k=T.length,I=L===void 0?" ":String(L),F=f(x);return F<=k||I==""?T:(N=F-k,(P=p.call(I,y(N/I.length))).length>N&&(P=P.slice(0,N)),S?T+P:P+T)}};l.exports={start:_(!1),end:_(!0)}},8415:function(l,h,o){var f=o(9958),p=o(4488);l.exports="".repeat||function(m){var y=String(p(this)),_="",S=f(m);if(S<0||S==1/0)throw RangeError("Wrong number of repetitions");for(;S>0;(S>>>=1)&&(y+=y))1&S&&(_+=y);return _}},3111:function(l,h,o){var f=o(4488),p="["+o(1361)+"]",m=RegExp("^"+p+p+"*"),y=RegExp(p+p+"*$"),_=function(S){return function(b){var x=String(f(b));return 1&S&&(x=x.replace(m,"")),2&S&&(x=x.replace(y,"")),x}};l.exports={start:_(1),end:_(2),trim:_(3)}},1400:function(l,h,o){var f=o(9958),p=Math.max,m=Math.min;l.exports=function(y,_){var S=f(y);return S<0?p(S+_,0):m(S,_)}},7067:function(l,h,o){var f=o(9958),p=o(7466);l.exports=function(m){if(m===void 0)return 0;var y=f(m),_=p(y);if(y!==_)throw RangeError("Wrong length or index");return _}},5656:function(l,h,o){var f=o(8361),p=o(4488);l.exports=function(m){return f(p(m))}},9958:function(l){var h=Math.ceil,o=Math.floor;l.exports=function(f){return isNaN(f=+f)?0:(f>0?o:h)(f)}},7466:function(l,h,o){var f=o(9958),p=Math.min;l.exports=function(m){return m>0?p(f(m),9007199254740991):0}},7908:function(l,h,o){var f=o(4488);l.exports=function(p){return Object(f(p))}},4590:function(l,h,o){var f=o(3002);l.exports=function(p,m){var y=f(p);if(y%m)throw RangeError("Wrong offset");return y}},3002:function(l,h,o){var f=o(9958);l.exports=function(p){var m=f(p);if(m<0)throw RangeError("The argument can't be less than 0");return m}},7593:function(l,h,o){var f=o(111);l.exports=function(p,m){if(!f(p))return p;var y,_;if(m&&typeof(y=p.toString)=="function"&&!f(_=y.call(p))||typeof(y=p.valueOf)=="function"&&!f(_=y.call(p))||!m&&typeof(y=p.toString)=="function"&&!f(_=y.call(p)))return _;throw TypeError("Can't convert object to primitive value")}},1694:function(l,h,o){var f={};f[o(5112)("toStringTag")]="z",l.exports=String(f)==="[object z]"},9843:function(l,h,o){var f=o(2109),p=o(7854),m=o(9781),y=o(3832),_=o(260),S=o(3331),b=o(5787),x=o(9114),L=o(8880),N=o(7466),P=o(7067),T=o(4590),k=o(7593),I=o(6656),F=o(648),V=o(111),ne=o(30),te=o(7674),Z=o(8006).f,Q=o(7321),he=o(2092).forEach,de=o(6340),M=o(3070),A=o(1236),v=o(9909),w=o(9587),R=v.get,C=v.set,O=M.f,G=A.f,z=Math.round,Y=p.RangeError,ie=S.ArrayBuffer,se=S.DataView,Se=_.NATIVE_ARRAY_BUFFER_VIEWS,we=_.TYPED_ARRAY_TAG,Pe=_.TypedArray,Ge=_.TypedArrayPrototype,it=_.aTypedArrayConstructor,Ie=_.isTypedArray,rt="BYTES_PER_ELEMENT",tt="Wrong length",xe=function(be,Ue){for(var ge=0,Je=Ue.length,ut=new(it(be))(Je);Je>ge;)ut[ge]=Ue[ge++];return ut},ht=function(be,Ue){O(be,Ue,{get:function(){return R(this)[Ue]}})},_t=function(be){var Ue;return be instanceof ie||(Ue=F(be))=="ArrayBuffer"||Ue=="SharedArrayBuffer"},et=function(be,Ue){return Ie(be)&&typeof Ue!="symbol"&&Ue in be&&String(+Ue)==String(Ue)},Ve=function(be,Ue){return et(be,Ue=k(Ue,!0))?x(2,be[Ue]):G(be,Ue)},fe=function(be,Ue,ge){return!(et(be,Ue=k(Ue,!0))&&V(ge)&&I(ge,"value"))||I(ge,"get")||I(ge,"set")||ge.configurable||I(ge,"writable")&&!ge.writable||I(ge,"enumerable")&&!ge.enumerable?O(be,Ue,ge):(be[Ue]=ge.value,be)};m?(Se||(A.f=Ve,M.f=fe,ht(Ge,"buffer"),ht(Ge,"byteOffset"),ht(Ge,"byteLength"),ht(Ge,"length")),f({target:"Object",stat:!0,forced:!Se},{getOwnPropertyDescriptor:Ve,defineProperty:fe}),l.exports=function(be,Ue,ge){var Je=be.match(/\d+$/)[0]/8,ut=be+(ge?"Clamped":"")+"Array",st="get"+be,We="set"+be,gt=p[ut],X=gt,re=X&&X.prototype,K={},j=function(oe,_e){O(oe,_e,{get:function(){return function(ae,Te){var Ee=R(ae);return Ee.view[st](Te*Je+Ee.byteOffset,!0)}(this,_e)},set:function(ae){return function(Te,Ee,ye){var Re=R(Te);ge&&(ye=(ye=z(ye))<0?0:ye>255?255:255&ye),Re.view[We](Ee*Je+Re.byteOffset,ye,!0)}(this,_e,ae)},enumerable:!0})};Se?y&&(X=Ue(function(oe,_e,ae,Te){return b(oe,X,ut),w(V(_e)?_t(_e)?Te!==void 0?new gt(_e,T(ae,Je),Te):ae!==void 0?new gt(_e,T(ae,Je)):new gt(_e):Ie(_e)?xe(X,_e):Q.call(X,_e):new gt(P(_e)),oe,X)}),te&&te(X,Pe),he(Z(gt),function(oe){oe in X||L(X,oe,gt[oe])}),X.prototype=re):(X=Ue(function(oe,_e,ae,Te){b(oe,X,ut);var Ee,ye,Re,Oe=0,Ne=0;if(V(_e)){if(!_t(_e))return Ie(_e)?xe(X,_e):Q.call(X,_e);Ee=_e,Ne=T(ae,Je);var qe=_e.byteLength;if(Te===void 0){if(qe%Je||(ye=qe-Ne)<0)throw Y(tt)}else if((ye=N(Te)*Je)+Ne>qe)throw Y(tt);Re=ye/Je}else Re=P(_e),Ee=new ie(ye=Re*Je);for(C(oe,{buffer:Ee,byteOffset:Ne,byteLength:ye,length:Re,view:new se(Ee)});Oe<Re;)j(oe,Oe++)}),te&&te(X,Pe),re=X.prototype=ne(Ge)),re.constructor!==X&&L(re,"constructor",X),we&&L(re,we,ut),K[ut]=X,f({global:!0,forced:X!=gt,sham:!Se},K),rt in X||L(X,rt,Je),rt in re||L(re,rt,Je),de(ut)}):l.exports=function(){}},3832:function(l,h,o){var f=o(7854),p=o(7293),m=o(7072),y=o(260).NATIVE_ARRAY_BUFFER_VIEWS,_=f.ArrayBuffer,S=f.Int8Array;l.exports=!y||!p(function(){S(1)})||!p(function(){new S(-1)})||!m(function(b){new S,new S(null),new S(1.5),new S(b)},!0)||p(function(){return new S(new _(2),1,void 0).length!==1})},7321:function(l,h,o){var f=o(7908),p=o(7466),m=o(1246),y=o(7659),_=o(9974),S=o(260).aTypedArrayConstructor;l.exports=function(b){var x,L,N,P,T,k,I=f(b),F=arguments.length,V=F>1?arguments[1]:void 0,ne=V!==void 0,te=m(I);if(te!=null&&!y(te))for(k=(T=te.call(I)).next,I=[];!(P=k.call(T)).done;)I.push(P.value);for(ne&&F>2&&(V=_(V,arguments[2],2)),L=p(I.length),N=new(S(this))(L),x=0;L>x;x++)N[x]=ne?V(I[x],x):I[x];return N}},9711:function(l){var h=0,o=Math.random();l.exports=function(f){return"Symbol("+String(f===void 0?"":f)+")_"+(++h+o).toString(36)}},3307:function(l,h,o){var f=o(133);l.exports=f&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},6061:function(l,h,o){var f=o(5112);h.f=f},5112:function(l,h,o){var f=o(7854),p=o(2309),m=o(6656),y=o(9711),_=o(133),S=o(3307),b=p("wks"),x=f.Symbol,L=S?x:x&&x.withoutSetter||y;l.exports=function(N){return m(b,N)||(_&&m(x,N)?b[N]=x[N]:b[N]=L("Symbol."+N)),b[N]}},1361:function(l){l.exports=`	
\v\f\r                　\u2028\u2029\uFEFF`},9575:function(l,h,o){var f=o(2109),p=o(7293),m=o(3331),y=o(9670),_=o(1400),S=o(7466),b=o(6707),x=m.ArrayBuffer,L=m.DataView,N=x.prototype.slice;f({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:p(function(){return!new x(2).slice(1,void 0).byteLength})},{slice:function(P,T){if(N!==void 0&&T===void 0)return N.call(y(this),P);for(var k=y(this).byteLength,I=_(P,k),F=_(T===void 0?k:T,k),V=new(b(this,x))(S(F-I)),ne=new L(this),te=new L(V),Z=0;I<F;)te.setUint8(Z++,ne.getUint8(I++));return V}})},2222:function(l,h,o){var f=o(2109),p=o(7293),m=o(3157),y=o(111),_=o(7908),S=o(7466),b=o(6135),x=o(5417),L=o(1194),N=o(5112),P=o(7392),T=N("isConcatSpreadable"),k=9007199254740991,I="Maximum allowed index exceeded",F=P>=51||!p(function(){var te=[];return te[T]=!1,te.concat()[0]!==te}),V=L("concat"),ne=function(te){if(!y(te))return!1;var Z=te[T];return Z!==void 0?!!Z:m(te)};f({target:"Array",proto:!0,forced:!F||!V},{concat:function(te){var Z,Q,he,de,M,A=_(this),v=x(A,0),w=0;for(Z=-1,he=arguments.length;Z<he;Z++)if(ne(M=Z===-1?A:arguments[Z])){if(w+(de=S(M.length))>k)throw TypeError(I);for(Q=0;Q<de;Q++,w++)Q in M&&b(v,w,M[Q])}else{if(w>=k)throw TypeError(I);b(v,w++,M)}return v.length=w,v}})},3290:function(l,h,o){var f=o(2109),p=o(1285),m=o(1223);f({target:"Array",proto:!0},{fill:p}),m("fill")},7327:function(l,h,o){var f=o(2109),p=o(2092).filter,m=o(1194),y=o(9207),_=m("filter"),S=y("filter");f({target:"Array",proto:!0,forced:!_||!S},{filter:function(b){return p(this,b,arguments.length>1?arguments[1]:void 0)}})},4553:function(l,h,o){var f=o(2109),p=o(2092).findIndex,m=o(1223),y=o(9207),_="findIndex",S=!0,b=y(_);_ in[]&&Array(1).findIndex(function(){S=!1}),f({target:"Array",proto:!0,forced:S||!b},{findIndex:function(x){return p(this,x,arguments.length>1?arguments[1]:void 0)}}),m(_)},9826:function(l,h,o){var f=o(2109),p=o(2092).find,m=o(1223),y=o(9207),_="find",S=!0,b=y(_);_ in[]&&Array(1).find(function(){S=!1}),f({target:"Array",proto:!0,forced:S||!b},{find:function(x){return p(this,x,arguments.length>1?arguments[1]:void 0)}}),m(_)},9554:function(l,h,o){var f=o(2109),p=o(8533);f({target:"Array",proto:!0,forced:[].forEach!=p},{forEach:p})},6699:function(l,h,o){var f=o(2109),p=o(1318).includes,m=o(1223);f({target:"Array",proto:!0,forced:!o(9207)("indexOf",{ACCESSORS:!0,1:0})},{includes:function(y){return p(this,y,arguments.length>1?arguments[1]:void 0)}}),m("includes")},6992:function(l,h,o){var f=o(5656),p=o(1223),m=o(7497),y=o(9909),_=o(654),S="Array Iterator",b=y.set,x=y.getterFor(S);l.exports=_(Array,"Array",function(L,N){b(this,{type:S,target:f(L),index:0,kind:N})},function(){var L=x(this),N=L.target,P=L.kind,T=L.index++;return!N||T>=N.length?(L.target=void 0,{value:void 0,done:!0}):P=="keys"?{value:T,done:!1}:P=="values"?{value:N[T],done:!1}:{value:[T,N[T]],done:!1}},"values"),m.Arguments=m.Array,p("keys"),p("values"),p("entries")},7042:function(l,h,o){var f=o(2109),p=o(111),m=o(3157),y=o(1400),_=o(7466),S=o(5656),b=o(6135),x=o(5112),L=o(1194),N=o(9207),P=L("slice"),T=N("slice",{ACCESSORS:!0,0:0,1:2}),k=x("species"),I=[].slice,F=Math.max;f({target:"Array",proto:!0,forced:!P||!T},{slice:function(V,ne){var te,Z,Q,he=S(this),de=_(he.length),M=y(V,de),A=y(ne===void 0?de:ne,de);if(m(he)&&(typeof(te=he.constructor)!="function"||te!==Array&&!m(te.prototype)?p(te)&&(te=te[k])===null&&(te=void 0):te=void 0,te===Array||te===void 0))return I.call(he,M,A);for(Z=new(te===void 0?Array:te)(F(A-M,0)),Q=0;M<A;M++,Q++)M in he&&b(Z,Q,he[M]);return Z.length=Q,Z}})},5212:function(l,h,o){var f=o(2109),p=o(2092).some,m=o(9341),y=o(9207),_=m("some"),S=y("some");f({target:"Array",proto:!0,forced:!_||!S},{some:function(b){return p(this,b,arguments.length>1?arguments[1]:void 0)}})},2707:function(l,h,o){var f=o(2109),p=o(3099),m=o(7908),y=o(7293),_=o(9341),S=[],b=S.sort,x=y(function(){S.sort(void 0)}),L=y(function(){S.sort(null)}),N=_("sort");f({target:"Array",proto:!0,forced:x||!L||!N},{sort:function(P){return P===void 0?b.call(m(this)):b.call(m(this),p(P))}})},561:function(l,h,o){var f=o(2109),p=o(1400),m=o(9958),y=o(7466),_=o(7908),S=o(5417),b=o(6135),x=o(1194),L=o(9207),N=x("splice"),P=L("splice",{ACCESSORS:!0,0:0,1:2}),T=Math.max,k=Math.min,I=9007199254740991,F="Maximum allowed length exceeded";f({target:"Array",proto:!0,forced:!N||!P},{splice:function(V,ne){var te,Z,Q,he,de,M,A=_(this),v=y(A.length),w=p(V,v),R=arguments.length;if(R===0?te=Z=0:R===1?(te=0,Z=v-w):(te=R-2,Z=k(T(m(ne),0),v-w)),v+te-Z>I)throw TypeError(F);for(Q=S(A,Z),he=0;he<Z;he++)(de=w+he)in A&&b(Q,he,A[de]);if(Q.length=Z,te<Z){for(he=w;he<v-Z;he++)M=he+te,(de=he+Z)in A?A[M]=A[de]:delete A[M];for(he=v;he>v-Z+te;he--)delete A[he-1]}else if(te>Z)for(he=v-Z;he>w;he--)M=he+te-1,(de=he+Z-1)in A?A[M]=A[de]:delete A[M];for(he=0;he<te;he++)A[he+w]=arguments[he+2];return A.length=v-Z+te,Q}})},1532:function(l,h,o){var f=o(7710),p=o(5631);l.exports=f("Map",function(m){return function(){return m(this,arguments.length?arguments[0]:void 0)}},p)},9653:function(l,h,o){var f=o(9781),p=o(7854),m=o(4705),y=o(1320),_=o(6656),S=o(4326),b=o(9587),x=o(7593),L=o(7293),N=o(30),P=o(8006).f,T=o(1236).f,k=o(3070).f,I=o(3111).trim,F="Number",V=p.Number,ne=V.prototype,te=S(N(ne))==F,Z=function(A){var v,w,R,C,O,G,z,Y,ie=x(A,!1);if(typeof ie=="string"&&ie.length>2){if((v=(ie=I(ie)).charCodeAt(0))===43||v===45){if((w=ie.charCodeAt(2))===88||w===120)return NaN}else if(v===48){switch(ie.charCodeAt(1)){case 66:case 98:R=2,C=49;break;case 79:case 111:R=8,C=55;break;default:return+ie}for(G=(O=ie.slice(2)).length,z=0;z<G;z++)if((Y=O.charCodeAt(z))<48||Y>C)return NaN;return parseInt(O,R)}}return+ie};if(m(F,!V(" 0o1")||!V("0b1")||V("+0x1"))){for(var Q,he=function(A){var v=arguments.length<1?0:A,w=this;return w instanceof he&&(te?L(function(){ne.valueOf.call(w)}):S(w)!=F)?b(new V(Z(v)),w,he):Z(v)},de=f?P(V):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),M=0;de.length>M;M++)_(V,Q=de[M])&&!_(he,Q)&&k(he,Q,T(V,Q));he.prototype=ne,ne.constructor=he,y(p,F,he)}},5192:function(l,h,o){o(2109)({target:"Number",stat:!0},{isFinite:o(7023)})},4363:function(l,h,o){o(2109)({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991})},9494:function(l,h,o){var f=o(2109),p=o(3009);f({target:"Number",stat:!0,forced:Number.parseInt!=p},{parseInt:p})},9720:function(l,h,o){var f=o(2109),p=o(4699).entries;f({target:"Object",stat:!0},{entries:function(m){return p(m)}})},489:function(l,h,o){var f=o(2109),p=o(7293),m=o(7908),y=o(9518),_=o(8544);f({target:"Object",stat:!0,forced:p(function(){y(1)}),sham:!_},{getPrototypeOf:function(S){return y(m(S))}})},8304:function(l,h,o){o(2109)({target:"Object",stat:!0},{setPrototypeOf:o(7674)})},1539:function(l,h,o){var f=o(1694),p=o(1320),m=o(288);f||p(Object.prototype,"toString",m,{unsafe:!0})},4916:function(l,h,o){var f=o(2109),p=o(2261);f({target:"RegExp",proto:!0,forced:/./.exec!==p},{exec:p})},9714:function(l,h,o){var f=o(1320),p=o(9670),m=o(7293),y=o(7066),_="toString",S=RegExp.prototype,b=S.toString,x=m(function(){return b.call({source:"a",flags:"b"})!="/a/b"}),L=b.name!=_;(x||L)&&f(RegExp.prototype,_,function(){var N=p(this),P=String(N.source),T=N.flags;return"/"+P+"/"+String(T===void 0&&N instanceof RegExp&&!("flags"in S)?y.call(N):T)},{unsafe:!0})},189:function(l,h,o){var f=o(7710),p=o(5631);l.exports=f("Set",function(m){return function(){return m(this,arguments.length?arguments[0]:void 0)}},p)},2023:function(l,h,o){var f=o(2109),p=o(3929),m=o(4488);f({target:"String",proto:!0,forced:!o(4964)("includes")},{includes:function(y){return!!~String(m(this)).indexOf(p(y),arguments.length>1?arguments[1]:void 0)}})},8783:function(l,h,o){var f=o(8710).charAt,p=o(9909),m=o(654),y="String Iterator",_=p.set,S=p.getterFor(y);m(String,"String",function(b){_(this,{type:y,string:String(b),index:0})},function(){var b,x=S(this),L=x.string,N=x.index;return N>=L.length?{value:void 0,done:!0}:(b=f(L,N),x.index+=b.length,{value:b,done:!1})})},3112:function(l,h,o){var f=o(2109),p=o(6650).start;f({target:"String",proto:!0,forced:o(4986)},{padStart:function(m){return p(this,m,arguments.length>1?arguments[1]:void 0)}})},5306:function(l,h,o){var f=o(7007),p=o(9670),m=o(7466),y=o(9958),_=o(4488),S=o(1530),b=o(647),x=o(7651),L=Math.max,N=Math.min;f("replace",2,function(P,T,k,I){var F=I.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,V=I.REPLACE_KEEPS_$0,ne=F?"$":"$0";return[function(te,Z){var Q=_(this),he=te==null?void 0:te[P];return he!==void 0?he.call(te,Q,Z):T.call(String(Q),te,Z)},function(te,Z){if(!F&&V||typeof Z=="string"&&Z.indexOf(ne)===-1){var Q=k(T,te,this,Z);if(Q.done)return Q.value}var he=p(te),de=String(this),M=typeof Z=="function";M||(Z=String(Z));var A=he.global;if(A){var v=he.unicode;he.lastIndex=0}for(var w=[];;){var R=x(he,de);if(R===null||(w.push(R),!A))break;String(R[0])===""&&(he.lastIndex=S(de,m(he.lastIndex),v))}for(var C,O="",G=0,z=0;z<w.length;z++){R=w[z];for(var Y=String(R[0]),ie=L(N(y(R.index),de.length),0),se=[],Se=1;Se<R.length;Se++)se.push((C=R[Se])===void 0?C:String(C));var we=R.groups;if(M){var Pe=[Y].concat(se,ie,de);we!==void 0&&Pe.push(we);var Ge=String(Z.apply(void 0,Pe))}else Ge=b(Y,de,ie,se,we,Z);ie>=G&&(O+=de.slice(G,ie)+Ge,G=ie+Y.length)}return O+de.slice(G)}]})},1817:function(l,h,o){var f=o(2109),p=o(9781),m=o(7854),y=o(6656),_=o(111),S=o(3070).f,b=o(9920),x=m.Symbol;if(p&&typeof x=="function"&&(!("description"in x.prototype)||x().description!==void 0)){var L={},N=function(){var F=arguments.length<1||arguments[0]===void 0?void 0:String(arguments[0]),V=this instanceof N?new x(F):F===void 0?x():x(F);return F===""&&(L[V]=!0),V};b(N,x);var P=N.prototype=x.prototype;P.constructor=N;var T=P.toString,k=String(x("test"))=="Symbol(test)",I=/^Symbol\((.*)\)[^)]+$/;S(P,"description",{configurable:!0,get:function(){var F=_(this)?this.valueOf():this,V=T.call(F);if(y(L,F))return"";var ne=k?V.slice(7,-1):V.replace(I,"$1");return ne===""?void 0:ne}}),f({global:!0,forced:!0},{Symbol:N})}},2526:function(l,h,o){var f=o(2109),p=o(7854),m=o(5005),y=o(1913),_=o(9781),S=o(133),b=o(3307),x=o(7293),L=o(6656),N=o(3157),P=o(111),T=o(9670),k=o(7908),I=o(5656),F=o(7593),V=o(9114),ne=o(30),te=o(1956),Z=o(8006),Q=o(1156),he=o(5181),de=o(1236),M=o(3070),A=o(5296),v=o(8880),w=o(1320),R=o(2309),C=o(6200),O=o(3501),G=o(9711),z=o(5112),Y=o(6061),ie=o(7235),se=o(8003),Se=o(9909),we=o(2092).forEach,Pe=C("hidden"),Ge="Symbol",it=z("toPrimitive"),Ie=Se.set,rt=Se.getterFor(Ge),tt=Object.prototype,xe=p.Symbol,ht=m("JSON","stringify"),_t=de.f,et=M.f,Ve=Q.f,fe=A.f,be=R("symbols"),Ue=R("op-symbols"),ge=R("string-to-symbol-registry"),Je=R("symbol-to-string-registry"),ut=R("wks"),st=p.QObject,We=!st||!st.prototype||!st.prototype.findChild,gt=_&&x(function(){return ne(et({},"a",{get:function(){return et(this,"a",{value:7}).a}})).a!=7})?function(Ee,ye,Re){var Oe=_t(tt,ye);Oe&&delete tt[ye],et(Ee,ye,Re),Oe&&Ee!==tt&&et(tt,ye,Oe)}:et,X=function(Ee,ye){var Re=be[Ee]=ne(xe.prototype);return Ie(Re,{type:Ge,tag:Ee,description:ye}),_||(Re.description=ye),Re},re=b?function(Ee){return typeof Ee=="symbol"}:function(Ee){return Object(Ee)instanceof xe},K=function(Ee,ye,Re){Ee===tt&&K(Ue,ye,Re),T(Ee);var Oe=F(ye,!0);return T(Re),L(be,Oe)?(Re.enumerable?(L(Ee,Pe)&&Ee[Pe][Oe]&&(Ee[Pe][Oe]=!1),Re=ne(Re,{enumerable:V(0,!1)})):(L(Ee,Pe)||et(Ee,Pe,V(1,{})),Ee[Pe][Oe]=!0),gt(Ee,Oe,Re)):et(Ee,Oe,Re)},j=function(Ee,ye){T(Ee);var Re=I(ye),Oe=te(Re).concat(Te(Re));return we(Oe,function(Ne){_&&!oe.call(Re,Ne)||K(Ee,Ne,Re[Ne])}),Ee},oe=function(Ee){var ye=F(Ee,!0),Re=fe.call(this,ye);return!(this===tt&&L(be,ye)&&!L(Ue,ye))&&(!(Re||!L(this,ye)||!L(be,ye)||L(this,Pe)&&this[Pe][ye])||Re)},_e=function(Ee,ye){var Re=I(Ee),Oe=F(ye,!0);if(Re!==tt||!L(be,Oe)||L(Ue,Oe)){var Ne=_t(Re,Oe);return!Ne||!L(be,Oe)||L(Re,Pe)&&Re[Pe][Oe]||(Ne.enumerable=!0),Ne}},ae=function(Ee){var ye=Ve(I(Ee)),Re=[];return we(ye,function(Oe){L(be,Oe)||L(O,Oe)||Re.push(Oe)}),Re},Te=function(Ee){var ye=Ee===tt,Re=Ve(ye?Ue:I(Ee)),Oe=[];return we(Re,function(Ne){!L(be,Ne)||ye&&!L(tt,Ne)||Oe.push(be[Ne])}),Oe};S||(w((xe=function(){if(this instanceof xe)throw TypeError("Symbol is not a constructor");var Ee=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,ye=G(Ee),Re=function(Oe){this===tt&&Re.call(Ue,Oe),L(this,Pe)&&L(this[Pe],ye)&&(this[Pe][ye]=!1),gt(this,ye,V(1,Oe))};return _&&We&&gt(tt,ye,{configurable:!0,set:Re}),X(ye,Ee)}).prototype,"toString",function(){return rt(this).tag}),w(xe,"withoutSetter",function(Ee){return X(G(Ee),Ee)}),A.f=oe,M.f=K,de.f=_e,Z.f=Q.f=ae,he.f=Te,Y.f=function(Ee){return X(z(Ee),Ee)},_&&(et(xe.prototype,"description",{configurable:!0,get:function(){return rt(this).description}}),y||w(tt,"propertyIsEnumerable",oe,{unsafe:!0}))),f({global:!0,wrap:!0,forced:!S,sham:!S},{Symbol:xe}),we(te(ut),function(Ee){ie(Ee)}),f({target:Ge,stat:!0,forced:!S},{for:function(Ee){var ye=String(Ee);if(L(ge,ye))return ge[ye];var Re=xe(ye);return ge[ye]=Re,Je[Re]=ye,Re},keyFor:function(Ee){if(!re(Ee))throw TypeError(Ee+" is not a symbol");if(L(Je,Ee))return Je[Ee]},useSetter:function(){We=!0},useSimple:function(){We=!1}}),f({target:"Object",stat:!0,forced:!S,sham:!_},{create:function(Ee,ye){return ye===void 0?ne(Ee):j(ne(Ee),ye)},defineProperty:K,defineProperties:j,getOwnPropertyDescriptor:_e}),f({target:"Object",stat:!0,forced:!S},{getOwnPropertyNames:ae,getOwnPropertySymbols:Te}),f({target:"Object",stat:!0,forced:x(function(){he.f(1)})},{getOwnPropertySymbols:function(Ee){return he.f(k(Ee))}}),ht&&f({target:"JSON",stat:!0,forced:!S||x(function(){var Ee=xe();return ht([Ee])!="[null]"||ht({a:Ee})!="{}"||ht(Object(Ee))!="{}"})},{stringify:function(Ee,ye,Re){for(var Oe,Ne=[Ee],qe=1;arguments.length>qe;)Ne.push(arguments[qe++]);if(Oe=ye,(P(ye)||Ee!==void 0)&&!re(Ee))return N(ye)||(ye=function(ft,St){if(typeof Oe=="function"&&(St=Oe.call(this,ft,St)),!re(St))return St}),Ne[1]=ye,ht.apply(null,Ne)}}),xe.prototype[it]||v(xe.prototype,it,xe.prototype.valueOf),se(xe,Ge),O[Pe]=!0},2990:function(l,h,o){var f=o(260),p=o(1048),m=f.aTypedArray;(0,f.exportTypedArrayMethod)("copyWithin",function(y,_){return p.call(m(this),y,_,arguments.length>2?arguments[2]:void 0)})},8927:function(l,h,o){var f=o(260),p=o(2092).every,m=f.aTypedArray;(0,f.exportTypedArrayMethod)("every",function(y){return p(m(this),y,arguments.length>1?arguments[1]:void 0)})},3105:function(l,h,o){var f=o(260),p=o(1285),m=f.aTypedArray;(0,f.exportTypedArrayMethod)("fill",function(y){return p.apply(m(this),arguments)})},5035:function(l,h,o){var f=o(260),p=o(2092).filter,m=o(6707),y=f.aTypedArray,_=f.aTypedArrayConstructor;(0,f.exportTypedArrayMethod)("filter",function(S){for(var b=p(y(this),S,arguments.length>1?arguments[1]:void 0),x=m(this,this.constructor),L=0,N=b.length,P=new(_(x))(N);N>L;)P[L]=b[L++];return P})},7174:function(l,h,o){var f=o(260),p=o(2092).findIndex,m=f.aTypedArray;(0,f.exportTypedArrayMethod)("findIndex",function(y){return p(m(this),y,arguments.length>1?arguments[1]:void 0)})},4345:function(l,h,o){var f=o(260),p=o(2092).find,m=f.aTypedArray;(0,f.exportTypedArrayMethod)("find",function(y){return p(m(this),y,arguments.length>1?arguments[1]:void 0)})},2846:function(l,h,o){var f=o(260),p=o(2092).forEach,m=f.aTypedArray;(0,f.exportTypedArrayMethod)("forEach",function(y){p(m(this),y,arguments.length>1?arguments[1]:void 0)})},4731:function(l,h,o){var f=o(260),p=o(1318).includes,m=f.aTypedArray;(0,f.exportTypedArrayMethod)("includes",function(y){return p(m(this),y,arguments.length>1?arguments[1]:void 0)})},7209:function(l,h,o){var f=o(260),p=o(1318).indexOf,m=f.aTypedArray;(0,f.exportTypedArrayMethod)("indexOf",function(y){return p(m(this),y,arguments.length>1?arguments[1]:void 0)})},6319:function(l,h,o){var f=o(7854),p=o(260),m=o(6992),y=o(5112)("iterator"),_=f.Uint8Array,S=m.values,b=m.keys,x=m.entries,L=p.aTypedArray,N=p.exportTypedArrayMethod,P=_&&_.prototype[y],T=!!P&&(P.name=="values"||P.name==null),k=function(){return S.call(L(this))};N("entries",function(){return x.call(L(this))}),N("keys",function(){return b.call(L(this))}),N("values",k,!T),N(y,k,!T)},8867:function(l,h,o){var f=o(260),p=f.aTypedArray,m=f.exportTypedArrayMethod,y=[].join;m("join",function(_){return y.apply(p(this),arguments)})},7789:function(l,h,o){var f=o(260),p=o(6583),m=f.aTypedArray;(0,f.exportTypedArrayMethod)("lastIndexOf",function(y){return p.apply(m(this),arguments)})},3739:function(l,h,o){var f=o(260),p=o(2092).map,m=o(6707),y=f.aTypedArray,_=f.aTypedArrayConstructor;(0,f.exportTypedArrayMethod)("map",function(S){return p(y(this),S,arguments.length>1?arguments[1]:void 0,function(b,x){return new(_(m(b,b.constructor)))(x)})})},4483:function(l,h,o){var f=o(260),p=o(3671).right,m=f.aTypedArray;(0,f.exportTypedArrayMethod)("reduceRight",function(y){return p(m(this),y,arguments.length,arguments.length>1?arguments[1]:void 0)})},9368:function(l,h,o){var f=o(260),p=o(3671).left,m=f.aTypedArray;(0,f.exportTypedArrayMethod)("reduce",function(y){return p(m(this),y,arguments.length,arguments.length>1?arguments[1]:void 0)})},2056:function(l,h,o){var f=o(260),p=f.aTypedArray,m=f.exportTypedArrayMethod,y=Math.floor;m("reverse",function(){for(var _,S=this,b=p(S).length,x=y(b/2),L=0;L<x;)_=S[L],S[L++]=S[--b],S[b]=_;return S})},3462:function(l,h,o){var f=o(260),p=o(7466),m=o(4590),y=o(7908),_=o(7293),S=f.aTypedArray;(0,f.exportTypedArrayMethod)("set",function(b){S(this);var x=m(arguments.length>1?arguments[1]:void 0,1),L=this.length,N=y(b),P=p(N.length),T=0;if(P+x>L)throw RangeError("Wrong length");for(;T<P;)this[x+T]=N[T++]},_(function(){new Int8Array(1).set({})}))},678:function(l,h,o){var f=o(260),p=o(6707),m=o(7293),y=f.aTypedArray,_=f.aTypedArrayConstructor,S=f.exportTypedArrayMethod,b=[].slice;S("slice",function(x,L){for(var N=b.call(y(this),x,L),P=p(this,this.constructor),T=0,k=N.length,I=new(_(P))(k);k>T;)I[T]=N[T++];return I},m(function(){new Int8Array(1).slice()}))},7462:function(l,h,o){var f=o(260),p=o(2092).some,m=f.aTypedArray;(0,f.exportTypedArrayMethod)("some",function(y){return p(m(this),y,arguments.length>1?arguments[1]:void 0)})},3824:function(l,h,o){var f=o(260),p=f.aTypedArray,m=f.exportTypedArrayMethod,y=[].sort;m("sort",function(_){return y.call(p(this),_)})},5021:function(l,h,o){var f=o(260),p=o(7466),m=o(1400),y=o(6707),_=f.aTypedArray;(0,f.exportTypedArrayMethod)("subarray",function(S,b){var x=_(this),L=x.length,N=m(S,L);return new(y(x,x.constructor))(x.buffer,x.byteOffset+N*x.BYTES_PER_ELEMENT,p((b===void 0?L:m(b,L))-N))})},2974:function(l,h,o){var f=o(7854),p=o(260),m=o(7293),y=f.Int8Array,_=p.aTypedArray,S=p.exportTypedArrayMethod,b=[].toLocaleString,x=[].slice,L=!!y&&m(function(){b.call(new y(1))});S("toLocaleString",function(){return b.apply(L?x.call(_(this)):_(this),arguments)},m(function(){return[1,2].toLocaleString()!=new y([1,2]).toLocaleString()})||!m(function(){y.prototype.toLocaleString.call([1,2])}))},5016:function(l,h,o){var f=o(260).exportTypedArrayMethod,p=o(7293),m=o(7854).Uint8Array,y=m&&m.prototype||{},_=[].toString,S=[].join;p(function(){_.call({})})&&(_=function(){return S.call(this)});var b=y.toString!=_;f("toString",_,b)},2472:function(l,h,o){o(9843)("Uint8",function(f){return function(p,m,y){return f(this,p,m,y)}})},4747:function(l,h,o){var f=o(7854),p=o(8324),m=o(8533),y=o(8880);for(var _ in p){var S=f[_],b=S&&S.prototype;if(b&&b.forEach!==m)try{y(b,"forEach",m)}catch{b.forEach=m}}},3948:function(l,h,o){var f=o(7854),p=o(8324),m=o(6992),y=o(8880),_=o(5112),S=_("iterator"),b=_("toStringTag"),x=m.values;for(var L in p){var N=f[L],P=N&&N.prototype;if(P){if(P[S]!==x)try{y(P,S,x)}catch{P[S]=x}if(P[b]||y(P,b,L),p[L]){for(var T in m)if(P[T]!==m[T])try{y(P,T,m[T])}catch{P[T]=m[T]}}}}}},u={};function c(l){if(u[l])return u[l].exports;var h=u[l]={exports:{}};return d[l](h,h.exports,c),h.exports}return c.d=function(l,h){for(var o in h)c.o(h,o)&&!c.o(l,o)&&Object.defineProperty(l,o,{enumerable:!0,get:h[o]})},c.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),c.o=function(l,h){return Object.prototype.hasOwnProperty.call(l,h)},c.r=function(l){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},c(9798)}()},845:(r,d,u)=>{/*! art-template@runtime | https://github.com/aui/art-template */var c=typeof self<"u"?self:typeof window<"u"?window:u.g!==void 0?u.g:{},l=Object.create(c),h=/["&'<>]/;function o(f){return typeof f!="string"&&(f=f==null?"":typeof f=="function"?o(f.call(f)):JSON.stringify(f)),f}l.$escape=function(f){return function(p){var m=""+p,y=h.exec(m);if(!y)return p;var _="",S=void 0,b=void 0,x=void 0;for(S=y.index,b=0;S<m.length;S++){switch(m.charCodeAt(S)){case 34:x="&#34;";break;case 38:x="&#38;";break;case 39:x="&#39;";break;case 60:x="&#60;";break;case 62:x="&#62;";break;default:continue}b!==S&&(_+=m.substring(b,S)),b=S+1,_+=x}return b!==S?_+m.substring(b,S):_}(o(f))},l.$each=function(f,p){if(Array.isArray(f))for(var m=0,y=f.length;m<y;m++)p(f[m],m);else for(var _ in f)p(f[_],_)},r.exports=l},143:(r,d,u)=>{r.exports=u(845)},122:r=>{r.exports=function(d){var u=[];return u.toString=function(){return this.map(function(c){var l="",h=c[5]!==void 0;return c[4]&&(l+="@supports (".concat(c[4],") {")),c[2]&&(l+="@media ".concat(c[2]," {")),h&&(l+="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {")),l+=d(c),h&&(l+="}"),c[2]&&(l+="}"),c[4]&&(l+="}"),l}).join("")},u.i=function(c,l,h,o,f){typeof c=="string"&&(c=[[null,c,void 0]]);var p={};if(h)for(var m=0;m<this.length;m++){var y=this[m][0];y!=null&&(p[y]=!0)}for(var _=0;_<c.length;_++){var S=[].concat(c[_]);h&&p[S[0]]||(f!==void 0&&(S[5]===void 0||(S[1]="@layer".concat(S[5].length>0?" ".concat(S[5]):""," {").concat(S[1],"}")),S[5]=f),l&&(S[2]&&(S[1]="@media ".concat(S[2]," {").concat(S[1],"}")),S[2]=l),o&&(S[4]?(S[1]="@supports (".concat(S[4],") {").concat(S[1],"}"),S[4]=o):S[4]="".concat(o)),u.push(S))}},u}},34:r=>{r.exports=function(d){var u=d[1],c=d[3];if(!c)return u;if(typeof btoa=="function"){var l=btoa(unescape(encodeURIComponent(JSON.stringify(c)))),h="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(l),o="/*# ".concat(h," */");return[u].concat([o]).join(`
`)}return[u].join(`
`)}},72:r=>{var d=[];function u(h){for(var o=-1,f=0;f<d.length;f++)if(d[f].identifier===h){o=f;break}return o}function c(h,o){for(var f={},p=[],m=0;m<h.length;m++){var y=h[m],_=o.base?y[0]+o.base:y[0],S=f[_]||0,b="".concat(_," ").concat(S);f[_]=S+1;var x=u(b),L={css:y[1],media:y[2],sourceMap:y[3],supports:y[4],layer:y[5]};if(x!==-1)d[x].references++,d[x].updater(L);else{var N=l(L,o);o.byIndex=m,d.splice(m,0,{identifier:b,updater:N,references:1})}p.push(b)}return p}function l(h,o){var f=o.domAPI(o);return f.update(h),function(p){if(p){if(p.css===h.css&&p.media===h.media&&p.sourceMap===h.sourceMap&&p.supports===h.supports&&p.layer===h.layer)return;f.update(h=p)}else f.remove()}}r.exports=function(h,o){var f=c(h=h||[],o=o||{});return function(p){p=p||[];for(var m=0;m<f.length;m++){var y=u(f[m]);d[y].references--}for(var _=c(p,o),S=0;S<f.length;S++){var b=u(f[S]);d[b].references===0&&(d[b].updater(),d.splice(b,1))}f=_}}},659:r=>{var d={};r.exports=function(u,c){var l=function(h){if(d[h]===void 0){var o=document.querySelector(h);if(window.HTMLIFrameElement&&o instanceof window.HTMLIFrameElement)try{o=o.contentDocument.head}catch{o=null}d[h]=o}return d[h]}(u);if(!l)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");l.appendChild(c)}},540:r=>{r.exports=function(d){var u=document.createElement("style");return d.setAttributes(u,d.attributes),d.insert(u,d.options),u}},56:(r,d,u)=>{r.exports=function(c){var l=u.nc;l&&c.setAttribute("nonce",l)}},825:r=>{r.exports=function(d){if(typeof document>"u")return{update:function(){},remove:function(){}};var u=d.insertStyleElement(d);return{update:function(c){(function(l,h,o){var f="";o.supports&&(f+="@supports (".concat(o.supports,") {")),o.media&&(f+="@media ".concat(o.media," {"));var p=o.layer!==void 0;p&&(f+="@layer".concat(o.layer.length>0?" ".concat(o.layer):""," {")),f+=o.css,p&&(f+="}"),o.media&&(f+="}"),o.supports&&(f+="}");var m=o.sourceMap;m&&typeof btoa<"u"&&(f+=`
/*# sourceMappingURL=data:application/json;base64,`.concat(btoa(unescape(encodeURIComponent(JSON.stringify(m))))," */")),h.styleTagTransform(f,l,h.options)})(u,d,c)},remove:function(){(function(c){if(c.parentNode===null)return!1;c.parentNode.removeChild(c)})(u)}}}},113:r=>{r.exports=function(d,u){if(u.styleSheet)u.styleSheet.cssText=d;else{for(;u.firstChild;)u.removeChild(u.firstChild);u.appendChild(document.createTextNode(d))}}},28:r=>{r.exports='<svg viewBox="0 0 288 288" xmlns="http://www.w3.org/2000/svg"><path d="M288 90v96c0 20-16 36-36 36h-10c-16 0-16-24 0-24h10c7 0 12-5 12-12V90c0-7-5-12-12-12H36c-7 0-12 5-12 12v96c0 7 5 12 12 12h10c16 0 16 24 0 24H36c-20 0-36-16-36-36V90c0-20 16-36 36-36h216c20 0 36 16 36 36zm-120 62l48 68c14 20 1 38-20 38H92c-21 0-34-18-20-38l48-68c13-18 35-18 48 0z"></path></svg>'},177:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 512 512"><path d="M11.5 280.6l192 160c20.6 17.2 52.5 2.8 52.5-24.6V96c0-27.4-31.9-41.8-52.5-24.6l-192 160c-15.3 12.8-15.3 36.4 0 49.2zm256 0l192 160c20.6 17.2 52.5 2.8 52.5-24.6V96c0-27.4-31.9-41.8-52.5-24.6l-192 160c-15.3 12.8-15.3 36.4 0 49.2z"></path></svg>'},631:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M16 23c-3.309 0-6-2.691-6-6s2.691-6 6-6 6 2.691 6 6-2.691 6-6 6zM16 13c-2.206 0-4 1.794-4 4s1.794 4 4 4c2.206 0 4-1.794 4-4s-1.794-4-4-4zM27 28h-22c-1.654 0-3-1.346-3-3v-16c0-1.654 1.346-3 3-3h3c0.552 0 1 0.448 1 1s-0.448 1-1 1h-3c-0.551 0-1 0.449-1 1v16c0 0.552 0.449 1 1 1h22c0.552 0 1-0.448 1-1v-16c0-0.551-0.448-1-1-1h-11c-0.552 0-1-0.448-1-1s0.448-1 1-1h11c1.654 0 3 1.346 3 3v16c0 1.654-1.346 3-3 3zM24 10.5c0 0.828 0.672 1.5 1.5 1.5s1.5-0.672 1.5-1.5c0-0.828-0.672-1.5-1.5-1.5s-1.5 0.672-1.5 1.5zM15 4c0 0.552-0.448 1-1 1h-4c-0.552 0-1-0.448-1-1v0c0-0.552 0.448-1 1-1h4c0.552 0 1 0.448 1 1v0z"></path></svg>'},642:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 24 24"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg>'},165:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M27.090 0.131h-22.731c-2.354 0-4.262 1.839-4.262 4.109v16.401c0 2.269 1.908 4.109 4.262 4.109h4.262v-2.706h8.469l-8.853 8.135 1.579 1.451 7.487-6.88h9.787c2.353 0 4.262-1.84 4.262-4.109v-16.401c0-2.27-1.909-4.109-4.262-4.109v0zM28.511 19.304c0 1.512-1.272 2.738-2.841 2.738h-8.425l-0.076-0.070-0.076 0.070h-11.311c-1.569 0-2.841-1.226-2.841-2.738v-13.696c0-1.513 1.272-2.739 2.841-2.739h19.889c1.569 0 2.841-0.142 2.841 1.37v15.064z"></path></svg>'},1:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M27.128 0.38h-22.553c-2.336 0-4.229 1.825-4.229 4.076v16.273c0 2.251 1.893 4.076 4.229 4.076h4.229v-2.685h8.403l-8.784 8.072 1.566 1.44 7.429-6.827h9.71c2.335 0 4.229-1.825 4.229-4.076v-16.273c0-2.252-1.894-4.076-4.229-4.076zM28.538 19.403c0 1.5-1.262 2.717-2.819 2.717h-8.36l-0.076-0.070-0.076 0.070h-11.223c-1.557 0-2.819-1.217-2.819-2.717v-13.589c0-1.501 1.262-2.718 2.819-2.718h19.734c1.557 0 2.819-0.141 2.819 1.359v14.947zM9.206 10.557c-1.222 0-2.215 0.911-2.215 2.036s0.992 2.035 2.215 2.035c1.224 0 2.216-0.911 2.216-2.035s-0.992-2.036-2.216-2.036zM22.496 10.557c-1.224 0-2.215 0.911-2.215 2.036s0.991 2.035 2.215 2.035c1.224 0 2.215-0.911 2.215-2.035s-0.991-2.036-2.215-2.036zM15.852 10.557c-1.224 0-2.215 0.911-2.215 2.036s0.991 2.035 2.215 2.035c1.222 0 2.215-0.911 2.215-2.035s-0.992-2.036-2.215-2.036z"></path></svg>'},833:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 512 512"><path d="M500.5 231.4l-192-160C287.9 54.3 256 68.6 256 96v320c0 27.4 31.9 41.8 52.5 24.6l192-160c15.3-12.8 15.3-36.4 0-49.2zm-256 0l-192-160C31.9 54.3 0 68.6 0 96v320c0 27.4 31.9 41.8 52.5 24.6l192-160c15.3-12.8 15.3-36.4 0-49.2z"></path></svg>'},928:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 33"><path d="M24.965 24.38h-18.132c-1.366 0-2.478-1.113-2.478-2.478v-11.806c0-1.364 1.111-2.478 2.478-2.478h18.132c1.366 0 2.478 1.113 2.478 2.478v11.806c0 1.364-1.11 2.478-2.478 2.478zM6.833 10.097v11.806h18.134l-0.002-11.806h-18.132zM2.478 28.928h5.952c0.684 0 1.238-0.554 1.238-1.239 0-0.684-0.554-1.238-1.238-1.238h-5.952v-5.802c0-0.684-0.554-1.239-1.238-1.239s-1.239 0.556-1.239 1.239v5.802c0 1.365 1.111 2.478 2.478 2.478zM30.761 19.412c-0.684 0-1.238 0.554-1.238 1.238v5.801h-5.951c-0.686 0-1.239 0.554-1.239 1.238 0 0.686 0.554 1.239 1.239 1.239h5.951c1.366 0 2.478-1.111 2.478-2.478v-5.801c0-0.683-0.554-1.238-1.239-1.238zM0 5.55v5.802c0 0.683 0.554 1.238 1.238 1.238s1.238-0.555 1.238-1.238v-5.802h5.952c0.684 0 1.238-0.554 1.238-1.238s-0.554-1.238-1.238-1.238h-5.951c-1.366-0.001-2.478 1.111-2.478 2.476zM32 11.35v-5.801c0-1.365-1.11-2.478-2.478-2.478h-5.951c-0.686 0-1.239 0.554-1.239 1.238s0.554 1.238 1.239 1.238h5.951v5.801c0 0.683 0.554 1.237 1.238 1.237 0.686 0.002 1.239-0.553 1.239-1.236z"></path></svg>'},717:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 33"><path d="M6.667 28h-5.333c-0.8 0-1.333-0.533-1.333-1.333v-5.333c0-0.8 0.533-1.333 1.333-1.333s1.333 0.533 1.333 1.333v4h4c0.8 0 1.333 0.533 1.333 1.333s-0.533 1.333-1.333 1.333zM30.667 28h-5.333c-0.8 0-1.333-0.533-1.333-1.333s0.533-1.333 1.333-1.333h4v-4c0-0.8 0.533-1.333 1.333-1.333s1.333 0.533 1.333 1.333v5.333c0 0.8-0.533 1.333-1.333 1.333zM30.667 12c-0.8 0-1.333-0.533-1.333-1.333v-4h-4c-0.8 0-1.333-0.533-1.333-1.333s0.533-1.333 1.333-1.333h5.333c0.8 0 1.333 0.533 1.333 1.333v5.333c0 0.8-0.533 1.333-1.333 1.333zM1.333 12c-0.8 0-1.333-0.533-1.333-1.333v-5.333c0-0.8 0.533-1.333 1.333-1.333h5.333c0.8 0 1.333 0.533 1.333 1.333s-0.533 1.333-1.333 1.333h-4v4c0 0.8-0.533 1.333-1.333 1.333z"></path></svg>'},105:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32" transform="scale(-1,1)"><path d="M22 16l-10.105-10.6-1.895 1.987 8.211 8.613-8.211 8.612 1.895 1.988 8.211-8.613z"></path></svg>'},454:r=>{r.exports='<svg version="1.1" viewBox="0 0 22 22"><svg x="7" y="1"><circle class="dplayer-loading-dot dplayer-loading-dot-0" cx="4" cy="4" r="2"></circle></svg><svg x="11" y="3"><circle class="dplayer-loading-dot dplayer-loading-dot-1" cx="4" cy="4" r="2"></circle></svg><svg x="13" y="7"><circle class="dplayer-loading-dot dplayer-loading-dot-2" cx="4" cy="4" r="2"></circle></svg><svg x="11" y="11"><circle class="dplayer-loading-dot dplayer-loading-dot-3" cx="4" cy="4" r="2"></circle></svg><svg x="7" y="13"><circle class="dplayer-loading-dot dplayer-loading-dot-4" cx="4" cy="4" r="2"></circle></svg><svg x="3" y="11"><circle class="dplayer-loading-dot dplayer-loading-dot-5" cx="4" cy="4" r="2"></circle></svg><svg x="1" y="7"><circle class="dplayer-loading-dot dplayer-loading-dot-6" cx="4" cy="4" r="2"></circle></svg><svg x="3" y="3"><circle class="dplayer-loading-dot dplayer-loading-dot-7" cx="4" cy="4" r="2"></circle></svg></svg>'},137:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M19.357 2.88c1.749 0 3.366 0.316 4.851 0.946 1.485 0.632 2.768 1.474 3.845 2.533s1.922 2.279 2.532 3.661c0.611 1.383 0.915 2.829 0.915 4.334 0 1.425-0.304 2.847-0.915 4.271-0.611 1.425-1.587 2.767-2.928 4.028-0.855 0.813-1.811 1.607-2.869 2.38s-2.136 1.465-3.233 2.075c-1.099 0.61-2.198 1.098-3.296 1.465-1.098 0.366-2.115 0.549-3.051 0.549-1.343 0-2.441-0.438-3.296-1.311-0.854-0.876-1.281-2.41-1.281-4.608 0-0.366 0.020-0.773 0.060-1.221s0.062-0.895 0.062-1.343c0-0.773-0.183-1.353-0.55-1.738-0.366-0.387-0.793-0.58-1.281-0.58-0.652 0-1.21 0.295-1.678 0.886s-0.926 1.23-1.373 1.921c-0.447 0.693-0.905 1.334-1.372 1.923s-1.028 0.886-1.679 0.886c-0.529 0-1.048-0.427-1.556-1.282s-0.763-2.259-0.763-4.212c0-2.197 0.529-4.241 1.587-6.133s2.462-3.529 4.21-4.912c1.75-1.383 3.762-2.471 6.041-3.264 2.277-0.796 4.617-1.212 7.018-1.253zM7.334 15.817c0.569 0 1.047-0.204 1.434-0.611s0.579-0.875 0.579-1.404c0-0.569-0.193-1.047-0.579-1.434s-0.864-0.579-1.434-0.579c-0.529 0-0.987 0.193-1.373 0.579s-0.58 0.864-0.58 1.434c0 0.53 0.194 0.998 0.58 1.404 0.388 0.407 0.845 0.611 1.373 0.611zM12.216 11.79c0.691 0 1.292-0.254 1.8-0.763s0.762-1.107 0.762-1.8c0-0.732-0.255-1.343-0.762-1.831-0.509-0.489-1.109-0.732-1.8-0.732-0.732 0-1.342 0.244-1.831 0.732-0.488 0.488-0.732 1.098-0.732 1.831 0 0.693 0.244 1.292 0.732 1.8s1.099 0.763 1.831 0.763zM16.366 25.947c0.692 0 1.282-0.214 1.77-0.64s0.732-0.987 0.732-1.678-0.244-1.261-0.732-1.709c-0.489-0.448-1.078-0.671-1.77-0.671-0.65 0-1.21 0.223-1.678 0.671s-0.702 1.018-0.702 1.709c0 0.692 0.234 1.25 0.702 1.678s1.027 0.64 1.678 0.64zM19.113 9.592c0.651 0 1.129-0.203 1.433-0.611 0.305-0.406 0.459-0.874 0.459-1.404 0-0.488-0.154-0.947-0.459-1.373-0.304-0.427-0.782-0.641-1.433-0.641-0.529 0-1.008 0.193-1.434 0.58s-0.64 0.865-0.64 1.434c0 0.571 0.213 1.049 0.64 1.434 0.427 0.389 0.905 0.581 1.434 0.581zM24.848 12.826c0.57 0 1.067-0.213 1.495-0.64 0.427-0.427 0.64-0.947 0.64-1.556 0-0.57-0.214-1.068-0.64-1.495-0.428-0.427-0.927-0.64-1.495-0.64-0.611 0-1.129 0.213-1.555 0.64-0.428 0.427-0.642 0.926-0.642 1.495 0 0.611 0.213 1.129 0.642 1.556s0.947 0.64 1.555 0.64z"></path></svg>'},32:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 17 32"><path d="M14.080 4.8q2.88 0 2.88 2.048v18.24q0 2.112-2.88 2.112t-2.88-2.112v-18.24q0-2.048 2.88-2.048zM2.88 4.8q2.88 0 2.88 2.048v18.24q0 2.112-2.88 2.112t-2.88-2.112v-18.24q0-2.048 2.88-2.048z"></path></svg>'},657:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 33"><path d="M26.3,15.1H14.5v8.6h11.8V15.1z M32.2,26.6V6.4c0-1.6-1.3-2.8-2.9-2.8H2.8c-1.6,0-2.9,1.3-2.9,2.8v20.1c0,1.6,1.3,2.9,2.9,2.9h26.4C30.8,29.4,32.2,28.1,32.2,26.6z M29.2,26.6H2.8V6.4h26.4V26.6z"></path></svg>'},416:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 16 32"><path d="M15.552 15.168q0.448 0.32 0.448 0.832 0 0.448-0.448 0.768l-13.696 8.512q-0.768 0.512-1.312 0.192t-0.544-1.28v-16.448q0-0.96 0.544-1.28t1.312 0.192z"></path></svg>'},460:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M22 16l-10.105-10.6-1.895 1.987 8.211 8.613-8.211 8.612 1.895 1.988 8.211-8.613z"></path></svg>'},484:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M13.725 30l3.9-5.325-3.9-1.125v6.45zM0 17.5l11.050 3.35 13.6-11.55-10.55 12.425 11.8 3.65 6.1-23.375-32 15.5z"></path></svg>'},894:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 28"><path d="M28.633 17.104c0.035 0.21 0.026 0.463-0.026 0.76s-0.14 0.598-0.262 0.904c-0.122 0.306-0.271 0.581-0.445 0.825s-0.367 0.419-0.576 0.524c-0.209 0.105-0.393 0.157-0.55 0.157s-0.332-0.035-0.524-0.105c-0.175-0.052-0.393-0.1-0.655-0.144s-0.528-0.052-0.799-0.026c-0.271 0.026-0.541 0.083-0.812 0.17s-0.502 0.236-0.694 0.445c-0.419 0.437-0.664 0.934-0.734 1.493s0.009 1.092 0.236 1.598c0.175 0.349 0.148 0.699-0.079 1.048-0.105 0.14-0.271 0.284-0.498 0.432s-0.476 0.284-0.747 0.406-0.555 0.218-0.851 0.288c-0.297 0.070-0.559 0.105-0.786 0.105-0.157 0-0.306-0.061-0.445-0.183s-0.236-0.253-0.288-0.393h-0.026c-0.192-0.541-0.52-1.009-0.982-1.402s-1-0.589-1.611-0.589c-0.594 0-1.131 0.197-1.611 0.589s-0.816 0.851-1.009 1.375c-0.087 0.21-0.218 0.362-0.393 0.458s-0.367 0.144-0.576 0.144c-0.244 0-0.52-0.044-0.825-0.131s-0.611-0.197-0.917-0.327c-0.306-0.131-0.581-0.284-0.825-0.458s-0.428-0.349-0.55-0.524c-0.087-0.122-0.135-0.266-0.144-0.432s0.057-0.397 0.197-0.694c0.192-0.402 0.266-0.86 0.223-1.375s-0.266-0.991-0.668-1.428c-0.244-0.262-0.541-0.432-0.891-0.511s-0.681-0.109-0.995-0.092c-0.367 0.017-0.742 0.087-1.127 0.21-0.244 0.070-0.489 0.052-0.734-0.052-0.192-0.070-0.371-0.231-0.537-0.485s-0.314-0.533-0.445-0.838c-0.131-0.306-0.231-0.62-0.301-0.943s-0.087-0.59-0.052-0.799c0.052-0.384 0.227-0.629 0.524-0.734 0.524-0.21 0.995-0.555 1.415-1.035s0.629-1.017 0.629-1.611c0-0.611-0.21-1.144-0.629-1.598s-0.891-0.786-1.415-0.996c-0.157-0.052-0.288-0.179-0.393-0.38s-0.157-0.406-0.157-0.616c0-0.227 0.035-0.48 0.105-0.76s0.162-0.55 0.275-0.812 0.244-0.502 0.393-0.72c0.148-0.218 0.31-0.38 0.485-0.485 0.14-0.087 0.275-0.122 0.406-0.105s0.275 0.052 0.432 0.105c0.524 0.21 1.070 0.275 1.637 0.197s1.070-0.327 1.506-0.747c0.21-0.209 0.362-0.467 0.458-0.773s0.157-0.607 0.183-0.904c0.026-0.297 0.026-0.568 0-0.812s-0.048-0.419-0.065-0.524c-0.035-0.105-0.066-0.227-0.092-0.367s-0.013-0.262 0.039-0.367c0.105-0.244 0.293-0.458 0.563-0.642s0.563-0.336 0.878-0.458c0.314-0.122 0.62-0.214 0.917-0.275s0.533-0.092 0.707-0.092c0.227 0 0.406 0.074 0.537 0.223s0.223 0.301 0.275 0.458c0.192 0.471 0.507 0.886 0.943 1.244s0.952 0.537 1.546 0.537c0.611 0 1.153-0.17 1.624-0.511s0.803-0.773 0.996-1.297c0.070-0.14 0.179-0.284 0.327-0.432s0.301-0.223 0.458-0.223c0.244 0 0.511 0.035 0.799 0.105s0.572 0.166 0.851 0.288c0.279 0.122 0.537 0.279 0.773 0.472s0.423 0.402 0.563 0.629c0.087 0.14 0.113 0.293 0.079 0.458s-0.070 0.284-0.105 0.354c-0.227 0.506-0.297 1.039-0.21 1.598s0.341 1.048 0.76 1.467c0.419 0.419 0.934 0.651 1.546 0.694s1.179-0.057 1.703-0.301c0.14-0.087 0.31-0.122 0.511-0.105s0.371 0.096 0.511 0.236c0.262 0.244 0.493 0.616 0.694 1.113s0.336 1 0.406 1.506c0.035 0.297-0.013 0.528-0.144 0.694s-0.266 0.275-0.406 0.327c-0.542 0.192-1.004 0.528-1.388 1.009s-0.576 1.026-0.576 1.637c0 0.594 0.162 1.113 0.485 1.559s0.747 0.764 1.27 0.956c0.122 0.070 0.227 0.14 0.314 0.21 0.192 0.157 0.323 0.358 0.393 0.602v0zM16.451 19.462c0.786 0 1.528-0.149 2.227-0.445s1.305-0.707 1.821-1.231c0.515-0.524 0.921-1.131 1.218-1.821s0.445-1.428 0.445-2.214c0-0.786-0.148-1.524-0.445-2.214s-0.703-1.292-1.218-1.808c-0.515-0.515-1.122-0.921-1.821-1.218s-1.441-0.445-2.227-0.445c-0.786 0-1.524 0.148-2.214 0.445s-1.292 0.703-1.808 1.218c-0.515 0.515-0.921 1.118-1.218 1.808s-0.445 1.428-0.445 2.214c0 0.786 0.149 1.524 0.445 2.214s0.703 1.297 1.218 1.821c0.515 0.524 1.118 0.934 1.808 1.231s1.428 0.445 2.214 0.445v0z"></path></svg>'},30:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M26.667 5.333h-21.333c-0 0-0.001 0-0.001 0-1.472 0-2.666 1.194-2.666 2.666 0 0 0 0.001 0 0.001v-0 16c0 0 0 0.001 0 0.001 0 1.472 1.194 2.666 2.666 2.666 0 0 0.001 0 0.001 0h21.333c0 0 0.001 0 0.001 0 1.472 0 2.666-1.194 2.666-2.666 0-0 0-0.001 0-0.001v0-16c0-0 0-0.001 0-0.001 0-1.472-1.194-2.666-2.666-2.666-0 0-0.001 0-0.001 0h0zM5.333 16h5.333v2.667h-5.333v-2.667zM18.667 24h-13.333v-2.667h13.333v2.667zM26.667 24h-5.333v-2.667h5.333v2.667zM26.667 18.667h-13.333v-2.667h13.333v2.667z"></path></svg>'},513:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 21 32"><path d="M13.728 6.272v19.456q0 0.448-0.352 0.8t-0.8 0.32-0.8-0.32l-5.952-5.952h-4.672q-0.48 0-0.8-0.352t-0.352-0.8v-6.848q0-0.48 0.352-0.8t0.8-0.352h4.672l5.952-5.952q0.32-0.32 0.8-0.32t0.8 0.32 0.352 0.8zM20.576 16q0 1.344-0.768 2.528t-2.016 1.664q-0.16 0.096-0.448 0.096-0.448 0-0.8-0.32t-0.32-0.832q0-0.384 0.192-0.64t0.544-0.448 0.608-0.384 0.512-0.64 0.192-1.024-0.192-1.024-0.512-0.64-0.608-0.384-0.544-0.448-0.192-0.64q0-0.48 0.32-0.832t0.8-0.32q0.288 0 0.448 0.096 1.248 0.48 2.016 1.664t0.768 2.528z"></path></svg>'},204:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 21 32"><path d="M13.728 6.272v19.456q0 0.448-0.352 0.8t-0.8 0.32-0.8-0.32l-5.952-5.952h-4.672q-0.48 0-0.8-0.352t-0.352-0.8v-6.848q0-0.48 0.352-0.8t0.8-0.352h4.672l5.952-5.952q0.32-0.32 0.8-0.32t0.8 0.32 0.352 0.8z"></path></svg>'},278:r=>{r.exports='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 21 32"><path d="M13.728 6.272v19.456q0 0.448-0.352 0.8t-0.8 0.32-0.8-0.32l-5.952-5.952h-4.672q-0.48 0-0.8-0.352t-0.352-0.8v-6.848q0-0.48 0.352-0.8t0.8-0.352h4.672l5.952-5.952q0.32-0.32 0.8-0.32t0.8 0.32 0.352 0.8zM20.576 16q0 1.344-0.768 2.528t-2.016 1.664q-0.16 0.096-0.448 0.096-0.448 0-0.8-0.32t-0.32-0.832q0-0.384 0.192-0.64t0.544-0.448 0.608-0.384 0.512-0.64 0.192-1.024-0.192-1.024-0.512-0.64-0.608-0.384-0.544-0.448-0.192-0.64q0-0.48 0.32-0.832t0.8-0.32q0.288 0 0.448 0.096 1.248 0.48 2.016 1.664t0.768 2.528zM25.152 16q0 2.72-1.536 5.056t-4 3.36q-0.256 0.096-0.448 0.096-0.48 0-0.832-0.352t-0.32-0.8q0-0.704 0.672-1.056 1.024-0.512 1.376-0.8 1.312-0.96 2.048-2.4t0.736-3.104-0.736-3.104-2.048-2.4q-0.352-0.288-1.376-0.8-0.672-0.352-0.672-1.056 0-0.448 0.32-0.8t0.8-0.352q0.224 0 0.48 0.096 2.496 1.056 4 3.36t1.536 5.056z"></path></svg>'}},n={};function i(r){var d=n[r];if(d!==void 0)return d.exports;var u=n[r]={id:r,exports:{}};return t[r].call(u.exports,u,u.exports,i),u.exports}i.n=r=>{var d=r&&r.__esModule?()=>r.default:()=>r;return i.d(d,{a:d}),d},i.d=(r,d)=>{for(var u in d)i.o(d,u)&&!i.o(r,u)&&Object.defineProperty(r,u,{enumerable:!0,get:d[u]})},i.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),i.o=(r,d)=>Object.prototype.hasOwnProperty.call(r,d),i.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},i.nc=void 0;var s={};return(()=>{i.d(s,{default:()=>ip});var r={};i.r(r),i.d(r,{hasBrowserEnv:()=>qe,hasStandardBrowserEnv:()=>ft,hasStandardBrowserWebWorkerEnv:()=>Yt,origin:()=>ce});var d=i(72),u=i.n(d),c=i(825),l=i.n(c),h=i(659),o=i.n(h),f=i(56),p=i.n(f),m=i(540),y=i.n(m),_=i(113),S=i.n(_),b=i(420),x={};x.styleTagTransform=S(),x.setAttributes=p(),x.insert=o().bind(null,"head"),x.domAPI=l(),x.insertStyleElement=y(),u()(b.A,x),b.A&&b.A.locals&&b.A.locals;var L=i(149);const N=/iPhone|iPad|iPod|Windows|Macintosh|Android|Mobile/i.test(navigator.userAgent)&&"ontouchend"in document,P={secondToTime:E=>{if((E=E||0)===0||E===1/0||E.toString()==="NaN")return"00:00";const D=Math.floor(E/3600),q=Math.floor((E-3600*D)/60),W=Math.floor(E-3600*D-60*q);return(D>0?[D,q,W]:[q,W]).map(ue=>ue<10?"0"+ue:""+ue).join(":")},getVideoDuration:(E,D)=>{let q=E.duration;return q===1/0&&(E.seekable.length>0?(D.dtime.textContent=P.secondToTime(E.seekable.end(0)),q=E.seekable.end(0)):E.buffered.length>0&&(D.dtime.textContent=P.secondToTime(E.buffered.end(0)),q=E.buffered.end(0))),q},getElementViewLeft:E=>{let D=E.offsetLeft,q=E.offsetParent;const W=document.body.scrollLeft+document.documentElement.scrollLeft;if(document.fullscreenElement||document.webkitFullscreenElement)for(;q!==null&&q!==E;)D+=q.offsetLeft,q=q.offsetParent;else for(;q!==null;)D+=q.offsetLeft,q=q.offsetParent;return D-W},getBoundingClientRectViewLeft(E){const D=window.scrollY||window.pageYOffset||document.body.scrollTop+(document.documentElement&&document.documentElement.scrollTop||0);if(E.getBoundingClientRect){if(typeof this.getBoundingClientRectViewLeft.offset!="number"){let ue=document.createElement("div");ue.style.cssText="position:absolute;top:0;left:0;",document.body.appendChild(ue),this.getBoundingClientRectViewLeft.offset=-ue.getBoundingClientRect().top-D,document.body.removeChild(ue),ue=null}const q=E.getBoundingClientRect(),W=this.getBoundingClientRectViewLeft.offset;return q.left+W}return this.getElementViewLeft(E)},getScrollPosition:()=>({left:window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,top:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0}),setScrollPosition({left:E=0,top:D=0}){this.isFirefox?(document.documentElement.scrollLeft=E,document.documentElement.scrollTop=D):window.scrollTo(E,D)},isMobile:N,isFirefox:/firefox/i.test(window.navigator.userAgent),isChrome:/chrome/i.test(window.navigator.userAgent),storage:{set:(E,D)=>{localStorage.setItem(E,D)},get:E=>localStorage.getItem(E)},nameMap:{dragStart:N?"touchstart":"mousedown",dragMove:N?"touchmove":"mousemove",dragEnd:N?"touchend":"mouseup"},color2Number:E=>(E[0]==="#"&&(E=E.substr(1)),E.length===3&&(E=`${E[0]}${E[0]}${E[1]}${E[1]}${E[2]}${E[2]}`),parseInt(E,16)+0&16777215),number2Color:E=>"#"+("00000"+E.toString(16)).slice(-6),number2Type:E=>{switch(E){case 0:default:return"right";case 1:return"top";case 2:return"bottom"}}},T=P;function k(E,D){return function(){return E.apply(D,arguments)}}const{toString:I}=Object.prototype,{getPrototypeOf:F}=Object,V=(ne=Object.create(null),E=>{const D=I.call(E);return ne[D]||(ne[D]=D.slice(8,-1).toLowerCase())});var ne;const te=E=>(E=E.toLowerCase(),D=>V(D)===E),Z=E=>D=>typeof D===E,{isArray:Q}=Array,he=Z("undefined"),de=te("ArrayBuffer"),M=Z("string"),A=Z("function"),v=Z("number"),w=E=>E!==null&&typeof E=="object",R=E=>{if(V(E)!=="object")return!1;const D=F(E);return!(D!==null&&D!==Object.prototype&&Object.getPrototypeOf(D)!==null||Symbol.toStringTag in E||Symbol.iterator in E)},C=te("Date"),O=te("File"),G=te("Blob"),z=te("FileList"),Y=te("URLSearchParams"),[ie,se,Se,we]=["ReadableStream","Request","Response","Headers"].map(te);function Pe(E,D,{allOwnKeys:q=!1}={}){if(E==null)return;let W,ue;if(typeof E!="object"&&(E=[E]),Q(E))for(W=0,ue=E.length;W<ue;W++)D.call(null,E[W],W,E);else{const Ae=q?Object.getOwnPropertyNames(E):Object.keys(E),Ce=Ae.length;let ze;for(W=0;W<Ce;W++)ze=Ae[W],D.call(null,E[ze],ze,E)}}function Ge(E,D){D=D.toLowerCase();const q=Object.keys(E);let W,ue=q.length;for(;ue-- >0;)if(W=q[ue],D===W.toLowerCase())return W;return null}const it=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:So,Ie=E=>!he(E)&&E!==it,rt=(tt=typeof Uint8Array<"u"&&F(Uint8Array),E=>tt&&E instanceof tt);var tt;const xe=te("HTMLFormElement"),ht=(({hasOwnProperty:E})=>(D,q)=>E.call(D,q))(Object.prototype),_t=te("RegExp"),et=(E,D)=>{const q=Object.getOwnPropertyDescriptors(E),W={};Pe(q,(ue,Ae)=>{let Ce;(Ce=D(ue,Ae,E))!==!1&&(W[Ae]=Ce||ue)}),Object.defineProperties(E,W)},Ve="abcdefghijklmnopqrstuvwxyz",fe="0123456789",be={DIGIT:fe,ALPHA:Ve,ALPHA_DIGIT:Ve+Ve.toUpperCase()+fe},Ue=te("AsyncFunction"),ge={isArray:Q,isArrayBuffer:de,isBuffer:function(E){return E!==null&&!he(E)&&E.constructor!==null&&!he(E.constructor)&&A(E.constructor.isBuffer)&&E.constructor.isBuffer(E)},isFormData:E=>{let D;return E&&(typeof FormData=="function"&&E instanceof FormData||A(E.append)&&((D=V(E))==="formdata"||D==="object"&&A(E.toString)&&E.toString()==="[object FormData]"))},isArrayBufferView:function(E){let D;return D=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(E):E&&E.buffer&&de(E.buffer),D},isString:M,isNumber:v,isBoolean:E=>E===!0||E===!1,isObject:w,isPlainObject:R,isReadableStream:ie,isRequest:se,isResponse:Se,isHeaders:we,isUndefined:he,isDate:C,isFile:O,isBlob:G,isRegExp:_t,isFunction:A,isStream:E=>w(E)&&A(E.pipe),isURLSearchParams:Y,isTypedArray:rt,isFileList:z,forEach:Pe,merge:function E(){const{caseless:D}=Ie(this)&&this||{},q={},W=(ue,Ae)=>{const Ce=D&&Ge(q,Ae)||Ae;R(q[Ce])&&R(ue)?q[Ce]=E(q[Ce],ue):R(ue)?q[Ce]=E({},ue):Q(ue)?q[Ce]=ue.slice():q[Ce]=ue};for(let ue=0,Ae=arguments.length;ue<Ae;ue++)arguments[ue]&&Pe(arguments[ue],W);return q},extend:(E,D,q,{allOwnKeys:W}={})=>(Pe(D,(ue,Ae)=>{q&&A(ue)?E[Ae]=k(ue,q):E[Ae]=ue},{allOwnKeys:W}),E),trim:E=>E.trim?E.trim():E.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:E=>(E.charCodeAt(0)===65279&&(E=E.slice(1)),E),inherits:(E,D,q,W)=>{E.prototype=Object.create(D.prototype,W),E.prototype.constructor=E,Object.defineProperty(E,"super",{value:D.prototype}),q&&Object.assign(E.prototype,q)},toFlatObject:(E,D,q,W)=>{let ue,Ae,Ce;const ze={};if(D=D||{},E==null)return D;do{for(ue=Object.getOwnPropertyNames(E),Ae=ue.length;Ae-- >0;)Ce=ue[Ae],W&&!W(Ce,E,D)||ze[Ce]||(D[Ce]=E[Ce],ze[Ce]=!0);E=q!==!1&&F(E)}while(E&&(!q||q(E,D))&&E!==Object.prototype);return D},kindOf:V,kindOfTest:te,endsWith:(E,D,q)=>{E=String(E),(q===void 0||q>E.length)&&(q=E.length),q-=D.length;const W=E.indexOf(D,q);return W!==-1&&W===q},toArray:E=>{if(!E)return null;if(Q(E))return E;let D=E.length;if(!v(D))return null;const q=new Array(D);for(;D-- >0;)q[D]=E[D];return q},forEachEntry:(E,D)=>{const q=(E&&E[Symbol.iterator]).call(E);let W;for(;(W=q.next())&&!W.done;){const ue=W.value;D.call(E,ue[0],ue[1])}},matchAll:(E,D)=>{let q;const W=[];for(;(q=E.exec(D))!==null;)W.push(q);return W},isHTMLForm:xe,hasOwnProperty:ht,hasOwnProp:ht,reduceDescriptors:et,freezeMethods:E=>{et(E,(D,q)=>{if(A(E)&&["arguments","caller","callee"].indexOf(q)!==-1)return!1;const W=E[q];A(W)&&(D.enumerable=!1,"writable"in D?D.writable=!1:D.set||(D.set=()=>{throw Error("Can not rewrite read-only method '"+q+"'")}))})},toObjectSet:(E,D)=>{const q={},W=ue=>{ue.forEach(Ae=>{q[Ae]=!0})};return Q(E)?W(E):W(String(E).split(D)),q},toCamelCase:E=>E.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(D,q,W){return q.toUpperCase()+W}),noop:()=>{},toFiniteNumber:(E,D)=>E!=null&&Number.isFinite(E=+E)?E:D,findKey:Ge,global:it,isContextDefined:Ie,ALPHABET:be,generateString:(E=16,D=be.ALPHA_DIGIT)=>{let q="";const{length:W}=D;for(;E--;)q+=D[Math.random()*W|0];return q},isSpecCompliantForm:function(E){return!!(E&&A(E.append)&&E[Symbol.toStringTag]==="FormData"&&E[Symbol.iterator])},toJSONObject:E=>{const D=new Array(10),q=(W,ue)=>{if(w(W)){if(D.indexOf(W)>=0)return;if(!("toJSON"in W)){D[ue]=W;const Ae=Q(W)?[]:{};return Pe(W,(Ce,ze)=>{const at=q(Ce,ue+1);!he(at)&&(Ae[ze]=at)}),D[ue]=void 0,Ae}}return W};return q(E,0)},isAsyncFn:Ue,isThenable:E=>E&&(w(E)||A(E))&&A(E.then)&&A(E.catch)};function Je(E,D,q,W,ue){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=E,this.name="AxiosError",D&&(this.code=D),q&&(this.config=q),W&&(this.request=W),ue&&(this.response=ue)}ge.inherits(Je,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ge.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const ut=Je.prototype,st={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(E=>{st[E]={value:E}}),Object.defineProperties(Je,st),Object.defineProperty(ut,"isAxiosError",{value:!0}),Je.from=(E,D,q,W,ue,Ae)=>{const Ce=Object.create(ut);return ge.toFlatObject(E,Ce,function(ze){return ze!==Error.prototype},ze=>ze!=="isAxiosError"),Je.call(Ce,E.message,D,q,W,ue),Ce.cause=E,Ce.name=E.name,Ae&&Object.assign(Ce,Ae),Ce};const We=Je;function gt(E){return ge.isPlainObject(E)||ge.isArray(E)}function X(E){return ge.endsWith(E,"[]")?E.slice(0,-2):E}function re(E,D,q){return E?E.concat(D).map(function(W,ue){return W=X(W),!q&&ue?"["+W+"]":W}).join(q?".":""):D}const K=ge.toFlatObject(ge,{},null,function(E){return/^is[A-Z]/.test(E)}),j=function(E,D,q){if(!ge.isObject(E))throw new TypeError("target must be an object");D=D||new FormData;const W=(q=ge.toFlatObject(q,{metaTokens:!0,dots:!1,indexes:!1},!1,function(lt,ct){return!ge.isUndefined(ct[lt])})).metaTokens,ue=q.visitor||$e,Ae=q.dots,Ce=q.indexes,ze=(q.Blob||typeof Blob<"u"&&Blob)&&ge.isSpecCompliantForm(D);if(!ge.isFunction(ue))throw new TypeError("visitor must be a function");function at(lt){if(lt===null)return"";if(ge.isDate(lt))return lt.toISOString();if(!ze&&ge.isBlob(lt))throw new We("Blob is not supported. Use a Buffer instead.");return ge.isArrayBuffer(lt)||ge.isTypedArray(lt)?ze&&typeof Blob=="function"?new Blob([lt]):Buffer.from(lt):lt}function $e(lt,ct,Ot){let In=lt;if(lt&&!Ot&&typeof lt=="object"){if(ge.endsWith(ct,"{}"))ct=W?ct:ct.slice(0,-2),lt=JSON.stringify(lt);else if(ge.isArray(lt)&&function(Wt){return ge.isArray(Wt)&&!Wt.some(gt)}(lt)||(ge.isFileList(lt)||ge.endsWith(ct,"[]"))&&(In=ge.toArray(lt)))return ct=X(ct),In.forEach(function(Wt,jt){!ge.isUndefined(Wt)&&Wt!==null&&D.append(Ce===!0?re([ct],jt,Ae):Ce===null?ct:ct+"[]",at(Wt))}),!1}return!!gt(lt)||(D.append(re(Ot,ct,Ae),at(lt)),!1)}const dt=[],It=Object.assign(K,{defaultVisitor:$e,convertValue:at,isVisitable:gt});if(!ge.isObject(E))throw new TypeError("data must be an object");return function lt(ct,Ot){if(!ge.isUndefined(ct)){if(dt.indexOf(ct)!==-1)throw Error("Circular reference detected in "+Ot.join("."));dt.push(ct),ge.forEach(ct,function(In,Wt){(!(ge.isUndefined(In)||In===null)&&ue.call(D,In,ge.isString(Wt)?Wt.trim():Wt,Ot,It))===!0&&lt(In,Ot?Ot.concat(Wt):[Wt])}),dt.pop()}}(E),D};function oe(E){const D={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(E).replace(/[!'()~]|%20|%00/g,function(q){return D[q]})}function _e(E,D){this._pairs=[],E&&j(E,this,D)}const ae=_e.prototype;ae.append=function(E,D){this._pairs.push([E,D])},ae.toString=function(E){const D=E?function(q){return E.call(this,q,oe)}:oe;return this._pairs.map(function(q){return D(q[0])+"="+D(q[1])},"").join("&")};const Te=_e;function Ee(E){return encodeURIComponent(E).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ye(E,D,q){if(!D)return E;const W=q&&q.encode||Ee,ue=q&&q.serialize;let Ae;if(Ae=ue?ue(D,q):ge.isURLSearchParams(D)?D.toString():new Te(D,q).toString(W),Ae){const Ce=E.indexOf("#");Ce!==-1&&(E=E.slice(0,Ce)),E+=(E.indexOf("?")===-1?"?":"&")+Ae}return E}const Re=class{constructor(){this.handlers=[]}use(E,D,q){return this.handlers.push({fulfilled:E,rejected:D,synchronous:!!q&&q.synchronous,runWhen:q?q.runWhen:null}),this.handlers.length-1}eject(E){this.handlers[E]&&(this.handlers[E]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(E){ge.forEach(this.handlers,function(D){D!==null&&E(D)})}},Oe={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ne={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:Te,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},qe=typeof window<"u"&&typeof document<"u",ft=(St=typeof navigator<"u"&&navigator.product,qe&&["ReactNative","NativeScript","NS"].indexOf(St)<0);var St;const Yt=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ce=qe&&window.location.href||"http://localhost",me={...r,...Ne},H=function(E){function D(q,W,ue,Ae){let Ce=q[Ae++];if(Ce==="__proto__")return!0;const ze=Number.isFinite(+Ce),at=Ae>=q.length;return Ce=!Ce&&ge.isArray(ue)?ue.length:Ce,at?(ge.hasOwnProp(ue,Ce)?ue[Ce]=[ue[Ce],W]:ue[Ce]=W,!ze):(ue[Ce]&&ge.isObject(ue[Ce])||(ue[Ce]=[]),D(q,W,ue[Ce],Ae)&&ge.isArray(ue[Ce])&&(ue[Ce]=function($e){const dt={},It=Object.keys($e);let lt;const ct=It.length;let Ot;for(lt=0;lt<ct;lt++)Ot=It[lt],dt[Ot]=$e[Ot];return dt}(ue[Ce])),!ze)}if(ge.isFormData(E)&&ge.isFunction(E.entries)){const q={};return ge.forEachEntry(E,(W,ue)=>{D(function(Ae){return ge.matchAll(/\w+|\[(\w*)]/g,Ae).map(Ce=>Ce[0]==="[]"?"":Ce[1]||Ce[0])}(W),ue,q,0)}),q}return null},B={transitional:Oe,adapter:["xhr","http","fetch"],transformRequest:[function(E,D){const q=D.getContentType()||"",W=q.indexOf("application/json")>-1,ue=ge.isObject(E);if(ue&&ge.isHTMLForm(E)&&(E=new FormData(E)),ge.isFormData(E))return W?JSON.stringify(H(E)):E;if(ge.isArrayBuffer(E)||ge.isBuffer(E)||ge.isStream(E)||ge.isFile(E)||ge.isBlob(E)||ge.isReadableStream(E))return E;if(ge.isArrayBufferView(E))return E.buffer;if(ge.isURLSearchParams(E))return D.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),E.toString();let Ae;if(ue){if(q.indexOf("application/x-www-form-urlencoded")>-1)return function(Ce,ze){return j(Ce,new me.classes.URLSearchParams,Object.assign({visitor:function(at,$e,dt,It){return me.isNode&&ge.isBuffer(at)?(this.append($e,at.toString("base64")),!1):It.defaultVisitor.apply(this,arguments)}},ze))}(E,this.formSerializer).toString();if((Ae=ge.isFileList(E))||q.indexOf("multipart/form-data")>-1){const Ce=this.env&&this.env.FormData;return j(Ae?{"files[]":E}:E,Ce&&new Ce,this.formSerializer)}}return ue||W?(D.setContentType("application/json",!1),function(Ce,ze,at){if(ge.isString(Ce))try{return(ze||JSON.parse)(Ce),ge.trim(Ce)}catch($e){if($e.name!=="SyntaxError")throw $e}return(0,JSON.stringify)(Ce)}(E)):E}],transformResponse:[function(E){const D=this.transitional||B.transitional,q=D&&D.forcedJSONParsing,W=this.responseType==="json";if(ge.isResponse(E)||ge.isReadableStream(E))return E;if(E&&ge.isString(E)&&(q&&!this.responseType||W)){const ue=!(D&&D.silentJSONParsing)&&W;try{return JSON.parse(E)}catch(Ae){if(ue)throw Ae.name==="SyntaxError"?We.from(Ae,We.ERR_BAD_RESPONSE,this,null,this.response):Ae}}return E}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:me.classes.FormData,Blob:me.classes.Blob},validateStatus:function(E){return E>=200&&E<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ge.forEach(["delete","get","head","post","put","patch"],E=>{B.headers[E]={}});const g=B,U=ge.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ee=Symbol("internals");function J(E){return E&&String(E).trim().toLowerCase()}function pe(E){return E===!1||E==null?E:ge.isArray(E)?E.map(pe):String(E)}function le(E,D,q,W,ue){return ge.isFunction(W)?W.call(this,D,q):(ue&&(D=q),ge.isString(D)?ge.isString(W)?D.indexOf(W)!==-1:ge.isRegExp(W)?W.test(D):void 0:void 0)}class ke{constructor(D){D&&this.set(D)}set(D,q,W){const ue=this;function Ae(ze,at,$e){const dt=J(at);if(!dt)throw new Error("header name must be a non-empty string");const It=ge.findKey(ue,dt);(!It||ue[It]===void 0||$e===!0||$e===void 0&&ue[It]!==!1)&&(ue[It||at]=pe(ze))}const Ce=(ze,at)=>ge.forEach(ze,($e,dt)=>Ae($e,dt,at));if(ge.isPlainObject(D)||D instanceof this.constructor)Ce(D,q);else if(ge.isString(D)&&(D=D.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(D.trim()))Ce((ze=>{const at={};let $e,dt,It;return ze&&ze.split(`
`).forEach(function(lt){It=lt.indexOf(":"),$e=lt.substring(0,It).trim().toLowerCase(),dt=lt.substring(It+1).trim(),!$e||at[$e]&&U[$e]||($e==="set-cookie"?at[$e]?at[$e].push(dt):at[$e]=[dt]:at[$e]=at[$e]?at[$e]+", "+dt:dt)}),at})(D),q);else if(ge.isHeaders(D))for(const[ze,at]of D.entries())Ae(at,ze,W);else D!=null&&Ae(q,D,W);return this}get(D,q){if(D=J(D)){const W=ge.findKey(this,D);if(W){const ue=this[W];if(!q)return ue;if(q===!0)return function(Ae){const Ce=Object.create(null),ze=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let at;for(;at=ze.exec(Ae);)Ce[at[1]]=at[2];return Ce}(ue);if(ge.isFunction(q))return q.call(this,ue,W);if(ge.isRegExp(q))return q.exec(ue);throw new TypeError("parser must be boolean|regexp|function")}}}has(D,q){if(D=J(D)){const W=ge.findKey(this,D);return!(!W||this[W]===void 0||q&&!le(0,this[W],W,q))}return!1}delete(D,q){const W=this;let ue=!1;function Ae(Ce){if(Ce=J(Ce)){const ze=ge.findKey(W,Ce);!ze||q&&!le(0,W[ze],ze,q)||(delete W[ze],ue=!0)}}return ge.isArray(D)?D.forEach(Ae):Ae(D),ue}clear(D){const q=Object.keys(this);let W=q.length,ue=!1;for(;W--;){const Ae=q[W];D&&!le(0,this[Ae],Ae,D,!0)||(delete this[Ae],ue=!0)}return ue}normalize(D){const q=this,W={};return ge.forEach(this,(ue,Ae)=>{const Ce=ge.findKey(W,Ae);if(Ce)return q[Ce]=pe(ue),void delete q[Ae];const ze=D?function(at){return at.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,($e,dt,It)=>dt.toUpperCase()+It)}(Ae):String(Ae).trim();ze!==Ae&&delete q[Ae],q[ze]=pe(ue),W[ze]=!0}),this}concat(...D){return this.constructor.concat(this,...D)}toJSON(D){const q=Object.create(null);return ge.forEach(this,(W,ue)=>{W!=null&&W!==!1&&(q[ue]=D&&ge.isArray(W)?W.join(", "):W)}),q}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([D,q])=>D+": "+q).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(D){return D instanceof this?D:new this(D)}static concat(D,...q){const W=new this(D);return q.forEach(ue=>W.set(ue)),W}static accessor(D){const q=(this[ee]=this[ee]={accessors:{}}).accessors,W=this.prototype;function ue(Ae){const Ce=J(Ae);q[Ce]||(function(ze,at){const $e=ge.toCamelCase(" "+at);["get","set","has"].forEach(dt=>{Object.defineProperty(ze,dt+$e,{value:function(It,lt,ct){return this[dt].call(this,at,It,lt,ct)},configurable:!0})})}(W,Ae),q[Ce]=!0)}return ge.isArray(D)?D.forEach(ue):ue(D),this}}ke.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ge.reduceDescriptors(ke.prototype,({value:E},D)=>{let q=D[0].toUpperCase()+D.slice(1);return{get:()=>E,set(W){this[q]=W}}}),ge.freezeMethods(ke);const Fe=ke;function Le(E,D){const q=this||g,W=D||q,ue=Fe.from(W.headers);let Ae=W.data;return ge.forEach(E,function(Ce){Ae=Ce.call(q,Ae,ue.normalize(),D?D.status:void 0)}),ue.normalize(),Ae}function Be(E){return!(!E||!E.__CANCEL__)}function Xe(E,D,q){We.call(this,E??"canceled",We.ERR_CANCELED,D,q),this.name="CanceledError"}ge.inherits(Xe,We,{__CANCEL__:!0});const He=Xe;function Ze(E,D,q){const W=q.config.validateStatus;q.status&&W&&!W(q.status)?D(new We("Request failed with status code "+q.status,[We.ERR_BAD_REQUEST,We.ERR_BAD_RESPONSE][Math.floor(q.status/100)-4],q.config,q.request,q)):E(q)}const Ye=function(E,D){E=E||10;const q=new Array(E),W=new Array(E);let ue,Ae=0,Ce=0;return D=D!==void 0?D:1e3,function(ze){const at=Date.now(),$e=W[Ce];ue||(ue=at),q[Ae]=ze,W[Ae]=at;let dt=Ce,It=0;for(;dt!==Ae;)It+=q[dt++],dt%=E;if(Ae=(Ae+1)%E,Ae===Ce&&(Ce=(Ce+1)%E),at-ue<D)return;const lt=$e&&at-$e;return lt?Math.round(1e3*It/lt):void 0}},ot=function(E,D){let q=0;const W=1e3/D;let ue=null;return function(){const Ae=this===!0,Ce=Date.now();if(Ae||Ce-q>W)return ue&&(clearTimeout(ue),ue=null),q=Ce,E.apply(null,arguments);ue||(ue=setTimeout(()=>(ue=null,q=Date.now(),E.apply(null,arguments)),W-(Ce-q)))}},nt=(E,D,q=3)=>{let W=0;const ue=Ye(50,250);return ot(Ae=>{const Ce=Ae.loaded,ze=Ae.lengthComputable?Ae.total:void 0,at=Ce-W,$e=ue(at);W=Ce;const dt={loaded:Ce,total:ze,progress:ze?Ce/ze:void 0,bytes:at,rate:$e||void 0,estimated:$e&&ze&&Ce<=ze?(ze-Ce)/$e:void 0,event:Ae,lengthComputable:ze!=null};dt[D?"download":"upload"]=!0,E(dt)},q)},Ct=me.hasStandardBrowserEnv?function(){const E=/(msie|trident)/i.test(navigator.userAgent),D=document.createElement("a");let q;function W(ue){let Ae=ue;return E&&(D.setAttribute("href",Ae),Ae=D.href),D.setAttribute("href",Ae),{href:D.href,protocol:D.protocol?D.protocol.replace(/:$/,""):"",host:D.host,search:D.search?D.search.replace(/^\?/,""):"",hash:D.hash?D.hash.replace(/^#/,""):"",hostname:D.hostname,port:D.port,pathname:D.pathname.charAt(0)==="/"?D.pathname:"/"+D.pathname}}return q=W(window.location.href),function(ue){const Ae=ge.isString(ue)?W(ue):ue;return Ae.protocol===q.protocol&&Ae.host===q.host}}():function(){return!0},At=me.hasStandardBrowserEnv?{write(E,D,q,W,ue,Ae){const Ce=[E+"="+encodeURIComponent(D)];ge.isNumber(q)&&Ce.push("expires="+new Date(q).toGMTString()),ge.isString(W)&&Ce.push("path="+W),ge.isString(ue)&&Ce.push("domain="+ue),Ae===!0&&Ce.push("secure"),document.cookie=Ce.join("; ")},read(E){const D=document.cookie.match(new RegExp("(^|;\\s*)("+E+")=([^;]*)"));return D?decodeURIComponent(D[3]):null},remove(E){this.write(E,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function vt(E,D){return E&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(D)?function(q,W){return W?q.replace(/\/?\/$/,"")+"/"+W.replace(/^\/+/,""):q}(E,D):D}const Rt=E=>E instanceof Fe?{...E}:E;function Tt(E,D){D=D||{};const q={};function W($e,dt,It){return ge.isPlainObject($e)&&ge.isPlainObject(dt)?ge.merge.call({caseless:It},$e,dt):ge.isPlainObject(dt)?ge.merge({},dt):ge.isArray(dt)?dt.slice():dt}function ue($e,dt,It){return ge.isUndefined(dt)?ge.isUndefined($e)?void 0:W(void 0,$e,It):W($e,dt,It)}function Ae($e,dt){if(!ge.isUndefined(dt))return W(void 0,dt)}function Ce($e,dt){return ge.isUndefined(dt)?ge.isUndefined($e)?void 0:W(void 0,$e):W(void 0,dt)}function ze($e,dt,It){return It in D?W($e,dt):It in E?W(void 0,$e):void 0}const at={url:Ae,method:Ae,data:Ae,baseURL:Ce,transformRequest:Ce,transformResponse:Ce,paramsSerializer:Ce,timeout:Ce,timeoutMessage:Ce,withCredentials:Ce,withXSRFToken:Ce,adapter:Ce,responseType:Ce,xsrfCookieName:Ce,xsrfHeaderName:Ce,onUploadProgress:Ce,onDownloadProgress:Ce,decompress:Ce,maxContentLength:Ce,maxBodyLength:Ce,beforeRedirect:Ce,transport:Ce,httpAgent:Ce,httpsAgent:Ce,cancelToken:Ce,socketPath:Ce,responseEncoding:Ce,validateStatus:ze,headers:($e,dt)=>ue(Rt($e),Rt(dt),!0)};return ge.forEach(Object.keys(Object.assign({},E,D)),function($e){const dt=at[$e]||ue,It=dt(E[$e],D[$e],$e);ge.isUndefined(It)&&dt!==ze||(q[$e]=It)}),q}const Gt=E=>{const D=Tt({},E);let q,{data:W,withXSRFToken:ue,xsrfHeaderName:Ae,xsrfCookieName:Ce,headers:ze,auth:at}=D;if(D.headers=ze=Fe.from(ze),D.url=ye(vt(D.baseURL,D.url),E.params,E.paramsSerializer),at&&ze.set("Authorization","Basic "+btoa((at.username||"")+":"+(at.password?unescape(encodeURIComponent(at.password)):""))),ge.isFormData(W)){if(me.hasStandardBrowserEnv||me.hasStandardBrowserWebWorkerEnv)ze.setContentType(void 0);else if((q=ze.getContentType())!==!1){const[$e,...dt]=q?q.split(";").map(It=>It.trim()).filter(Boolean):[];ze.setContentType([$e||"multipart/form-data",...dt].join("; "))}}if(me.hasStandardBrowserEnv&&(ue&&ge.isFunction(ue)&&(ue=ue(D)),ue||ue!==!1&&Ct(D.url))){const $e=Ae&&Ce&&At.read(Ce);$e&&ze.set(Ae,$e)}return D},kt=typeof XMLHttpRequest<"u"&&function(E){return new Promise(function(D,q){const W=Gt(E);let ue=W.data;const Ae=Fe.from(W.headers).normalize();let Ce,{responseType:ze}=W;function at(){W.cancelToken&&W.cancelToken.unsubscribe(Ce),W.signal&&W.signal.removeEventListener("abort",Ce)}let $e=new XMLHttpRequest;function dt(){if(!$e)return;const lt=Fe.from("getAllResponseHeaders"in $e&&$e.getAllResponseHeaders());Ze(function(ct){D(ct),at()},function(ct){q(ct),at()},{data:ze&&ze!=="text"&&ze!=="json"?$e.response:$e.responseText,status:$e.status,statusText:$e.statusText,headers:lt,config:E,request:$e}),$e=null}$e.open(W.method.toUpperCase(),W.url,!0),$e.timeout=W.timeout,"onloadend"in $e?$e.onloadend=dt:$e.onreadystatechange=function(){$e&&$e.readyState===4&&($e.status!==0||$e.responseURL&&$e.responseURL.indexOf("file:")===0)&&setTimeout(dt)},$e.onabort=function(){$e&&(q(new We("Request aborted",We.ECONNABORTED,W,$e)),$e=null)},$e.onerror=function(){q(new We("Network Error",We.ERR_NETWORK,W,$e)),$e=null},$e.ontimeout=function(){let lt=W.timeout?"timeout of "+W.timeout+"ms exceeded":"timeout exceeded";const ct=W.transitional||Oe;W.timeoutErrorMessage&&(lt=W.timeoutErrorMessage),q(new We(lt,ct.clarifyTimeoutError?We.ETIMEDOUT:We.ECONNABORTED,W,$e)),$e=null},ue===void 0&&Ae.setContentType(null),"setRequestHeader"in $e&&ge.forEach(Ae.toJSON(),function(lt,ct){$e.setRequestHeader(ct,lt)}),ge.isUndefined(W.withCredentials)||($e.withCredentials=!!W.withCredentials),ze&&ze!=="json"&&($e.responseType=W.responseType),typeof W.onDownloadProgress=="function"&&$e.addEventListener("progress",nt(W.onDownloadProgress,!0)),typeof W.onUploadProgress=="function"&&$e.upload&&$e.upload.addEventListener("progress",nt(W.onUploadProgress)),(W.cancelToken||W.signal)&&(Ce=lt=>{$e&&(q(!lt||lt.type?new He(null,E,$e):lt),$e.abort(),$e=null)},W.cancelToken&&W.cancelToken.subscribe(Ce),W.signal&&(W.signal.aborted?Ce():W.signal.addEventListener("abort",Ce)));const It=function(lt){const ct=/^([-+\w]{1,25})(:?\/\/|:)/.exec(lt);return ct&&ct[1]||""}(W.url);It&&me.protocols.indexOf(It)===-1?q(new We("Unsupported protocol "+It+":",We.ERR_BAD_REQUEST,E)):$e.send(ue||null)})},yt=(E,D)=>{let q,W=new AbortController;const ue=function(at){if(!q){q=!0,Ce();const $e=at instanceof Error?at:this.reason;W.abort($e instanceof We?$e:new He($e instanceof Error?$e.message:$e))}};let Ae=D&&setTimeout(()=>{ue(new We(`timeout ${D} of ms exceeded`,We.ETIMEDOUT))},D);const Ce=()=>{E&&(Ae&&clearTimeout(Ae),Ae=null,E.forEach(at=>{at&&(at.removeEventListener?at.removeEventListener("abort",ue):at.unsubscribe(ue))}),E=null)};E.forEach(at=>at&&at.addEventListener&&at.addEventListener("abort",ue));const{signal:ze}=W;return ze.unsubscribe=Ce,[ze,()=>{Ae&&clearTimeout(Ae),Ae=null}]},Qe=function*(E,D){let q=E.byteLength;if(q<D)return void(yield E);let W,ue=0;for(;ue<q;)W=ue+D,yield E.slice(ue,W),ue=W},Et=(E,D,q,W,ue)=>{const Ae=async function*(ze,at,$e){for await(const dt of ze)yield*Qe(ArrayBuffer.isView(dt)?dt:await $e(String(dt)),at)}(E,D,ue);let Ce=0;return new ReadableStream({type:"bytes",async pull(ze){const{done:at,value:$e}=await Ae.next();if(at)return ze.close(),void W();let dt=$e.byteLength;q&&q(Ce+=dt),ze.enqueue(new Uint8Array($e))},cancel:ze=>(W(ze),Ae.return())},{highWaterMark:2})},Ut=(E,D)=>{const q=E!=null;return W=>setTimeout(()=>D({lengthComputable:q,total:E,loaded:W}))},$t=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Bt=$t&&typeof ReadableStream=="function",Mt=$t&&(typeof TextEncoder=="function"?(Ht=new TextEncoder,E=>Ht.encode(E)):async E=>new Uint8Array(await new Response(E).arrayBuffer()));var Ht;const Qt=Bt&&(()=>{let E=!1;const D=new Request(me.origin,{body:new ReadableStream,method:"POST",get duplex(){return E=!0,"half"}}).headers.has("Content-Type");return E&&!D})(),qt=Bt&&!!(()=>{try{return ge.isReadableStream(new Response("").body)}catch{}})(),rn={stream:qt&&(E=>E.body)};var dn;$t&&(dn=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(E=>{!rn[E]&&(rn[E]=ge.isFunction(dn[E])?D=>D[E]():(D,q)=>{throw new We(`Response type '${E}' is not supported`,We.ERR_NOT_SUPPORT,q)})}));const vn=async(E,D)=>{const q=ge.toFiniteNumber(E.getContentLength());return q??(async W=>W==null?0:ge.isBlob(W)?W.size:ge.isSpecCompliantForm(W)?(await new Request(W).arrayBuffer()).byteLength:ge.isArrayBufferView(W)?W.byteLength:(ge.isURLSearchParams(W)&&(W+=""),ge.isString(W)?(await Mt(W)).byteLength:void 0))(D)},En=$t&&(async E=>{let{url:D,method:q,data:W,signal:ue,cancelToken:Ae,timeout:Ce,onDownloadProgress:ze,onUploadProgress:at,responseType:$e,headers:dt,withCredentials:It="same-origin",fetchOptions:lt}=Gt(E);$e=$e?($e+"").toLowerCase():"text";let ct,Ot,[In,Wt]=ue||Ae||Ce?yt([ue,Ae],Ce):[];const jt=()=>{!ct&&setTimeout(()=>{In&&In.unsubscribe()}),ct=!0};let wn;try{if(at&&Qt&&q!=="get"&&q!=="head"&&(wn=await vn(dt,W))!==0){let wi,ki=new Request(D,{method:"POST",body:W,duplex:"half"});ge.isFormData(W)&&(wi=ki.headers.get("content-type"))&&dt.setContentType(wi),ki.body&&(W=Et(ki.body,65536,Ut(wn,nt(at)),null,Mt))}ge.isString(It)||(It=It?"cors":"omit"),Ot=new Request(D,{...lt,signal:In,method:q.toUpperCase(),headers:dt.normalize().toJSON(),body:W,duplex:"half",withCredentials:It});let yn=await fetch(Ot);const $s=qt&&($e==="stream"||$e==="response");if(qt&&(ze||$s)){const wi={};["status","statusText","headers"].forEach(sl=>{wi[sl]=yn[sl]});const ki=ge.toFiniteNumber(yn.headers.get("content-length"));yn=new Response(Et(yn.body,65536,ze&&Ut(ki,nt(ze,!0)),$s&&jt,Mt),wi)}$e=$e||"text";let rp=await rn[ge.findKey(rn,$e)||"text"](yn,E);return!$s&&jt(),Wt&&Wt(),await new Promise((wi,ki)=>{Ze(wi,ki,{data:rp,headers:Fe.from(yn.headers),status:yn.status,statusText:yn.statusText,config:E,request:Ot})})}catch(yn){throw jt(),yn&&yn.name==="TypeError"&&/fetch/i.test(yn.message)?Object.assign(new We("Network Error",We.ERR_NETWORK,E,Ot),{cause:yn.cause||yn}):We.from(yn,yn&&yn.code,E,Ot)}}),cn={http:null,xhr:kt,fetch:En};ge.forEach(cn,(E,D)=>{if(E){try{Object.defineProperty(E,"name",{value:D})}catch{}Object.defineProperty(E,"adapterName",{value:D})}});const sn=E=>`- ${E}`,un=E=>ge.isFunction(E)||E===null||E===!1,mn=E=>{E=ge.isArray(E)?E:[E];const{length:D}=E;let q,W;const ue={};for(let Ae=0;Ae<D;Ae++){let Ce;if(q=E[Ae],W=q,!un(q)&&(W=cn[(Ce=String(q)).toLowerCase()],W===void 0))throw new We(`Unknown adapter '${Ce}'`);if(W)break;ue[Ce||"#"+Ae]=W}if(!W){const Ae=Object.entries(ue).map(([ze,at])=>`adapter ${ze} `+(at===!1?"is not supported by the environment":"is not available in the build"));let Ce=D?Ae.length>1?`since :
`+Ae.map(sn).join(`
`):" "+sn(Ae[0]):"as no adapter specified";throw new We("There is no suitable adapter to dispatch the request "+Ce,"ERR_NOT_SUPPORT")}return W};function hn(E){if(E.cancelToken&&E.cancelToken.throwIfRequested(),E.signal&&E.signal.aborted)throw new He(null,E)}function bn(E){return hn(E),E.headers=Fe.from(E.headers),E.data=Le.call(E,E.transformRequest),["post","put","patch"].indexOf(E.method)!==-1&&E.headers.setContentType("application/x-www-form-urlencoded",!1),mn(E.adapter||g.adapter)(E).then(function(D){return hn(E),D.data=Le.call(E,E.transformResponse,D),D.headers=Fe.from(D.headers),D},function(D){return Be(D)||(hn(E),D&&D.response&&(D.response.data=Le.call(E,E.transformResponse,D.response),D.response.headers=Fe.from(D.response.headers))),Promise.reject(D)})}const fn="1.7.2",gn={};["object","boolean","number","function","string","symbol"].forEach((E,D)=>{gn[E]=function(q){return typeof q===E||"a"+(D<1?"n ":" ")+E}});const Zt={};gn.transitional=function(E,D,q){function W(ue,Ae){return"[Axios v1.7.2] Transitional option '"+ue+"'"+Ae+(q?". "+q:"")}return(ue,Ae,Ce)=>{if(E===!1)throw new We(W(Ae," has been removed"+(D?" in "+D:"")),We.ERR_DEPRECATED);return D&&!Zt[Ae]&&(Zt[Ae]=!0,console.warn(W(Ae," has been deprecated since v"+D+" and will be removed in the near future"))),!E||E(ue,Ae,Ce)}};const Nn={assertOptions:function(E,D,q){if(typeof E!="object")throw new We("options must be an object",We.ERR_BAD_OPTION_VALUE);const W=Object.keys(E);let ue=W.length;for(;ue-- >0;){const Ae=W[ue],Ce=D[Ae];if(Ce){const ze=E[Ae],at=ze===void 0||Ce(ze,Ae,E);if(at!==!0)throw new We("option "+Ae+" must be "+at,We.ERR_BAD_OPTION_VALUE)}else if(q!==!0)throw new We("Unknown option "+Ae,We.ERR_BAD_OPTION)}},validators:gn},Xt=Nn.validators;class Un{constructor(D){this.defaults=D,this.interceptors={request:new Re,response:new Re}}async request(D,q){try{return await this._request(D,q)}catch(W){if(W instanceof Error){let ue;Error.captureStackTrace?Error.captureStackTrace(ue={}):ue=new Error;const Ae=ue.stack?ue.stack.replace(/^.+\n/,""):"";try{W.stack?Ae&&!String(W.stack).endsWith(Ae.replace(/^.+\n.+\n/,""))&&(W.stack+=`
`+Ae):W.stack=Ae}catch{}}throw W}}_request(D,q){typeof D=="string"?(q=q||{}).url=D:q=D||{},q=Tt(this.defaults,q);const{transitional:W,paramsSerializer:ue,headers:Ae}=q;W!==void 0&&Nn.assertOptions(W,{silentJSONParsing:Xt.transitional(Xt.boolean),forcedJSONParsing:Xt.transitional(Xt.boolean),clarifyTimeoutError:Xt.transitional(Xt.boolean)},!1),ue!=null&&(ge.isFunction(ue)?q.paramsSerializer={serialize:ue}:Nn.assertOptions(ue,{encode:Xt.function,serialize:Xt.function},!0)),q.method=(q.method||this.defaults.method||"get").toLowerCase();let Ce=Ae&&ge.merge(Ae.common,Ae[q.method]);Ae&&ge.forEach(["delete","get","head","post","put","patch","common"],Ot=>{delete Ae[Ot]}),q.headers=Fe.concat(Ce,Ae);const ze=[];let at=!0;this.interceptors.request.forEach(function(Ot){typeof Ot.runWhen=="function"&&Ot.runWhen(q)===!1||(at=at&&Ot.synchronous,ze.unshift(Ot.fulfilled,Ot.rejected))});const $e=[];let dt;this.interceptors.response.forEach(function(Ot){$e.push(Ot.fulfilled,Ot.rejected)});let It,lt=0;if(!at){const Ot=[bn.bind(this),void 0];for(Ot.unshift.apply(Ot,ze),Ot.push.apply(Ot,$e),It=Ot.length,dt=Promise.resolve(q);lt<It;)dt=dt.then(Ot[lt++],Ot[lt++]);return dt}It=ze.length;let ct=q;for(lt=0;lt<It;){const Ot=ze[lt++],In=ze[lt++];try{ct=Ot(ct)}catch(Wt){In.call(this,Wt);break}}try{dt=bn.call(this,ct)}catch(Ot){return Promise.reject(Ot)}for(lt=0,It=$e.length;lt<It;)dt=dt.then($e[lt++],$e[lt++]);return dt}getUri(D){return ye(vt((D=Tt(this.defaults,D)).baseURL,D.url),D.params,D.paramsSerializer)}}ge.forEach(["delete","get","head","options"],function(E){Un.prototype[E]=function(D,q){return this.request(Tt(q||{},{method:E,url:D,data:(q||{}).data}))}}),ge.forEach(["post","put","patch"],function(E){function D(q){return function(W,ue,Ae){return this.request(Tt(Ae||{},{method:E,headers:q?{"Content-Type":"multipart/form-data"}:{},url:W,data:ue}))}}Un.prototype[E]=D(),Un.prototype[E+"Form"]=D(!0)});const ni=Un;class cr{constructor(D){if(typeof D!="function")throw new TypeError("executor must be a function.");let q;this.promise=new Promise(function(ue){q=ue});const W=this;this.promise.then(ue=>{if(!W._listeners)return;let Ae=W._listeners.length;for(;Ae-- >0;)W._listeners[Ae](ue);W._listeners=null}),this.promise.then=ue=>{let Ae;const Ce=new Promise(ze=>{W.subscribe(ze),Ae=ze}).then(ue);return Ce.cancel=function(){W.unsubscribe(Ae)},Ce},D(function(ue,Ae,Ce){W.reason||(W.reason=new He(ue,Ae,Ce),q(W.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(D){this.reason?D(this.reason):this._listeners?this._listeners.push(D):this._listeners=[D]}unsubscribe(D){if(!this._listeners)return;const q=this._listeners.indexOf(D);q!==-1&&this._listeners.splice(q,1)}static source(){let D;return{token:new cr(function(q){D=q}),cancel:D}}}const $h=cr,Ns={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ns).forEach(([E,D])=>{Ns[D]=E});const Gh=Ns,Cn=function E(D){const q=new ni(D),W=k(ni.prototype.request,q);return ge.extend(W,ni.prototype,q,{allOwnKeys:!0}),ge.extend(W,q,null,{allOwnKeys:!0}),W.create=function(ue){return E(Tt(D,ue))},W}(g);Cn.Axios=ni,Cn.CanceledError=He,Cn.CancelToken=$h,Cn.isCancel=Be,Cn.VERSION=fn,Cn.toFormData=j,Cn.AxiosError=We,Cn.Cancel=Cn.CanceledError,Cn.all=function(E){return Promise.all(E)},Cn.spread=function(E){return function(D){return E.apply(null,D)}},Cn.isAxiosError=function(E){return ge.isObject(E)&&E.isAxiosError===!0},Cn.mergeConfig=Tt,Cn.AxiosHeaders=Fe,Cn.formToJSON=E=>H(ge.isHTMLForm(E)?new FormData(E):E),Cn.getAdapter=mn,Cn.HttpStatusCode=Gh,Cn.default=Cn;const il=Cn,Vh={send:E=>{E.url!==void 0?il.post(E.url,E.data).then(D=>{const q=D.data;q&&q.code===0?E.success&&E.success():E.error&&E.error(q&&q.msg)}).catch(D=>{console.error(D),E.error&&E.error()}):E.error&&E.error()},read:E=>{E.url!==void 0?il.get(E.url).then(D=>{const q=D.data;q&&q.code===0?q.data?E.success&&E.success(q.data.map(W=>({author:W[3],time:W[0],text:W[4],color:W[2],type:W[1],size:W[5]&&(W[5]==="big"||W[5]==="small")?W[5]:"medium"}))):E.success&&E.success([{author:"",time:0,text:"",color:"#ffeaea",type:"right",size:"medium"}]):E.error&&E.error(q&&q.msg)}).catch(D=>{console.error(D),E.error&&E.error()}):E.error&&E.error()}},jh=Vh,Us={"zh-cn":{"Danmaku is loading":"弹幕加载中",Top:"顶部",Bottom:"底部",Rolling:"滚动",Big:"大的",Medium:"中等的",Small:"小的","Input danmaku, hit Enter":"输入弹幕，回车发送","About author":"关于作者","DPlayer feedback":"播放器意见反馈","About DPlayer":"关于 DPlayer 播放器",Loop:"洗脑循环",Speed:"速度",Audio:"音频","Primary audio":"主要音频","Secondary audio":"辅助音频","Opacity for danmaku":"弹幕透明度",Normal:"正常","Please input danmaku content!":"要输入弹幕内容啊喂！","Set danmaku color":"设置弹幕颜色","Set danmaku type":"设置弹幕类型","Set danmaku size":"设置弹幕大小","Show danmaku":"显示弹幕","Video load failed":"视频加载失败","Danmaku load failed":"弹幕加载失败","Danmaku send failed":"弹幕发送失败","Switching to":"正在切换至","Switched to":"已经切换至",Synchronize:"同步",Synchronized:"同步的",Quality:"画质",quality:"画质",FF:"快进",REW:"快退","Unlimited danmaku":"海量弹幕","Send danmaku":"发送弹幕",Setting:"设置","Full screen":"全屏","Web full screen":"页面全屏","Picture-in-Picture":"子母画面",Send:"发送",Screenshot:"截图",AirPlay:"无线投屏",s:"秒","Show comment":"显示弹幕","Hide comment":"隐藏弹幕","Show subtitle":"显示字幕","Hide subtitle":"隐藏字幕",Volume:"音量",Live:"直播","Video info":"视频统计信息"},"zh-tw":{"Danmaku is loading":"彈幕載入中",Top:"頂部",Bottom:"底部",Rolling:"滾動",Big:"大的",Medium:"中等的",Small:"小的","Input danmaku, hit Enter":"輸入彈幕，Enter 發送","About author":"關於作者","DPlayer feedback":"播放器意見回饋","About DPlayer":"關於 DPlayer 播放器",Loop:"循環播放",Speed:"速度",Audio:"音頻","Primary audio":"主要音頻","Secondary audio":"輔助音頻","Opacity for danmaku":"彈幕透明度",Normal:"正常","Please input danmaku content!":"請輸入彈幕內容啊！","Set danmaku color":"設定彈幕顏色","Set danmaku type":"設定彈幕類型","Set danmaku size":"设置弹幕大小","Show danmaku":"顯示彈幕","Video load failed":"影片載入失敗","Danmaku load failed":"彈幕載入失敗","Danmaku send failed":"彈幕發送失敗","Switching to":"正在切換至","Switched to":"已經切換至",Synchronize:"同步",Synchronized:"同步的",Quality:"畫質",quality:"畫質",FF:"快進",REW:"快退","Unlimited danmaku":"巨量彈幕","Send danmaku":"發送彈幕",Setting:"設定","Full screen":"全螢幕","Web full screen":"頁面全螢幕","Picture-in-Picture":"子母畫面",Send:"發送",Screenshot:"截圖",AirPlay:"無線投屏",s:"秒","Show comment":"顯示彈幕","Hide comment":"隱藏彈幕","Show subtitle":"顯示字幕","Hide subtitle":"隱藏字幕",Volume:"音量",Live:"直播","Video info":"影片統計訊息"},"ja-jp":{"Danmaku is loading":"コメントを読み込み中…",Top:"上固定",Bottom:"下固定",Rolling:"スクロール",Big:"大きめ",Medium:"標準",Small:"小さめ","Input danmaku, hit Enter":"右のボタンを押すとコメントできます","About author":"作者について","DPlayer feedback":"フィードバック","About DPlayer":"DPlayer について",Loop:"リピート再生",Speed:"再生速度",Audio:"音声","Primary audio":"主音声","Secondary audio":"副音声","Opacity for danmaku":"コメントの透明度",Normal:"標準","Please input danmaku content!":"コメント内容を入力して下さい！","Set danmaku color":"コメントの色","Set danmaku type":"コメントの位置","Set danmaku size":"コメントのサイズ","Show danmaku":"コメントを表示","Video load failed":"動画の読み込みに失敗しました…","Danmaku load failed":"コメントの読み込みに失敗しました…","Danmaku send failed":"コメントの送信に失敗しました…","Switching to":"画質を切り替えています…","Switched to":"画質を切り替えました",Synchronize:"同期する",Synchronized:"同期しました",Quality:"画質",quality:"画質",FF:"早送り",REW:"巻き戻し","Unlimited danmaku":"コメントを無制限に表示","Send danmaku":"コメントする",Setting:"設定","Full screen":"フルスクリーン","Web full screen":"ブラウザフルスクリーン","Picture-in-Picture":"Picture-in-Picture",Send:"コメントする",Screenshot:"スクリーンショット",s:"秒","Show comment":"コメントを表示する","Hide comment":"コメントを表示しない","Show subtitle":"字幕を表示する","Hide subtitle":"字幕を表示しない",Volume:"音量",Live:"Live","Video info":"動画の統計情報"}},Hh=function(E){this.lang=E,this.lang==="ja"&&(this.lang="ja-jp"),this.tran=D=>Us[this.lang]&&Us[this.lang][D]?Us[this.lang][D]:D};var qh=i(416),zh=i.n(qh),Kh=i(32),Wh=i.n(Kh),Yh=i(177),Xh=i.n(Yh),Jh=i(833),Qh=i.n(Jh),Zh=i(278),ef=i.n(Zh),tf=i(513),nf=i.n(tf),rf=i(204),sf=i.n(rf),af=i(717),of=i.n(af),lf=i(928),df=i.n(lf),cf=i(657),uf=i.n(cf),hf=i(894),ff=i.n(hf),pf=i(105),mf=i.n(pf),gf=i(460),yf=i.n(gf),_f=i(642),Af=i.n(_f),vf=i(1),bf=i.n(vf),Sf=i(165),Ef=i.n(Sf),Tf=i(484),xf=i.n(Tf),Cf=i(137),wf=i.n(Cf),kf=i(631),Rf=i.n(kf),If=i(28),Lf=i.n(If),Df=i(30),Pf=i.n(Df),Of=i(454),Mf=i.n(Of);const Zn={play:zh(),pause:Wh(),backward:Xh(),forward:Qh(),volumeUp:ef(),volumeDown:nf(),volumeOff:sf(),full:of(),fullWeb:df(),pip:uf(),setting:ff(),left:mf(),right:yf(),check:Af(),comment:bf(),commentOff:Ef(),send:xf(),pallette:wf(),camera:Rf(),subtitle:Pf(),loading:Mf(),airplay:Lf()};var Bf=i(456),Ff=i.n(Bf);const Nf=class{constructor(E){ve(this,"container");ve(this,"options");ve(this,"index");ve(this,"tran");ve(this,"volumeBar");ve(this,"volumeBarWrap");ve(this,"volumeBarWrapWrap");ve(this,"volumeButton");ve(this,"volumeButtonIcon");ve(this,"volumeIcon");ve(this,"playedBar");ve(this,"loadedBar");ve(this,"playedBarWrap");ve(this,"playedBarTime");ve(this,"danmaku");ve(this,"danmakuLoading");ve(this,"video");ve(this,"bezel");ve(this,"playButton");ve(this,"mobileBackwardButton");ve(this,"mobilePlayButton");ve(this,"mobileForwardButton");ve(this,"videoWrap");ve(this,"videoWrapAspect");ve(this,"controllerMask");ve(this,"ptime");ve(this,"settingButton");ve(this,"settingBox");ve(this,"settingOriginPanel");ve(this,"mask");ve(this,"syncButton");ve(this,"loop");ve(this,"loopToggle");ve(this,"showDanmaku");ve(this,"showDanmakuToggle");ve(this,"unlimitDanmaku");ve(this,"unlimitDanmakuToggle");ve(this,"quality");ve(this,"qualityValue");ve(this,"qualityHeader");ve(this,"qualityItem");ve(this,"speed");ve(this,"speedValue");ve(this,"speedHeader");ve(this,"speedItem");ve(this,"audio");ve(this,"audioValue");ve(this,"audioHeader");ve(this,"audioItem");ve(this,"danmakuOpacityBar");ve(this,"danmakuOpacityBarWrap");ve(this,"danmakuOpacityBarWrapWrap");ve(this,"danmakuOpacityBox");ve(this,"danmakuOpacityValue");ve(this,"dtime");ve(this,"controller");ve(this,"commentInput");ve(this,"commentButton");ve(this,"commentSettingBox");ve(this,"commentSettingButton");ve(this,"commentSettingFill");ve(this,"commentSendButton");ve(this,"commentSendFill");ve(this,"commentColorSettingBox");ve(this,"browserFullButton");ve(this,"webFullButton");ve(this,"pipButton");ve(this,"menu");ve(this,"menuItem");ve(this,"cameraButton");ve(this,"airplayButton");ve(this,"subtitleButton");ve(this,"subtitleButtonInner");ve(this,"subtitle");ve(this,"barPreview");ve(this,"barWrap");ve(this,"notice");ve(this,"infoPanel");ve(this,"infoPanelClose");ve(this,"infoMimeType");ve(this,"infoVersion");ve(this,"infoVideoFPS");ve(this,"infoPageFPS");ve(this,"infoDroppedFrames");ve(this,"infoType");ve(this,"infoUrl");ve(this,"infoResolution");ve(this,"infoDuration");ve(this,"infoBufferRemain");ve(this,"infoDownloadSpeed");this.container=E.container,this.options=E.options,this.index=E.index,this.tran=E.tran,this.init()}init(){this.container.innerHTML=Ff()({options:this.options,index:this.index,tran:this.tran,icons:Zn,mobile:T.isMobile,video:{current:!0,pic:this.options.video.pic,screenshot:this.options.screenshot,airplay:this.options.airplay,preload:this.options.preload,url:this.options.video.url,subtitle:this.options.subtitle,crossOrigin:this.options.crossOrigin}}),this.volumeBar=this.container.querySelector(".dplayer-volume-bar-inner"),this.volumeBarWrap=this.container.querySelector(".dplayer-volume-bar"),this.volumeBarWrapWrap=this.container.querySelector(".dplayer-volume-bar-wrap"),this.volumeButton=this.container.querySelector(".dplayer-volume"),this.volumeButtonIcon=this.container.querySelector(".dplayer-volume-icon"),this.volumeIcon=this.container.querySelector(".dplayer-volume-icon .dplayer-icon-content"),this.playedBar=this.container.querySelector(".dplayer-played"),this.loadedBar=this.container.querySelector(".dplayer-loaded"),this.playedBarWrap=this.container.querySelector(".dplayer-bar-wrap"),this.playedBarTime=this.container.querySelector(".dplayer-bar-time"),this.danmaku=this.container.querySelector(".dplayer-danmaku"),this.danmakuLoading=this.container.querySelector(".dplayer-danloading"),this.video=this.container.querySelector(".dplayer-video-current"),this.bezel=this.container.querySelector(".dplayer-bezel-icon"),this.playButton=this.container.querySelector(".dplayer-play-icon"),this.mobileBackwardButton=this.container.querySelector(".dplayer-mobile-icon-backward"),this.mobilePlayButton=this.container.querySelector(".dplayer-mobile-icon-play"),this.mobileForwardButton=this.container.querySelector(".dplayer-mobile-icon-forward"),this.videoWrap=this.container.querySelector(".dplayer-video-wrap"),this.videoWrapAspect=this.container.querySelector(".dplayer-video-wrap-aspect"),this.controllerMask=this.container.querySelector(".dplayer-controller-mask"),this.ptime=this.container.querySelector(".dplayer-ptime"),this.settingButton=this.container.querySelector(".dplayer-setting-icon"),this.settingBox=this.container.querySelector(".dplayer-setting-box"),this.settingOriginPanel=this.container.querySelector(".dplayer-setting-origin-panel"),this.mask=this.container.querySelector(".dplayer-mask"),this.syncButton=this.container.querySelector(".dplayer-live-badge"),this.loop=this.container.querySelector(".dplayer-setting-loop"),this.loopToggle=this.container.querySelector(".dplayer-setting-loop .dplayer-toggle-setting-input"),this.showDanmaku=this.container.querySelector(".dplayer-setting-showdan"),this.showDanmakuToggle=this.container.querySelector(".dplayer-showdan-setting-input"),this.unlimitDanmaku=this.container.querySelector(".dplayer-setting-danunlimit"),this.unlimitDanmakuToggle=this.container.querySelector(".dplayer-danunlimit-setting-input"),this.quality=this.container.querySelector(".dplayer-setting-quality"),this.qualityValue=this.container.querySelector(".dplayer-setting-quality .dplayer-label-value"),this.qualityHeader=this.container.querySelector(".dplayer-setting-quality-header"),this.qualityItem=this.container.querySelectorAll(".dplayer-setting-quality-item"),this.speed=this.container.querySelector(".dplayer-setting-speed"),this.speedValue=this.container.querySelector(".dplayer-setting-speed .dplayer-label-value"),this.speedHeader=this.container.querySelector(".dplayer-setting-speed-header"),this.speedItem=this.container.querySelectorAll(".dplayer-setting-speed-item"),this.audio=this.container.querySelector(".dplayer-setting-audio"),this.audioValue=this.container.querySelector(".dplayer-setting-audio .dplayer-label-value"),this.audioHeader=this.container.querySelector(".dplayer-setting-audio-header"),this.audioItem=this.container.querySelectorAll(".dplayer-setting-audio-item"),this.danmakuOpacityBar=this.container.querySelector(".dplayer-danmaku-bar-inner"),this.danmakuOpacityBarWrap=this.container.querySelector(".dplayer-danmaku-bar"),this.danmakuOpacityBarWrapWrap=this.container.querySelector(".dplayer-danmaku-bar-wrap"),this.danmakuOpacityBox=this.container.querySelector(".dplayer-setting-danmaku"),this.danmakuOpacityValue=this.container.querySelector(".dplayer-setting-danmaku .dplayer-label-value"),this.dtime=this.container.querySelector(".dplayer-dtime"),this.controller=this.container.querySelector(".dplayer-controller"),this.commentInput=this.container.querySelector(".dplayer-comment-input"),this.commentButton=this.container.querySelector(".dplayer-comment-icon"),this.commentSettingBox=this.container.querySelector(".dplayer-comment-setting-box"),this.commentSettingButton=this.container.querySelector(".dplayer-comment-setting-icon"),this.commentSettingFill=this.container.querySelector(".dplayer-comment-setting-icon path"),this.commentSendButton=this.container.querySelector(".dplayer-send-icon"),this.commentSendFill=this.container.querySelector(".dplayer-send-icon path"),this.commentColorSettingBox=this.container.querySelector(".dplayer-comment-setting-color"),this.browserFullButton=this.container.querySelector(".dplayer-full-icon"),this.webFullButton=this.container.querySelector(".dplayer-full-in-icon"),this.pipButton=this.container.querySelector(".dplayer-pip-icon"),this.menu=this.container.querySelector(".dplayer-menu"),this.menuItem=this.container.querySelectorAll(".dplayer-menu-item"),this.cameraButton=this.container.querySelector(".dplayer-camera-icon"),this.airplayButton=this.container.querySelector(".dplayer-airplay-icon"),this.subtitleButton=this.container.querySelector(".dplayer-subtitle-icon"),this.subtitleButtonInner=this.container.querySelector(".dplayer-subtitle-icon .dplayer-icon-content"),this.subtitle=this.container.querySelector(".dplayer-subtitle"),this.barPreview=this.container.querySelector(".dplayer-bar-preview"),this.barWrap=this.container.querySelector(".dplayer-bar-wrap"),this.notice=this.container.querySelector(".dplayer-notice"),this.infoPanel=this.container.querySelector(".dplayer-info-panel"),this.infoPanelClose=this.container.querySelector(".dplayer-info-panel-close"),this.infoMimeType=this.container.querySelector(".dplayer-info-panel-item-mimetype .dplayer-info-panel-item-data"),this.infoVersion=this.container.querySelector(".dplayer-info-panel-item-version .dplayer-info-panel-item-data"),this.infoVideoFPS=this.container.querySelector(".dplayer-info-panel-item-video-fps .dplayer-info-panel-item-data"),this.infoPageFPS=this.container.querySelector(".dplayer-info-panel-item-page-fps .dplayer-info-panel-item-data"),this.infoDroppedFrames=this.container.querySelector(".dplayer-info-panel-item-dropped-frames .dplayer-info-panel-item-data"),this.infoType=this.container.querySelector(".dplayer-info-panel-item-type .dplayer-info-panel-item-data"),this.infoUrl=this.container.querySelector(".dplayer-info-panel-item-url .dplayer-info-panel-item-data"),this.infoResolution=this.container.querySelector(".dplayer-info-panel-item-resolution .dplayer-info-panel-item-data"),this.infoDuration=this.container.querySelector(".dplayer-info-panel-item-duration .dplayer-info-panel-item-data"),this.infoBufferRemain=this.container.querySelector(".dplayer-info-panel-item-buffer-remain .dplayer-info-panel-item-data"),this.infoDownloadSpeed=this.container.querySelector(".dplayer-info-panel-item-download-speed .dplayer-info-panel-item-data")}},Uf=class{constructor(E){ve(this,"options");ve(this,"player");ve(this,"container");ve(this,"danTunnel");ve(this,"danIndex");ve(this,"danFontSize");ve(this,"dan");ve(this,"_opacity");ve(this,"events");ve(this,"unlimited");ve(this,"context",null);ve(this,"showing");ve(this,"paused",!1);this.options=E,this.player=this.options.player,this.container=this.options.container,this.danTunnel={right:{},top:{},bottom:{}},this.danIndex=0,this.danFontSize=24,this.dan=[],this.showing=!0,this._opacity=this.options.opacity,this.events=this.options.events,this.unlimited=this.options.unlimited===1,this._measure("",0),this.load()}load(){let E;E=this.options.api.maximum?`${this.options.api.address}?id=${this.options.api.id}&max=${this.options.api.maximum}`:`${this.options.api.address}?id=${this.options.api.id}`;const D=(this.options.api.addition||[]).slice(0);D.push(E),this.events&&this.events.trigger("danmaku_load_start",D),this._readAllEndpoints(D,q=>{this.dan=[].concat(...q).sort((W,ue)=>W.time-ue.time),window.requestAnimationFrame(()=>{this.frame()}),this.options.callback(),this.events&&this.events.trigger("danmaku_load_end")})}reload(E){this.options.api=E,this.dan=[],this.clear(),this.load()}_readAllEndpoints(E,D){const q=[];let W=0;for(let ue=0;ue<E.length;++ue)this.options.apiBackend.read({url:E[ue],success:Ae=>{q[ue]=Ae,++W,W===E.length&&D(q)},error:Ae=>{this.options.error(Ae||this.options.tran("Danmaku load failed")),q[ue]=[],++W,W===E.length&&D(q)}})}send(E,D,q=!1){const W={token:this.options.api.token,id:this.options.api.id,author:this.options.api.user,time:this.options.time(),text:E.text,color:E.color,type:E.type,size:E.size};this.options.apiBackend.send({url:this.options.api.address,data:W,success:()=>{this.dan.splice(this.danIndex,0,W),this.danIndex++,this.draw({text:W.text,color:W.color,type:W.type,size:W.size,border:!0}),this.events&&this.events.trigger("danmaku_send",W),D()},error:ue=>{this.options.error(ue||this.options.tran("Danmaku send failed")),q===!0&&D()}})}frame(){if(this.dan.length&&!this.paused&&this.showing){let E=this.dan[this.danIndex];const D=[];for(;E&&this.options.time()>(typeof E.time=="number"?E.time:parseFloat(E.time));)D.push(E),E=this.dan[++this.danIndex];this.draw(D)}window.requestAnimationFrame(()=>{this.frame()})}opacity(E){return E!==void 0&&(this.container.style.setProperty("--dplayer-danmaku-opacity",`${E}`),this._opacity=E,this.events&&this.events.trigger("danmaku_opacity",this._opacity)),this._opacity}draw(E){if(this.showing){let D;D=Object.prototype.toString.call(E)!=="[object Array]"?[E]:E;let W=this.container.offsetWidth/1024*1.25;W>=1&&(W=1);let ue=this.options.fontSize*W;const Ae=ue+6*W,Ce=this.container.offsetWidth,ze=this.container.offsetHeight/Ae,at=lt=>{const ct=lt.offsetWidth||parseInt(lt.style.width),Ot=lt.getBoundingClientRect().right||this.container.getBoundingClientRect().right+ct;return this.container.getBoundingClientRect().right-Ot},$e=lt=>(Ce+lt)/5,dt=(lt,ct,Ot)=>{const In=Ce/$e(Ot);for(let Wt=0;this.unlimited||Wt<ze;Wt++){const jt=this.danTunnel[ct][Wt+""];if(!jt||!jt.length)return this.danTunnel[ct][Wt+""]=[lt],lt.addEventListener("animationend",()=>{this.danTunnel[ct][Wt+""].splice(0,1)}),Wt%ze;if(ct==="right")for(let wn=0;wn<jt.length;wn++){const yn=at(jt[wn])-10;if(yn<=Ce-In*$e(parseInt(jt[wn].style.width))||yn<=0)break;if(wn===jt.length-1)return this.danTunnel[ct][Wt+""].push(lt),lt.addEventListener("animationend",()=>{this.danTunnel[ct][Wt+""].splice(0,1)}),Wt%ze}}return-1},It=document.createDocumentFragment();for(let lt=0;lt<D.length;lt++){const ct=D[lt];switch(typeof ct.color=="number"&&isFinite(ct.color)&&(ct.color=T.number2Color(ct.color)),typeof ct.type=="number"&&isFinite(ct.type)&&(ct.type=T.number2Type(ct.type)),ct.color||(ct.color="#ffeaea"),(!ct.type||ct.type!=="right"&&ct.type!=="top"&&ct.type!=="bottom")&&(ct.type="right"),ct.size||(ct.size="medium"),ct.size){case"big":ue*=1.25;break;case"small":ue*=.8}const Ot=(()=>{let Wt=0;for(const jt of ct.text.split(`
`)){const wn=this._measure(jt,ue);wn>Wt&&(Wt=wn)}return Wt})(),In=ct.text.split(`
`);for(const Wt of ct.type==="bottom"?In.reverse():In){const jt=document.createElement("div");if(jt.classList.add("dplayer-danmaku-item"),jt.classList.add(`dplayer-danmaku-${ct.type}`),jt.classList.add(`dplayer-danmaku-size-${ct.size}`),jt.style.color=ct.color,"border"in ct&&ct.border){const yn=document.createElement("span");yn.style.border=`2px solid ${this.options.borderColor}`,yn.textContent=Wt,jt.appendChild(yn)}else jt.textContent=Wt;jt.addEventListener("animationend",()=>{this.container.removeChild(jt)});const wn=dt(jt,ct.type,Ot);switch(ct.type){case"right":wn>=0&&(jt.style.width=Ot+1+"px",jt.style.top=Ae*wn+8+"px",jt.style.transform=`translateX(-${Ce}px)`,jt.style.willChange="transform");break;case"top":wn>=0&&(jt.style.width=Ot+1+"px",jt.style.top=Ae*wn+8+"px",jt.style.willChange="visibility");break;case"bottom":wn>=0&&(jt.style.width=Ot+1+"px",jt.style.bottom=Ae*wn+8+"px",jt.style.willChange="visibility");break;default:console.error(`Can't handled danmaku type: ${ct.type}`)}wn>=0&&(jt.classList.add("dplayer-danmaku-move"),jt.style.animationDuration=this._danAnimation(ct.type),It.appendChild(jt))}}return this.container.style.setProperty("--dplayer-danmaku-font-size",`${ue}px`),this.container.appendChild(It),It}return null}play(){this.paused=!1}pause(){this.paused=!0}_measure(E,D){this.context&&this.danFontSize===D||(this.danFontSize=D,this.context=document.createElement("canvas").getContext("2d"),this.context.font=`bold ${this.danFontSize}px "Segoe UI", Arial`);const q=E.split(`
`);let W=0;for(let ue=0;ue<q.length;ue++)W=Math.max(W,this.context.measureText(q[ue]).width);return W}seek(){this.clear();for(let E=0;E<this.dan.length;E++){if(this.dan[E].time>=this.options.time()){this.danIndex=E;break}this.danIndex=this.dan.length}}clear(){this.danTunnel={right:{},top:{},bottom:{}},this.danIndex=0,this.options.container.innerHTML="",this.events&&this.events.trigger("danmaku_clear")}resize(){const E=this.container.offsetWidth,D=this.container.querySelectorAll(".dplayer-danmaku-item");for(let q=0;q<D.length;q++)D[q].style.transform=`translateX(-${E}px)`}hide(){this.showing=!1,this.pause(),this.clear(),this.events&&this.events.trigger("danmaku_hide")}show(){this.seek(),this.showing=!0,this.play(),this.events&&this.events.trigger("danmaku_show")}toggle(){this.showing?this.hide():this.show()}unlimit(E){this.unlimited=E}speed(E){this.options.speedRate=E}_danAnimation(E){const D=this.options.speedRate,q=this.player.fullScreen.isFullScreen("browser")||this.player.fullScreen.isFullScreen("web");return{top:(q?4.5:4)/D+"s",right:(q?5.5:5)/D+"s",bottom:(q?4.5:4)/D+"s"}[E]}},$f=class{constructor(){ve(this,"events");ve(this,"videoEvents");ve(this,"playerEvents");this.events={},this.videoEvents=["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","mozaudioavailable","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],this.playerEvents=["screenshot","thumbnails_show","thumbnails_hide","danmaku_show","danmaku_hide","danmaku_clear","danmaku_load_start","danmaku_load_end","danmaku_send","danmaku_opacity","contextmenu_show","contextmenu_hide","notice_show","notice_hide","quality_start","quality_end","destroy","resize","fullscreen","fullscreen_cancel","webfullscreen","webfullscreen_cancel","subtitle_show","subtitle_hide","subtitle_change"]}on(E,D,q=!1){this.type(E)&&typeof D=="function"&&(this.events[E]||(this.events[E]=[]),this.events[E].push({callback:D,once:q}))}off(E,D){if(this.type(E)&&typeof D=="function"&&this.events[E])for(const q of this.events[E])q.callback===D&&this.events[E].splice(this.events[E].indexOf(q),1)}trigger(E,D){if(this.events[E]&&this.events[E].length)for(const q of this.events[E])q.callback(D),q.once&&this.off(E,q.callback)}type(E){return this.playerEvents.indexOf(E)!==-1?"player":this.videoEvents.indexOf(E)!==-1?"video":(console.error(`Unknown event name: ${E}`),null)}},Gf=class{constructor(E){ve(this,"player");ve(this,"lastScrollPosition");ve(this,"fullscreenchange");this.player=E,this.lastScrollPosition={left:0,top:0},this.player.events.on("webfullscreen",()=>{this.player.resize()}),this.player.events.on("webfullscreen_cancel",()=>{this.player.resize(),T.setScrollPosition(this.lastScrollPosition)}),this.fullscreenchange=()=>{this.player.resize(),this.isFullScreen("browser")?this.player.events.trigger("fullscreen"):(T.setScrollPosition(this.lastScrollPosition),this.player.container.classList.remove("dplayer-fulled-browser"),this.player.events.trigger("fullscreen_cancel"))},this.player.container.onfullscreenchange!==void 0?this.player.container.addEventListener("fullscreenchange",this.fullscreenchange):this.player.container.addEventListener("webkitfullscreenchange",this.fullscreenchange)}isFullScreen(E="browser"){switch(E){case"browser":{const D=document.fullscreenElement||document.webkitFullscreenElement;return!(!D||D!==this.player.container)}case"web":return this.player.container.classList.contains("dplayer-fulled")}}request(E="browser"){const D=E==="browser"?"web":"browser",q=this.isFullScreen(D);switch(q||(this.lastScrollPosition=T.getScrollPosition()),E){case"browser":if(this.player.container.requestFullscreen=this.player.container.requestFullscreen||this.player.container.webkitRequestFullscreen,this.player.container.requestFullscreen!==void 0?this.player.container.requestFullscreen():this.player.video.webkitEnterFullscreen&&this.player.video.webkitEnterFullscreen(),screen.orientation)try{screen.orientation.lock("landscape").catch(()=>{})}catch{}this.player.container.requestFullscreen!==void 0&&this.player.container.classList.add("dplayer-fulled-browser");break;case"web":this.player.container.classList.add("dplayer-fulled"),document.body.classList.add("dplayer-web-fullscreen-fix"),this.player.events.trigger("webfullscreen")}q&&this.cancel(D)}cancel(E="browser"){switch(E){case"browser":if(document.exitFullscreen=document.exitFullscreen||document.webkitExitFullscreen,document.exitFullscreen&&document.exitFullscreen(),screen.orientation)try{screen.orientation.unlock()}catch{}this.player.container.classList.remove("dplayer-fulled-browser");break;case"web":this.player.container.classList.remove("dplayer-fulled"),document.body.classList.remove("dplayer-web-fullscreen-fix"),this.player.events.trigger("webfullscreen_cancel")}}toggle(E="browser"){this.isFullScreen(E)?this.cancel(E):this.request(E)}destroy(){this.player.container.removeEventListener("fullscreenchange",this.fullscreenchange),this.player.container.removeEventListener("webkitfullscreenchange",this.fullscreenchange)}},Vf=class{constructor(E){ve(this,"storageName");ve(this,"default");ve(this,"data");this.storageName={opacity:"dplayer-danmaku-opacity",volume:"dplayer-volume",unlimited:"dplayer-danmaku-unlimited",danmaku:"dplayer-danmaku-show",subtitle:"dplayer-subtitle-show"},this.default={opacity:1,volume:Object.prototype.hasOwnProperty.call(E.options,"volume")?E.options.volume:1,unlimited:(E.options.danmaku&&E.options.danmaku.unlimited?1:0)||0,danmaku:1,subtitle:1},this.data={},this.init()}init(){for(const E in this.storageName){const D=this.storageName[E];this.data[E]=parseFloat(T.storage.get(D)||this.default[E].toString())}}get(E){return this.data[E]}set(E,D){this.data[E]=D,T.storage.set(this.storageName[E],D)}},jf=class{constructor(E,D,q,W,ue){ve(this,"container");ve(this,"video");ve(this,"plugins");ve(this,"options");ve(this,"events");this.container=E,this.video=D,this.plugins=q,this.options=W,this.events=ue,this.init()}init(){if(this.container.style.fontSize=this.options.fontSize,this.container.style.bottom=this.options.bottom,this.container.style.color=this.options.color,this.options.type==="webvtt"&&this.video.textTracks&&this.video.textTracks[0]){const E=this.video.textTracks[0];E.oncuechange=()=>{if(!E.activeCues)return;const D=E.activeCues[0];if(this.container.innerHTML="",D){const q=document.createElement("div");q.appendChild(D.getCueAsHTML());const W=q.innerHTML.split(/\r?\n/).map(ue=>`<p>${ue}</p>`).join("");this.container.innerHTML=W}this.events.trigger("subtitle_change")}}}show(){this.container.classList.remove("dplayer-subtitle-hide"),this.options.type==="aribb24"&&this.plugins.aribb24Caption&&this.plugins.aribb24Caption.show(),this.events.trigger("subtitle_show")}hide(){this.container.classList.add("dplayer-subtitle-hide"),this.options.type==="aribb24"&&this.plugins.aribb24Caption&&this.plugins.aribb24Caption.hide(),this.events.trigger("subtitle_hide")}toggle(){this.container.classList.contains("dplayer-subtitle-hide")?this.show():this.hide()}},Hf=class{constructor(E){ve(this,"elements");this.elements={},this.elements.volume=E.volumeBar,this.elements.played=E.playedBar,this.elements.loaded=E.loadedBar,this.elements.danmaku=E.danmakuOpacityBar}set(E,D,q){D=Math.max(D,0),D=Math.min(D,1),this.elements[E].style[q]=100*D+"%"}get(E){return parseFloat(this.elements[E].style.width)/100}},qf=class{constructor(E){ve(this,"player");ve(this,"types");ve(this,"enablefpsChecker");ve(this,"enableinfoChecker");ve(this,"enableloadingChecker");ve(this,"fpsIndex");ve(this,"fpsStart");ve(this,"fpsChecker");ve(this,"infoChecker");ve(this,"loadingChecker");this.player=E,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(D){window.setTimeout(D,1e3/60)},this.types=["loading","info","fps"],this.init()}init(){this.types.map(E=>(E!=="fps"&&this[`init${E}Checker`](),E))}initloadingChecker(){let E=0,D=0,q=!1;this.loadingChecker=window.setInterval(()=>{this.enableloadingChecker&&(D=this.player.video.currentTime,q||D!==E||this.player.video.paused||(this.player.container.classList.add("dplayer-loading"),q=!0),q&&D>E&&!this.player.video.paused&&(this.player.container.classList.remove("dplayer-loading"),q=!1),E=D)},100)}initfpsChecker(){window.requestAnimationFrame(()=>{if(this.enablefpsChecker)if(this.initfpsChecker(),this.fpsStart){this.fpsIndex++;const E=new Date;E-this.fpsStart>1e3&&(this.player.infoPanel.fps(this.fpsIndex/(E-this.fpsStart)*1e3),this.fpsStart=new Date,this.fpsIndex=0)}else this.fpsStart=new Date,this.fpsIndex=0;else this.fpsStart=0,this.fpsIndex=0})}initinfoChecker(){this.infoChecker=window.setInterval(()=>{this.enableinfoChecker&&this.player.infoPanel.update()},1e3)}enable(E){this[`enable${E}Checker`]=!0,E==="fps"&&this.initfpsChecker()}disable(E){this[`enable${E}Checker`]=!1}destroy(){this.types.map(E=>(this[`enable${E}Checker`]=!1,this[`${E}Checker`]&&window.clearInterval(this[`${E}Checker`]),E))}},zf=class{constructor(E){ve(this,"container");this.container=E,this.container.addEventListener("animationend",()=>{this.container.classList.remove("dplayer-bezel-transition")})}switch(E){this.container.innerHTML=E,this.container.classList.add("dplayer-bezel-transition")}},Kf=class{constructor(E){ve(this,"container");ve(this,"barWidth");ve(this,"events");this.container=E.container,this.barWidth=E.barWidth,this.container.style.backgroundImage=`url('${E.url}')`,this.events=E.events}resize(E,D,q){this.container.style.width=`${E}px`,this.container.style.height=`${D}px`,this.container.style.top=2-D+"px",this.barWidth=q}show(){this.container.style.display="block",this.events&&this.events.trigger("thumbnails_show")}move(E){this.container.style.backgroundPosition=`-${160*(Math.ceil(E/this.barWidth*100)-1)}px 0`,this.container.style.left=`${Math.min(Math.max(E-this.container.offsetWidth/2,-10),this.barWidth-150)}px`}hide(){this.container.style.display="none",this.events&&this.events.trigger("thumbnails_hide")}},Wf=class{constructor(E){ve(this,"player");ve(this,"disableAutoHide",!1);ve(this,"autoHideTimer");ve(this,"mobileSkipTimer");ve(this,"mobileBackwardTime");ve(this,"mobileForwardTime");ve(this,"setAutoHideHandler");ve(this,"thumbnails",null);this.player=E,this.autoHideTimer=0,this.mobileSkipTimer=0,this.mobileBackwardTime=0,this.mobileForwardTime=0,this.setAutoHideHandler=()=>this.setAutoHide(),T.isMobile?this.player.container.addEventListener("touchmove",this.setAutoHideHandler):(this.player.container.addEventListener("mousemove",this.setAutoHideHandler),this.player.container.addEventListener("click",this.setAutoHideHandler)),this.player.on("play",this.setAutoHideHandler),this.player.on("pause",this.setAutoHideHandler),this.initPlayButton(),this.initThumbnails(),this.initPlayedBar(),this.initFullButton(),this.initPipButton(),this.initSyncButton(),this.initScreenshotButton(),this.initSubtitleButton(),this.initHighlights(),this.initAirplayButton(),T.isMobile||this.initVolumeButton()}initPlayButton(){this.player.template.playButton.addEventListener("click",()=>{this.player.toggle()}),this.player.template.mobilePlayButton.addEventListener("click",()=>{this.player.toggle()}),T.isMobile?(this.player.template.videoWrap.addEventListener("click",()=>{this.toggle(),this.isShow()&&this.setAutoHide()}),this.player.template.controllerMask.addEventListener("click",()=>{this.toggle(),this.isShow()&&this.setAutoHide()})):(this.player.template.videoWrap.addEventListener("click",()=>{this.player.toggle()}),this.player.template.controllerMask.addEventListener("click",()=>{this.player.toggle()})),this.player.template.mobileBackwardButton.addEventListener("click",()=>{this.mobileBackwardTime+=10,this.player.seek(this.player.video.currentTime-10),this.player.notice(`${this.player.tran("REW")} ${this.mobileBackwardTime.toFixed(0)} ${this.player.tran("s")}`),window.clearTimeout(this.mobileSkipTimer),this.mobileSkipTimer=window.setTimeout(()=>{this.mobileBackwardTime=0},1e3),this.setAutoHide()}),this.player.template.mobileForwardButton.addEventListener("click",()=>{this.mobileForwardTime+=10,this.player.seek(this.player.video.currentTime+10),this.player.notice(`${this.player.tran("FF")} ${this.mobileForwardTime.toFixed(0)} ${this.player.tran("s")}`),window.clearTimeout(this.mobileSkipTimer),this.mobileSkipTimer=window.setTimeout(()=>{this.mobileForwardTime=0},1e3),this.setAutoHide()})}initHighlights(){this.player.on("durationchange",()=>{if(this.player.video.duration!==1&&this.player.video.duration!==1/0&&this.player.options.highlight){const E=this.player.template.playedBarWrap.querySelectorAll(".dplayer-highlight");[].slice.call(E,0).forEach(D=>{this.player.template.playedBarWrap.removeChild(D)});for(let D=0;D<this.player.options.highlight.length;D++){if(!this.player.options.highlight[D].text||!this.player.options.highlight[D].time)continue;const q=document.createElement("div");q.classList.add("dplayer-highlight"),q.style.left=this.player.options.highlight[D].time/this.player.video.duration*100+"%";const W=document.createElement("span");W.classList.add("dplayer-highlight-text"),W.textContent=this.player.options.highlight[D].text,q.appendChild(W),this.player.template.playedBarWrap.insertBefore(q,this.player.template.playedBarTime)}}})}initThumbnails(){this.player.options.video.thumbnails&&(this.thumbnails=new Kf({container:this.player.template.barPreview,barWidth:this.player.template.barWrap.offsetWidth,url:this.player.options.video.thumbnails,events:this.player.events}),this.player.on("loadedmetadata",()=>{this.thumbnails.resize(160,this.player.video.videoHeight/this.player.video.videoWidth*160,this.player.template.barWrap.offsetWidth)}))}initPlayedBar(){let E;const D=W=>{let ue=((W.clientX||W.changedTouches&&W.changedTouches[0].clientX)-T.getBoundingClientRectViewLeft(this.player.template.playedBarWrap))/this.player.template.playedBarWrap.clientWidth;ue=Math.max(ue,0),ue=Math.min(ue,1),this.player.bar.set("played",ue,"width");const Ae=T.getVideoDuration(this.player.video,this.player.template);this.player.template.ptime.textContent=T.secondToTime(ue*Ae),this.player.container.classList.add("dplayer-seeking"),this.player.video.paused||this.player.video.pause()},q=W=>{document.removeEventListener(T.nameMap.dragEnd,q),document.removeEventListener(T.nameMap.dragMove,D);let ue=((W.clientX||W.changedTouches&&W.changedTouches[0].clientX)-T.getBoundingClientRectViewLeft(this.player.template.playedBarWrap))/this.player.template.playedBarWrap.clientWidth;ue=Math.max(ue,0),ue=Math.min(ue,1),this.player.bar.set("played",ue,"width");const Ae=T.getVideoDuration(this.player.video,this.player.template);this.player.seek(this.player.bar.get("played")*Ae),E||this.player.video.play(),this.player.container.classList.remove("dplayer-seeking")};this.player.template.playedBarWrap.addEventListener(T.nameMap.dragStart,()=>{E=this.player.video.paused,document.addEventListener(T.nameMap.dragMove,D),document.addEventListener(T.nameMap.dragEnd,q)}),this.player.template.playedBarWrap.addEventListener(T.nameMap.dragMove,W=>{const ue=T.getVideoDuration(this.player.video,this.player.template);if(ue){const Ae=this.player.template.playedBarWrap.getBoundingClientRect().left,Ce=(W.clientX||W.changedTouches[0].clientX)-Ae;if(Ce<0||Ce>this.player.template.playedBarWrap.offsetWidth)return;const ze=ue*(Ce/this.player.template.playedBarWrap.offsetWidth);T.isMobile&&this.thumbnails&&this.thumbnails.show(),this.thumbnails&&this.thumbnails.move(Ce),this.player.template.playedBarTime.style.left=Ce-(ze>=3600?25:20)+"px",this.player.template.playedBarTime.textContent=T.secondToTime(ze),this.player.template.playedBarTime.classList.remove("hidden")}}),this.player.template.playedBarWrap.addEventListener(T.nameMap.dragEnd,()=>{T.isMobile&&this.thumbnails&&this.thumbnails.hide()}),T.isMobile||(this.player.template.playedBarWrap.addEventListener("mouseenter",()=>{this.player.video.duration&&(this.thumbnails&&this.thumbnails.show(),this.player.template.playedBarTime.classList.remove("hidden"))}),this.player.template.playedBarWrap.addEventListener("mouseleave",()=>{this.player.video.duration&&(this.thumbnails&&this.thumbnails.hide(),this.player.template.playedBarTime.classList.add("hidden"))}))}initFullButton(){this.player.template.browserFullButton.addEventListener("click",()=>{this.player.fullScreen.toggle("browser")}),this.player.template.webFullButton.addEventListener("click",()=>{this.player.fullScreen.toggle("web")})}initPipButton(){document.pictureInPictureEnabled?this.player.template.pipButton.addEventListener("click",()=>{document.pictureInPictureElement?document.exitPictureInPicture():this.player.video.requestPictureInPicture().catch(E=>{console.error(E),this.player.options.lang==="ja"||this.player.options.lang==="ja-jp"?this.player.notice("Picture-in-Picture を開始できませんでした。",void 0,void 0,"#FF6F6A"):this.player.notice("Picture-in-Picture could not be started.",void 0,void 0,"#FF6F6A")})}):this.player.template.pipButton.style.display="none"}initVolumeButton(){const E=q=>{const W=q||window.event,ue=((W.clientX||W.changedTouches[0].clientX)-T.getBoundingClientRectViewLeft(this.player.template.volumeBarWrap)-5.5)/35;this.player.volume(ue)},D=()=>{document.removeEventListener(T.nameMap.dragEnd,D),document.removeEventListener(T.nameMap.dragMove,E),this.player.template.volumeButton.classList.remove("dplayer-volume-active")};this.player.template.volumeBarWrapWrap.addEventListener("click",q=>{const W=q||window.event,ue=((W.clientX||W.changedTouches[0].clientX)-T.getBoundingClientRectViewLeft(this.player.template.volumeBarWrap)-5.5)/35;this.player.volume(ue)}),this.player.template.volumeBarWrapWrap.addEventListener(T.nameMap.dragStart,()=>{document.addEventListener(T.nameMap.dragMove,E),document.addEventListener(T.nameMap.dragEnd,D),this.player.template.volumeButton.classList.add("dplayer-volume-active")}),this.player.template.volumeButtonIcon.addEventListener("click",()=>{this.player.video.muted?(this.player.video.muted=!1,this.player.switchVolumeIcon(),this.player.bar.set("volume",this.player.volume(),"width")):(this.player.video.muted=!0,this.player.template.volumeIcon.innerHTML=Zn.volumeOff,this.player.bar.set("volume",0,"width"))})}initSyncButton(){this.player.options.live&&this.player.template.syncButton.addEventListener("click",()=>{this.player.sync()})}initScreenshotButton(){this.player.options.screenshot&&this.player.template.cameraButton.addEventListener("click",()=>{const E=document.createElement("canvas");E.width=this.player.video.videoWidth,E.height=this.player.video.videoHeight,E.getContext("2d").drawImage(this.player.video,0,0,E.width,E.height),E.toBlob(D=>{if(D===null)return;const q=new Date,W=`Capture_${q.getFullYear()}${("0"+(q.getMonth()+1)).slice(-2)}${("0"+q.getDate()).slice(-2)}-${("0"+q.getHours()).slice(-2)}${("0"+q.getMinutes()).slice(-2)}${("0"+q.getSeconds()).slice(-2)}.jpg`,ue=URL.createObjectURL(D),Ae=document.createElement("a");Ae.download!==void 0?(Ae.download=W,Ae.href=ue,Ae.click(),URL.revokeObjectURL(ue),this.player.events.trigger("screenshot",D)):this.player.notice("Error: Screenshot download is not supported.",void 0,void 0,"#FF6F6A")},"image/jpeg",1)})}initAirplayButton(){this.player.options.airplay&&(window.WebKitPlaybackTargetAvailabilityEvent?this.player.video.addEventListener("webkitplaybacktargetavailabilitychanged",(function(E){E.availability==="available"?this.template.airplayButton.disable=!1:this.template.airplayButton.disable=!0,this.template.airplayButton.addEventListener("click",(function(){this.video.webkitShowPlaybackTargetPicker()}).bind(this))}).bind(this.player)):this.player.template.airplayButton.style.display="none")}initSubtitleButton(){this.player.options.subtitle&&(this.player.events.on("subtitle_show",()=>{this.player.template.subtitleButton.ariaLabel=this.player.tran("Hide subtitle"),this.player.template.subtitleButtonInner.style.opacity="",this.player.user.set("subtitle",1)}),this.player.events.on("subtitle_hide",()=>{this.player.template.subtitleButton.ariaLabel=this.player.tran("Show subtitle"),this.player.template.subtitleButtonInner.style.opacity="0.4",this.player.user.set("subtitle",0)}),this.player.template.subtitleButton.addEventListener("click",()=>{this.player.subtitle!==null&&this.player.subtitle.toggle()}))}setAutoHide(E=3e3){this.show(),window.clearTimeout(this.autoHideTimer),this.autoHideTimer=window.setTimeout(()=>{!this.player.video.played.length||this.player.paused||this.disableAutoHide||this.hide()},E)}show(){this.player.container.classList.remove("dplayer-hide-controller")}hide(){this.player.container.classList.add("dplayer-hide-controller"),this.player.setting.hide(),this.player.comment&&this.player.comment.hide()}isShow(){return!this.player.container.classList.contains("dplayer-hide-controller")}toggle(){this.isShow()?this.hide():this.show()}destroy(){T.isMobile?this.player.container.removeEventListener("touchmove",this.setAutoHideHandler):(this.player.container.removeEventListener("mousemove",this.setAutoHideHandler),this.player.container.removeEventListener("click",this.setAutoHideHandler)),window.clearTimeout(this.autoHideTimer)}},Yf=class{constructor(E){ve(this,"player");ve(this,"loop");ve(this,"showDanmaku");ve(this,"unlimitDanmaku");ve(this,"currentAudio","primary");ve(this,"resizeObserver");this.player=E,this.player.template.mask.addEventListener("click",()=>{this.hide()}),this.player.template.settingButton.addEventListener("click",()=>{this.show()});const D=()=>{const q=this.player.template.settingOriginPanel.scrollHeight;this.player.template.settingBox.style.clipPath=`inset(calc(100% - ${q}px) 0 0 round 7px)`};if(D(),this.resizeObserver=new ResizeObserver(D),this.resizeObserver.observe(this.player.template.settingOriginPanel),this.player.options.video.quality){this.player.template.quality.addEventListener("click",()=>{this.player.template.settingBox.classList.add("dplayer-setting-box-quality")}),this.player.template.qualityHeader.addEventListener("click",()=>{this.player.template.settingBox.classList.remove("dplayer-setting-box-quality")});for(let q=0;q<this.player.template.qualityItem.length;q++)this.player.template.qualityItem[q].addEventListener("click",()=>{this.player.switchingQuality||this.player.switchQuality(parseInt(this.player.template.qualityItem[q].dataset.index))})}this.player.template.speed.addEventListener("click",()=>{this.player.template.settingBox.classList.add("dplayer-setting-box-speed")}),this.player.template.speedHeader.addEventListener("click",()=>{this.player.template.settingBox.classList.remove("dplayer-setting-box-speed")});for(let q=0;q<this.player.template.speedItem.length;q++)this.player.template.speedItem[q].addEventListener("click",W=>{this.player.speed(parseFloat(W.target.dataset.speed))});this.player.template.audio.addEventListener("click",()=>{this.player.template.settingBox.classList.add("dplayer-setting-box-audio")}),this.player.template.audioHeader.addEventListener("click",()=>{this.player.template.settingBox.classList.remove("dplayer-setting-box-audio")});for(let q=0;q<this.player.template.audioItem.length;q++)this.player.template.audioItem[q].addEventListener("click",()=>{if(this.player.plugins.mpegts||this.player.plugins.liveLLHLSForKonomiTV){if(this.player.template.audioItem[q].dataset.audio===this.currentAudio)return;this.player.template.audioItem[q].dataset.audio==="primary"?(this.currentAudio="primary",this.player.template.audioItem[0].classList.add("dplayer-setting-audio-current"),this.player.template.audioItem[1].classList.remove("dplayer-setting-audio-current"),this.player.template.audioValue.textContent=this.player.tran("Primary audio"),window.mpegts&&this.player.plugins.mpegts&&this.player.plugins.mpegts instanceof window.mpegts.MSEPlayer?this.player.plugins.mpegts.switchPrimaryAudio():this.player.plugins.liveLLHLSForKonomiTV&&this.player.plugins.liveLLHLSForKonomiTV.switchPrimaryAudio()):this.player.template.audioItem[q].dataset.audio==="secondary"&&(this.currentAudio="secondary",this.player.template.audioItem[0].classList.remove("dplayer-setting-audio-current"),this.player.template.audioItem[1].classList.add("dplayer-setting-audio-current"),this.player.template.audioValue.textContent=this.player.tran("Secondary audio"),window.mpegts&&this.player.plugins.mpegts&&this.player.plugins.mpegts instanceof window.mpegts.MSEPlayer?this.player.plugins.mpegts.switchSecondaryAudio():this.player.plugins.liveLLHLSForKonomiTV&&this.player.plugins.liveLLHLSForKonomiTV.switchSecondaryAudio()),this.player.template.settingBox.classList.remove("dplayer-setting-box-audio")}});if(this.loop=this.player.options.loop,this.player.template.loopToggle.checked=this.loop,this.player.template.loop.addEventListener("click",()=>{this.player.template.loopToggle.checked=!this.player.template.loopToggle.checked,this.player.template.loopToggle.checked?this.loop=!0:this.loop=!1}),this.showDanmaku=this.player.user.get("danmaku")===1,this.showDanmaku||this.player.danmaku&&this.player.danmaku.hide(),this.player.template.showDanmakuToggle.checked=this.showDanmaku,this.player.template.showDanmaku.addEventListener("click",()=>{this.player.template.showDanmakuToggle.checked=!this.player.template.showDanmakuToggle.checked,this.player.template.showDanmakuToggle.checked?(this.showDanmaku=!0,this.player.danmaku!==null&&this.player.danmaku.show()):(this.showDanmaku=!1,this.player.danmaku!==null&&this.player.danmaku.hide()),this.player.user.set("danmaku",this.showDanmaku?1:0)}),this.unlimitDanmaku=this.player.user.get("unlimited")===1,this.player.template.unlimitDanmakuToggle.checked=this.unlimitDanmaku,this.player.template.unlimitDanmaku.addEventListener("click",()=>{this.player.template.unlimitDanmakuToggle.checked=!this.player.template.unlimitDanmakuToggle.checked,this.player.template.unlimitDanmakuToggle.checked?(this.unlimitDanmaku=!0,this.player.danmaku!==null&&this.player.danmaku.unlimit(!0)):(this.unlimitDanmaku=!1,this.player.danmaku!==null&&this.player.danmaku.unlimit(!1)),this.player.user.set("unlimited",this.unlimitDanmaku?1:0)}),this.player.danmaku){this.player.on("danmaku_opacity",Ae=>{this.player.bar.set("danmaku",Ae,"width"),this.player.user.set("opacity",Ae),this.player.template.danmakuOpacityValue.textContent=Ae.toFixed(1)}),this.player.danmaku.opacity(this.player.user.get("opacity")),this.player.template.danmakuOpacityValue.textContent=this.player.user.get("opacity").toFixed(1);const W=Ae=>{const Ce=Ae||window.event;let ze=((Ce.clientX||Ce.changedTouches[0].clientX)-T.getBoundingClientRectViewLeft(this.player.template.danmakuOpacityBarWrap))/190;ze=Math.max(ze,0),ze=Math.min(ze,1),this.player.danmaku!==null&&this.player.danmaku.opacity(ze)},ue=()=>{document.removeEventListener(T.nameMap.dragEnd,ue),document.removeEventListener(T.nameMap.dragMove,W),this.player.template.danmakuOpacityBox.classList.remove("dplayer-setting-danmaku-active")};this.player.template.danmakuOpacityBarWrapWrap.addEventListener("click",Ae=>{const Ce=Ae||window.event;let ze=((Ce.clientX||Ce.changedTouches[0].clientX)-T.getBoundingClientRectViewLeft(this.player.template.danmakuOpacityBarWrap))/190;ze=Math.max(ze,0),ze=Math.min(ze,1),this.player.danmaku!==null&&this.player.danmaku.opacity(ze)}),this.player.template.danmakuOpacityBarWrapWrap.addEventListener(T.nameMap.dragStart,()=>{document.addEventListener(T.nameMap.dragMove,W),document.addEventListener(T.nameMap.dragEnd,ue),this.player.template.danmakuOpacityBox.classList.add("dplayer-setting-danmaku-active")})}}hide(){this.player.template.container.classList.remove("dplayer-show-controller"),this.player.template.settingBox.classList.remove("dplayer-setting-box-open"),this.player.template.mask.classList.remove("dplayer-mask-show"),window.setTimeout(()=>{this.player.template.settingBox.classList.remove("dplayer-setting-box-speed"),this.player.template.settingBox.classList.remove("dplayer-setting-box-audio")},300),this.player.controller.disableAutoHide=!1}show(){this.player.template.container.classList.add("dplayer-show-controller"),this.player.template.settingBox.classList.add("dplayer-setting-box-open"),this.player.template.mask.classList.add("dplayer-mask-show"),this.player.controller.disableAutoHide=!0}destroy(){this.resizeObserver.disconnect()}},Xf=class{constructor(E){ve(this,"player");this.player=E,this.player.template.mask.addEventListener("click",()=>{this.hide()}),this.player.template.commentButton.addEventListener("click",()=>{this.show()}),this.player.template.commentSettingButton.addEventListener("click",()=>{this.toggleSetting()}),this.player.template.commentColorSettingBox.addEventListener("click",()=>{if(this.player.template.commentColorSettingBox.querySelector("input:checked+span")){const D=this.player.template.commentColorSettingBox.querySelector("input:checked").value;this.player.template.commentSettingFill.style.fill=D,this.player.template.commentInput.style.color=D,this.player.template.commentSendFill.style.fill=D}}),this.player.template.commentInput.addEventListener("click",()=>{this.hideSetting()}),this.player.template.commentInput.addEventListener("keydown",D=>{(D||window.event).keyCode===13&&this.send()}),this.player.template.commentSendButton.addEventListener("click",()=>{this.send()})}show(){this.player.controller.disableAutoHide=!0,this.player.template.controller.classList.add("dplayer-controller-comment"),this.player.template.mask.classList.add("dplayer-mask-show"),this.player.container.classList.add("dplayer-show-controller"),this.player.template.commentInput.focus()}hide(){this.player.template.controller.classList.remove("dplayer-controller-comment"),this.player.template.mask.classList.remove("dplayer-mask-show"),this.player.container.classList.remove("dplayer-show-controller"),this.player.controller.disableAutoHide=!1,this.hideSetting()}showSetting(){this.player.template.commentSettingBox.classList.add("dplayer-comment-setting-open")}hideSetting(){this.player.template.commentSettingBox.classList.remove("dplayer-comment-setting-open")}toggleSetting(){this.player.template.commentSettingBox.classList.contains("dplayer-comment-setting-open")?this.hideSetting():this.showSetting()}send(){var E;((E=this.player.options.danmaku)==null?void 0:E.closeCommentFormAfterSend)===!0&&this.player.template.commentInput.blur(),this.player.template.commentInput.value.replace(/^\s+|\s+$/g,"")?(this.player.danmaku!==null&&this.player.danmaku.send({text:this.player.template.commentInput.value,color:this.player.container.querySelector(".dplayer-comment-setting-color input:checked").value,type:this.player.container.querySelector(".dplayer-comment-setting-type input:checked").value,size:this.player.container.querySelector(".dplayer-comment-setting-size input:checked").value},()=>{var D;((D=this.player.options.danmaku)==null?void 0:D.closeCommentFormAfterSend)===!0&&(this.hide(),this.player.controller.setAutoHide(750))},!0),this.player.template.commentInput.value=""):this.player.notice(this.player.tran("Please input danmaku content!"),void 0,void 0,"#FF6F6A")}},Jf=class{constructor(E){ve(this,"player");ve(this,"doHotKeyHandler");ve(this,"cancelFullScreenHandler");this.player=E,this.doHotKeyHandler=this.doHotKey.bind(this),this.cancelFullScreenHandler=this.cancelFullScreen.bind(this),this.player.options.hotkey&&document.addEventListener("keydown",this.doHotKeyHandler),document.addEventListener("keydown",this.cancelFullScreenHandler)}doHotKey(E){var W,ue;const D=(W=document.activeElement)==null?void 0:W.tagName.toUpperCase(),q=(ue=document.activeElement)==null?void 0:ue.getAttribute("contenteditable");if(D!=="INPUT"&&D!=="TEXTAREA"&&q!==""&&q!=="true"){const Ae=E||window.event;let Ce;switch(Ae.keyCode){case 32:(this.player.focus||this.player.options.hotkey)&&(Ae.preventDefault(),this.player.toggle());break;case 37:(this.player.focus||this.player.options.hotkey)&&(Ae.preventDefault(),Ae.altKey?this.player.seek(this.player.video.currentTime-60):Ae.shiftKey?this.player.seek(this.player.video.currentTime-30):Ae.ctrlKey||Ae.metaKey?this.player.seek(this.player.video.currentTime-15):this.player.seek(this.player.video.currentTime-5),this.player.controller.setAutoHide());break;case 39:(this.player.focus||this.player.options.hotkey)&&(Ae.preventDefault(),Ae.altKey?this.player.seek(this.player.video.currentTime+60):Ae.shiftKey?this.player.seek(this.player.video.currentTime+30):Ae.ctrlKey||Ae.metaKey?this.player.seek(this.player.video.currentTime+15):this.player.seek(this.player.video.currentTime+5),this.player.controller.setAutoHide());break;case 38:this.player.focus&&(Ae.preventDefault(),Ce=this.player.volume()+.1,this.player.volume(Ce));break;case 40:this.player.focus&&(Ae.preventDefault(),Ce=this.player.volume()-.1,this.player.volume(Ce));break;case 70:Ae.ctrlKey||Ae.metaKey||(Ae.preventDefault(),this.player.fullScreen.toggle("browser"));break;case 87:Ae.ctrlKey||Ae.metaKey||(Ae.preventDefault(),this.player.fullScreen.toggle("web"));break;case 76:this.player.options.live&&(Ae.preventDefault(),this.player.sync());break;case 80:this.player.options.pictureInPicture&&document.pictureInPictureEnabled&&(Ae.preventDefault(),this.player.template.pipButton.click());break;case 67:typeof this.player.options.danmaku=="object"&&this.player.options.danmaku&&(Ae.ctrlKey||Ae.metaKey||(Ae.preventDefault(),this.player.controller.show(),this.player.comment!=null&&this.player.comment.show()));break;case 68:typeof this.player.options.danmaku=="object"&&this.player.options.danmaku&&(Ae.ctrlKey||Ae.metaKey||(Ae.preventDefault(),this.player.template.showDanmaku.click(),this.player.template.showDanmakuToggle.checked?this.player.notice(`${this.player.tran("Show comment")}`):this.player.notice(`${this.player.tran("Hide comment")}`)));break;case 83:this.player.options.subtitle&&(Ae.ctrlKey||Ae.metaKey||(Ae.preventDefault(),this.player.subtitle!==null&&(this.player.subtitle.container.classList.contains("dplayer-subtitle-hide")?this.player.notice(`${this.player.tran("Show subtitle")}`):this.player.notice(`${this.player.tran("Hide subtitle")}`),this.player.subtitle.toggle())))}}}cancelFullScreen(E){(E||window.event).keyCode===27&&this.player.fullScreen.isFullScreen("web")&&this.player.fullScreen.cancel("web")}destroy(){this.player.options.hotkey&&document.removeEventListener("keydown",this.doHotKeyHandler),document.removeEventListener("keydown",this.cancelFullScreenHandler)}},Qf=class{constructor(E){ve(this,"contextmenuHandler");ve(this,"player");ve(this,"shown");this.player=E,this.shown=!1,Array.prototype.slice.call(this.player.template.menuItem).forEach((D,q)=>{this.player.options.contextmenu[q].click&&D.addEventListener("click",()=>{const W=this.player.options.contextmenu[q];W.click&&W.click(this.player),this.hide()})}),this.contextmenuHandler=D=>{const q=D||window.event;if(q.preventDefault(),this.shown)return void this.hide();const W=this.player.container.getBoundingClientRect();this.show(q.clientX-W.left,q.clientY-W.top),this.player.template.mask.addEventListener("click",()=>{this.hide()})},this.player.container.addEventListener("contextmenu",this.contextmenuHandler)}show(E,D){this.player.template.menu.classList.add("dplayer-menu-show");const q=this.player.container.getBoundingClientRect();E+this.player.template.menu.offsetWidth>=q.width?(this.player.template.menu.style.right=q.width-E+"px",this.player.template.menu.style.left="initial"):(this.player.template.menu.style.left=E+"px",this.player.template.menu.style.right="initial"),D+this.player.template.menu.offsetHeight>=q.height?(this.player.template.menu.style.bottom=q.height-D+"px",this.player.template.menu.style.top="initial"):(this.player.template.menu.style.top=D+"px",this.player.template.menu.style.bottom="initial"),this.player.template.mask.classList.add("dplayer-mask-show"),this.shown=!0,this.player.events.trigger("contextmenu_show")}hide(){this.player.template.mask.classList.remove("dplayer-mask-show"),this.player.template.menu.classList.remove("dplayer-menu-show"),this.shown=!1,this.player.events.trigger("contextmenu_hide")}destroy(){this.player.container.removeEventListener("contextmenu",this.contextmenuHandler)}},Zf=class{constructor(E){ve(this,"player");ve(this,"container");ve(this,"template");ve(this,"video");ve(this,"beginTime",0);this.player=E,this.container=E.template.infoPanel,this.template=E.template,this.video=E.video,this.template.infoPanelClose.addEventListener("click",()=>{this.hide()})}show(){this.beginTime=Date.now(),this.update(),this.player.timer.enable("info"),this.player.timer.enable("fps"),this.container.classList.remove("dplayer-info-panel-hide")}hide(){this.player.timer.disable("info"),this.player.timer.disable("fps"),this.container.classList.add("dplayer-info-panel-hide")}toggle(){this.container.classList.contains("dplayer-info-panel-hide")?this.show():this.hide()}update(){var E;if(this.template.infoVersion.textContent="v1.31.3 b063e0f",this.template.infoType.textContent=this.player.type,this.template.infoUrl.textContent=this.player.options.video.url??"N/A",this.template.infoResolution.textContent=`${this.player.video.videoWidth} x ${this.player.video.videoHeight}`,this.template.infoDuration.textContent=`${this.player.video.duration}`,this.player.video.getVideoPlaybackQuality!=null){const D=this.player.video.getVideoPlaybackQuality();this.template.infoDroppedFrames.textContent=`${D.droppedVideoFrames} / ${D.totalVideoFrames}`}else if(this.player.video.webkitDecodedFrameCount!=null){const D=this.player.video.webkitDecodedFrameCount,q=this.player.video.webkitDroppedFrameCount;this.template.infoDroppedFrames.textContent=`${q} / ${D}`}else this.template.infoDroppedFrames.textContent="N/A";if(this.player.video.buffered.length>0){const D=this.player.video.buffered.length,q=this.player.video.buffered.end(D-1)-this.player.video.currentTime;this.template.infoBufferRemain.textContent=`${q.toFixed(3)} s`}else this.template.infoBufferRemain.textContent="N/A";if(this.player.type==="mpegts"||this.player.type==="flv"){const D=this.player.plugins.mpegts||this.player.plugins.flvjs;if(D){const q=D.mediaInfo,W=D.statisticsInfo;this.template.infoMimeType.textContent=q.mimeType??"N/A",this.template.infoVideoFPS.textContent=`${((E=q.fps)==null?void 0:E.toFixed(3))??"N/A"}`,W.speed!=null?this.template.infoDownloadSpeed.textContent=`${W.speed.toFixed(3)} KB/s`:this.template.infoDownloadSpeed.textContent="N/A"}}else this.template.infoMimeType.textContent="N/A",this.template.infoVideoFPS.textContent="N/A",this.template.infoDownloadSpeed.textContent="N/A"}fps(E){this.template.infoPageFPS.textContent=`${E.toFixed(1)}`}};var ep=i(194),tp=i.n(ep);let rl=0;const $i=[],np=class{constructor(E){ve(this,"bar");ve(this,"bezel");ve(this,"comment",null);ve(this,"contextmenu");ve(this,"controller");ve(this,"danmaku",null);ve(this,"events");ve(this,"fullScreen");ve(this,"hotkey");ve(this,"infoPanel");ve(this,"setting");ve(this,"subtitle",null);ve(this,"template");ve(this,"timer");ve(this,"user");ve(this,"container");ve(this,"containerClickFun");ve(this,"docClickFun");ve(this,"focus",!1);ve(this,"narrow",!1);ve(this,"noticeTime",null);ve(this,"options");ve(this,"paused",!1);ve(this,"plugins");ve(this,"prevVideoCurrentTime",0);ve(this,"prevVideo",null);ve(this,"quality",null);ve(this,"qualityIndex",null);ve(this,"switchingQuality",!1);ve(this,"resizeObserver");ve(this,"tran");ve(this,"type","auto");ve(this,"video");this.options=(D=>{const q={container:D.container||document.querySelector(".dplayer")||void 0,live:!1,liveSyncMinBufferSize:.8,syncWhenPlayingLive:!0,autoplay:!1,theme:"#b7daff",loop:!1,lang:navigator.language.toLowerCase(),screenshot:!1,pictureInPicture:!0,airplay:!0,hotkey:!0,preload:"metadata",crossOrigin:null,volume:1,playbackSpeed:[.25,.5,.75,1,1.25,1.5,1.75,2],apiBackend:jh,video:{},contextmenu:[],mutex:!0,pluginOptions:{}};for(const W in q)Object.prototype.hasOwnProperty.call(q,W)&&!Object.prototype.hasOwnProperty.call(D,W)&&(D[W]=q[W]);return D.video&&!D.video.type&&(D.video.type="auto"),typeof D.danmaku=="object"&&D.danmaku&&(!D.danmaku.user&&(D.danmaku.user="DPlayer"),!D.danmaku.speedRate&&(D.danmaku.speedRate=1),!D.danmaku.fontSize&&(D.danmaku.fontSize=35),D.danmaku.closeCommentFormAfterSend!==!1&&(D.danmaku.closeCommentFormAfterSend=!0)),D.subtitle&&(!D.subtitle.type&&(D.subtitle.type="webvtt"),!D.subtitle.fontSize&&(D.subtitle.fontSize="20px"),!D.subtitle.bottom&&(D.subtitle.bottom="40px"),!D.subtitle.color&&(D.subtitle.color="#fff")),D.video.quality&&(typeof D.video.defaultQuality=="string"&&(D.video.quality.forEach((W,ue)=>{D.video.defaultQuality===W.name&&(D.video.defaultQuality=ue)}),typeof D.video.defaultQuality=="string"&&(D.video.defaultQuality=0)),D.video.defaultQuality===void 0&&(D.video.defaultQuality=0),D.video.type=D.video.quality[D.video.defaultQuality].type,D.video.url=D.video.quality[D.video.defaultQuality].url),D.lang&&(D.lang=D.lang.toLowerCase()),D.contextmenu=D.contextmenu.concat([{text:"Video info",click:W=>{W.infoPanel.toggle()}},{text:"DPlayer v1.31.3",link:"https://github.com/tsukumijima/DPlayer"}]),{container:D.container,live:D.live,liveSyncMinBufferSize:D.liveSyncMinBufferSize,syncWhenPlayingLive:D.syncWhenPlayingLive,autoplay:D.autoplay,theme:D.theme,loop:D.loop,lang:D.lang,screenshot:D.screenshot,pictureInPicture:D.pictureInPicture,airplay:D.airplay,hotkey:D.hotkey,preload:D.preload,crossOrigin:D.crossOrigin,volume:D.volume,playbackSpeed:D.playbackSpeed,logo:D.logo,apiBackend:D.apiBackend,video:D.video,subtitle:D.subtitle,danmaku:D.danmaku,contextmenu:D.contextmenu,highlight:D.highlight,mutex:D.mutex,pluginOptions:D.pluginOptions}})({preload:E.video.type==="webtorrent"?"none":"metadata",...E}),this.options.video.quality&&(this.qualityIndex=this.options.video.defaultQuality,this.quality=this.options.video.quality[this.options.video.defaultQuality]),this.tran=new Hh(this.options.lang).tran,this.events=new $f,this.user=new Vf(this),this.container=this.options.container,this.container.classList.add("dplayer"),this.options.danmaku||this.container.classList.add("dplayer-no-danmaku"),this.options.live?this.container.classList.add("dplayer-live"):this.container.classList.remove("dplayer-live"),T.isMobile&&this.container.classList.add("dplayer-mobile"),this.narrow=this.container.offsetWidth<=500,this.narrow&&this.container.classList.add("dplayer-narrow"),this.resizeObserver=new ResizeObserver(D=>{for(const q of D)q.target===this.container&&(this.narrow=this.container.offsetWidth<=500,this.narrow?this.container.classList.add("dplayer-narrow"):this.container.classList.remove("dplayer-narrow"))}),this.resizeObserver.observe(this.container),this.template=new Nf({container:this.container,options:this.options,index:rl,tran:this.tran}),this.video=this.template.video,this.bar=new Hf(this.template),this.bezel=new zf(this.template.bezel),this.fullScreen=new Gf(this),this.controller=new Wf(this),this.options.danmaku&&(this.danmaku=new Uf({player:this,container:this.template.danmaku,opacity:this.user.get("opacity"),callback:()=>{setTimeout(()=>{this.template.danmakuLoading.style.display="none",this.options.autoplay&&this.play()},0)},error:D=>{this.notice(D,void 0,void 0,"#FF6F6A")},apiBackend:this.options.apiBackend,borderColor:this.options.theme,fontSize:this.options.danmaku.fontSize,time:()=>this.video.currentTime,unlimited:this.user.get("unlimited"),speedRate:this.options.danmaku.speedRate,api:{id:this.options.danmaku.id,address:this.options.danmaku.api,token:this.options.danmaku.token,maximum:this.options.danmaku.maximum,addition:this.options.danmaku.addition,user:this.options.danmaku.user},events:this.events,tran:D=>this.tran(D)}),this.comment=new Xf(this)),this.plugins={},this.docClickFun=()=>{this.focus=!1},this.containerClickFun=()=>{this.focus=!0},document.addEventListener("click",this.docClickFun,!0),this.container.addEventListener("click",this.containerClickFun,!0),this.paused=!0,this.timer=new qf(this),this.hotkey=new Jf(this),this.contextmenu=new Qf(this),this.initVideo(this.video,this.quality&&this.quality.type||this.options.video.type),this.setting=new Yf(this),this.infoPanel=new Zf(this),!this.danmaku&&this.options.autoplay&&this.play(),rl++,$i.push(this)}seek(E){E=Math.max(E,0);const D=T.getVideoDuration(this.video,this.template);D&&(E=Math.min(E,D)),this.video.currentTime<E?this.notice(`${this.tran("FF")} ${(E-this.video.currentTime).toFixed(0)} ${this.tran("s")}`):this.video.currentTime>E&&this.notice(`${this.tran("REW")} ${(this.video.currentTime-E).toFixed(0)} ${this.tran("s")}`),isFinite(E)&&(this.video.currentTime=E),this.danmaku&&this.danmaku.seek(),this.bar.set("played",E/D,"width"),this.template.ptime.textContent=T.secondToTime(E)}sync(E=!1){if(this.options.live){const D=T.getVideoDuration(this.video,this.template)-this.options.liveSyncMinBufferSize;try{this.video.currentTime=D}catch{return}this.danmaku&&this.danmaku.seek(),this.template.ptime.textContent=T.secondToTime(D),E||this.notice(this.tran("Synchronized"))}}play(E=!1){if(this.paused=!1,this.video.paused&&!T.isMobile&&this.bezel.switch(Zn.play),this.template.playButton.innerHTML=Zn.pause,this.template.mobilePlayButton.innerHTML=Zn.pause,this.options.live&&this.options.syncWhenPlayingLive&&this.sync(!0),!E){const D=this.type==="mpegts"&&this.plugins.mpegts&&this.plugins.mpegts.play.bind(this.plugins.mpegts)||this.video.play.bind(this.video);Promise.resolve(D()).catch(()=>{this.pause()}).then(()=>{})}if(this.timer.enable("loading"),this.container.classList.remove("dplayer-paused"),this.container.classList.add("dplayer-playing"),this.danmaku&&this.danmaku.play(),this.options.mutex)for(let D=0;D<$i.length;D++)this!==$i[D]&&$i[D].pause()}pause(E=!1){this.paused=!0,this.container.classList.remove("dplayer-loading"),this.video.paused||T.isMobile||this.bezel.switch(Zn.pause),this.template.playButton.innerHTML=Zn.play,this.template.mobilePlayButton.innerHTML=Zn.play,E||this.video.pause(),this.timer.disable("loading"),this.container.classList.remove("dplayer-playing"),this.container.classList.add("dplayer-paused"),this.danmaku&&this.danmaku.pause()}switchVolumeIcon(){this.volume()>=.95?this.template.volumeIcon.innerHTML=Zn.volumeUp:this.volume()>0?this.template.volumeIcon.innerHTML=Zn.volumeDown:this.template.volumeIcon.innerHTML=Zn.volumeOff}volume(E=NaN,D=!1,q=!1){if(typeof E=="string"&&(E=parseFloat(E)),!isNaN(E)){E=Math.max(E,0),E=Math.min(E,1),this.bar.set("volume",E,"width");const W=`${(100*E).toFixed(0)}%`;this.template.volumeBarWrapWrap.ariaLabel=W,D||this.user.set("volume",E),q||this.notice(`${this.tran("Volume")} ${(100*E).toFixed(0)}%`),this.video.volume=E,this.video.muted&&(this.video.muted=!1),this.switchVolumeIcon()}return this.video.volume}toggle(){this.video.paused?this.play():this.pause()}on(E,D,q=!1){this.events.on(E,D,q)}off(E,D){this.events.off(E,D)}switchVideo(E,D){this.pause(),this.video.poster=E.pic?E.pic:"",this.video.src=E.url,this.initMSE(this.video,E.type||"auto"),D&&(this.template.danmakuLoading.style.display="block",this.bar.set("played",0,"width"),this.bar.set("loaded",0,"width"),this.template.ptime.textContent="00:00",this.template.danmaku.innerHTML="",this.danmaku&&this.danmaku.reload({id:D.id,address:D.api,token:D.token,maximum:D.maximum,addition:D.addition,user:D.user}))}initMSE(E,D){if(this.type=D,this.options.video.customType&&this.options.video.customType[D])Object.prototype.toString.call(this.options.video.customType[D])==="[object Function]"?this.options.video.customType[D](this.video,this):console.error(`Illegal customType: ${D}`);else switch(this.type==="auto"&&(/m3u8(#|\?|$)/i.exec(E.src)?this.type="hls":/.ts(#|\?|$)/i.exec(E.src)?this.type="mpegts":/.flv(#|\?|$)/i.exec(E.src)?this.type="flv":/.mpd(#|\?|$)/i.exec(E.src)?this.type="dash":this.type="normal"),this.type!=="mpegts"&&this.container.classList.add("dplayer-no-audio-switching"),this.type){case"hls":if(window.Hls){const q=/Safari/i.test(navigator.userAgent)&&/iPad|Macintosh/i.test(navigator.userAgent)&&"ontouchend"in document&&(E.canPlayType("application/x-mpegURL")||E.canPlayType("application/vnd.apple.mpegURL"));if(window.Hls.isSupported()&&!q){this.plugins.hls&&(this.plugins.aribb24Caption&&(this.plugins.aribb24Caption.dispose(),delete this.plugins.aribb24Caption),this.plugins.aribb24Superimpose&&(this.plugins.aribb24Superimpose.dispose(),delete this.plugins.aribb24Superimpose),this.plugins.hls.destroy(),delete this.plugins.hls);const W=this.options.pluginOptions.hls,ue=new window.Hls(W);if(this.plugins.hls=ue,ue.loadSource(E.src),ue.attachMedia(E),this.events.on("destroy",()=>{this.plugins.aribb24Caption&&(this.plugins.aribb24Caption.dispose(),delete this.plugins.aribb24Caption),this.plugins.aribb24Superimpose&&(this.plugins.aribb24Superimpose.dispose(),delete this.plugins.aribb24Superimpose),ue.destroy(),delete this.plugins.hls}),this.options.subtitle&&this.options.subtitle.type==="aribb24"){this.options.pluginOptions.aribb24===void 0&&(this.options.pluginOptions.aribb24={}),this.options.pluginOptions.aribb24.enableAutoInBandMetadataTextTrackDetection=!1;const Ae=this.options.pluginOptions.aribb24,Ce=this.plugins.aribb24Caption=new L.CanvasRenderer({...Ae,data_identifier:128});if(Ce.attachMedia(E),Ce.show(),this.options.pluginOptions.aribb24.disableSuperimposeRenderer!==!0){const ze=this.plugins.aribb24Superimpose=new L.CanvasRenderer({...Ae,data_identifier:129});ze.attachMedia(E),ze.show()}ue.on(window.Hls.Events.FRAG_PARSING_METADATA,(ze,at)=>{for(const $e of at.samples)this.plugins.aribb24Caption&&this.plugins.aribb24Caption.pushID3v2Data($e.pts,$e.data),this.plugins.aribb24Superimpose&&this.plugins.aribb24Superimpose.pushID3v2Data($e.pts,$e.data)})}}else if(E.canPlayType("application/x-mpegURL")||E.canPlayType("application/vnd.apple.mpegURL")){if(this.plugins.aribb24Caption&&(this.plugins.aribb24Caption.dispose(),delete this.plugins.aribb24Caption),this.plugins.aribb24Superimpose&&(this.plugins.aribb24Superimpose.dispose(),delete this.plugins.aribb24Superimpose),this.events.on("destroy",()=>{this.plugins.aribb24Caption&&(this.plugins.aribb24Caption.dispose(),delete this.plugins.aribb24Caption),this.plugins.aribb24Superimpose&&(this.plugins.aribb24Superimpose.dispose(),delete this.plugins.aribb24Superimpose)}),this.options.subtitle&&this.options.subtitle.type==="aribb24"){this.options.pluginOptions.aribb24===void 0&&(this.options.pluginOptions.aribb24={}),this.options.pluginOptions.aribb24.enableAutoInBandMetadataTextTrackDetection=!0;const W=this.options.pluginOptions.aribb24,ue=this.plugins.aribb24Caption=new L.CanvasRenderer({...W,data_identifier:128});if(ue.attachMedia(E),ue.show(),this.options.pluginOptions.aribb24.disableSuperimposeRenderer!==!0){const Ae=this.plugins.aribb24Superimpose=new L.CanvasRenderer({...W,data_identifier:129});Ae.attachMedia(E),Ae.show()}}}else this.notice("Error: HLS is not supported.",void 0,void 0,"#FF6F6A")}else this.notice("Error: Can't find hls.js.",void 0,void 0,"#FF6F6A");break;case"mpegts":if(window.mpegts)if(window.mpegts.isSupported()){this.plugins.mpegts&&(this.plugins.aribb24Caption&&(this.plugins.aribb24Caption.dispose(),delete this.plugins.aribb24Caption),this.plugins.aribb24Superimpose&&(this.plugins.aribb24Superimpose.dispose(),delete this.plugins.aribb24Superimpose),this.plugins.mpegts.unload(),this.plugins.mpegts.detachMediaElement(),this.plugins.mpegts.destroy(),delete this.plugins.mpegts),this.options.pluginOptions.mpegts===void 0&&(this.options.pluginOptions.mpegts={});const q=window.mpegts.createPlayer(Object.assign(this.options.pluginOptions.mpegts.mediaDataSource||{},{type:"mpegts",isLive:this.options.live,url:E.src}),this.options.pluginOptions.mpegts.config);if(this.plugins.mpegts=q,q.attachMediaElement(E),q.load(),this.events.on("destroy",()=>{this.plugins.aribb24Caption&&(this.plugins.aribb24Caption.dispose(),delete this.plugins.aribb24Caption),this.plugins.aribb24Superimpose&&(this.plugins.aribb24Superimpose.dispose(),delete this.plugins.aribb24Superimpose),q.unload(),q.detachMediaElement(),q.destroy(),delete this.plugins.mpegts}),this.options.subtitle&&this.options.subtitle.type==="aribb24"){this.options.pluginOptions.aribb24===void 0&&(this.options.pluginOptions.aribb24={}),this.options.pluginOptions.aribb24.enableAutoInBandMetadataTextTrackDetection=!1;const W=this.options.pluginOptions.aribb24,ue=this.plugins.aribb24Caption=new L.CanvasRenderer({...W,data_identifier:128});if(ue.attachMedia(E),ue.show(),this.options.pluginOptions.aribb24.disableSuperimposeRenderer!==!0){const Ae=this.plugins.aribb24Superimpose=new L.CanvasRenderer({...W,data_identifier:129});Ae.attachMedia(E),Ae.show()}q.on(window.mpegts.Events.TIMED_ID3_METADATA_ARRIVED,Ae=>{this.plugins.aribb24Caption&&this.plugins.aribb24Caption.pushID3v2Data(Ae.pts/1e3,Ae.data),this.plugins.aribb24Superimpose&&this.plugins.aribb24Superimpose.pushID3v2Data(Ae.pts/1e3,Ae.data)})}}else this.notice("Error: mpegts.js is not supported.",void 0,void 0,"#FF6F6A");else this.notice("Error: Can't find mpegts.js.",void 0,void 0,"#FF6F6A");break;case"flv":if(window.flvjs)if(window.flvjs.isSupported()){this.options.pluginOptions.flv===void 0&&(this.options.pluginOptions.flv={});const q=window.flvjs.createPlayer(Object.assign(this.options.pluginOptions.flv.mediaDataSource||{},{type:"flv",url:E.src}),this.options.pluginOptions.flv.config);this.plugins.flvjs=q,q.attachMediaElement(E),q.load(),this.events.on("destroy",()=>{q.unload(),q.detachMediaElement(),q.destroy(),delete this.plugins.flvjs})}else this.notice("Error: flv.js is not supported.",void 0,void 0,"#FF6F6A");else this.notice("Error: Can't find flv.js.",void 0,void 0,"#FF6F6A");break;case"dash":if(window.dashjs){const q=window.dashjs.MediaPlayer().create();q.initialize(E,E.src,!1);const W=this.options.pluginOptions.dash;q.updateSettings(W??{}),this.plugins.dash=q,this.events.on("destroy",()=>{q.reset(),delete this.plugins.dash})}else this.notice("Error: Can't find dash.js.",void 0,void 0,"#FF6F6A");break;case"webtorrent":if(window.WebTorrent)if(window.WebTorrent.WEBRTC_SUPPORT){this.container.classList.add("dplayer-loading");const q=this.options.pluginOptions.webtorrent,W=new window.WebTorrent(q);this.plugins.webtorrent=W;const ue=E.src;E.src="",E.preload="metadata",E.addEventListener("durationchange",()=>this.container.classList.remove("dplayer-loading"),{once:!0}),W.add(ue,Ae=>{const Ce=Ae.files.find(ze=>ze.name.endsWith(".mp4"));Ce&&Ce.renderTo(this.video,{autoplay:this.options.autoplay,controls:!1})}),this.events.on("destroy",()=>{W.remove(ue),W.destroy(),delete this.plugins.webtorrent})}else this.notice("Error: Webtorrent is not supported.",void 0,void 0,"#FF6F6A");else this.notice("Error: Can't find Webtorrent.",void 0,void 0,"#FF6F6A")}}initVideo(E,D){this.initMSE(E,D),this.on("durationchange",()=>{E.duration!==1&&E.duration!==1/0&&(this.template.dtime.textContent=T.secondToTime(E.duration))}),this.on("progress",()=>{const q=T.getVideoDuration(this.video,this.template),W=E.buffered.length?E.buffered.end(E.buffered.length-1)/q:0;this.bar.set("loaded",W,"width")}),this.on("error",()=>{this.video.error&&(this.switchingQuality&&(this.prevVideo!==null&&this.template.videoWrapAspect.removeChild(this.prevVideo),this.video.classList.add("dplayer-video-current"),this.prevVideo=null,this.switchingQuality=!1,this.events.trigger("quality_end")),this.tran&&this.notice&&this.type!=="webtorrent"&&this.notice(this.tran("Video load failed"),-1,void 0,"#FF6F6A"),this.container.classList.remove("dplayer-loading"))}),this.on("ended",()=>{this.bar.set("played",1,"width"),this.setting.loop?(this.seek(0),this.play()):this.pause(),this.danmaku&&(this.danmaku.danIndex=0)}),this.on("play",()=>{this.paused&&this.play(!0)}),this.on("pause",()=>{this.paused||this.pause(!0)}),this.on("timeupdate",()=>{const q=T.getVideoDuration(this.video,this.template);this.bar.set("played",this.video.currentTime/q,"width");const W=T.secondToTime(this.video.currentTime);this.template.ptime.textContent!==W&&(this.template.ptime.textContent=W)});for(let q=0;q<this.events.videoEvents.length;q++)E.addEventListener(this.events.videoEvents[q],W=>{this.events.trigger(this.events.videoEvents[q],W)});this.volume(this.user.get("volume"),!0,!0),this.options.subtitle&&(this.subtitle=new jf(this.template.subtitle,this.video,this.plugins,this.options.subtitle,this.events),this.user.get("subtitle")||this.subtitle.hide())}switchQuality(E){if(E=typeof E=="string"?parseInt(E):E,this.options.video.quality===void 0||this.qualityIndex===E||this.switchingQuality)return;this.qualityIndex=E,this.switchingQuality=!0,this.quality=this.options.video.quality[E];const D=this.video.paused;this.video.pause();const q=tp()({current:!1,pic:null,screenshot:this.options.screenshot,preload:"auto",url:this.quality.url,subtitle:this.options.subtitle,crossOrigin:this.options.crossOrigin}),W=new DOMParser().parseFromString(q,"text/html").body.firstChild;this.template.videoWrapAspect.insertBefore(W,this.template.videoWrapAspect.getElementsByTagName("div")[0]),this.prevVideoCurrentTime=this.video.currentTime,this.prevVideo=this.video,this.video=W,this.initVideo(this.video,this.quality.type||this.options.video.type),this.options.live||this.seek(this.prevVideoCurrentTime),D||this.video.play(),this.options.lang==="ja"||this.options.lang==="ja-jp"?this.notice(`画質を ${this.quality.name} に切り替えています…`,-1):this.notice(`${this.tran("Switching to")} ${this.quality.name} ${this.tran("quality")}`,-1),this.container.classList.add("dplayer-loading"),this.events.trigger("quality_start",this.quality),this.template.qualityItem.forEach(ue=>{ue.classList.remove("dplayer-setting-quality-current"),parseInt(ue.dataset.index)===E&&(ue.classList.add("dplayer-setting-quality-current"),this.template.qualityValue.textContent=this.quality.name,this.template.settingBox.classList.remove("dplayer-setting-box-quality"))}),this.on("canplay",()=>{if(this.prevVideo!==null){if(!this.options.live&&this.video.currentTime!==this.prevVideoCurrentTime)return void this.seek(this.prevVideoCurrentTime);this.template.videoWrapAspect.removeChild(this.prevVideo),this.video.classList.add("dplayer-video-current"),D||this.video.play(),this.prevVideo=null,this.options.lang==="ja"||this.options.lang==="ja-jp"?this.notice(`画質を ${this.quality.name} に切り替えました。`,1e3):this.notice(`${this.tran("Switched to")} ${this.quality.name} ${this.tran("quality")}`),this.switchingQuality=!1;const ue=parseFloat(this.template.settingBox.querySelector(".dplayer-setting-speed-current").dataset.speed);this.speed(ue),this.template.settingBox.querySelector(".dplayer-setting-audio-current").dataset.audio==="secondary"&&(window.mpegts&&this.plugins.mpegts&&this.plugins.mpegts instanceof window.mpegts.MSEPlayer?this.plugins.mpegts.switchSecondaryAudio():this.plugins.liveLLHLSForKonomiTV&&this.plugins.liveLLHLSForKonomiTV.switchSecondaryAudio()),this.container.classList.remove("dplayer-loading"),this.events.trigger("quality_end")}})}notice(E,D=2e3,q=.8,W){this.template.notice.textContent=E,this.template.notice.style.opacity=`${q}`,this.template.notice.style.color=W&&W!==""?W:"",this.noticeTime&&window.clearTimeout(this.noticeTime),this.events.trigger("notice_show",E),D>0&&(this.noticeTime=window.setTimeout(()=>{this.hideNotice()},D))}hideNotice(){this.template.notice.style.opacity="0",this.events.trigger("notice_hide")}resize(){this.danmaku&&this.danmaku.resize(),this.plugins.aribb24Caption&&this.plugins.aribb24Caption.refresh(),this.plugins.aribb24Superimpose&&this.plugins.aribb24Superimpose.refresh(),this.controller.thumbnails&&this.controller.thumbnails.resize(160,this.video.videoHeight/this.video.videoWidth*160,this.template.barWrap.offsetWidth),this.events.trigger("resize")}speed(E){this.video.playbackRate=E,this.template.speedItem.forEach(D=>{D.classList.remove("dplayer-setting-speed-current"),parseFloat(D.dataset.speed)===E&&(D.classList.add("dplayer-setting-speed-current"),parseFloat(D.dataset.speed)===1?this.template.speedValue.textContent=this.tran("Normal"):this.template.speedValue.textContent=`${E}`,this.template.settingBox.classList.remove("dplayer-setting-box-speed"))})}destroy(E=!1){$i.splice($i.indexOf(this),1),this.pause(),document.removeEventListener("click",this.docClickFun,!0),this.container.removeEventListener("click",this.containerClickFun,!0),this.fullScreen.destroy(),this.hotkey.destroy(),this.contextmenu.destroy(),this.controller.destroy(),this.timer.destroy(),this.setting.destroy(),this.resizeObserver.disconnect(),this.video.src="",E||(this.container.innerHTML=""),this.events.trigger("destroy")}static get version(){return"1.31.3"}};console.log(`
 %c DPlayer v1.31.3 b063e0f %c http://dplayer.js.org 

`,"color: #fadfa3; background: #030307; padding:5px 0;","background: #fadfa3; padding:5px 0;");const ip=np})(),s=s.default})())})(gu);var Y_=gu.exports;const X_=Eo(Y_),pt=Number.isFinite||function(a){return typeof a=="number"&&isFinite(a)},J_=Number.isSafeInteger||function(a){return typeof a=="number"&&Math.abs(a)<=Q_},Q_=Number.MAX_SAFE_INTEGER||9007199254740991;let xt=function(a){return a.NETWORK_ERROR="networkError",a.MEDIA_ERROR="mediaError",a.KEY_SYSTEM_ERROR="keySystemError",a.MUX_ERROR="muxError",a.OTHER_ERROR="otherError",a}({}),Me=function(a){return a.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",a.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",a.KEY_SYSTEM_NO_SESSION="keySystemNoSession",a.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",a.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",a.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",a.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",a.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",a.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",a.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",a.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",a.MANIFEST_LOAD_ERROR="manifestLoadError",a.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",a.MANIFEST_PARSING_ERROR="manifestParsingError",a.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",a.LEVEL_EMPTY_ERROR="levelEmptyError",a.LEVEL_LOAD_ERROR="levelLoadError",a.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",a.LEVEL_PARSING_ERROR="levelParsingError",a.LEVEL_SWITCH_ERROR="levelSwitchError",a.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",a.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",a.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",a.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",a.FRAG_LOAD_ERROR="fragLoadError",a.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",a.FRAG_DECRYPT_ERROR="fragDecryptError",a.FRAG_PARSING_ERROR="fragParsingError",a.FRAG_GAP="fragGap",a.REMUX_ALLOC_ERROR="remuxAllocError",a.KEY_LOAD_ERROR="keyLoadError",a.KEY_LOAD_TIMEOUT="keyLoadTimeOut",a.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",a.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",a.BUFFER_APPEND_ERROR="bufferAppendError",a.BUFFER_APPENDING_ERROR="bufferAppendingError",a.BUFFER_STALLED_ERROR="bufferStalledError",a.BUFFER_FULL_ERROR="bufferFullError",a.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",a.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",a.ASSET_LIST_LOAD_ERROR="assetListLoadError",a.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",a.ASSET_LIST_PARSING_ERROR="assetListParsingError",a.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",a.INTERNAL_EXCEPTION="internalException",a.INTERNAL_ABORTED="aborted",a.ATTACH_MEDIA_ERROR="attachMediaError",a.UNKNOWN="unknown",a}({}),$=function(a){return a.MEDIA_ATTACHING="hlsMediaAttaching",a.MEDIA_ATTACHED="hlsMediaAttached",a.MEDIA_DETACHING="hlsMediaDetaching",a.MEDIA_DETACHED="hlsMediaDetached",a.MEDIA_ENDED="hlsMediaEnded",a.STALL_RESOLVED="hlsStallResolved",a.BUFFER_RESET="hlsBufferReset",a.BUFFER_CODECS="hlsBufferCodecs",a.BUFFER_CREATED="hlsBufferCreated",a.BUFFER_APPENDING="hlsBufferAppending",a.BUFFER_APPENDED="hlsBufferAppended",a.BUFFER_EOS="hlsBufferEos",a.BUFFERED_TO_END="hlsBufferedToEnd",a.BUFFER_FLUSHING="hlsBufferFlushing",a.BUFFER_FLUSHED="hlsBufferFlushed",a.MANIFEST_LOADING="hlsManifestLoading",a.MANIFEST_LOADED="hlsManifestLoaded",a.MANIFEST_PARSED="hlsManifestParsed",a.LEVEL_SWITCHING="hlsLevelSwitching",a.LEVEL_SWITCHED="hlsLevelSwitched",a.LEVEL_LOADING="hlsLevelLoading",a.LEVEL_LOADED="hlsLevelLoaded",a.LEVEL_UPDATED="hlsLevelUpdated",a.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",a.LEVELS_UPDATED="hlsLevelsUpdated",a.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",a.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",a.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",a.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",a.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",a.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",a.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",a.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",a.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",a.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",a.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",a.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",a.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",a.CUES_PARSED="hlsCuesParsed",a.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",a.INIT_PTS_FOUND="hlsInitPtsFound",a.FRAG_LOADING="hlsFragLoading",a.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",a.FRAG_LOADED="hlsFragLoaded",a.FRAG_DECRYPTED="hlsFragDecrypted",a.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",a.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",a.FRAG_PARSING_METADATA="hlsFragParsingMetadata",a.FRAG_PARSED="hlsFragParsed",a.FRAG_BUFFERED="hlsFragBuffered",a.FRAG_CHANGED="hlsFragChanged",a.FPS_DROP="hlsFpsDrop",a.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",a.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",a.ERROR="hlsError",a.DESTROYING="hlsDestroying",a.KEY_LOADING="hlsKeyLoading",a.KEY_LOADED="hlsKeyLoaded",a.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",a.BACK_BUFFER_REACHED="hlsBackBufferReached",a.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",a.ASSET_LIST_LOADING="hlsAssetListLoading",a.ASSET_LIST_LOADED="hlsAssetListLoaded",a.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",a.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",a.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",a.INTERSTITIAL_STARTED="hlsInterstitialStarted",a.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",a.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",a.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",a.INTERSTITIAL_ENDED="hlsInterstitialEnded",a.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",a.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",a.EVENT_CUE_ENTER="hlsEventCueEnter",a}({});var Vt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},bt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class ji{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Z_{constructor(e,t,n,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ji(e),this.fast_=new ji(t),this.defaultTTFB_=i,this.ttfb_=new ji(e)}update(e,t){const{slow_:n,fast_:i,ttfb_:s}=this;n.halfLife!==e&&(this.slow_=new ji(e,n.getEstimate(),n.getTotalWeight())),i.halfLife!==t&&(this.fast_=new ji(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new ji(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,i=e/1e3,s=n/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function eA(a,e,t){return(e=nA(e))in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function nn(){return nn=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a},nn.apply(null,arguments)}function Ql(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),t.push.apply(t,n)}return t}function en(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ql(Object(t),!0).forEach(function(n){eA(a,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):Ql(Object(t)).forEach(function(n){Object.defineProperty(a,n,Object.getOwnPropertyDescriptor(t,n))})}return a}function tA(a,e){if(typeof a!="object"||!a)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var n=t.call(a,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(a)}function nA(a){var e=tA(a,"string");return typeof e=="symbol"?e:e+""}class vi{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=Ei,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const Ei=function(){},iA={trace:Ei,debug:Ei,log:Ei,warn:Ei,info:Ei,error:Ei};function to(){return nn({},iA)}function rA(a,e){const t=self.console[a];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${a}] >`):Ei}function Zl(a,e,t){return e[a]?e[a].bind(e):rA(a,t)}const no=to();function sA(a,e,t){const n=to();if(typeof console=="object"&&a===!0||typeof a=="object"){const i=["debug","log","info","warn","error"];i.forEach(s=>{n[s]=Zl(s,a,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.5`)}catch{return to()}i.forEach(s=>{no[s]=Zl(s,a)})}else nn(no,n);return n}const Jt=no;function xi(a=!0){return typeof self>"u"?void 0:(a||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function aA(a){return typeof self<"u"&&a===self.ManagedMediaSource}function yu(a,e){const t=Object.keys(a),n=Object.keys(e),i=t.length,s=n.length;return!i||!s||i===s&&!t.some(r=>n.indexOf(r)===-1)}function qn(a,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(a);if(e){const l=c.indexOf("\0");return l!==-1?c.substring(0,l):c}return c.replace(/\0/g,"")}const t=a.length;let n,i,s,r="",d=0;for(;d<t;){if(n=a[d++],n===0&&e)return r;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(n);break;case 12:case 13:i=a[d++],r+=String.fromCharCode((n&31)<<6|i&63);break;case 14:i=a[d++],s=a[d++],r+=String.fromCharCode((n&15)<<12|(i&63)<<6|(s&63)<<0);break}}return r}const ai={hexDump:function(a){let e="";for(let t=0;t<a.length;t++){let n=a[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}};function oA(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Sa={exports:{}},ed;function lA(){return ed||(ed=1,function(a,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,r=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,d={buildAbsoluteURL:function(u,c,l){if(l=l||{},u=u.trim(),c=c.trim(),!c){if(!l.alwaysNormalize)return u;var h=d.parseURL(u);if(!h)throw new Error("Error trying to parse base URL.");return h.path=d.normalizePath(h.path),d.buildURLFromParts(h)}var o=d.parseURL(c);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return l.alwaysNormalize?(o.path=d.normalizePath(o.path),d.buildURLFromParts(o)):c;var f=d.parseURL(u);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var p=i.exec(f.path);f.netLoc=p[1],f.path=p[2]}f.netLoc&&!f.path&&(f.path="/");var m={scheme:f.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(m.netLoc=f.netLoc,o.path[0]!=="/"))if(!o.path)m.path=f.path,o.params||(m.params=f.params,o.query||(m.query=f.query));else{var y=f.path,_=y.substring(0,y.lastIndexOf("/")+1)+o.path;m.path=d.normalizePath(_)}return m.path===null&&(m.path=l.alwaysNormalize?d.normalizePath(o.path):o.path),d.buildURLFromParts(m)},parseURL:function(u){var c=n.exec(u);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(u){for(u=u.split("").reverse().join("").replace(s,"");u.length!==(u=u.replace(r,"")).length;);return u.split("").reverse().join("")},buildURLFromParts:function(u){return u.scheme+u.netLoc+u.path+u.params+u.query+u.fragment}};a.exports=d})()}(Sa)),Sa.exports}var Bo=lA();class Fo{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ln={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class _u{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,cA(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let i;n.length===1?i=(t==null?void 0:t.byteRangeEndOffset)||0:i=parseInt(n[1]),this._byteRange=[i,parseInt(n[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[ln.AUDIO]:null,[ln.VIDEO]:null,[ln.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Fo),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Bo.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ln.AUDIO]=null,e[ln.VIDEO]=null,e[ln.AUDIOVIDEO]=null}}function Pn(a){return a.sn!=="initSegment"}class Ea extends _u{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(pt(e)&&pt(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const n=Object.keys(this.levelkeys);if(n.length===1)return this._decryptdata=this.levelkeys[n[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=pt(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),n=t.length;if(n>1||n===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!pt(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Pn(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,i,s,r=!1){const{elementaryStreams:d}=this,u=d[e];if(!u){d[e]={startPTS:t,endPTS:n,startDTS:i,endDTS:s,partial:r};return}u.startPTS=Math.min(u.startPTS,t),u.endPTS=Math.max(u.endPTS,n),u.startDTS=Math.min(u.startDTS,i),u.endDTS=Math.max(u.endDTS,s)}}class dA extends _u{constructor(e,t,n,i,s){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const r=e.enumeratedString("BYTERANGE");r&&this.setByteRange(r,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Au(a,e){const t=Object.getPrototypeOf(a);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||Au(t,e)}}function cA(a,e){const t=Au(a,e);t&&(t.enumerable=!0,Object.defineProperty(a,e,t))}const ys=Math.pow(2,32)-1,uA=[].push,vu={video:1,audio:2,id3:3,text:4};function kn(a){return String.fromCharCode.apply(null,a)}function bu(a,e){const t=a[e]<<8|a[e+1];return t<0?65536+t:t}function Pt(a,e){const t=Su(a,e);return t<0?4294967296+t:t}function td(a,e){let t=Pt(a,e);return t*=Math.pow(2,32),t+=Pt(a,e+4),t}function Su(a,e){return a[e]<<24|a[e+1]<<16|a[e+2]<<8|a[e+3]}function Ta(a,e,t){a[e]=t>>24,a[e+1]=t>>16&255,a[e+2]=t>>8&255,a[e+3]=t&255}function hA(a){const e=a.byteLength;for(let t=0;t<e;){const n=Pt(a,t);if(n>8&&a[t+4]===109&&a[t+5]===111&&a[t+6]===111&&a[t+7]===102)return!0;t=n>1?t+n:e}return!1}function Nt(a,e){const t=[];if(!e.length)return t;const n=a.byteLength;for(let i=0;i<n;){const s=Pt(a,i),r=kn(a.subarray(i+4,i+8)),d=s>1?i+s:n;if(r===e[0])if(e.length===1)t.push(a.subarray(i+8,d));else{const u=Nt(a.subarray(i+8,d),e.slice(1));u.length&&uA.apply(t,u)}i=d}return t}function fA(a){const e=[],t=a[0];let n=8;const i=Pt(a,n);n+=4;let s=0,r=0;t===0?(s=Pt(a,n),r=Pt(a,n+4),n+=8):(s=td(a,n),r=td(a,n+8),n+=16),n+=2;let d=a.length+r;const u=bu(a,n);n+=2;for(let c=0;c<u;c++){let l=n;const h=Pt(a,l);l+=4;const o=h&2147483647;if((h&2147483648)>>>31===1)return Jt.warn("SIDX has hierarchical references (not supported)"),null;const p=Pt(a,l);l+=4,e.push({referenceSize:o,subsegmentDuration:p,info:{duration:p/i,start:d,end:d+o-1}}),d+=o,l+=4,n=l}return{earliestPresentationTime:s,timescale:i,version:t,referencesCount:u,references:e}}function Eu(a){const e=[],t=Nt(a,["moov","trak"]);for(let i=0;i<t.length;i++){const s=t[i],r=Nt(s,["tkhd"])[0];if(r){let d=r[0];const u=Pt(r,d===0?12:20),c=Nt(s,["mdia","mdhd"])[0];if(c){d=c[0];const l=Pt(c,d===0?12:20),h=Nt(s,["mdia","hdlr"])[0];if(h){const o=kn(h.subarray(8,12)),f={soun:ln.AUDIO,vide:ln.VIDEO}[o],p=Nt(s,["mdia","minf","stbl","stsd"])[0],m=pA(p);f?(e[u]={timescale:l,type:f,stsd:m},e[f]=en({timescale:l,id:u},m)):e[u]={timescale:l,type:o,stsd:m}}}}}return Nt(a,["moov","mvex","trex"]).forEach(i=>{const s=Pt(i,4),r=e[s];r&&(r.default={duration:Pt(i,12),flags:Pt(i,20)})}),e}function pA(a){const e=a.subarray(8),t=e.subarray(86),n=kn(e.subarray(4,8));let i=n,s;const r=n==="enca"||n==="encv";if(r){const c=Nt(e,[n])[0].subarray(n==="enca"?28:78);Nt(c,["sinf"]).forEach(h=>{const o=Nt(h,["schm"])[0];if(o){const f=kn(o.subarray(4,8));if(f==="cbcs"||f==="cenc"){const p=Nt(h,["frma"])[0];p&&(i=kn(p))}}})}const d=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const u=Nt(t,["avcC"])[0];u&&u.length>3&&(i+="."+Dr(u[1])+Dr(u[2])+Dr(u[3]),s=Lr(d==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const u=Nt(e,[n])[0],c=Nt(u.subarray(28),["esds"])[0];if(c&&c.length>7){let l=4;if(c[l++]!==3)break;l=xa(c,l),l+=2;const h=c[l++];if(h&128&&(l+=2),h&64&&(l+=c[l++]),c[l++]!==4)break;l=xa(c,l);const o=c[l++];if(o===64)i+="."+Dr(o);else break;if(l+=12,c[l++]!==5)break;l=xa(c,l);const f=c[l++];let p=(f&248)>>3;p===31&&(p+=1+((f&7)<<3)+((c[l]&224)>>5)),i+="."+p}break}case"hvc1":case"hev1":{const u=Nt(t,["hvcC"])[0];if(u&&u.length>12){const c=u[1],l=["","A","B","C"][c>>6],h=c&31,o=Pt(u,2),f=(c&32)>>5?"H":"L",p=u[12],m=u.subarray(6,12);i+="."+l+h,i+="."+mA(o).toString(16).toUpperCase(),i+="."+f+p;let y="";for(let _=m.length;_--;){const S=m[_];(S||y)&&(y="."+S.toString(16).toUpperCase()+y)}i+=y}s=Lr(d=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=Lr(i,t)||i;break}case"vp09":{const u=Nt(t,["vpcC"])[0];if(u&&u.length>6){const c=u[4],l=u[5],h=u[6]>>4&15;i+="."+si(c)+"."+si(l)+"."+si(h)}break}case"av01":{const u=Nt(t,["av1C"])[0];if(u&&u.length>2){const c=u[1]>>>5,l=u[1]&31,h=u[2]>>>7?"H":"M",o=(u[2]&64)>>6,f=(u[2]&32)>>5,p=c===2&&o?f?12:10:o?10:8,m=(u[2]&16)>>4,y=(u[2]&8)>>3,_=(u[2]&4)>>2,S=u[2]&3;i+="."+c+"."+si(l)+h+"."+si(p)+"."+m+"."+y+_+S+"."+si(1)+"."+si(1)+"."+si(1)+"."+0,s=Lr("dav1",t)}break}}return{codec:i,encrypted:r,supplemental:s}}function Lr(a,e){const t=Nt(e,["dvvC"]),n=t.length?t[0]:Nt(e,["dvcC"])[0];if(n){const i=n[2]>>1&127,s=n[2]<<5&32|n[3]>>3&31;return a+"."+si(i)+"."+si(s)}}function mA(a){let e=0;for(let t=0;t<32;t++)e|=(a>>t&1)<<31-t;return e>>>0}function xa(a,e){const t=e+5;for(;a[e++]&128&&e<t;);return e}function Dr(a){return("0"+a.toString(16).toUpperCase()).slice(-2)}function si(a){return(a<10?"0":"")+a}function gA(a,e){if(!a||!e)return a;const t=e.keyId;return t&&e.isCommonEncryption&&Nt(a,["moov","trak"]).forEach(i=>{const r=Nt(i,["mdia","minf","stbl","stsd"])[0].subarray(8);let d=Nt(r,["enca"]);const u=d.length>0;u||(d=Nt(r,["encv"])),d.forEach(c=>{const l=u?c.subarray(28):c.subarray(78);Nt(l,["sinf"]).forEach(o=>{const f=Tu(o);if(f){const p=f.subarray(8,24);p.some(m=>m!==0)||(Jt.log(`[eme] Patching keyId in 'enc${u?"a":"v"}>sinf>>tenc' box: ${ai.hexDump(p)} -> ${ai.hexDump(t)}`),f.set(t,8))}})})}),a}function Tu(a){const e=Nt(a,["schm"])[0];if(e){const t=kn(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return Nt(a,["schi","tenc"])[0]}return null}function yA(a,e,t){const n={},i=Nt(a,["moof","traf"]);for(let s=0;s<i.length;s++){const r=i[s],d=Nt(r,["tfhd"])[0],u=Pt(d,4),c=e[u];if(!c)continue;const l=n[u]||(n[u]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type}),h=Nt(r,["tfdt"])[0];if(h){const b=h[0];let x=Pt(h,4);b===1&&(x===ys?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(x*=ys+1,x+=Pt(h,8))),pt(x)&&(!pt(l.start)||x<l.start)&&(l.start=x)}const o=c.default,f=Pt(d,0)|(o==null?void 0:o.flags);let p=(o==null?void 0:o.duration)||0;f&8&&(f&2?p=Pt(d,12):p=Pt(d,8));const m=Nt(r,["trun"]);let y=l.start||0,_=0,S=p;for(let b=0;b<m.length;b++){const x=m[b],L=Pt(x,4),N=l.sampleCount;l.sampleCount+=L;const P=x[3]&1,T=x[3]&4,k=x[2]&1,I=x[2]&2,F=x[2]&4,V=x[2]&8;let ne=8,te=L;for(P&&(ne+=4),T&&L&&(!(x[ne+1]&1)&&l.keyFrameIndex===void 0&&(l.keyFrameIndex=N),ne+=4,k?(S=Pt(x,ne),ne+=4):S=p,I&&(ne+=4),V&&(ne+=4),y+=S,_+=S,te--);te--;)k?(S=Pt(x,ne),ne+=4):S=p,I&&(ne+=4),F&&(x[ne+1]&1||l.keyFrameIndex===void 0&&(l.keyFrameIndex=l.sampleCount-(te+1),l.keyFrameStart=y),ne+=4),V&&(ne+=4),y+=S,_+=S;!_&&p&&(_+=p*L)}l.duration+=_}if(!Object.keys(n).some(s=>n[s].duration)){let s=1/0,r=0;const d=Nt(a,["sidx"]);for(let u=0;u<d.length;u++){const c=fA(d[u]);if(c!=null&&c.references){s=Math.min(s,c.earliestPresentationTime/c.timescale);const l=c.references.reduce((h,o)=>h+o.info.duration||0,0);r=Math.max(r,l+c.earliestPresentationTime/c.timescale)}}r&&pt(r)&&Object.keys(n).forEach(u=>{n[u].duration||(n[u].duration=r*n[u].timescale-n[u].start)})}return n}function _A(a,e,t){Nt(e,["moof","traf"]).forEach(n=>{Nt(n,["tfhd"]).forEach(i=>{const s=Pt(i,4),r=a[s];if(!r)return;const d=r.timescale||9e4;Nt(n,["tfdt"]).forEach(u=>{const c=u[0],l=t*d;if(l){let h=Pt(u,4);if(c===0)h-=l,h=Math.max(h,0),Ta(u,4,h);else{h*=Math.pow(2,32),h+=Pt(u,8),h-=l,h=Math.max(h,0);const o=Math.floor(h/(ys+1)),f=Math.floor(h%(ys+1));Ta(u,4,o),Ta(u,8,f)}}})})})}function AA(a){const e={valid:null,remainder:null},t=Nt(a,["moof"]);if(t.length<2)return e.remainder=a,e;const n=t[t.length-1];return e.valid=a.slice(0,n.byteOffset-8),e.remainder=a.slice(n.byteOffset-8),e}function Qn(a,e){const t=new Uint8Array(a.length+e.length);return t.set(a),t.set(e,a.length),t}function nd(a,e){const t=[],n=e.samples,i=e.timescale,s=e.id;let r=!1;return Nt(n,["moof"]).map(u=>{const c=u.byteOffset-8;Nt(u,["traf"]).map(h=>{const o=Nt(h,["tfdt"]).map(f=>{const p=f[0];let m=Pt(f,4);return p===1&&(m*=Math.pow(2,32),m+=Pt(f,8)),m/i})[0];return o!==void 0&&(a=o),Nt(h,["tfhd"]).map(f=>{const p=Pt(f,4),m=Pt(f,0)&16777215,y=(m&1)!==0,_=(m&2)!==0,S=(m&8)!==0;let b=0;const x=(m&16)!==0;let L=0;const N=(m&32)!==0;let P=8;p===s&&(y&&(P+=8),_&&(P+=4),S&&(b=Pt(f,P),P+=4),x&&(L=Pt(f,P),P+=4),N&&(P+=4),e.type==="video"&&(r=Bs(e.codec)),Nt(h,["trun"]).map(T=>{const k=T[0],I=Pt(T,0)&16777215,F=(I&1)!==0;let V=0;const ne=(I&4)!==0,te=(I&256)!==0;let Z=0;const Q=(I&512)!==0;let he=0;const de=(I&1024)!==0,M=(I&2048)!==0;let A=0;const v=Pt(T,4);let w=8;F&&(V=Pt(T,w),w+=4),ne&&(w+=4);let R=V+c;for(let C=0;C<v;C++){if(te?(Z=Pt(T,w),w+=4):Z=b,Q?(he=Pt(T,w),w+=4):he=L,de&&(w+=4),M&&(k===0?A=Pt(T,w):A=Su(T,w),w+=4),e.type===ln.VIDEO){let O=0;for(;O<he;){const G=Pt(n,R);if(R+=4,vA(r,n[R])){const z=n.subarray(R,R+G);No(z,r?2:1,a+A/i,t)}R+=G,O+=G+4}}a+=Z/i}}))})})}),t}function Bs(a){if(!a)return!1;const e=a.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function vA(a,e){if(a){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function No(a,e,t,n){const i=xu(a);let s=0;s+=e;let r=0,d=0,u=0;for(;s<i.length;){r=0;do{if(s>=i.length)break;u=i[s++],r+=u}while(u===255);d=0;do{if(s>=i.length)break;u=i[s++],d+=u}while(u===255);const c=i.length-s;let l=s;if(d<c)s+=d;else if(d>c){Jt.error(`Malformed SEI payload. ${d} is too small, only ${c} bytes left to parse.`);break}if(r===4){if(i[l++]===181){const o=bu(i,l);if(l+=2,o===49){const f=Pt(i,l);if(l+=4,f===1195456820){const p=i[l++];if(p===3){const m=i[l++],y=31&m,_=64&m,S=_?2+y*3:0,b=new Uint8Array(S);if(_){b[0]=m;for(let x=1;x<S;x++)b[x]=i[l++]}n.push({type:p,payloadType:r,pts:t,bytes:b})}}}}}else if(r===5&&d>16){const h=[];for(let p=0;p<16;p++){const m=i[l++].toString(16);h.push(m.length==1?"0"+m:m),(p===3||p===5||p===7||p===9)&&h.push("-")}const o=d-16,f=new Uint8Array(o);for(let p=0;p<o;p++)f[p]=i[l++];n.push({payloadType:r,pts:t,uuid:h.join(""),userData:qn(f),userDataBytes:f})}}}function xu(a){const e=a.byteLength,t=[];let n=1;for(;n<e-2;)a[n]===0&&a[n+1]===0&&a[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return a;const i=e-t.length,s=new Uint8Array(i);let r=0;for(n=0;n<i;r++,n++)r===t[0]&&(r++,t.shift()),s[n]=a[r];return s}function bA(a){const e=a[0];let t="",n="",i=0,s=0,r=0,d=0,u=0,c=0;if(e===0){for(;kn(a.subarray(c,c+1))!=="\0";)t+=kn(a.subarray(c,c+1)),c+=1;for(t+=kn(a.subarray(c,c+1)),c+=1;kn(a.subarray(c,c+1))!=="\0";)n+=kn(a.subarray(c,c+1)),c+=1;n+=kn(a.subarray(c,c+1)),c+=1,i=Pt(a,12),s=Pt(a,16),d=Pt(a,20),u=Pt(a,24),c=28}else if(e===1){c+=4,i=Pt(a,c),c+=4;const h=Pt(a,c);c+=4;const o=Pt(a,c);for(c+=4,r=2**32*h+o,J_(r)||(r=Number.MAX_SAFE_INTEGER,Jt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),d=Pt(a,c),c+=4,u=Pt(a,c),c+=4;kn(a.subarray(c,c+1))!=="\0";)t+=kn(a.subarray(c,c+1)),c+=1;for(t+=kn(a.subarray(c,c+1)),c+=1;kn(a.subarray(c,c+1))!=="\0";)n+=kn(a.subarray(c,c+1)),c+=1;n+=kn(a.subarray(c,c+1)),c+=1}const l=a.subarray(c,a.byteLength);return{schemeIdUri:t,value:n,timeScale:i,presentationTime:r,presentationTimeDelta:s,eventDuration:d,id:u,payload:l}}function SA(a,...e){const t=e.length;let n=8,i=t;for(;i--;)n+=e[i].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=n&255,s.set(a,4),i=0,n=8;i<t;i++)s.set(e[i],n),n+=e[i].byteLength;return s}function EA(a,e,t){if(a.byteLength!==16)throw new RangeError("Invalid system id");let n,i;n=0,i=new Uint8Array;let s;n>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const r=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(r.buffer).setUint32(0,t.byteLength,!1),SA([112,115,115,104],new Uint8Array([n,0,0,0]),a,s,i,r,t||new Uint8Array)}function TA(a){const e=[];if(a instanceof ArrayBuffer){const t=a.byteLength;let n=0;for(;n+32<t;){const i=new DataView(a,n),s=xA(i);e.push(s),n+=s.size}}return e}function xA(a){const e=a.getUint32(0),t=a.byteOffset,n=a.byteLength;if(n<e)return{offset:t,size:n};if(a.getUint32(4)!==1886614376)return{offset:t,size:e};const s=a.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const r=a.buffer,d=ai.hexDump(new Uint8Array(r,t+12,16)),u=a.getUint32(28);let c=null,l=null;if(s===0){if(e-32<u||u<22)return{offset:t,size:e};l=new Uint8Array(r,t+32,u)}else if(s===1){if(!u||n<t+32+u*16+16)return{offset:t,size:e};c=[];for(let h=0;h<u;h++)c.push(new Uint8Array(r,t+32+h*16,16))}return{version:s,systemId:d,kids:c,data:l,offset:t,size:e}}const Cu=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),sr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function wu(a,e){const t=sr[e];return!!t&&!!t[a.slice(0,4)]}function io(a,e,t=!0){return!a.split(",").some(n=>!ku(n,e,t))}function ku(a,e,t=!0){var n;const i=xi(t);return(n=i==null?void 0:i.isTypeSupported(_r(a,e)))!=null?n:!1}function _r(a,e){return`${e}/mp4;codecs=${a}`}function id(a){if(a){const e=a.substring(0,4);return sr.video[e]}return 2}function _s(a){const e=Cu();return a.split(",").reduce((t,n)=>{const s=e&&Bs(n)?9:sr.video[n];return s?(s*2+t)/(t?3:2):(sr.audio[n]+t)/(t?2:1)},0)}const Ca={};function CA(a,e=!0){if(Ca[a])return Ca[a];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[a];for(let i=0;i<t.length;i++){var n;if(ku(t[i],"audio",e))return Ca[a]=t[i],t[i];if(t[i]==="mp3"&&(n=xi(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return a}const wA=/flac|opus|mp4a\.40\.34/i;function As(a,e=!0){return a.replace(wA,t=>CA(t.toLowerCase(),e))}function kA(a,e){const t=[];if(a){const n=a.split(",");for(let i=0;i<n.length;i++)wu(n[i],"video")||t.push(n[i])}return e&&t.push(e),t.join(",")}function ts(a,e){if(a&&(a.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(a)!==-1))return a;if(e){const t=e.split(",");if(t.length>1){if(a){for(let n=t.length;n--;)if(t[n].substring(0,4)===a.substring(0,4))return t[n]}return t[0]}}return e||a}function RA(a){const e=a.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function IA(a){if(a.startsWith("av01.")){const e=a.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return a}function rd(a){const e=xi(a)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Ru(a){return a.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Iu={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function Lu(a,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:a}}const sd={};function LA(a,e,t,n,i,s){const r=a.audioCodec?a.audioGroups:null,d=s==null?void 0:s.audioCodec,u=s==null?void 0:s.channels,c=u?parseInt(u):d?1/0:2;let l=null;if(r!=null&&r.length)try{r.length===1&&r[0]?l=e.groups[r[0]].channels:l=r.reduce((h,o)=>{if(o){const f=e.groups[o];if(!f)throw new Error(`Audio track group ${o} not found`);Object.keys(f.channels).forEach(p=>{h[p]=(h[p]||0)+f.channels[p]})}return h},{2:0})}catch{return!0}return a.videoCodec!==void 0&&(a.width>1920&&a.height>1088||a.height>1920&&a.width>1088||a.frameRate>Math.max(n,30)||a.videoRange!=="SDR"&&a.videoRange!==t||a.bitrate>Math.max(i,8e6))||!!l&&pt(c)&&Object.keys(l).some(h=>parseInt(h)>c)}function Du(a,e,t){const n=a.videoCodec,i=a.audioCodec;if(!n&&!i||!t)return Promise.resolve(Iu);const s=[];if(n){const r={width:a.width,height:a.height,bitrate:Math.ceil(Math.max(a.bitrate*.9,a.averageBitrate)),framerate:a.frameRate||30},d=a.videoRange;d!=="SDR"&&(r.transferFunction=d.toLowerCase());const u=n.split(","),c=navigator.userAgent;if(u.some(l=>Bs(l))&&Cu())return Promise.resolve(Lu(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${c})`),s));s.push.apply(s,u.map(l=>({type:"media-source",video:en(en({},r),{},{contentType:_r(IA(l),"video")})})))}return i&&a.audioGroups&&a.audioGroups.forEach(r=>{var d;r&&((d=e.groups[r])==null||d.tracks.forEach(u=>{if(u.groupId===r){const c=u.channels||"",l=parseFloat(c);pt(l)&&l>2&&s.push.apply(s,i.split(",").map(h=>({type:"media-source",audio:{contentType:_r(h,"audio"),channels:""+l}})))}}))}),Promise.all(s.map(r=>{const d=DA(r);return sd[d]||(sd[d]=t.decodingInfo(r))})).then(r=>({supported:!r.some(d=>!d.supported),configurations:s,decodingInfoResults:r})).catch(r=>({supported:!1,configurations:s,decodingInfoResults:[],error:r}))}function DA(a){const{audio:e,video:t}=a,n=t||e;if(n){const i=Ru(n.contentType);if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${i}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${i}`}return""}const ro=["NONE","TYPE-0","TYPE-1",null];function PA(a){return ro.indexOf(a)>-1}const vs=["SDR","PQ","HLG"];function OA(a){return!!a&&vs.indexOf(a)>-1}var ns={No:"",Yes:"YES",v2:"v2"};function ad(a){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=a,i=n<e/2;return e&&i?t?ns.v2:ns.Yes:ns.No}class od{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Ar{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return ld(this._audioGroups,e)}hasSubtitleGroup(e){return ld(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function ld(a,e){return!e||!a?!1:a.indexOf(e)!==-1}function MA(){if(typeof matchMedia=="function"){const a=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(a.media!==e.media)return a.matches===!0}return!1}function BA(a,e){let t=!1,n=[];if(a&&(t=a!=="SDR",n=[a]),e){n=e.allowedVideoRanges||vs.slice(0);const i=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:i&&MA(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const FA=a=>{const e=new WeakSet;return(t,n)=>{if(a&&(n=a(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},An=(a,e)=>JSON.stringify(a,FA(e));function NA(a,e,t,n,i){const s=Object.keys(a),r=n==null?void 0:n.channels,d=n==null?void 0:n.audioCodec,u=i==null?void 0:i.videoCodec,c=r&&parseInt(r)===2;let l=!1,h=!1,o=1/0,f=1/0,p=1/0,m=1/0,y=0,_=[];const{preferHDR:S,allowedVideoRanges:b}=BA(e,i);for(let T=s.length;T--;){const k=a[s[T]];l||(l=k.channels[2]>0),o=Math.min(o,k.minHeight),f=Math.min(f,k.minFramerate),p=Math.min(p,k.minBitrate),b.filter(F=>k.videoRanges[F]>0).length>0&&(h=!0)}o=pt(o)?o:0,f=pt(f)?f:0;const x=Math.max(1080,o),L=Math.max(30,f);p=pt(p)?p:t,t=Math.max(p,t),h||(e=void 0);const N=s.length>1;return{codecSet:s.reduce((T,k)=>{const I=a[k];if(k===T)return T;if(_=h?b.filter(F=>I.videoRanges[F]>0):[],N){if(I.minBitrate>t)return ii(k,`min bitrate of ${I.minBitrate} > current estimate of ${t}`),T;if(!I.hasDefaultAudio)return ii(k,"no renditions with default or auto-select sound found"),T;if(d&&k.indexOf(d.substring(0,4))%5!==0)return ii(k,`audio codec preference "${d}" not found`),T;if(r&&!c){if(!I.channels[r])return ii(k,`no renditions with ${r} channel sound found (channels options: ${Object.keys(I.channels)})`),T}else if((!d||c)&&l&&I.channels[2]===0)return ii(k,"no renditions with stereo sound found"),T;if(I.minHeight>x)return ii(k,`min resolution of ${I.minHeight} > maximum of ${x}`),T;if(I.minFramerate>L)return ii(k,`min framerate of ${I.minFramerate} > maximum of ${L}`),T;if(!_.some(F=>I.videoRanges[F]>0))return ii(k,`no variants with VIDEO-RANGE of ${An(_)} found`),T;if(u&&k.indexOf(u.substring(0,4))%5!==0)return ii(k,`video codec preference "${u}" not found`),T;if(I.maxScore<y)return ii(k,`max score of ${I.maxScore} < selected max of ${y}`),T}return T&&(_s(k)>=_s(T)||I.fragmentError>a[T].fragmentError)?T:(m=I.minIndex,y=I.maxScore,k)},void 0),videoRanges:_,preferHDR:S,minFramerate:f,minBitrate:p,minIndex:m}}function ii(a,e){Jt.log(`[abr] start candidates with "${a}" ignored because ${e}`)}function Pu(a){return a.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const i=t.channels||"2";return n.channels[i]=(n.channels[i]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function UA(a,e,t,n){return a.slice(t,n+1).reduce((i,s,r)=>{if(!s.codecSet)return i;const d=s.audioGroups;let u=i[s.codecSet];u||(i[s.codecSet]=u={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:r,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!d,fragmentError:0}),u.minBitrate=Math.min(u.minBitrate,s.bitrate);const c=Math.min(s.height,s.width);return u.minHeight=Math.min(u.minHeight,c),u.minFramerate=Math.min(u.minFramerate,s.frameRate),u.minIndex=Math.min(u.minIndex,r),u.maxScore=Math.max(u.maxScore,s.score),u.fragmentError+=s.fragmentError,u.videoRanges[s.videoRange]=(u.videoRanges[s.videoRange]||0)+1,d&&d.forEach(l=>{if(!l)return;const h=e.groups[l];h&&(u.hasDefaultAudio=u.hasDefaultAudio||e.hasDefaultAudio?h.hasDefault:h.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(h.channels).forEach(o=>{u.channels[o]=(u.channels[o]||0)+h.channels[o]}))}),i},{})}function dd(a){if(!a)return a;const{lang:e,assocLang:t,characteristics:n,channels:i,audioCodec:s}=a;return{lang:e,assocLang:t,characteristics:n,channels:i,audioCodec:s}}function li(a,e,t){if("attrs"in a){const n=e.indexOf(a);if(n!==-1)return n}for(let n=0;n<e.length;n++){const i=e[n];if(Ni(a,i,t))return n}return-1}function Ni(a,e,t){const{groupId:n,name:i,lang:s,assocLang:r,default:d}=a,u=a.forced;return(n===void 0||e.groupId===n)&&(i===void 0||e.name===i)&&(s===void 0||$A(s,e.lang))&&(s===void 0||e.assocLang===r)&&(d===void 0||e.default===d)&&(u===void 0||e.forced===u)&&(!("characteristics"in a)||GA(a.characteristics||"",e.characteristics))&&(t===void 0||t(a,e))}function $A(a,e="--"){return a.length===e.length?a===e:a.startsWith(e)||e.startsWith(a)}function GA(a,e=""){const t=a.split(","),n=e.split(",");return t.length===n.length&&!t.some(i=>n.indexOf(i)===-1)}function Li(a,e){const{audioCodec:t,channels:n}=a;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function VA(a,e,t,n,i){const s=e[n],d=e.reduce((o,f,p)=>{const m=f.uri;return(o[m]||(o[m]=[])).push(p),o},{})[s.uri];d.length>1&&(n=Math.max.apply(Math,d));const u=s.videoRange,c=s.frameRate,l=s.codecSet.substring(0,4),h=cd(e,n,o=>{if(o.videoRange!==u||o.frameRate!==c||o.codecSet.substring(0,4)!==l)return!1;const f=o.audioGroups,p=t.filter(m=>!f||f.indexOf(m.groupId)!==-1);return li(a,p,i)>-1});return h>-1?h:cd(e,n,o=>{const f=o.audioGroups,p=t.filter(m=>!f||f.indexOf(m.groupId)!==-1);return li(a,p,i)>-1})}function cd(a,e,t){for(let n=e;n>-1;n--)if(t(a[n]))return n;for(let n=e+1;n<a.length;n++)if(t(a[n]))return n;return-1}function bs(a,e){var t;return!!a&&a!==((t=e.loadLevelObj)==null?void 0:t.uri)}class jA extends vi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:i,partCurrent:s,hls:r}=this,{autoLevelEnabled:d,media:u}=r;if(!i||!u)return;const c=performance.now(),l=s?s.stats:i.stats,h=s?s.duration:i.duration,o=c-l.loading.start,f=r.minAutoLevel,p=i.level,m=this._nextAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||p<=f){this.clearTimer(),this._nextAutoLevel=-1;return}if(!d)return;const y=m>-1&&m!==p,_=!!t||y;if(!_&&(u.paused||!u.playbackRate||!u.readyState))return;const S=r.mainForwardBufferInfo;if(!_&&S===null)return;const b=this.bwEstimator.getEstimateTTFB(),x=Math.abs(u.playbackRate);if(o<=Math.max(b,1e3*(h/(x*2))))return;const L=S?S.len/x:0,N=l.loading.first?l.loading.first-l.loading.start:-1,P=l.loaded&&N>-1,T=this.getBwEstimate(),k=r.levels,I=k[p],F=Math.max(l.loaded,Math.round(h*(i.bitrate||I.averageBitrate)/8));let V=P?o-N:o;V<1&&P&&(V=Math.min(o,l.loaded*8/T));const ne=P?l.loaded*1e3/V:0,te=b/1e3,Z=ne?(F-l.loaded)/ne:F*8/T+te;if(Z<=L)return;const Q=ne?ne*8:T,he=((n=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,de=this.hls.config.abrBandWidthUpFactor;let M=Number.POSITIVE_INFINITY,A;for(A=p-1;A>f;A--){const C=k[A].maxBitrate,O=!k[A].details||he;if(M=this.getTimeToLoadFrag(te,Q,h*C,O),M<Math.min(L,h+te))break}if(M>=Z||M>h*10)return;P?this.bwEstimator.sample(o-Math.min(b,N),l.loaded):this.bwEstimator.sampleTTFB(o);const v=k[A].maxBitrate;this.getBwEstimate()*de>v&&this.resetEstimator(v);const w=this.findBestLevel(v,f,A,0,L,1,1);w>-1&&(A=w),this.warn(`Fragment ${i.sn}${s?" part "+s.index:""} of level ${p} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${L.toFixed(3)} s
      Estimated load time for current fragment: ${Z.toFixed(3)} s
      Estimated load time for down switch fragment: ${M.toFixed(3)} s
      TTFB estimate: ${N|0} ms
      Current BW estimate: ${pt(T)?T|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${A} @ ${v|0} bps`),r.nextLoadLevel=r.nextAutoLevel=A,this.clearTimer();const R=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===A&&A>0){const C=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${A>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${C.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,A>f){let O=this.findBestLevel(this.hls.levels[f].bitrate,f,A,0,C,1,1);O===-1&&(O=f),this.hls.nextLoadLevel=this.hls.nextAutoLevel=O,this.resetEstimator(this.hls.levels[O].bitrate)}}};y||Z>M*2?R():this.timer=self.setInterval(R,M*1e3),r.trigger($.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:s,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Z_(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.FRAG_LOADING,this.onFragLoading,this),e.on($.FRAG_LOADED,this.onFragLoaded,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this),e.on($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on($.LEVEL_LOADED,this.onLevelLoaded,this),e.on($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on($.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.FRAG_LOADING,this.onFragLoading,this),e.off($.FRAG_LOADED,this.onFragLoaded,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this),e.off($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off($.LEVEL_LOADED,this.onLevelLoaded,this),e.off($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off($.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off($.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var i;this.fragCurrent=n,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Me.BUFFER_ADD_CODEC_ERROR:case Me.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Me.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:i,partCurrent:s}=this;if(n&&i&&n.sn===i.sn&&n.level===i.level){const r=performance.now(),d=s?s.stats:n.stats,u=r-d.loading.start,c=d.loading.first?d.loading.first-d.loading.start:-1;if(d.loaded&&c>-1){const h=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(u-Math.min(h,c),d.loaded)}else this.bwEstimator.sampleTTFB(u)}break}}}getTimeToLoadFrag(e,t,n,i){const s=e+n/t,r=i?e+this.lastLevelLoadSec:0;return s+r}onLevelLoaded(e,t){const n=this.hls.config,{loading:i}=t.stats,s=i.end-i.first;pt(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const i=n?n.stats:t.stats;if(t.type===bt.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=n?n.duration:t.duration,r=this.hls.levels[t.level],d=(r.loaded?r.loaded.bytes:0)+i.loaded,u=(r.loaded?r.loaded.duration:0)+s;r.loaded={bytes:d,duration:u},r.realBitrate=Math.round(8*d/u)}if(t.bitrateTest){const s={stats:i,frag:t,part:n,id:t.type};this.onFragBuffered($.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:i}=t,s=i!=null&&i.stats.loaded?i.stats:n.stats;if(s.aborted||this.ignoreFragment(n))return;const r=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(r,s.loaded),s.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==bt.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,s=this.findBestLevel(n,t,e,0,i,1,1);if(s>-1)return s;const r=this.hls.firstLevel,d=Math.min(Math.max(r,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${r} clamped to ${d}`),d}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=n&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const r=this.hls.levels;if(r.length>Math.max(e,s)&&r[e].loadError<=r[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:i,config:s,minAutoLevel:r}=n,d=t?t.duration:e?e.duration:0,u=this.getBwEstimate(),c=this.getStarvationDelay();let l=s.abrBandWidthFactor,h=s.abrBandWidthUpFactor;if(c){const y=this.findBestLevel(u,r,i,c,0,l,h);if(y>=0)return this.rebufferNotice=-1,y}let o=d?Math.min(d,s.maxStarvationDelay):s.maxStarvationDelay;if(!c){const y=this.bitrateTestDelay;y&&(o=(d?Math.min(d,s.maxLoadingDelay):s.maxLoadingDelay)-y,this.info(`bitrate test took ${Math.round(1e3*y)}ms, set first fragment max fetchDuration to ${Math.round(1e3*o)} ms`),l=h=1)}const f=this.findBestLevel(u,r,i,c,o,l,h);if(this.rebufferNotice!==f&&(this.rebufferNotice=f,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${f}`)),f>-1)return f;const p=n.levels[r],m=n.loadLevelObj;return m&&(p==null?void 0:p.bitrate)<m.bitrate?r:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,i,s,r,d){var u;const c=i+s,l=this.lastLoadedFragLevel,h=l===-1?this.hls.firstLevel:l,{fragCurrent:o,partCurrent:f}=this,{levels:p,allAudioTracks:m,loadLevel:y,config:_}=this.hls;if(p.length===1)return 0;const S=p[h],b=!!((u=this.hls.latestLevelDetails)!=null&&u.live),x=y===-1||l===-1;let L,N="SDR",P=(S==null?void 0:S.frameRate)||0;const{audioPreference:T,videoPreference:k}=_,I=this.audioTracksByGroup||(this.audioTracksByGroup=Pu(m));let F=-1;if(x){if(this.firstSelection!==-1)return this.firstSelection;const Q=this.codecTiers||(this.codecTiers=UA(p,I,t,n)),he=NA(Q,N,e,T,k),{codecSet:de,videoRanges:M,minFramerate:A,minBitrate:v,minIndex:w,preferHDR:R}=he;F=w,L=de,N=R?M[M.length-1]:M[0],P=A,e=Math.max(e,v),this.log(`picked start tier ${An(he)}`)}else L=S==null?void 0:S.codecSet,N=S==null?void 0:S.videoRange;const V=f?f.duration:o?o.duration:0,ne=this.bwEstimator.getEstimateTTFB()/1e3,te=[];for(let Q=n;Q>=t;Q--){var Z;const he=p[Q],de=Q>h;if(!he)continue;if(_.useMediaCapabilities&&!he.supportedResult&&!he.supportedPromise){const O=navigator.mediaCapabilities;typeof(O==null?void 0:O.decodingInfo)=="function"&&(LA(he,I,N,P,e,T)||Bs(he.videoCodec))?(he.supportedPromise=Du(he,I,O),he.supportedPromise.then(G=>{if(!this.hls)return;he.supportedResult=G;const z=this.hls.levels,Y=z.indexOf(he);G.error?this.warn(`MediaCapabilities decodingInfo error: "${G.error}" for level ${Y} ${An(G)}`):G.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Y} ${An(G)}`),Y>-1&&z.length>1&&(this.log(`Removing unsupported level ${Y}`),this.hls.removeLevel(Y),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):he.supportedResult=Iu}if((L&&he.codecSet!==L||N&&he.videoRange!==N||de&&P>he.frameRate||!de&&P>0&&P<he.frameRate||he.supportedResult&&!((Z=he.supportedResult.decodingInfoResults)!=null&&Z[0].smooth))&&(!x||Q!==F)){te.push(Q);continue}const M=he.details,A=(f?M==null?void 0:M.partTarget:M==null?void 0:M.averagetargetduration)||V;let v;de?v=d*e:v=r*e;const w=V&&i>=V*2&&s===0?he.averageBitrate:he.maxBitrate,R=this.getTimeToLoadFrag(ne,v,w*A,M===void 0);if(v>=w&&(Q===l||he.loadError===0&&he.fragmentError===0)&&(R<=ne||!pt(R)||b&&!this.bitrateTestDelay||R<c)){const O=this.forcedAutoLevel;return Q!==y&&(O===-1||O!==y)&&(te.length&&this.trace(`Skipped level(s) ${te.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${p[te[0]].codecs}" ${p[te[0]].videoRange}; not compatible with "${L}" ${N}`),this.info(`switch candidate:${h}->${Q} adjustedbw(${Math.round(v)})-bitrate=${Math.round(v-w)} ttfb:${ne.toFixed(1)} avgDuration:${A.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${R.toFixed(1)} firstSelection:${x} codecSet:${he.codecSet} videoRange:${he.videoRange} hls.loadLevel:${y}`)),x&&(this.firstSelection=Q),Q}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const Ou={search:function(a,e){let t=0,n=a.length-1,i=null,s=null;for(;t<=n;){i=(t+n)/2|0,s=a[i];const r=e(s);if(r>0)t=i+1;else if(r<0)n=i-1;else return s}return null}};function HA(a,e,t){if(e===null||!Array.isArray(a)||!a.length||!pt(e))return null;const n=a[0].programDateTime;if(e<(n||0))return null;const i=a[a.length-1].endProgramDateTime;if(e>=(i||0))return null;for(let s=0;s<a.length;++s){const r=a[s];if(zA(e,t,r))return r}return null}function Ui(a,e,t=0,n=0,i=.005){let s=null;if(a){s=e[1+a.sn-e[0].sn]||null;const d=a.endDTS-t;d>0&&d<15e-7&&(t+=15e-7),s&&a.level!==s.level&&s.end<=a.end&&(s=e[2+a.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!a||a.level===s.level)&&ud(t,n,s)===0||qA(s,a,Math.min(i,n))))return s;const r=Ou.search(e,ud.bind(null,t,n));return r&&(r!==a||!s)?r:s}function qA(a,e,t){if(e&&e.start===0&&e.level<a.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((i,s)=>(s[0]==="INF"&&(i+=parseFloat(s[1])),i),t);return a.start<=n}return!1}function ud(a=0,e=0,t){if(t.start<=a&&t.start+t.duration>a)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=a?1:t.start-n>a&&t.start?-1:0}function zA(a,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>a}function Mu(a,e,t){if(a&&a.startCC<=e&&a.endCC>=e){let n=a.fragments;const{fragmentHint:i}=a;i&&(n=n.concat(i));let s;return Ou.search(n,r=>r.cc<e?1:r.cc>e?-1:(s=r,r.end<=t?1:r.start>t?-1:0)),s||null}return null}function Ss(a){switch(a.details){case Me.FRAG_LOAD_TIMEOUT:case Me.KEY_LOAD_TIMEOUT:case Me.LEVEL_LOAD_TIMEOUT:case Me.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function hd(a,e){const t=Ss(e);return a.default[`${t?"timeout":"error"}Retry`]}function Uo(a,e){const t=a.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*a.retryDelayMs,a.maxRetryDelayMs)}function fd(a){return en(en({},a),{errorRetry:null,timeoutRetry:null})}function Es(a,e,t,n){if(!a)return!1;const i=n==null?void 0:n.code,s=e<a.maxNumRetry&&(KA(i)||!!t);return a.shouldRetry?a.shouldRetry(a,e,t,n,s):s}function KA(a){return a===0&&navigator.onLine===!1||!!a&&(a<400||a>499)}var Fn={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ti={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class WA extends vi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on($.ERROR,this.onError,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off($.ERROR,this.onError,this),e.off($.ERROR,this.onErrorOut,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===bt.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const i=this.hls,s=t.context;switch(t.details){case Me.FRAG_LOAD_ERROR:case Me.FRAG_LOAD_TIMEOUT:case Me.KEY_LOAD_ERROR:case Me.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Me.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=vr();return}case Me.FRAG_GAP:case Me.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Fn.SendAlternateToPenaltyBox;return}case Me.LEVEL_EMPTY_ERROR:case Me.LEVEL_PARSING_ERROR:{var r,d;const c=t.parent===bt.MAIN?t.level:i.loadLevel;t.details===Me.LEVEL_EMPTY_ERROR&&((r=t.context)!=null&&(d=r.levelDetails)!=null&&d.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,c):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,c))}return;case Me.LEVEL_LOAD_ERROR:case Me.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case Me.AUDIO_TRACK_LOAD_ERROR:case Me.AUDIO_TRACK_LOAD_TIMEOUT:case Me.SUBTITLE_LOAD_ERROR:case Me.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const c=i.loadLevelObj;if(c&&(s.type===Vt.AUDIO_TRACK&&c.hasAudioGroup(s.groupId)||s.type===Vt.SUBTITLE_TRACK&&c.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=Fn.SendAlternateToPenaltyBox,t.errorAction.flags=ti.MoveAllAlternatesMatchingHost;return}}return;case Me.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const c=i.loadLevelObj,l=c==null?void 0:c.attrs["HDCP-LEVEL"];l?t.errorAction={action:Fn.SendAlternateToPenaltyBox,flags:ti.MoveAllAlternatesMatchingHDCP,hdcpLevel:l}:this.keySystemError(t)}return;case Me.BUFFER_ADD_CODEC_ERROR:case Me.REMUX_ALLOC_ERROR:case Me.BUFFER_APPEND_ERROR:if(!t.errorAction){var u;t.errorAction=this.getLevelSwitchAction(t,(u=t.level)!=null?u:i.loadLevel)}return;case Me.INTERNAL_EXCEPTION:case Me.BUFFER_APPENDING_ERROR:case Me.BUFFER_FULL_ERROR:case Me.LEVEL_SWITCH_ERROR:case Me.BUFFER_STALLED_ERROR:case Me.BUFFER_SEEK_OVER_HOLE:case Me.BUFFER_NUDGE_ON_STALL:t.errorAction=vr();return}t.type===xt.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,i=hd(n.config.playlistLoadPolicy,e),s=this.playlistError++;if(Es(i,s,Ss(e),e.response))return{action:Fn.RetryRequest,flags:ti.None,retryConfig:i,retryCount:s};const d=this.getLevelSwitchAction(e,t);return i&&(d.retryConfig=i,d.retryCount=s),d}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),i=t.levels[n],{fragLoadPolicy:s,keyLoadPolicy:r}=t.config,d=hd(e.details.startsWith("key")?r:s,e),u=t.levels.reduce((l,h)=>l+h.fragmentError,0);if(i&&(e.details!==Me.FRAG_GAP&&i.fragmentError++,Es(d,u,Ss(e),e.response)))return{action:Fn.RetryRequest,flags:ti.None,retryConfig:d,retryCount:u};const c=this.getLevelSwitchAction(e,n);return d&&(c.retryConfig=d,c.retryCount=u),c}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const i=this.hls.levels[t];if(i){var s,r;const c=e.details;i.loadError++,c===Me.BUFFER_APPEND_ERROR&&i.fragmentError++;let l=-1;const{levels:h,loadLevel:o,minAutoLevel:f,maxAutoLevel:p}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const m=(s=e.frag)==null?void 0:s.type,_=(m===bt.AUDIO&&c===Me.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===Me.BUFFER_ADD_CODEC_ERROR||c===Me.BUFFER_APPEND_ERROR))&&h.some(({audioCodec:N})=>i.audioCodec!==N),b=e.sourceBufferName==="video"&&(c===Me.BUFFER_ADD_CODEC_ERROR||c===Me.BUFFER_APPEND_ERROR)&&h.some(({codecSet:N,audioCodec:P})=>i.codecSet!==N&&i.audioCodec===P),{type:x,groupId:L}=(r=e.context)!=null?r:{};for(let N=h.length;N--;){const P=(N+o)%h.length;if(P!==o&&P>=f&&P<=p&&h[P].loadError===0){var d,u;const T=h[P];if(c===Me.FRAG_GAP&&m===bt.MAIN&&e.frag){const k=h[P].details;if(k){const I=Ui(e.frag,k.fragments,e.frag.start);if(I!=null&&I.gap)continue}}else{if(x===Vt.AUDIO_TRACK&&T.hasAudioGroup(L)||x===Vt.SUBTITLE_TRACK&&T.hasSubtitleGroup(L))continue;if(m===bt.AUDIO&&(d=i.audioGroups)!=null&&d.some(k=>T.hasAudioGroup(k))||m===bt.SUBTITLE&&(u=i.subtitleGroups)!=null&&u.some(k=>T.hasSubtitleGroup(k))||_&&i.audioCodec===T.audioCodec||!_&&i.audioCodec!==T.audioCodec||b&&i.codecSet===T.codecSet)continue}l=P;break}}if(l>-1&&n.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:Fn.SendAlternateToPenaltyBox,flags:ti.None,nextAutoLevel:l}}return{action:Fn.SendAlternateToPenaltyBox,flags:ti.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case Fn.DoNothing:break;case Fn.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Me.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:i,hdcpLevel:s,nextAutoLevel:r}=n;switch(i){case ti.None:this.switchLevel(e,r);break;case ti.MoveAllAlternatesMatchingHDCP:s&&(t.maxHdcpLevel=ro[ro.indexOf(s)-1],n.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}n.resolved||this.switchLevel(e,r)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Me.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=Ru(e.mimeType),i=this.hls.levels;for(let s=i.length;s--;)i[s][`${e.sourceBufferName}Codec`]===n&&this.hls.removeLevel(s)}}}function vr(a){const e={action:Fn.DoNothing,flags:ti.None};return a&&(e.resolved=!0),e}var Rn={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class YA{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.BUFFER_APPENDED,this.onBufferAppended,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this),e.on($.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.BUFFER_APPENDED,this.onBufferAppended,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this),e.off($.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let i=n.length;i--;){const s=n[i];if(!s)break;const r=s.end;if(s.start<=e&&r!==null&&e<=r)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:i}=this,s=Object.keys(i);for(let r=s.length;r--;){const d=i[s[r]];if((d==null?void 0:d.body.type)===t&&(!n||d.buffered)){const u=d.body;if(u.start<=e&&e<=u.end)return u}}return null}detectEvictedFragments(e,t,n,i,s){this.timeRanges&&(this.timeRanges[e]=t);const r=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(d=>{const u=this.fragments[d];if(!u||r>=u.body.sn)return;if(!u.buffered&&(!u.loaded||s)){u.body.type===n&&this.removeFragment(u.body);return}const c=u.range[e];if(c){if(c.time.length===0){this.removeFragment(u.body);return}c.time.some(l=>{const h=!this.isTimeBuffered(l.startPTS,l.endPTS,t);return h&&this.removeFragment(u.body),h})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,i=Hi(n),s=this.fragments[i];if(!s||s.buffered&&n.gap)return;const r=!n.relurl;Object.keys(t).forEach(d=>{const u=n.elementaryStreams[d];if(!u)return;const c=t[d],l=r||u.partial===!0;s.range[d]=this.getBufferedTimes(n,e.part,l,c)}),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,(s.body.endList=n.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),Pr(s)||this.removeParts(n.sn-1,n.type)):this.removeFragment(s.body)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=pd(n,i=>i.fragment.sn>=e))}fragBuffered(e,t){const n=Hi(e);let i=this.fragments[n];!i&&t&&(i=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,n,i){const s={time:[],partial:n},r=e.start,d=e.end,u=e.minEndPTS||d,c=e.maxStartPTS||r;for(let l=0;l<i.length;l++){const h=i.start(l)-this.bufferPadding,o=i.end(l)+this.bufferPadding;if(c>=h&&u<=o){s.time.push({startPTS:Math.max(r,i.start(l)),endPTS:Math.min(d,i.end(l))});break}else if(r<o&&d>h){const f=Math.max(r,i.start(l)),p=Math.min(d,i.end(l));p>f&&(s.partial=!0,s.time.push({startPTS:f,endPTS:p}))}else if(d<=h)break}return s}getPartialFragment(e){let t=null,n,i,s,r=0;const{bufferPadding:d,fragments:u}=this;return Object.keys(u).forEach(c=>{const l=u[c];l&&Pr(l)&&(i=l.body.start-d,s=l.body.end+d,e>=i&&e<=s&&(n=Math.min(e-i,s-e),r<=n&&(t=l.body,r=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Pr(t))}getState(e){const t=Hi(e),n=this.fragments[t];return n?n.buffered?Pr(n)?Rn.PARTIAL:Rn.OK:Rn.APPENDING:Rn.NOT_LOADED}isTimeBuffered(e,t,n){let i,s;for(let r=0;r<n.length;r++){if(i=n.start(r)-this.bufferPadding,s=n.end(r)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,i=t.part?null:t,s=Hi(n);this.fragments[s]={body:n,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:i,timeRanges:s,type:r}=t;if(n.sn==="initSegment")return;const d=n.type;if(i){let c=this.activePartLists[d];c||(this.activePartLists[d]=c=[]),c.push(i)}this.timeRanges=s;const u=s[r];this.detectEvictedFragments(r,u,d,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Hi(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let i=n.length;i--;){const s=t[n[i]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(r=>{const d=this.fragments[r];if(!d)return;const u=d.body;u.type!==n||i&&!u.gap||u.start<t&&u.end>e&&(d.buffered||s)&&this.removeFragment(u)})}removeFragment(e){const t=Hi(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const i=e.sn;this.activePartLists[e.type]=pd(n,s=>s.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const n=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;n&&n.forEach(i=>i.clearElementaryStreamInfo())}}function Pr(a){var e,t,n;return a.buffered&&(a.body.gap||((e=a.range.video)==null?void 0:e.partial)||((t=a.range.audio)==null?void 0:t.partial)||((n=a.range.audiovideo)==null?void 0:n.partial))}function Hi(a){return`${a.type}_${a.level}_${a.sn}`}function pd(a,e){return a.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var Ci={cbc:0,ctr:1};class XA{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case Ci.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Ci.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function JA(a){const e=a.byteLength,t=e&&new DataView(a.buffer).getUint8(e-1);return t?a.slice(0,e-t):a}class QA{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let i=0;i<4;i++)n[i]=t.getUint32(i*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,i=n[0],s=n[1],r=n[2],d=n[3],u=this.invSubMix,c=u[0],l=u[1],h=u[2],o=u[3],f=new Uint32Array(256);let p=0,m=0,y=0;for(y=0;y<256;y++)y<128?f[y]=y<<1:f[y]=y<<1^283;for(y=0;y<256;y++){let _=m^m<<1^m<<2^m<<3^m<<4;_=_>>>8^_&255^99,e[p]=_,t[_]=p;const S=f[p],b=f[S],x=f[b];let L=f[_]*257^_*16843008;i[p]=L<<24|L>>>8,s[p]=L<<16|L>>>16,r[p]=L<<8|L>>>24,d[p]=L,L=x*16843009^b*65537^S*257^p*16843008,c[_]=L<<24|L>>>8,l[_]=L<<16|L>>>16,h[_]=L<<8|L>>>24,o[_]=L,p?(p=S^f[f[f[x^S]]],m^=f[f[m]]):p=m=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,i=0;for(;i<t.length&&n;)n=t[i]===this.key[i],i++;if(n)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const r=this.ksRows=(s+6+1)*4;let d,u;const c=this.keySchedule=new Uint32Array(r),l=this.invKeySchedule=new Uint32Array(r),h=this.sBox,o=this.rcon,f=this.invSubMix,p=f[0],m=f[1],y=f[2],_=f[3];let S,b;for(d=0;d<r;d++){if(d<s){S=c[d]=t[d];continue}b=S,d%s===0?(b=b<<8|b>>>24,b=h[b>>>24]<<24|h[b>>>16&255]<<16|h[b>>>8&255]<<8|h[b&255],b^=o[d/s|0]<<24):s>6&&d%s===4&&(b=h[b>>>24]<<24|h[b>>>16&255]<<16|h[b>>>8&255]<<8|h[b&255]),c[d]=S=(c[d-s]^b)>>>0}for(u=0;u<r;u++)d=r-u,u&3?b=c[d]:b=c[d-4],u<4||d<=4?l[u]=b:l[u]=p[h[b>>>24]]^m[h[b>>>16&255]]^y[h[b>>>8&255]]^_[h[b&255]],l[u]=l[u]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const i=this.keySize+6,s=this.invKeySchedule,r=this.invSBox,d=this.invSubMix,u=d[0],c=d[1],l=d[2],h=d[3],o=this.uint8ArrayToUint32Array_(n);let f=o[0],p=o[1],m=o[2],y=o[3];const _=new Int32Array(e),S=new Int32Array(_.length);let b,x,L,N,P,T,k,I,F,V,ne,te,Z,Q;const he=this.networkToHostOrderSwap;for(;t<_.length;){for(F=he(_[t]),V=he(_[t+1]),ne=he(_[t+2]),te=he(_[t+3]),P=F^s[0],T=te^s[1],k=ne^s[2],I=V^s[3],Z=4,Q=1;Q<i;Q++)b=u[P>>>24]^c[T>>16&255]^l[k>>8&255]^h[I&255]^s[Z],x=u[T>>>24]^c[k>>16&255]^l[I>>8&255]^h[P&255]^s[Z+1],L=u[k>>>24]^c[I>>16&255]^l[P>>8&255]^h[T&255]^s[Z+2],N=u[I>>>24]^c[P>>16&255]^l[T>>8&255]^h[k&255]^s[Z+3],P=b,T=x,k=L,I=N,Z=Z+4;b=r[P>>>24]<<24^r[T>>16&255]<<16^r[k>>8&255]<<8^r[I&255]^s[Z],x=r[T>>>24]<<24^r[k>>16&255]<<16^r[I>>8&255]<<8^r[P&255]^s[Z+1],L=r[k>>>24]<<24^r[I>>16&255]<<16^r[P>>8&255]<<8^r[T&255]^s[Z+2],N=r[I>>>24]<<24^r[P>>16&255]<<16^r[T>>8&255]<<8^r[k&255]^s[Z+3],S[t]=he(b^f),S[t+1]=he(N^p),S[t+2]=he(L^m),S[t+3]=he(x^y),f=F,p=V,m=ne,y=te,t=t+4}return S.buffer}}class ZA{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=ev(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function ev(a){switch(a){case Ci.cbc:return"AES-CBC";case Ci.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${a}`)}}const tv=16;class $o{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?JA(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,i){return this.useSoftware?new Promise((s,r)=>{const d=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(d,t,n,i);const u=this.flush();u?s(u.buffer):r(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,i)}softwareDecrypt(e,t,n,i){const{currentIV:s,currentResult:r,remainderData:d}=this;if(i!==Ci.cbc||t.byteLength!==16)return Jt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),d&&(e=Qn(d,e),this.remainderData=null);const u=this.getValidChunk(e);if(!u.length)return null;s&&(n=s);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new QA),c.expandKey(t);const l=r;return this.currentResult=c.decrypt(u.buffer,0,n),this.currentIV=u.slice(-16).buffer,l||null}webCryptoDecrypt(e,t,n,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,i));this.key=t,this.fastAesKey=new ZA(this.subtle,t,i)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new XA(this.subtle,new Uint8Array(n),i).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Jt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,n,i)))}onWebCryptoError(e,t,n,i){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,i);const r=this.flush();if(r)return r.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%tv;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(Jt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const md=Math.pow(2,17);class nv{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new yi({type:xt.NETWORK_ERROR,details:Me.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,s=i.fLoader,r=i.loader;return new Promise((d,u)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(p=>p[0]==="GAP")){u(yd(e));return}else e.gap=!1;const c=this.loader=s?new s(i):new r(i),l=gd(e);e.loader=c;const h=fd(i.fragLoadPolicy.default),o={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:md};e.stats=c.stats;const f={onSuccess:(p,m,y,_)=>{this.resetLoader(e,c);let S=p.data;y.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(S.slice(0,16)),S=S.slice(16)),d({frag:e,part:null,payload:S,networkDetails:_})},onError:(p,m,y,_)=>{this.resetLoader(e,c),u(new yi({type:xt.NETWORK_ERROR,details:Me.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:en({url:n,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:y,stats:_}))},onAbort:(p,m,y)=>{this.resetLoader(e,c),u(new yi({type:xt.NETWORK_ERROR,details:Me.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:y,stats:p}))},onTimeout:(p,m,y)=>{this.resetLoader(e,c),u(new yi({type:xt.NETWORK_ERROR,details:Me.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${o.timeout}ms`),networkDetails:y,stats:p}))}};t&&(f.onProgress=(p,m,y,_)=>t({frag:e,part:null,payload:y,networkDetails:_})),c.load(l,o,f)})}loadPart(e,t,n){this.abort();const i=this.config,s=i.fLoader,r=i.loader;return new Promise((d,u)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){u(yd(e,t));return}const c=this.loader=s?new s(i):new r(i),l=gd(e,t);e.loader=c;const h=fd(i.fragLoadPolicy.default),o={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:md};t.stats=c.stats,c.load(l,o,{onSuccess:(f,p,m,y)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const _={frag:e,part:t,payload:f.data,networkDetails:y};n(_),d(_)},onError:(f,p,m,y)=>{this.resetLoader(e,c),u(new yi({type:xt.NETWORK_ERROR,details:Me.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:en({url:l.url,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:m,stats:y}))},onAbort:(f,p,m)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),u(new yi({type:xt.NETWORK_ERROR,details:Me.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:m,stats:f}))},onTimeout:(f,p,m)=>{this.resetLoader(e,c),u(new yi({type:xt.NETWORK_ERROR,details:Me.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${o.timeout}ms`),networkDetails:m,stats:f}))}})})}updateStatsFromPart(e,t){const n=e.stats,i=t.stats,s=i.total;if(n.loaded+=i.loaded,s){const u=Math.round(e.duration/t.duration),c=Math.min(Math.round(n.loaded/s),u),h=(u-c)*Math.round(n.loaded/c);n.total=n.loaded+h}else n.total=Math.max(n.loaded,n.total);const r=n.loading,d=i.loading;r.start?r.first+=d.first-d.start:(r.start=d.start,r.first=d.first),r.end=d.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function gd(a,e=null){const t=e||a,n={frag:a,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(pt(i)&&pt(s)){var r;let d=i,u=s;if(a.sn==="initSegment"&&iv((r=a.decryptdata)==null?void 0:r.method)){const c=s-i;c%16&&(u=s+(16-c%16)),i!==0&&(n.resetIV=!0,d=i-16)}n.rangeStart=d,n.rangeEnd=u}return n}function yd(a,e){const t=new Error(`GAP ${a.gap?"tag":"attribute"} found`),n={type:xt.MEDIA_ERROR,details:Me.FRAG_GAP,fatal:!1,frag:a,error:t,networkDetails:null};return e&&(n.part=e),(e||a).stats.aborted=!0,new yi(n)}function iv(a){return a==="AES-128"||a==="AES-256"}class yi extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Bu extends vi{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Go{constructor(e,t,n,i=0,s=-1,r=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Or(),this.buffering={audio:Or(),video:Or(),audiovideo:Or()},this.level=e,this.sn=t,this.id=n,this.size=i,this.part=s,this.partial=r}}function Or(){return{start:0,executeStart:0,executeEnd:0,end:0}}const _d={length:0,start:()=>0,end:()=>0};class Ft{static isBuffered(e,t){if(e){const n=Ft.getBuffered(e);for(let i=n.length;i--;)if(t>=n.start(i)&&t<=n.end(i))return!0}return!1}static bufferedRanges(e){if(e){const t=Ft.getBuffered(e);return Ft.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const i=Ft.bufferedRanges(e);if(i.length)return Ft.bufferedInfo(i,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((l,h)=>l.start-h.start||h.end-l.end);let i=-1,s=[];if(n)for(let l=0;l<e.length;l++){t>=e[l].start&&t<=e[l].end&&(i=l);const h=s.length;if(h){const o=s[h-1].end;e[l].start-o<n?e[l].end>o&&(s[h-1].end=e[l].end):s.push(e[l])}else s.push(e[l])}else s=e;let r=0,d,u=t,c=t;for(let l=0;l<s.length;l++){const h=s[l].start,o=s[l].end;if(i===-1&&t>=h&&t<=o&&(i=l),t+n>=h&&t<o)u=h,c=o,r=c-t;else if(t+n<h){d=h;break}}return{len:r,start:u||0,end:c||0,nextStart:d,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||_d}catch(t){return Jt.log("failed to get media.buffered",t),_d}}}const Fu=/\{\$([a-zA-Z0-9-_]+)\}/g;function Ad(a){return Fu.test(a)}function so(a,e){if(a.variableList!==null||a.hasVariableRefs){const t=a.variableList;return e.replace(Fu,n=>{const i=n.substring(2,n.length-1),s=t==null?void 0:t[i];return s===void 0?(a.playlistParsingError||(a.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),n):s})}return e}function vd(a,e,t){let n=a.variableList;n||(a.variableList=n={});let i,s;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const r=new self.URL(t).searchParams;if(r.has(i))s=r.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(r){a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${r.message}`))}}else i=e.NAME,s=e.VALUE;i in n?a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):n[i]=s||""}function rv(a,e,t){const n=e.IMPORT;if(t&&n in t){let i=a.variableList;i||(a.variableList=i={}),i[n]=t[n]}else a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const sv=/^(\d+)x(\d+)$/,bd=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Sn{constructor(e,t){typeof e=="string"&&(e=Sn.parseAttrList(e,t)),nn(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)n[i]=parseInt(t.slice(i*2,i*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((i,s)=>(i[s.toLowerCase()]=!0,i),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=sv.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const i={},s='"';for(bd.lastIndex=0;(n=bd.exec(e))!==null;){const r=n[1].trim();let d=n[2];const u=d.indexOf(s)===0&&d.lastIndexOf(s)===d.length-1;let c=!1;if(u)d=d.slice(1,-1);else switch(r){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(u||c))d=so(t,d);else if(!c&&!u)switch(r){case"CLOSED-CAPTIONS":if(d==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Jt.warn(`${e}: attribute ${r} is missing quotes`)}i[r]=d}return i}}const av="com.apple.hls.interstitial";function ov(a){return a!=="ID"&&a!=="CLASS"&&a!=="CUE"&&a!=="START-DATE"&&a!=="DURATION"&&a!=="END-DATE"&&a!=="END-ON-NEXT"}function lv(a){return a==="SCTE35-OUT"||a==="SCTE35-IN"||a==="SCTE35-CMD"}class Nu{constructor(e,t,n=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(i=t==null?void 0:t.tagOrder)!=null?i:n,t){const s=t.attr;for(const r in s)if(Object.prototype.hasOwnProperty.call(e,r)&&e[r]!==s[r]){Jt.warn(`DATERANGE tag attribute: "${r}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=r;break}e=nn(new Sn({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);pt(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Jt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(pt(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===av}get isValid(){return!!this.id&&!this._badValueForSameId&&pt(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const dv=10;class cv{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?pt(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||dv}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function er(a){return a==="AES-128"||a==="AES-256"||a==="AES-256-CTR"}function Vo(a){switch(a){case"AES-128":case"AES-256":return Ci.cbc;case"AES-256-CTR":return Ci.ctr;default:throw new Error(`invalid full segment method ${a}`)}}function jo(a){return Uint8Array.from(atob(a),e=>e.charCodeAt(0))}function ao(a){return Uint8Array.from(unescape(encodeURIComponent(a)),e=>e.charCodeAt(0))}function uv(a){const e=ao(a).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function hv(a){const e=function(n,i,s){const r=n[i];n[i]=n[s],n[s]=r};e(a,0,3),e(a,1,2),e(a,4,5),e(a,6,7)}function fv(a){const e=a.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),i=n[n.length-1].split(",");if(i.length===2){const s=i[0]==="base64",r=i[1];s?(n.splice(-1,1),t=jo(r)):t=uv(r)}}return t}const Ts=typeof self<"u"?self:void 0;var tn={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Gn={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function is(a){switch(a){case Gn.FAIRPLAY:return tn.FAIRPLAY;case Gn.PLAYREADY:return tn.PLAYREADY;case Gn.WIDEVINE:return tn.WIDEVINE;case Gn.CLEARKEY:return tn.CLEARKEY}}var Mr={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function wa(a){if(a===Mr.WIDEVINE)return tn.WIDEVINE;if(a===Mr.PLAYREADY)return tn.PLAYREADY;if(a===Mr.CENC||a===Mr.CLEARKEY)return tn.CLEARKEY}function Br(a){switch(a){case tn.FAIRPLAY:return Gn.FAIRPLAY;case tn.PLAYREADY:return Gn.PLAYREADY;case tn.WIDEVINE:return Gn.WIDEVINE;case tn.CLEARKEY:return Gn.CLEARKEY}}function hr(a){const{drmSystems:e,widevineLicenseUrl:t}=a,n=e?[tn.FAIRPLAY,tn.WIDEVINE,tn.PLAYREADY,tn.CLEARKEY].filter(i=>!!e[i]):[];return!n[tn.WIDEVINE]&&t&&n.push(tn.WIDEVINE),n}const Uu=function(a){return Ts!=null&&(a=Ts.navigator)!=null&&a.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function pv(a,e,t,n){let i;switch(a){case tn.FAIRPLAY:i=["cenc","sinf"];break;case tn.WIDEVINE:case tn.PLAYREADY:i=["cenc"];break;case tn.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${a}`)}return mv(i,e,t,n)}function mv(a,e,t,n){return[{initDataTypes:a,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function gv(a){var e;return a.sessionType==="persistent-license"||!!((e=a.sessionTypes)!=null&&e.some(t=>t==="persistent-license"))}function $u(a){const e=new Uint16Array(a.buffer,a.byteOffset,a.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),r=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(r){const d=r.childNodes[0]?r.childNodes[0].nodeValue:r.getAttribute("VALUE");if(d){const u=jo(d).subarray(0,16);return hv(u),u}}return null}let Fr={};class br{static clearKeyUriToKeyIdMap(){Fr={}}constructor(e,t,n,i=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=i,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!er(e)}isSupported(){if(this.method){if(er(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Gn.FAIRPLAY:case Gn.WIDEVINE:case Gn.PLAYREADY:case Gn.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(er(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(Jt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const n=yv(e);return new br(this.method,this.uri,"identity",this.keyFormatVersions,n)}const t=fv(this.uri);if(t)switch(this.keyFormat){case Gn.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Gn.PLAYREADY:{const n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=EA(n,null,t),this.keyId=$u(t);break}default:{let n=t.subarray(0,16);if(n.length!==16){const i=new Uint8Array(16);i.set(n,16-n.length),n=i}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){let n=Fr[this.uri];if(!n){const i=Object.keys(Fr).length%Number.MAX_SAFE_INTEGER;n=new Uint8Array(16),new DataView(n.buffer,12,4).setUint32(0,i),Fr[this.uri]=n}this.keyId=n}return this}}function yv(a){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=a>>8*(15-t)&255;return e}const Sd=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Ed=/#EXT-X-MEDIA:(.*)/g,_v=/^#EXT(?:INF|-X-TARGETDURATION):/m,ka=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Av=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class di{static findGroup(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.id===t)return i}}static resolve(e,t){return Bo.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return _v.test(e)}static parseMasterPlaylist(e,t){const n=Ad(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},s=[];Sd.lastIndex=0;let r;for(;(r=Sd.exec(e))!=null;)if(r[1]){var d;const c=new Sn(r[1],i),l=so(i,r[2]),h={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:di.resolve(l,t)},o=c.decimalResolution("RESOLUTION");o&&(h.width=o.width,h.height=o.height),Cd(c.CODECS,h);const f=c["SUPPLEMENTAL-CODECS"];f&&(h.supplemental={},Cd(f,h.supplemental)),(d=h.unknownCodecs)!=null&&d.length||s.push(h),i.levels.push(h)}else if(r[3]){const c=r[3],l=r[4];switch(c){case"SESSION-DATA":{const h=new Sn(l,i),o=h["DATA-ID"];o&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[o]=h);break}case"SESSION-KEY":{const h=Td(l,t,i);h.encrypted&&h.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(h)):Jt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${l}"`);break}case"DEFINE":{{const h=new Sn(l,i);vd(i,h,t)}break}case"CONTENT-STEERING":{const h=new Sn(l,i);i.contentSteering={uri:di.resolve(h["SERVER-URI"],t),pathwayId:h["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=xd(l);break}}}const u=s.length>0&&s.length<i.levels.length;return i.levels=u?s:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,n){let i;const s={},r=n.levels,d={AUDIO:r.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:r.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let u=0;for(Ed.lastIndex=0;(i=Ed.exec(e))!==null;){const c=new Sn(i[1],n),l=c.TYPE;if(l){const h=d[l],o=s[l]||[];s[l]=o;const f=c.LANGUAGE,p=c["ASSOC-LANGUAGE"],m=c.CHANNELS,y=c.CHARACTERISTICS,_=c["INSTREAM-ID"],S={attrs:c,bitrate:0,id:u++,groupId:c["GROUP-ID"]||"",name:c.NAME||f||"",type:l,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:f,url:c.URI?di.resolve(c.URI,t):""};if(p&&(S.assocLang=p),m&&(S.channels=m),y&&(S.characteristics=y),_&&(S.instreamId=_),h!=null&&h.length){const b=di.findGroup(h,S.groupId)||h[0];wd(S,b,"audioCodec"),wd(S,b,"textCodec")}o.push(S)}}return s}static parseLevelPlaylist(e,t,n,i,s,r){var d;const u={url:t},c=new cv(t),l=c.fragments,h=[];let o=null,f=0,p=0,m=0,y=0,_=0,S=null,b=new Ea(i,u),x,L,N,P=-1,T=!1,k=null,I;if(ka.lastIndex=0,c.m3u8=e,c.hasVariableRefs=Ad(e),((d=ka.exec(e))==null?void 0:d[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(x=ka.exec(e))!==null;){T&&(T=!1,b=new Ea(i,u),b.playlistOffset=m,b.start=m,b.sn=f,b.cc=y,_&&(b.bitrate=_),b.level=n,o&&(b.initSegment=o,o.rawProgramDateTime&&(b.rawProgramDateTime=o.rawProgramDateTime,o.rawProgramDateTime=null),k&&(b.setByteRange(k),k=null)));const te=x[1];if(te){b.duration=parseFloat(te);const Z=(" "+x[2]).slice(1);b.title=Z||null,b.tagList.push(Z?["INF",te,Z]:["INF",te])}else if(x[3]){if(pt(b.duration)){b.playlistOffset=m,b.start=m,N&&Rd(b,N,c),b.sn=f,b.level=n,b.cc=y,l.push(b);const Z=(" "+x[3]).slice(1);b.relurl=so(c,Z),oo(b,S,h),S=b,m+=b.duration,f++,p=0,T=!0}}else{if(x=x[0].match(Av),!x){Jt.warn("No matches on slow regex match for level playlist!");continue}for(L=1;L<x.length&&x[L]===void 0;L++);const Z=(" "+x[L]).slice(1),Q=(" "+x[L+1]).slice(1),he=x[L+2]?(" "+x[L+2]).slice(1):null;switch(Z){case"BYTERANGE":S?b.setByteRange(Q,S):b.setByteRange(Q);break;case"PROGRAM-DATE-TIME":b.rawProgramDateTime=Q,b.tagList.push(["PROGRAM-DATE-TIME",Q]),P===-1&&(P=l.length);break;case"PLAYLIST-TYPE":c.type&&mi(c,Z,x),c.type=Q.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?mi(c,Z,x):l.length>0&&Id(c,Z,x),f=c.startSN=parseInt(Q);break;case"SKIP":{c.skippedSegments&&mi(c,Z,x);const de=new Sn(Q,c),M=de.decimalInteger("SKIPPED-SEGMENTS");if(pt(M)){c.skippedSegments+=M;for(let v=M;v--;)l.push(null);f+=M}const A=de.enumeratedString("RECENTLY-REMOVED-DATERANGES");A&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(A.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&mi(c,Z,x),c.targetduration=Math.max(parseInt(Q),1);break;case"VERSION":c.version!==null&&mi(c,Z,x),c.version=parseInt(Q);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||mi(c,Z,x),c.live=!1;break;case"#":(Q||he)&&b.tagList.push(he?[Q,he]:[Q]);break;case"DISCONTINUITY":y++,b.tagList.push(["DIS"]);break;case"GAP":b.gap=!0,b.tagList.push([Z]);break;case"BITRATE":b.tagList.push([Z,Q]),_=parseInt(Q)*1e3,pt(_)?b.bitrate=_:_=0;break;case"DATERANGE":{const de=new Sn(Q,c),M=new Nu(de,c.dateRanges[de.ID],c.dateRangeTagCount);c.dateRangeTagCount++,M.isValid||c.skippedSegments?c.dateRanges[M.id]=M:Jt.warn(`Ignoring invalid DATERANGE tag: "${Q}"`),b.tagList.push(["EXT-X-DATERANGE",Q]);break}case"DEFINE":{{const de=new Sn(Q,c);"IMPORT"in de?rv(c,de,r):vd(c,de,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?mi(c,Z,x):l.length>0&&Id(c,Z,x),c.startCC=y=parseInt(Q);break;case"KEY":{const de=Td(Q,t,c);if(de.isSupported()){if(de.method==="NONE"){N=void 0;break}N||(N={}),N[de.keyFormat]&&(N=nn({},N)),N[de.keyFormat]=de}else Jt.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${Q}"`);break}case"START":c.startTimeOffset=xd(Q);break;case"MAP":{const de=new Sn(Q,c);if(b.duration){const M=new Ea(i,u);kd(M,de,n,N),o=M,b.initSegment=o,o.rawProgramDateTime&&!b.rawProgramDateTime&&(b.rawProgramDateTime=o.rawProgramDateTime)}else{const M=b.byteRangeEndOffset;if(M){const A=b.byteRangeStartOffset;k=`${M-A}@${A}`}else k=null;kd(b,de,n,N),o=b,T=!0}o.cc=y;break}case"SERVER-CONTROL":{I&&mi(c,Z,x),I=new Sn(Q),c.canBlockReload=I.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=I.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&I.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=I.optionalFloat("PART-HOLD-BACK",0),c.holdBack=I.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&mi(c,Z,x);const de=new Sn(Q);c.partTarget=de.decimalFloatingPoint("PART-TARGET");break}case"PART":{let de=c.partList;de||(de=c.partList=[]);const M=p>0?de[de.length-1]:void 0,A=p++,v=new Sn(Q,c),w=new dA(v,b,u,A,M);de.push(w),b.duration+=w.duration;break}case"PRELOAD-HINT":{const de=new Sn(Q,c);c.preloadHint=de;break}case"RENDITION-REPORT":{const de=new Sn(Q,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(de);break}default:Jt.warn(`line parsed but not handled: ${x}`);break}}}S&&!S.relurl?(l.pop(),m-=S.duration,c.partList&&(c.fragmentHint=S)):c.partList&&(oo(b,S,h),b.cc=y,c.fragmentHint=b,N&&Rd(b,N,c)),c.targetduration||(c.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const F=l.length,V=l[0],ne=l[F-1];if(m+=c.skippedSegments*c.targetduration,m>0&&F&&ne){c.averagetargetduration=m/F;const te=ne.sn;c.endSN=te!=="initSegment"?te:0,c.live||(ne.endList=!0),V&&c.startCC===void 0&&(c.startCC=V.cc),P>0&&(bv(l,P),V&&h.unshift(V))}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(m+=c.fragmentHint.duration),c.totalduration=m,h.length&&c.dateRangeTagCount&&V&&Gu(h,c),c.endCC=y,c}}function Gu(a,e){const t=a.length;if(!t)return;const n=a[t-1],i=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let r=s.length;r--;){const d=e.dateRanges[s[r]],u=d.startDate.getTime();d.tagAnchor=n.ref;for(let c=t;c--;){const l=vv(e,u,a,c,i);if(l!==-1){d.tagAnchor=e.fragments[l].ref;break}}}}function vv(a,e,t,n,i){const s=t[n];if(s){const d=s.programDateTime;if(e>=d||n===0){var r;const u=(((r=t[n+1])==null?void 0:r.start)||i)-s.start;if(e<=d+u*1e3){const c=t[n].sn-a.startSN,l=a.fragments;if(l.length>t.length){const o=(t[n+1]||l[l.length-1]).sn-a.startSN;for(let f=o;f>c;f--){const p=l[f].programDateTime;if(e>=p&&e<p+l[f].duration*1e3)return f}}return c}}}return-1}function Td(a,e,t){var n,i;const s=new Sn(a,t),r=(n=s.METHOD)!=null?n:"",d=s.URI,u=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,l=(i=s.KEYFORMAT)!=null?i:"identity";d&&s.IV&&!u&&Jt.error(`Invalid IV: ${s.IV}`);const h=d?di.resolve(d,e):"",o=(c||"1").split("/").map(Number).filter(Number.isFinite);return new br(r,h,l,o,u)}function xd(a){const t=new Sn(a).decimalFloatingPoint("TIME-OFFSET");return pt(t)?t:null}function Cd(a,e){let t=(a||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const i=t.filter(s=>wu(s,n));i.length&&(e[`${n}Codec`]=i.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>i.indexOf(s)===-1))}),e.unknownCodecs=t}function wd(a,e,t){const n=e[t];n&&(a[t]=n)}function bv(a,e){let t=a[e];for(let n=e;n--;){const i=a[n];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function oo(a,e,t){a.rawProgramDateTime?t.push(a):e!=null&&e.programDateTime&&(a.programDateTime=e.endProgramDateTime)}function kd(a,e,t,n){a.relurl=e.URI,e.BYTERANGE&&a.setByteRange(e.BYTERANGE),a.level=t,a.sn="initSegment",n&&(a.levelkeys=n),a.initSegment=null}function Rd(a,e,t){a.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&n.push(a)}function mi(a,e,t){a.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Id(a,e,t){a.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Ra(a,e){const t=e.startPTS;if(pt(t)){let n=0,i;e.sn>a.sn?(n=t-a.start,i=a):(n=a.start-t,i=e),i.duration!==n&&i.setDuration(n)}else e.sn>a.sn?a.cc===e.cc&&a.minEndPTS?e.setStart(a.start+(a.minEndPTS-a.start)):e.setStart(a.start+a.duration):e.setStart(Math.max(a.start-e.duration,0))}function Vu(a,e,t,n,i,s){n-t<=0&&(Jt.warn("Fragment should have a positive duration",e),n=t+e.duration,s=i+e.duration);let d=t,u=n;const c=e.startPTS,l=e.endPTS;if(pt(c)){const y=Math.abs(c-t);pt(e.deltaPTS)?e.deltaPTS=Math.max(y,e.deltaPTS):e.deltaPTS=y,d=Math.max(t,c),t=Math.min(t,c),i=Math.min(i,e.startDTS),u=Math.min(n,l),n=Math.max(n,l),s=Math.max(s,e.endDTS)}const h=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=d,e.startDTS=i,e.endPTS=n,e.minEndPTS=u,e.endDTS=s;const o=e.sn;if(!a||o<a.startSN||o>a.endSN)return 0;let f;const p=o-a.startSN,m=a.fragments;for(m[p]=e,f=p;f>0;f--)Ra(m[f],m[f-1]);for(f=p;f<m.length-1;f++)Ra(m[f],m[f+1]);return a.fragmentHint&&Ra(m[m.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,h}function Sv(a,e){if(a===e)return;let t=null;const n=a.fragments;for(let c=n.length-1;c>=0;c--){const l=n[c].initSegment;if(l){t=l;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;let i;xv(a,e,(c,l,h,o)=>{if((!e.startCC||e.skippedSegments)&&l.cc!==c.cc){const f=c.cc-l.cc;for(let p=h;p<o.length;p++)o[p].cc+=f;e.endCC=o[o.length-1].cc}pt(c.startPTS)&&pt(c.endPTS)&&(l.setStart(l.startPTS=c.startPTS),l.startDTS=c.startDTS,l.maxStartPTS=c.maxStartPTS,l.endPTS=c.endPTS,l.endDTS=c.endDTS,l.minEndPTS=c.minEndPTS,l.setDuration(c.endPTS-c.startPTS),l.duration&&(i=l),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(l.elementaryStreams=c.elementaryStreams),l.loader=c.loader,c.hasStats&&(l.stats=c.stats),c.initSegment&&(l.initSegment=c.initSegment,t=c.initSegment)});const s=e.fragments,r=e.fragmentHint?s.concat(e.fragmentHint):s;if(t&&r.forEach(c=>{var l;c&&(!c.initSegment||c.initSegment.relurl===((l=t)==null?void 0:l.relurl))&&(c.initSegment=t)}),e.skippedSegments){if(e.deltaUpdateFailed=s.some(c=>!c),e.deltaUpdateFailed){Jt.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)s.shift();e.startSN=s[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Ev(a.dateRanges,e));const c=a.fragments.filter(l=>l.rawProgramDateTime);if(a.hasProgramDateTime&&!e.hasProgramDateTime)for(let l=1;l<r.length;l++)r[l].programDateTime===null&&oo(r[l],r[l-1],c);Gu(c,e)}e.endCC=s[s.length-1].cc}if(!e.startCC){var d;const c=qu(a,e.startSN-1);e.startCC=(d=c==null?void 0:c.cc)!=null?d:s[0].cc}Tv(a.partList,e.partList,(c,l)=>{l.elementaryStreams=c.elementaryStreams,l.stats=c.stats}),i?Vu(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):ju(a,e),s.length&&(e.totalduration=e.edge-s[0].start),e.driftStartTime=a.driftStartTime,e.driftStart=a.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const c=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=c),e.driftEndTime=u,e.driftEnd=c}else e.driftEndTime=a.driftEndTime,e.driftEnd=a.driftEnd,e.advancedDateTime=a.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=a.requestScheduled)}function Ev(a,e){const{dateRanges:t,recentlyRemovedDateranges:n}=e,i=nn({},a);n&&n.forEach(d=>{delete i[d]});const r=Object.keys(i).length;return r&&Object.keys(t).forEach(d=>{const u=i[d],c=new Nu(t[d].attr,u);c.isValid?(i[d]=c,u||(c.tagOrder+=r)):Jt.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${An(t[d].attr)}"`)}),i}function Tv(a,e,t){if(a&&e){let n=0;for(let i=0,s=a.length;i<=s;i++){const r=a[i],d=e[i+n];r&&d&&r.index===d.index&&r.fragment.sn===d.fragment.sn?t(r,d):n--}}}function xv(a,e,t){const n=e.skippedSegments,i=Math.max(a.startSN,e.startSN)-e.startSN,s=(a.fragmentHint?1:0)+(n?e.endSN:Math.min(a.endSN,e.endSN))-e.startSN,r=e.startSN-a.startSN,d=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,u=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments;for(let c=i;c<=s;c++){const l=u[r+c];let h=d[c];if(n&&!h&&l&&(h=e.fragments[c]=l),l&&h){if(t(l,h,c,d),l.url&&l.url!==h.url){e.playlistParsingError=Ld(`media sequence mismatch ${h.sn}:`,a,e,l,h);return}else if(l.cc!==h.cc){e.playlistParsingError=Ld(`discontinuity sequence mismatch (${l.cc}!=${h.cc})`,a,e,l,h);return}}}}function Ld(a,e,t,n,i){return new Error(`${a} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function ju(a,e,t=!0){const n=e.startSN+e.skippedSegments-a.startSN,i=a.fragments,s=n>=0;let r=0;if(s&&n<i.length)r=i[n].start;else if(s&&e.startSN===a.endSN+1)r=a.fragmentEnd;else if(s&&t)r=a.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)r=a.fragmentStart;else return;lo(e,r)}function lo(a,e){if(e){const t=a.fragments;for(let n=a.skippedSegments;n<t.length;n++)t[n].addStart(e);a.fragmentHint&&a.fragmentHint.addStart(e)}}function Hu(a,e=1/0){let t=1e3*a.targetduration;if(a.updated){const n=a.fragments;if(n.length&&t*4>e){const s=n[n.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function qu(a,e,t){if(!a)return null;let n=a.fragments[e-a.startSN];return n||(n=a.fragmentHint,n&&n.sn===e)?n:e<a.startSN&&t&&t.sn===e?t:null}function Dd(a,e,t){return a?zu(a.partList,e,t):null}function zu(a,e,t){if(a)for(let n=a.length;n--;){const i=a[n];if(i.index===t&&i.fragment.sn===e)return i}return null}function Ku(a){a.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(i=>{i.level=t,i.initSegment&&(i.initSegment.level=t)})})}function pr(a,e){for(let n=0,i=a.length;n<i;n++){var t;if(((t=a[n])==null?void 0:t.cc)===e)return a[n]}return null}function Cv(a,e){return!!(a&&e.startCC<a.endCC&&e.endCC>a.startCC)}function Pd(a,e){if(a){const t=a.start+e;a.start=a.startPTS=t,a.endPTS=t+a.duration}}function Wu(a,e){const t=e.fragments;for(let n=0,i=t.length;n<i;n++)Pd(t[n],a);e.fragmentHint&&Pd(e.fragmentHint,a),e.alignedSliding=!0}function wv(a,e){a&&(Yu(e,a),!e.alignedSliding&&a&&xs(e,a),!e.alignedSliding&&a&&!e.skippedSegments&&ju(a,e,!1))}function Yu(a,e){if(!Cv(e,a))return;const t=Math.min(e.endCC,a.endCC),n=pr(e.fragments,t),i=pr(a.fragments,t);if(!n||!i)return;Jt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=n.start-i.start;Wu(s,a)}function xs(a,e){if(!a.hasProgramDateTime||!e.hasProgramDateTime)return;const t=a.fragments,n=e.fragments;if(!t.length||!n.length)return;let i,s;const r=Math.min(e.endCC,a.endCC);e.startCC<r&&a.startCC<r&&(i=pr(n,r),s=pr(t,r)),(!i||!s)&&(i=n[Math.floor(n.length/2)],s=pr(t,i.cc)||t[Math.floor(t.length/2)]);const d=i.programDateTime,u=s.programDateTime;if(!d||!u)return;const c=(u-d)/1e3-(s.start-i.start);Wu(c,a)}const kv={toString:function(a){let e="";const t=a.length;for(let n=0;n<t;n++)e+=`[${a.start(n).toFixed(3)}-${a.end(n).toFixed(3)}]`;return e}},Ke={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Ho extends Bu{constructor(e,t,n,i,s){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Ke.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:r,fragCurrent:d,media:u,mediaBuffer:c,state:l}=this,h=u?u.currentTime:0,o=Ft.bufferInfo(c||u,h,r.maxBufferHole);if(this.log(`media seeking to ${pt(h)?h.toFixed(3):h}, state: ${l}`),this.state===Ke.ENDED)this.resetLoadingState();else if(d){const f=r.maxFragLookUpTolerance,p=d.start-f,m=d.start+d.duration+f;if(!o.len||m<o.start||p>o.end){const y=h>m;(h<p||y)&&(y&&d.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),d.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(u){this.fragmentTracker.removeFragmentsInRange(h,1/0,this.playlistType,!0);const f=this.lastCurrentTime;if(h>f&&(this.lastCurrentTime=h),!this.loadingParts){const p=Math.max(o.end,h),m=this.shouldLoadParts(this.getLevelDetails(),p);m&&(this.log(`LL-Part loading ON after seeking to ${h.toFixed(2)} with buffer @${p.toFixed(2)}`),this.loadingParts=m)}}!this.hls.hasEnoughToStart&&!o.len&&(this.log(`setting startPosition to ${h} because of seek before start`),this.nextLoadPosition=this.startPosition=h),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new nv(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new $o(e.config)}registerListeners(){const{hls:e}=this;e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_LOADED,this.onManifestLoaded,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_LOADED,this.onManifestLoaded,this),e.off($.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===Ke.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Ke.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,i=this.config.timelineOffset||0;if(n<=i)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=Ft.bufferedInfo(s,e.start,0));const r=e.nextStart;if(r&&r>i&&r<t.edge||this.media.currentTime<e.start)return!1;const u=t.partList;if(u!=null&&u.length){const l=u[u.length-1];return Ft.isBuffered(this.media,l.start+l.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;n.removeEventListener("seeking",this.onMediaSeeking),n.removeEventListener("ended",this.onMediaEnded),n.addEventListener("seeking",this.onMediaSeeking),n.addEventListener("ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===Ke.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=Ke.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const i=s=>{const r=s.frag;if(this.fragContextChanged(r)){this.warn(`${r.type} sn: ${r.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(r,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(r);return}r.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,n,i).then(s=>{if(!s)return;const r=this.state,d=s.frag;if(this.fragContextChanged(d)){(r===Ke.FRAG_LOADING||!this.fragCurrent&&r===Ke.PARSING)&&(this.fragmentTracker.removeFragment(d),this.state=Ke.IDLE);return}"payload"in s&&(this.log(`Loaded ${d.type} sn: ${d.sn} of ${this.playlistLabel()} ${d.level}`),this.hls.trigger($.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===Ke.STOPPED||this.state===Ke.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===Rn.APPENDING){const s=e.type,r=this.getFwdBufferInfo(this.mediaBuffer,s),d=Math.max(e.duration,r?r.len:this.config.maxBufferLength),u=this.backtrackFragment;((u?e.sn-u.sn:0)===1||this.reduceMaxBufferLength(d,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===Rn.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:n};this.hls.trigger($.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const i=n==null?void 0:n.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:i}=this,{frag:s,payload:r}=n,d=s.decryptdata;if(r&&r.byteLength>0&&d!=null&&d.key&&d.iv&&er(d.method)){const u=self.performance.now();return this.decrypter.decrypt(new Uint8Array(r),d.key.buffer,d.iv.buffer,Vo(d.method)).catch(c=>{throw i.trigger($.ERROR,{type:xt.MEDIA_ERROR,details:Me.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:s}),c}).then(c=>{const l=self.performance.now();return i.trigger($.FRAG_DECRYPTED,{frag:s,payload:c,stats:{tstart:u,tdecrypt:l}}),n.payload=c,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===Ke.STOPPED||this.state===Ke.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==Ke.STOPPED&&(this.state=Ke.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?kv.toString(Ft.getBuffered(n)):"(detached)"})`),Pn(e)){var i;if(e.type!==bt.SUBTITLE){const r=e.elementaryStreams;if(!Object.keys(r).some(d=>!!r[d])){this.state=Ke.IDLE;return}}const s=(i=this.levels)==null?void 0:i[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=Ke.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:i,partsLoaded:s}=e,r=!s||s.length===0||s.some(u=>!u),d=new Go(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!r);t.flush(d)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,i){var s;this.fragCurrent=e;const r=t==null?void 0:t.details;if(!this.levels||!r)throw new Error(`frag load aborted, missing level${r?"":" detail"}s`);let d=null;e.encrypted&&!((s=e.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${e.sn} of [${r.startSN}-${r.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=Ke.KEY_LOADING,this.fragCurrent=e,d=this.keyLoader.load(e).then(h=>{if(!this.fragContextChanged(h.frag))return this.hls.trigger($.KEY_LOADED,h),this.state===Ke.KEY_LOADING&&(this.state=Ke.IDLE),h}),this.hls.trigger($.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(d=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):e.encrypted||(d=this.keyLoader.loadClear(e,r.encryptedFragments),d&&this.log("[eme] blocking frag load until media-keys acquired"));const u=this.fragPrevious;if(Pn(e)&&(!u||e.sn!==u.sn)){const h=this.shouldLoadParts(t.details,e.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} loading sn ${u==null?void 0:u.sn}->${e.sn}`),this.loadingParts=h)}if(n=Math.max(e.start,n||0),this.loadingParts&&Pn(e)){const h=r.partList;if(h&&i){n>e.end&&r.fragmentHint&&(e=r.fragmentHint);const o=this.getNextPart(h,e,n);if(o>-1){const f=h[o];e=this.fragCurrent=f.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${f.index} (${o}/${h.length-1}) of ${this.fragInfo(e,!1,f)}) cc: ${e.cc} [${r.startSN}-${r.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=f.start+f.duration,this.state=Ke.FRAG_LOADING;let p;return d?p=d.then(m=>!m||this.fragContextChanged(m.frag)?null:this.doFragPartsLoad(e,f,t,i)).catch(m=>this.handleFragLoadError(m)):p=this.doFragPartsLoad(e,f,t,i).catch(m=>this.handleFragLoadError(m)),this.hls.trigger($.FRAG_LOADING,{frag:e,part:f,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):p}else if(!e.url||this.loadedEndOfParts(h,n))return Promise.resolve(null)}}if(Pn(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${r?"["+r.startSN+"-"+r.endSN+"]":""}, target: ${parseFloat(n.toFixed(3))}`),pt(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Ke.FRAG_LOADING;const c=this.config.progressive;let l;return c&&d?l=d.then(h=>!h||this.fragContextChanged(h==null?void 0:h.frag)?null:this.fragmentLoader.load(e,i)).catch(h=>this.handleFragLoadError(h)):l=Promise.all([this.fragmentLoader.load(e,c?i:void 0),d]).then(([h])=>(!c&&h&&i&&i(h),h)).catch(h=>this.handleFragLoadError(h)),this.hls.trigger($.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):l}doFragPartsLoad(e,t,n,i){return new Promise((s,r)=>{var d;const u=[],c=(d=n.details)==null?void 0:d.partList,l=h=>{this.fragmentLoader.loadPart(e,h,i).then(o=>{u[h.index]=o;const f=o.part;this.hls.trigger($.FRAG_LOADED,o);const p=Dd(n.details,e.sn,h.index+1)||zu(c,e.sn,h.index+1);if(p)l(p);else return s({frag:e,part:f,partsLoaded:u})}).catch(r)};l(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===Me.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger($.ERROR,t)}else this.hls.trigger($.ERROR,{type:xt.OTHER_ERROR,details:Me.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Ke.PARSING){!this.fragCurrent&&this.state!==Ke.STOPPED&&this.state!==Ke.ERROR&&(this.state=Ke.IDLE);return}const{frag:n,part:i,level:s}=t,r=self.performance.now();n.stats.parsing.end=r,i&&(i.stats.parsing.end=r);const d=this.getLevelDetails(),c=d&&n.sn>d.endSN||this.shouldLoadParts(d,n.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(n,i,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var n;const s=e.partList[0],r=s.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=r){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:i,sn:s,part:r}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const d=t[i],u=d.details,c=r>-1?Dd(u,s,r):null,l=c?c.fragment:qu(u,s,n);return l?(n&&n!==l&&(l.stats=n.stats),{frag:l,part:c,level:d}):null}bufferFragmentData(e,t,n,i,s){var r;if(!e||this.state!==Ke.PARSING)return;const{data1:d,data2:u}=e;let c=d;if(d&&u&&(c=Qn(d,u)),!((r=c)!=null&&r.length))return;const l={type:e.type,frag:t,part:n,chunkMeta:i,parent:t.type,data:c};if(this.hls.trigger($.BUFFER_APPENDING,l),e.dropped&&e.independent&&!n){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ft.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,i=Ft.bufferInfo(t,n,0),s=e.duration,r=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),d=Math.max(Math.min(e.start-r,i.end-r),n+r);e.start-d>r&&this.flushMainBuffer(d,e.start)}getFwdBufferInfo(e,t){var n;const i=this.getLoadPosition();if(!pt(i))return null;const r=this.lastCurrentTime>i||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,r)}getFwdBufferInfoAtPos(e,t,n,i){const s=Ft.bufferInfo(e,t,i);if(s.len===0&&s.nextStart!==void 0){const r=this.fragmentTracker.getBufferedFrag(t,n);if(r&&(s.nextStart<=r.end||r.gap)){const d=Math.max(Math.min(s.nextStart,r.end)-t,i);return Ft.bufferInfo(e,t,d)}}return s}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,i=Math.max(Math.min(e-t,n.maxBufferLength),t),s=Math.max(e-t*3,n.maxMaxBufferLength/2,i);return s>=i?(n.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=bt.MAIN){var n;const i=(n=this.fragmentTracker)==null?void 0:n.getAppendedFrag(e,t);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const n=t.fragments,i=n.length;if(!i)return null;const{config:s}=this,r=n[0].start,d=s.lowLatencyMode&&!!t.partList;let u=null;if(t.live){const h=s.initialLiveManifestSize;if(i<h)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${h})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<r){var c;d&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),u=this.getInitialLiveFragment(t);const o=this.hls.startPosition,f=this.hls.liveSyncPosition,p=u?(o!==-1&&o>=r?o:f)||u.start:e;this.log(`Setting startPosition to ${p} to match start frag at live edge. mainStart: ${o} liveSyncPosition: ${f} frag.start: ${(c=u)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=p}}else e<=r&&(u=n[0]);if(!u){const h=this.loadingParts?t.partEnd:t.fragmentEnd;u=this.getFragmentAtPosition(e,h,t)}let l=this.filterReplacedPrimary(u,t);if(!l&&u){const h=u.sn-t.startSN;l=this.filterReplacedPrimary(n[h+1]||null,t)}return this.mapToInitFragWhenRequired(l)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===Rn.OK||n===Rn.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,i,s){let r=null;if(e.gap&&(r=this.getNextFragment(this.nextLoadPosition,t),r&&!r.gap&&n.nextStart)){const d=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i,0);if(d!==null&&n.len+d.len>=s){const u=r.sn;return this.loopSn!==u&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${u}`),this.loopSn=u),null}}return this.loopSn=void 0,r}get primaryPrefetch(){if(Od(this.hls.config)){var e,t;if((e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Od(this.hls.config)&&e.type!==bt.SUBTITLE){const n=this.hls.interstitialsManager,i=n==null?void 0:n.bufferingItem;if(i){const r=i.event;if(r){if(r.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&(t==null?void 0:t.live)===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const s=n==null?void 0:n.playerQueue;if(s)for(let r=s.length;r--;){const d=s[r].interstitial;if(d.appendInPlace&&e.start>=d.startTime&&e.end<=d.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let i=-1,s=!1,r=!0;for(let d=0,u=e.length;d<u;d++){const c=e[d];if(r=r&&!c.independent,i>-1&&n<c.start)break;const l=c.loaded;l?i=-1:(s||c.independent||r)&&c.fragment===t&&(i=d),s=l}return i}loadedEndOfParts(e,t){const n=e[e.length-1];return n&&t>n.start&&n.loaded}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let i=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),i=HA(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const s=n.sn+1;if(s>=e.startSN&&s<=e.endSN){const r=t[s-e.startSN];n.cc===r.cc&&(i=r,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=Mu(e,n.cc,n.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,n){const{config:i}=this;let{fragPrevious:s}=this,{fragments:r,endSN:d}=n;const{fragmentHint:u}=n,{maxFragLookUpTolerance:c}=i,l=n.partList,h=!!(this.loadingParts&&l!=null&&l.length&&u);h&&u&&!this.bitrateTest&&l[l.length-1].fragment.sn===u.sn&&(r=r.concat(u),d=u.sn);let o;if(e<t){var f;const m=e<this.lastCurrentTime||e>t-c||(f=this.media)!=null&&f.paused||!this.startFragRequested?0:c;o=Ui(s,r,e,m)}else o=r[r.length-1];if(o){const p=o.sn-n.startSN,m=this.fragmentTracker.getState(o);if((m===Rn.OK||m===Rn.PARTIAL&&o.gap)&&(s=o),s&&o.sn===s.sn&&(!h||l[0].fragment.sn>o.sn||!n.live&&!h)&&s&&o.level===s.level){const _=r[p+1];o.sn<d&&this.fragmentTracker.getState(_)!==Rn.OK?o=_:o=null}}return o}alignPlaylists(e,t,n){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,r=!t,d=e.alignedSliding&&pt(s);if(r||!d&&!s){wv(n,e);const u=e.fragmentStart;return this.log(`Live playlist sliding: ${u.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),u}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const i=this.timelineOffset;if(n===-1){const s=this.startTimeOffset!==null,r=s?this.startTimeOffset:e.startTimeOffset;r!==null&&pt(r)?(n=t+r,r<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${r} found in ${s?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+i}this.nextLoadPosition=n+i}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Pn(e)&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==Ke.FRAG_LOADING_WAITING_RETRY)&&(this.state=Ke.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const p=this.getCurrentContext(t.chunkMeta);p&&(t.frag=p.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var i;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const s=t.details===Me.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(n,!0);const r=t.errorAction,{action:d,flags:u,retryCount:c=0,retryConfig:l}=r||{},h=!!r&&!!l,o=h&&d===Fn.RetryRequest,f=h&&!r.resolved&&u===ti.MoveAllAlternatesMatchingHost;if(!o&&f&&Pn(n)&&!n.endList)this.resetFragmentErrors(e),this.treatAsGap(n),r.resolved=!0;else if((o||f)&&c<l.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const p=Uo(l,c);this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${c+1}/${l.maxNumRetry} in ${p}ms`),r.resolved=!0,this.retryDate=self.performance.now()+p,this.state=Ke.FRAG_LOADING_WAITING_RETRY}else if(l&&r)if(this.resetFragmentErrors(e),c<l.maxNumRetry)!s&&d!==Fn.RemoveAlternatePermanently&&(r.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${c})`);return}else d===Fn.SendAlternateToPenaltyBox?this.state=Ke.WAITING_LEVEL:this.state=Ke.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===Ke.PARSING||this.state===Ke.PARSED){const t=e.frag,n=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,n),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len,(t==null?void 0:t.duration)||10);const r=!s;return r&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),r}return!1}resetFragmentErrors(e){e===bt.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==Ke.STOPPED&&(this.state=Ke.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const i=Ft.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,n),this.state===Ke.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==Ke.STOPPED&&(this.state=Ke.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,i){const s=n.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((u,c)=>{const l=e.elementaryStreams[c];if(l){const h=l.endPTS-l.startPTS;if(h<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${h})`),u||!1;const o=i?0:Vu(s,e,l.startPTS,l.endPTS,l.startDTS,l.endDTS);return this.hls.trigger($.LEVEL_PTS_UPDATED,{details:s,level:n,drift:o,type:c,frag:e,start:l.startPTS,end:l.endPTS}),!0}return u},!1)){var d;if(n.fragmentError===0&&this.treatAsGap(e,n),((d=this.transmuxer)==null?void 0:d.error)===null){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger($.ERROR,{type:xt.MEDIA_ERROR,details:Me.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=Ke.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger($.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===bt.MAIN?"level":"track"}fragInfo(e,t=!0,n){var i,s;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((i=t&&!n?e.startPTS:(n||e).start)!=null?i:NaN).toFixed(3)}-${((s=t&&!n?e.endPTS:(n||e).end)!=null?s:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Od(a){return!!a.interstitialsController&&a.enableInterstitialPlayback!==!1}class Xu{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=Rv(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function Rv(a,e){const t=new Uint8Array(e);let n=0;for(let i=0;i<a.length;i++){const s=a[i];t.set(s,n),n+=s.length}return t}var Ia={exports:{}},Md;function Iv(){return Md||(Md=1,function(a){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(u,c,l){this.fn=u,this.context=c,this.once=l||!1}function s(u,c,l,h,o){if(typeof l!="function")throw new TypeError("The listener must be a function");var f=new i(l,h||u,o),p=t?t+c:c;return u._events[p]?u._events[p].fn?u._events[p]=[u._events[p],f]:u._events[p].push(f):(u._events[p]=f,u._eventsCount++),u}function r(u,c){--u._eventsCount===0?u._events=new n:delete u._events[c]}function d(){this._events=new n,this._eventsCount=0}d.prototype.eventNames=function(){var c=[],l,h;if(this._eventsCount===0)return c;for(h in l=this._events)e.call(l,h)&&c.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},d.prototype.listeners=function(c){var l=t?t+c:c,h=this._events[l];if(!h)return[];if(h.fn)return[h.fn];for(var o=0,f=h.length,p=new Array(f);o<f;o++)p[o]=h[o].fn;return p},d.prototype.listenerCount=function(c){var l=t?t+c:c,h=this._events[l];return h?h.fn?1:h.length:0},d.prototype.emit=function(c,l,h,o,f,p){var m=t?t+c:c;if(!this._events[m])return!1;var y=this._events[m],_=arguments.length,S,b;if(y.fn){switch(y.once&&this.removeListener(c,y.fn,void 0,!0),_){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,l),!0;case 3:return y.fn.call(y.context,l,h),!0;case 4:return y.fn.call(y.context,l,h,o),!0;case 5:return y.fn.call(y.context,l,h,o,f),!0;case 6:return y.fn.call(y.context,l,h,o,f,p),!0}for(b=1,S=new Array(_-1);b<_;b++)S[b-1]=arguments[b];y.fn.apply(y.context,S)}else{var x=y.length,L;for(b=0;b<x;b++)switch(y[b].once&&this.removeListener(c,y[b].fn,void 0,!0),_){case 1:y[b].fn.call(y[b].context);break;case 2:y[b].fn.call(y[b].context,l);break;case 3:y[b].fn.call(y[b].context,l,h);break;case 4:y[b].fn.call(y[b].context,l,h,o);break;default:if(!S)for(L=1,S=new Array(_-1);L<_;L++)S[L-1]=arguments[L];y[b].fn.apply(y[b].context,S)}}return!0},d.prototype.on=function(c,l,h){return s(this,c,l,h,!1)},d.prototype.once=function(c,l,h){return s(this,c,l,h,!0)},d.prototype.removeListener=function(c,l,h,o){var f=t?t+c:c;if(!this._events[f])return this;if(!l)return r(this,f),this;var p=this._events[f];if(p.fn)p.fn===l&&(!o||p.once)&&(!h||p.context===h)&&r(this,f);else{for(var m=0,y=[],_=p.length;m<_;m++)(p[m].fn!==l||o&&!p[m].once||h&&p[m].context!==h)&&y.push(p[m]);y.length?this._events[f]=y.length===1?y[0]:y:r(this,f)}return this},d.prototype.removeAllListeners=function(c){var l;return c?(l=t?t+c:c,this._events[l]&&r(this,l)):(this._events=new n,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=t,d.EventEmitter=d,a.exports=d}(Ia)),Ia.exports}var Lv=Iv(),qo=oA(Lv);const Sr="1.6.5",ar={};function Dv(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Pv(){const a=ar[Sr];if(a)return a.clientCount++,a;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i={worker:new self.Worker(t),objectURL:t,clientCount:1};return ar[Sr]=i,i}function Ov(a){const e=ar[a];if(e)return e.clientCount++,e;const t=new self.URL(a,self.location.href).href,i={worker:new self.Worker(t),scriptURL:t,clientCount:1};return ar[a]=i,i}function Mv(a){const e=ar[a||Sr];if(e&&e.clientCount--===1){const{worker:n,objectURL:i}=e;delete ar[a||Sr],i&&self.URL.revokeObjectURL(i),n.terminate()}}function Ju(a,e){return e+10<=a.length&&a[e]===51&&a[e+1]===68&&a[e+2]===73&&a[e+3]<255&&a[e+4]<255&&a[e+6]<128&&a[e+7]<128&&a[e+8]<128&&a[e+9]<128}function zo(a,e){return e+10<=a.length&&a[e]===73&&a[e+1]===68&&a[e+2]===51&&a[e+3]<255&&a[e+4]<255&&a[e+6]<128&&a[e+7]<128&&a[e+8]<128&&a[e+9]<128}function Fs(a,e){let t=0;return t=(a[e]&127)<<21,t|=(a[e+1]&127)<<14,t|=(a[e+2]&127)<<7,t|=a[e+3]&127,t}function Er(a,e){const t=e;let n=0;for(;zo(a,e);){n+=10;const i=Fs(a,e+6);n+=i,Ju(a,e+10)&&(n+=10),e+=n}if(n>0)return a.subarray(t,t+n)}function Bv(a,e,t,n){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],r=s>>2&15;if(r>12){const f=new Error(`invalid ADTS sampling index:${r}`);a.emit($.ERROR,$.ERROR,{type:xt.MEDIA_ERROR,details:Me.FRAG_PARSING_ERROR,fatal:!0,error:f,reason:f.message});return}const d=(s>>6&3)+1,u=e[t+3]>>6&3|(s&1)<<2,c="mp4a.40."+d,l=i[r];let h=r;(d===5||d===29)&&(h-=3);const o=[d<<3|(h&14)>>1,(h&1)<<7|u<<3];return Jt.log(`manifest codec:${n}, parsed codec:${c}, channels:${u}, rate:${l} (ADTS object type:${d} sampling index:${r})`),{config:o,samplerate:l,channelCount:u,codec:c,parsedCodec:c,manifestCodec:n}}function Qu(a,e){return a[e]===255&&(a[e+1]&246)===240}function Zu(a,e){return a[e+1]&1?7:9}function Ko(a,e){return(a[e+3]&3)<<11|a[e+4]<<3|(a[e+5]&224)>>>5}function Fv(a,e){return e+5<a.length}function Cs(a,e){return e+1<a.length&&Qu(a,e)}function Nv(a,e){return Fv(a,e)&&Qu(a,e)&&Ko(a,e)<=a.length-e}function Uv(a,e){if(Cs(a,e)){const t=Zu(a,e);if(e+t>=a.length)return!1;const n=Ko(a,e);if(n<=t)return!1;const i=e+n;return i===a.length||Cs(a,i)}return!1}function eh(a,e,t,n,i){if(!a.samplerate){const s=Bv(e,t,n,i);if(!s)return;nn(a,s)}}function th(a){return 1024*9e4/a}function $v(a,e){const t=Zu(a,e);if(e+t<=a.length){const n=Ko(a,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function nh(a,e,t,n,i){const s=th(a.samplerate),r=n+i*s,d=$v(e,t);let u;if(d){const{frameLength:h,headerLength:o}=d,f=o+h,p=Math.max(0,t+f-e.length);p?(u=new Uint8Array(f-o),u.set(e.subarray(t+o,e.length),0)):u=e.subarray(t+o,t+f);const m={unit:u,pts:r};return p||a.samples.push(m),{sample:m,length:f,missing:p}}const c=e.length-t;return u=new Uint8Array(c),u.set(e.subarray(t,e.length),0),{sample:{unit:u,pts:r},length:c,missing:-1}}function Gv(a,e){return zo(a,e)&&Fs(a,e+6)+10<=a.length-e}function Vv(a){return a instanceof ArrayBuffer?a:a.byteOffset==0&&a.byteLength==a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer}function La(a,e=0,t=1/0){return jv(a,e,t,Uint8Array)}function jv(a,e,t,n){const i=Hv(a);let s=1;"BYTES_PER_ELEMENT"in n&&(s=n.BYTES_PER_ELEMENT);const r=qv(a)?a.byteOffset:0,d=(r+a.byteLength)/s,u=(r+e)/s,c=Math.floor(Math.max(0,Math.min(u,d))),l=Math.floor(Math.min(c+Math.max(t,0),d));return new n(i,c,l-c)}function Hv(a){return a instanceof ArrayBuffer?a:a.buffer}function qv(a){return a&&a.buffer instanceof ArrayBuffer&&a.byteLength!==void 0&&a.byteOffset!==void 0}function zv(a){const e={key:a.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(a.size<2)return;if(a.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=a.data.subarray(1).indexOf(0);if(n===-1)return;const i=qn(La(a.data,1,n)),s=a.data[2+n],r=a.data.subarray(3+n).indexOf(0);if(r===-1)return;const d=qn(La(a.data,3+n,r));let u;return i==="-->"?u=qn(La(a.data,4+n+r)):u=Vv(a.data.subarray(4+n+r)),e.mimeType=i,e.pictureType=s,e.description=d,e.data=u,e}function Kv(a){if(a.size<2)return;const e=qn(a.data,!0),t=new Uint8Array(a.data.subarray(e.length+1));return{key:a.type,info:e,data:t.buffer}}function Wv(a){if(a.size<2)return;if(a.type==="TXXX"){let t=1;const n=qn(a.data.subarray(t),!0);t+=n.length+1;const i=qn(a.data.subarray(t));return{key:a.type,info:n,data:i}}const e=qn(a.data.subarray(1));return{key:a.type,info:"",data:e}}function Yv(a){if(a.type==="WXXX"){if(a.size<2)return;let t=1;const n=qn(a.data.subarray(t),!0);t+=n.length+1;const i=qn(a.data.subarray(t));return{key:a.type,info:n,data:i}}const e=qn(a.data);return{key:a.type,info:"",data:e}}function Xv(a){return a.type==="PRIV"?Kv(a):a.type[0]==="W"?Yv(a):a.type==="APIC"?zv(a):Wv(a)}function Jv(a){const e=String.fromCharCode(a[0],a[1],a[2],a[3]),t=Fs(a,4),n=10;return{type:e,size:t,data:a.subarray(n,n+t)}}const Nr=10,Qv=10;function ih(a){let e=0;const t=[];for(;zo(a,e);){const n=Fs(a,e+6);a[e+5]>>6&1&&(e+=Nr),e+=Nr;const i=e+n;for(;e+Qv<i;){const s=Jv(a.subarray(e)),r=Xv(s);r&&t.push(r),e+=s.size+Nr}Ju(a,e)&&(e+=Nr)}return t}function rh(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"}function Zv(a){if(a.data.byteLength===8){const e=new Uint8Array(a.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function Wo(a){const e=ih(a);for(let t=0;t<e.length;t++){const n=e[t];if(rh(n))return Zv(n)}}let Vn=function(a){return a.audioId3="org.id3",a.dateRange="com.apple.quicktime.HLS",a.emsg="https://aomedia.org/emsg/ID3",a.misbklv="urn:misb:KLV:bin:1910.1",a}({});function oi(a="",e=9e4){return{type:a,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Yo{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=Qn(this.cachedData,e),this.cachedData=null);let n=Er(e,0),i=n?n.length:0,s;const r=this._audioTrack,d=this._id3Track,u=n?Wo(n):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&pt(u))&&(this.basePTS=eb(u,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&d.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Vn.audioId3,duration:Number.POSITIVE_INFINITY});i<c;){if(this.canParse(e,i)){const l=this.appendFrame(r,e,i);l?(this.frameIndex++,this.lastPTS=l.sample.pts,i+=l.length,s=i):i=c}else Gv(e,i)?(n=Er(e,i),d.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Vn.audioId3,duration:Number.POSITIVE_INFINITY}),i+=n.length,s=i):i++;if(i===c&&s!==c){const l=e.slice(s);this.cachedData?this.cachedData=Qn(this.cachedData,l):this.cachedData=l}}return{audioTrack:r,videoTrack:oi(),id3Track:d,textTrack:oi()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:oi(),id3Track:this._id3Track,textTrack:oi()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const eb=(a,e,t)=>{if(pt(a))return a*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let Ur=null;const tb=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],nb=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],ib=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],rb=[0,1,1,4];function sh(a,e,t,n,i){if(t+24>e.length)return;const s=ah(e,t);if(s&&t+s.frameLength<=e.length){const r=s.samplesPerFrame*9e4/s.sampleRate,d=n+i*r,u={unit:e.subarray(t,t+s.frameLength),pts:d,dts:d};return a.config=[],a.channelCount=s.channelCount,a.samplerate=s.sampleRate,a.samples.push(u),{sample:u,length:s.frameLength,missing:0}}}function ah(a,e){const t=a[e+1]>>3&3,n=a[e+1]>>1&3,i=a[e+2]>>4&15,s=a[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&s!==3){const r=a[e+2]>>1&1,d=a[e+3]>>6,u=t===3?3-n:n===3?3:4,c=tb[u*14+i-1]*1e3,h=nb[(t===3?0:t===2?1:2)*3+s],o=d===3?1:2,f=ib[t][n],p=rb[n],m=f*8*p,y=Math.floor(f*c/h+r)*p;if(Ur===null){const b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ur=b?parseInt(b[1]):0}return!!Ur&&Ur<=87&&n===2&&c>=224e3&&d===0&&(a[e+3]=a[e+3]|128),{sampleRate:h,channelCount:o,frameLength:y,samplesPerFrame:m}}}function Xo(a,e){return a[e]===255&&(a[e+1]&224)===224&&(a[e+1]&6)!==0}function oh(a,e){return e+1<a.length&&Xo(a,e)}function sb(a,e){return Xo(a,e)&&4<=a.length-e}function lh(a,e){if(e+1<a.length&&Xo(a,e)){const n=ah(a,e);let i=4;n!=null&&n.frameLength&&(i=n.frameLength);const s=e+i;return s===a.length||oh(a,s)}return!1}class ab extends Yo{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Er(e,0);let i=(n==null?void 0:n.length)||0;if(lh(e,i))return!1;for(let s=e.length;i<s;i++)if(Uv(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Nv(e,t)}appendFrame(e,t,n){eh(e,this.observer,t,n,e.manifestCodec);const i=nh(e,t,n,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const dh=(a,e)=>{let t=0,n=5;e+=n;const i=new Uint32Array(1),s=new Uint32Array(1),r=new Uint8Array(1);for(;n>0;){r[0]=a[e];const d=Math.min(n,8),u=8-d;s[0]=4278190080>>>24+u<<u,i[0]=(r[0]&s[0])>>u,t=t?t<<d|i[0]:i[0],e+=1,n-=d}return t};class ob extends Yo{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const i=ch(e,t,n,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=Er(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&Wo(t)!==void 0&&dh(e,n)<16}}function ch(a,e,t,n,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const d=[48e3,44100,32e3][s],u=e[t+4]&63,l=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][u*3+s]*2;if(t+l>e.length)return-1;const h=e[t+6]>>5;let o=0;h===2?o+=2:(h&1&&h!==1&&(o+=2),h&4&&(o+=2));const f=(e[t+6]<<8|e[t+7])>>12-o&1,m=[2,1,2,3,3,4,4,5][h]+f,y=e[t+5]>>3,_=e[t+5]&7,S=new Uint8Array([s<<6|y<<1|_>>2,(_&3)<<6|h<<3|f<<2|u>>4,u<<4&224]),b=1536/d*9e4,x=n+i*b,L=e.subarray(t,t+l);return a.config=S,a.channelCount=m,a.samplerate=d,a.samples.push({unit:L,pts:x}),l}class lb extends Yo{resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Er(e,0);let n=(t==null?void 0:t.length)||0;if(t&&e[n]===11&&e[n+1]===119&&Wo(t)!==void 0&&dh(e,n)<=16)return!1;for(let i=e.length;n<i;n++)if(lh(e,n))return Jt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return sb(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return sh(e,t,n,this.basePTS,this.frameIndex)}}const db=/\/emsg[-/]ID3/i;class cb{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,i){const s=this.videoTrack=oi("video",1),r=this.audioTrack=oi("audio",1),d=this.txtTrack=oi("text",1);if(this.id3Track=oi("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const u=Eu(e);if(u.video){const{id:c,timescale:l,codec:h,supplemental:o}=u.video;s.id=c,s.timescale=d.timescale=l,s.codec=h,s.supplemental=o}if(u.audio){const{id:c,timescale:l,codec:h}=u.audio;r.id=c,r.timescale=l,r.codec=h}d.id=vu.text,s.sampleDuration=0,s.duration=r.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return hA(e)}demux(e,t){this.timeOffset=t;let n=e;const i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Qn(this.remainderData,e));const d=AA(n);this.remainderData=d.remainder,i.samples=d.valid||new Uint8Array}else i.samples=n;const r=this.extractID3Track(i,t);return s.samples=nd(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:r,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return n.samples=nd(e,t),{videoTrack:t,audioTrack:oi(),id3Track:i,textTrack:oi()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const i=Nt(e.samples,["emsg"]);i&&i.forEach(s=>{const r=bA(s);if(db.test(r.schemeIdUri)){const d=Bd(r,t);let u=r.eventDuration===4294967295?Number.POSITIVE_INFINITY:r.eventDuration/r.timeScale;u<=.001&&(u=Number.POSITIVE_INFINITY);const c=r.payload;n.samples.push({data:c,len:c.byteLength,dts:d,pts:d,type:Vn.emsg,duration:u})}else if(this.config.enableEmsgKLVMetadata&&r.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const d=Bd(r,t);n.samples.push({data:r.payload,len:r.payload.byteLength,dts:d,pts:d,type:Vn.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Bd(a,e){return pt(a.presentationTime)?a.presentationTime/a.timeScale:e+a.presentationTimeDelta/a.timeScale}class ub{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new $o(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Ci.cbc)}decryptAacSample(e,t,n){const i=e[t].unit;if(i.length<=16)return;const s=i.subarray(16,i.length-i.length%16),r=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(r).then(d=>{const u=new Uint8Array(d);i.set(u,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)})}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)n.set(e.subarray(s,s+16),i);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(n.subarray(i,i+16),s);return e}decryptAvcSample(e,t,n,i,s){const r=xu(s.data),d=this.getAvcEncryptedData(r);this.decryptBuffer(d.buffer).then(u=>{s.data=this.getAvcDecryptedUnit(r,u),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,i)})}decryptAvcSamples(e,t,n,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){i();return}const s=e[t].units;for(;!(n>=s.length);n++){const r=s[n];if(!(r.data.length<=48||r.type!==1&&r.type!==5)&&(this.decryptAvcSample(e,t,n,i,r),!this.decrypter.isSync()))return}}}}class uh{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,i;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const s=n.units;i=s[s.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,i=n.length;if(i){const s=n[i-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const i=t.byteLength;let s=e.naluState||0;const r=s,d=[];let u=0,c,l,h,o=-1,f=0;for(s===-1&&(o=0,f=this.getNALuType(t,0),s=0,u=1);u<i;){if(c=t[u++],!s){s=c?0:1;continue}if(s===1){s=c?0:2;continue}if(!c)s=3;else if(c===1){if(l=u-s-1,o>=0){const p={data:t.subarray(o,l),type:f};d.push(p)}else{const p=this.getLastNalUnit(e.samples);p&&(r&&u<=4-r&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-r)),l>0&&(p.data=Qn(p.data,t.subarray(0,l)),p.state=0))}u<i?(h=this.getNALuType(t,u),o=u,f=h,s=0):s=-1}else s=0}if(o>=0&&s>=0){const p={data:t.subarray(o,i),type:f,state:s};d.push(p)}if(d.length===0){const p=this.getLastNalUnit(e.samples);p&&(p.data=Qn(p.data,t))}return e.naluState=s,d}}class mr{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");i.set(e.subarray(n,n+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&Jt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Fd extends uh{parsePES(e,t,n,i){const s=this.parseNALu(e,n.data,i);let r=this.VideoSample,d,u=!1;n.data=null,r&&s.length&&!e.audFound&&(this.pushAccessUnit(r,e),r=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(c=>{var l,h;switch(c.type){case 1:{let m=!1;d=!0;const y=c.data;if(u&&y.length>4){const _=this.readSliceType(y);(_===2||_===4||_===7||_===9)&&(m=!0)}if(m){var o;(o=r)!=null&&o.frame&&!r.key&&(this.pushAccessUnit(r,e),r=this.VideoSample=null)}r||(r=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),r.frame=!0,r.key=m;break}case 5:d=!0,(l=r)!=null&&l.frame&&!r.key&&(this.pushAccessUnit(r,e),r=this.VideoSample=null),r||(r=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),r.key=!0,r.frame=!0;break;case 6:{d=!0,No(c.data,1,n.pts,t.samples);break}case 7:{var f,p;d=!0,u=!0;const m=c.data,y=this.readSPS(m);if(!e.sps||e.width!==y.width||e.height!==y.height||((f=e.pixelRatio)==null?void 0:f[0])!==y.pixelRatio[0]||((p=e.pixelRatio)==null?void 0:p[1])!==y.pixelRatio[1]){e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.sps=[m];const _=m.subarray(1,4);let S="avc1.";for(let b=0;b<3;b++){let x=_[b].toString(16);x.length<2&&(x="0"+x),S+=x}e.codec=S}break}case 8:d=!0,e.pps=[c.data];break;case 9:d=!0,e.audFound=!0,(h=r)!=null&&h.frame&&(this.pushAccessUnit(r,e),r=null),r||(r=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:d=!0;break;default:d=!1;break}r&&d&&r.units.push(c)}),i&&r&&(this.pushAccessUnit(r,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new mr(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,i=8,s;for(let r=0;r<e;r++)i!==0&&(s=t.readEG(),i=(n+s+256)%256),n=i===0?n:i}readSPS(e){const t=new mr(e);let n=0,i=0,s=0,r=0,d,u,c;const l=t.readUByte.bind(t),h=t.readBits.bind(t),o=t.readUEG.bind(t),f=t.readBoolean.bind(t),p=t.skipBits.bind(t),m=t.skipEG.bind(t),y=t.skipUEG.bind(t),_=this.skipScalingList.bind(this);l();const S=l();if(h(5),p(3),l(),y(),S===100||S===110||S===122||S===244||S===44||S===83||S===86||S===118||S===128){const T=o();if(T===3&&p(1),y(),y(),p(1),f())for(u=T!==3?8:12,c=0;c<u;c++)f()&&(c<6?_(16,t):_(64,t))}y();const b=o();if(b===0)o();else if(b===1)for(p(1),m(),m(),d=o(),c=0;c<d;c++)m();y(),p(1);const x=o(),L=o(),N=h(1);N===0&&p(1),p(1),f()&&(n=o(),i=o(),s=o(),r=o());let P=[1,1];if(f()&&f())switch(l()){case 1:P=[1,1];break;case 2:P=[12,11];break;case 3:P=[10,11];break;case 4:P=[16,11];break;case 5:P=[40,33];break;case 6:P=[24,11];break;case 7:P=[20,11];break;case 8:P=[32,11];break;case 9:P=[80,33];break;case 10:P=[18,11];break;case 11:P=[15,11];break;case 12:P=[64,33];break;case 13:P=[160,99];break;case 14:P=[4,3];break;case 15:P=[3,2];break;case 16:P=[2,1];break;case 255:{P=[l()<<8|l(),l()<<8|l()];break}}return{width:Math.ceil((x+1)*16-n*2-i*2),height:(2-N)*(L+1)*16-(N?2:4)*(s+r),pixelRatio:P}}}class Nd extends uh{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,i){const s=this.parseNALu(e,n.data,i);let r=this.VideoSample,d,u=!1;n.data=null,r&&s.length&&!e.audFound&&(this.pushAccessUnit(r,e),r=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(c=>{var l,h;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:r||(r=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),r.frame=!0,d=!0;break;case 16:case 17:case 18:case 21:if(d=!0,u){var o;(o=r)!=null&&o.frame&&!r.key&&(this.pushAccessUnit(r,e),r=this.VideoSample=null)}r||(r=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),r.key=!0,r.frame=!0;break;case 19:case 20:d=!0,(l=r)!=null&&l.frame&&!r.key&&(this.pushAccessUnit(r,e),r=this.VideoSample=null),r||(r=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),r.key=!0,r.frame=!0;break;case 39:d=!0,No(c.data,2,n.pts,t.samples);break;case 32:d=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=nn(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(d=!0,u=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const f=this.readSPS(c.data);e.width=f.width,e.height=f.height,e.pixelRatio=f.pixelRatio,e.codec=f.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const p in f.params)e.params[p]=f.params[p]}this.pushParameterSet(e.sps,c.data,e.vps),r||(r=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),r.key=!0;break;case 34:if(d=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const f=this.readPPS(c.data);for(const p in f)e.params[p]=f[p]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:d=!0,e.audFound=!0,(h=r)!=null&&h.frame&&(this.pushAccessUnit(r,e),r=null),r||(r=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:d=!1;break}r&&d&&r.units.push(c)}),i&&r&&(this.pushAccessUnit(r,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(t[n]=e[i],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new mr(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),i=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:i}}readSPS(e){const t=new mr(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const i=t.readBits(2),s=t.readBoolean(),r=t.readBits(5),d=t.readUByte(),u=t.readUByte(),c=t.readUByte(),l=t.readUByte(),h=t.readUByte(),o=t.readUByte(),f=t.readUByte(),p=t.readUByte(),m=t.readUByte(),y=t.readUByte(),_=t.readUByte(),S=[],b=[];for(let Ie=0;Ie<n;Ie++)S.push(t.readBoolean()),b.push(t.readBoolean());if(n>0)for(let Ie=n;Ie<8;Ie++)t.readBits(2);for(let Ie=0;Ie<n;Ie++)S[Ie]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),b[Ie]&&t.readUByte();t.readUEG();const x=t.readUEG();x==3&&t.skipBits(1);const L=t.readUEG(),N=t.readUEG(),P=t.readBoolean();let T=0,k=0,I=0,F=0;P&&(T+=t.readUEG(),k+=t.readUEG(),I+=t.readUEG(),F+=t.readUEG());const V=t.readUEG(),ne=t.readUEG(),te=t.readUEG(),Z=t.readBoolean();for(let Ie=Z?0:n;Ie<=n;Ie++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let rt=0;rt<4;rt++)for(let tt=0;tt<(rt===3?2:6);tt++)if(!t.readBoolean())t.readUEG();else{const ht=Math.min(64,1<<4+(rt<<1));rt>1&&t.readEG();for(let _t=0;_t<ht;_t++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const de=t.readUEG();let M=0;for(let Ie=0;Ie<de;Ie++){let rt=!1;if(Ie!==0&&(rt=t.readBoolean()),rt){Ie===de&&t.readUEG(),t.readBoolean(),t.readUEG();let tt=0;for(let xe=0;xe<=M;xe++){const ht=t.readBoolean();let _t=!1;ht||(_t=t.readBoolean()),(ht||_t)&&tt++}M=tt}else{const tt=t.readUEG(),xe=t.readUEG();M=tt+xe;for(let ht=0;ht<tt;ht++)t.readUEG(),t.readBoolean();for(let ht=0;ht<xe;ht++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ie=t.readUEG();for(let rt=0;rt<Ie;rt++){for(let tt=0;tt<te+4;tt++)t.readBits(1);t.readBits(1)}}let v=0,w=1,R=1,C=!0,O=1,G=0;t.readBoolean(),t.readBoolean();let z=!1;if(t.readBoolean()){if(t.readBoolean()){const et=t.readUByte(),Ve=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],fe=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];et>0&&et<16?(w=Ve[et-1],R=fe[et-1]):et===255&&(w=t.readBits(16),R=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),z=t.readBoolean(),z&&(T+=t.readUEG(),k+=t.readUEG(),I+=t.readUEG(),F+=t.readUEG()),t.readBoolean()&&(O=t.readBits(32),G=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const fe=t.readBoolean(),be=t.readBoolean();let Ue=!1;(fe||be)&&(Ue=t.readBoolean(),Ue&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Ue&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let ge=0;ge<=n;ge++){C=t.readBoolean();const Je=C||t.readBoolean();let ut=!1;Je?t.readEG():ut=t.readBoolean();const st=ut?1:t.readUEG()+1;if(fe)for(let We=0;We<st;We++)t.readUEG(),t.readUEG(),Ue&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(be)for(let We=0;We<st;We++)t.readUEG(),t.readUEG(),Ue&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),v=t.readUEG())}let ie=L,se=N;if(P||z){let Ie=1,rt=1;x===1?Ie=rt=2:x==2&&(Ie=2),ie=L-Ie*k-Ie*T,se=N-rt*F-rt*I}const Se=i?["A","B","C"][i]:"",we=d<<24|u<<16|c<<8|l;let Pe=0;for(let Ie=0;Ie<32;Ie++)Pe=(Pe|(we>>Ie&1)<<31-Ie)>>>0;let Ge=Pe.toString(16);return r===1&&Ge==="2"&&(Ge="6"),{codecString:`hvc1.${Se}${r}.${Ge}.${s?"H":"L"}${_}.B0`,params:{general_tier_flag:s,general_profile_idc:r,general_profile_space:i,general_profile_compatibility_flags:[d,u,c,l],general_constraint_indicator_flags:[h,o,f,p,m,y],general_level_idc:_,bit_depth:V+8,bit_depth_luma_minus8:V,bit_depth_chroma_minus8:ne,min_spatial_segmentation_idc:v,chroma_format_idc:x,frame_rate:{fixed:C,fps:G/O}},width:ie,height:se,pixelRatio:[w,R]}}readPPS(e){const t=new mr(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const i=t.readBoolean(),s=t.readBoolean();let r=1;return s&&i?r=0:s?r=3:i&&(r=2),{parallelismType:r}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Ln=188;class Ti{constructor(e,t,n,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=i,this.videoParser=null}static probe(e,t){const n=Ti.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(Ln*5,t-Ln)+1,i=0;for(;i<n;){let s=!1,r=-1,d=0;for(let u=i;u<t;u+=Ln)if(e[u]===71&&(t-u===Ln||e[u+Ln]===71)){if(d++,r===-1&&(r=u,r!==0&&(n=Math.min(r+Ln*99,e.length-Ln)+1)),s||(s=co(e,u)===0),s&&d>1&&(r===0&&d>2||u+Ln>n))return r}else{if(d)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:vu[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Ti.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=Ti.createTrack("audio",i),this._id3Track=Ti.createTrack("id3"),this._txtTrack=Ti.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,i=!1){n||(this.sampleAes=null);let s;const r=this._videoTrack,d=this._audioTrack,u=this._id3Track,c=this._txtTrack;let l=r.pid,h=r.pesData,o=d.pid,f=u.pid,p=d.pesData,m=u.pesData,y=null,_=this.pmtParsed,S=this._pmtId,b=e.length;if(this.remainderData&&(e=Qn(this.remainderData,e),b=e.length,this.remainderData=null),b<Ln&&!i)return this.remainderData=e,{audioTrack:d,videoTrack:r,id3Track:u,textTrack:c};const x=Math.max(0,Ti.syncOffset(e));b-=(b-x)%Ln,b<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,b,e.buffer.byteLength-b));let L=0;for(let P=x;P<b;P+=Ln)if(e[P]===71){const T=!!(e[P+1]&64),k=co(e,P),I=(e[P+3]&48)>>4;let F;if(I>1){if(F=P+5+e[P+4],F===P+Ln)continue}else F=P+4;switch(k){case l:if(T){if(h&&(s=qi(h,this.logger))){if(this.videoParser===null)switch(r.segmentCodec){case"avc":this.videoParser=new Fd;break;case"hevc":this.videoParser=new Nd;break}this.videoParser!==null&&this.videoParser.parsePES(r,c,s,!1)}h={data:[],size:0}}h&&(h.data.push(e.subarray(F,P+Ln)),h.size+=P+Ln-F);break;case o:if(T){if(p&&(s=qi(p,this.logger)))switch(d.segmentCodec){case"aac":this.parseAACPES(d,s);break;case"mp3":this.parseMPEGPES(d,s);break;case"ac3":this.parseAC3PES(d,s);break}p={data:[],size:0}}p&&(p.data.push(e.subarray(F,P+Ln)),p.size+=P+Ln-F);break;case f:T&&(m&&(s=qi(m,this.logger))&&this.parseID3PES(u,s),m={data:[],size:0}),m&&(m.data.push(e.subarray(F,P+Ln)),m.size+=P+Ln-F);break;case 0:T&&(F+=e[F]+1),S=this._pmtId=hb(e,F);break;case S:{T&&(F+=e[F]+1);const V=fb(e,F,this.typeSupported,n,this.observer,this.logger);l=V.videoPid,l>0&&(r.pid=l,r.segmentCodec=V.segmentVideoCodec),o=V.audioPid,o>0&&(d.pid=o,d.segmentCodec=V.segmentAudioCodec),f=V.id3Pid,f>0&&(u.pid=f),y!==null&&!_&&(this.logger.warn(`MPEG-TS PMT found at ${P} after unknown PID '${y}'. Backtracking to sync byte @${x} to parse all TS packets.`),y=null,P=x-188),_=this.pmtParsed=!0;break}case 17:case 8191:break;default:y=k;break}}else L++;L>0&&uo(this.observer,new Error(`Found ${L} TS packet/s that do not start with 0x47`),void 0,this.logger),r.pesData=h,d.pesData=p,u.pesData=m;const N={audioTrack:d,videoTrack:r,id3Track:u,textTrack:c};return i&&this.extractRemainingSamples(N),N}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:i,textTrack:s}=e,r=n.pesData,d=t.pesData,u=i.pesData;let c;if(r&&(c=qi(r,this.logger))){if(this.videoParser===null)switch(n.segmentCodec){case"avc":this.videoParser=new Fd;break;case"hevc":this.videoParser=new Nd;break}this.videoParser!==null&&(this.videoParser.parsePES(n,s,c,!0),n.pesData=null)}else n.pesData=r;if(d&&(c=qi(d,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else d!=null&&d.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=d;u&&(c=qi(u,this.logger))?(this.parseID3PES(i,c),i.pesData=null):i.pesData=u}demuxSampleAes(e,t,n){const i=this.demux(e,n,!0,!this.config.progressive),s=this.sampleAes=new ub(this.observer,this.config,t);return this.decrypt(i,s)}decrypt(e,t){return new Promise(n=>{const{audioTrack:i,videoTrack:s}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{n(e)}):n(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const i=this.aacOverFlow;let s=t.data;if(i){this.aacOverFlow=null;const h=i.missing,o=i.sample.unit.byteLength;if(h===-1)s=Qn(i.sample.unit,s);else{const f=o-h;i.sample.unit.set(s.subarray(0,h),f),e.samples.push(i.sample),n=i.missing}}let r,d;for(r=n,d=s.length;r<d-1&&!Cs(s,r);r++);if(r!==n){let h;const o=r<d-1;if(o?h=`AAC PES did not start with ADTS header,offset:${r}`:h="No ADTS header found in AAC PES",uo(this.observer,new Error(h),o,this.logger),!o)return}eh(e,this.observer,s,r,this.audioCodec);let u;if(t.pts!==void 0)u=t.pts;else if(i){const h=th(e.samplerate);u=i.sample.pts+h}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,l;for(;r<d;)if(l=nh(e,s,r,u,c),r+=l.length,l.missing){this.aacOverFlow=l;break}else for(c++;r<d-1&&!Cs(s,r);r++);}parseMPEGPES(e,t){const n=t.data,i=n.length;let s=0,r=0;const d=t.pts;if(d===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;r<i;)if(oh(n,r)){const u=sh(e,n,r,d,s);if(u)r+=u.length,s++;else break}else r++}parseAC3PES(e,t){{const n=t.data,i=t.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=n.length;let r=0,d=0,u;for(;d<s&&(u=ch(e,n,d,i,r++))>0;)d+=u}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=nn({},t,{type:this._videoTrack?Vn.emsg:Vn.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function co(a,e){return((a[e+1]&31)<<8)+a[e+2]}function hb(a,e){return(a[e+10]&31)<<8|a[e+11]}function fb(a,e,t,n,i,s){const r={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},d=(a[e+1]&15)<<8|a[e+2],u=e+3+d-4,c=(a[e+10]&15)<<8|a[e+11];for(e+=12+c;e<u;){const l=co(a,e),h=(a[e+3]&15)<<8|a[e+4];switch(a[e]){case 207:if(!n){Da("ADTS AAC",s);break}case 15:r.audioPid===-1&&(r.audioPid=l);break;case 21:r.id3Pid===-1&&(r.id3Pid=l);break;case 219:if(!n){Da("H.264",s);break}case 27:r.videoPid===-1&&(r.videoPid=l);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):r.audioPid===-1&&(r.audioPid=l,r.segmentAudioCodec="mp3");break;case 193:if(!n){Da("AC-3",s);break}case 129:t.ac3?r.audioPid===-1&&(r.audioPid=l,r.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(r.audioPid===-1&&h>0){let o=e+5,f=h;for(;f>2;){switch(a[o]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(r.audioPid=l,r.segmentAudioCodec="ac3");break}const m=a[o+1]+2;o+=m,f-=m}}break;case 194:case 135:return uo(i,new Error("Unsupported EC-3 in M2TS found"),void 0,s),r;case 36:r.videoPid===-1&&(r.videoPid=l,r.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=h+5}return r}function uo(a,e,t,n){n.warn(`parsing error: ${e.message}`),a.emit($.ERROR,$.ERROR,{type:xt.MEDIA_ERROR,details:Me.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Da(a,e){e.log(`${a} with AES-128-CBC encryption found in unencrypted stream`)}function qi(a,e){let t=0,n,i,s,r,d;const u=a.data;if(!a||a.size===0)return null;for(;u[0].length<19&&u.length>1;)u[0]=Qn(u[0],u[1]),u.splice(1,1);if(n=u[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(i=(n[4]<<8)+n[5],i&&i>a.size-6)return null;const l=n[7];l&192&&(r=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,l&64?(d=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,r-d>60*9e4&&(e.warn(`${Math.round((r-d)/9e4)}s delta between PTS and DTS, align them`),r=d)):d=r),s=n[8];let h=s+9;if(a.size<=h)return null;a.size-=h;const o=new Uint8Array(a.size);for(let f=0,p=u.length;f<p;f++){n=u[f];let m=n.byteLength;if(h)if(h>m){h-=m;continue}else n=n.subarray(h),m-=h,h=0;o.set(n,t),t+=m}return i&&(i-=s+3),{data:o,pts:r,dts:d,len:i}}return null}class pb{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const bi=Math.pow(2,32)-1;class De{static init(){De.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in De.types)De.types.hasOwnProperty(e)&&(De.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);De.HDLR_TYPES={video:t,audio:n};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);De.STTS=De.STSC=De.STCO=s,De.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),De.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),De.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),De.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const r=new Uint8Array([105,115,111,109]),d=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);De.FTYP=De.box(De.types.ftyp,r,u,r,d),De.DINF=De.box(De.types.dinf,De.box(De.types.dref,i))}static box(e,...t){let n=8,i=t.length;const s=i;for(;i--;)n+=t[i].byteLength;const r=new Uint8Array(n);for(r[0]=n>>24&255,r[1]=n>>16&255,r[2]=n>>8&255,r[3]=n&255,r.set(e,4),i=0,n=8;i<s;i++)r.set(t[i],n),n+=t[i].byteLength;return r}static hdlr(e){return De.box(De.types.hdlr,De.HDLR_TYPES[e])}static mdat(e){return De.box(De.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(bi+1)),i=Math.floor(t%(bi+1));return De.box(De.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return De.box(De.types.mdia,De.mdhd(e.timescale||0,e.duration||0),De.hdlr(e.type),De.minf(e))}static mfhd(e){return De.box(De.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?De.box(De.types.minf,De.box(De.types.smhd,De.SMHD),De.DINF,De.stbl(e)):De.box(De.types.minf,De.box(De.types.vmhd,De.VMHD),De.DINF,De.stbl(e))}static moof(e,t,n){return De.box(De.types.moof,De.mfhd(e),De.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=De.trak(e[t]);return De.box.apply(null,[De.types.moov,De.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(De.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=De.trex(e[t]);return De.box.apply(null,[De.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(bi+1)),i=Math.floor(t%(bi+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return De.box(De.types.mvhd,s)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let i,s;for(i=0;i<t.length;i++)s=t[i].flags,n[i+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return De.box(De.types.sdtp,n)}static stbl(e){return De.box(De.types.stbl,De.stsd(e),De.box(De.types.stts,De.STTS),De.box(De.types.stsc,De.STSC),De.box(De.types.stsz,De.STSZ),De.box(De.types.stco,De.STCO))}static avc1(e){let t=[],n=[],i,s,r;for(i=0;i<e.sps.length;i++)s=e.sps[i],r=s.byteLength,t.push(r>>>8&255),t.push(r&255),t=t.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)s=e.pps[i],r=s.byteLength,n.push(r>>>8&255),n.push(r&255),n=n.concat(Array.prototype.slice.call(s));const d=De.box(De.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),u=e.width,c=e.height,l=e.pixelRatio[0],h=e.pixelRatio[1];return De.box(De.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,De.box(De.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),De.box(De.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,l&255,h>>24,h>>16&255,h>>8&255,h&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return De.box(De.types.mp4a,De.audioStsd(e),De.box(De.types.esds,De.esds(e)))}static mp3(e){return De.box(De.types[".mp3"],De.audioStsd(e))}static ac3(e){return De.box(De.types["ac-3"],De.audioStsd(e),De.box(De.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return De.box(De.types.stsd,De.STSD,De.mp4a(e));if(t==="ac3"&&e.config)return De.box(De.types.stsd,De.STSD,De.ac3(e));if(t==="mp3"&&e.codec==="mp3")return De.box(De.types.stsd,De.STSD,De.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return De.box(De.types.stsd,De.STSD,De.avc1(e));if(t==="hevc"&&e.vps)return De.box(De.types.stsd,De.STSD,De.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),i=e.width||0,s=e.height||0,r=Math.floor(n/(bi+1)),d=Math.floor(n%(bi+1));return De.box(De.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,d>>24,d>>16&255,d>>8&255,d&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const n=De.sdtp(e),i=e.id,s=Math.floor(t/(bi+1)),r=Math.floor(t%(bi+1));return De.box(De.types.traf,De.box(De.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),De.box(De.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255])),De.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,De.box(De.types.trak,De.tkhd(e),De.mdia(e))}static trex(e){const t=e.id;return De.box(De.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],i=n.length,s=12+16*i,r=new Uint8Array(s);let d,u,c,l,h,o;for(t+=8+s,r.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),d=0;d<i;d++)u=n[d],c=u.duration,l=u.size,h=u.flags,o=u.cts,r.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,l>>>24&255,l>>>16&255,l>>>8&255,l&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,h.degradPrio&61440,h.degradPrio&15,o>>>24&255,o>>>16&255,o>>>8&255,o&255],12+16*d);return De.box(De.types.trun,r)}static initSegment(e){De.types||De.init();const t=De.moov(e);return Qn(De.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],i=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),i-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let r=s.length;for(let p=0;p<n.length;p+=1){r+=3;for(let m=0;m<n[p].length;m+=1)r+=2+n[p][m].length}const d=new Uint8Array(r);d.set(s,0),r=s.length;const u=n.length-1;for(let p=0;p<n.length;p+=1){d.set(new Uint8Array([32+p|(p===u?128:0),0,n[p].length]),r),r+=3;for(let m=0;m<n[p].length;m+=1)d.set(new Uint8Array([n[p][m].length>>8,n[p][m].length&255]),r),r+=2,d.set(n[p][m],r),r+=n[p][m].length}const c=De.box(De.types.hvcC,d),l=e.width,h=e.height,o=e.pixelRatio[0],f=e.pixelRatio[1];return De.box(De.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,De.box(De.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),De.box(De.types.pasp,new Uint8Array([o>>24,o>>16&255,o>>8&255,o&255,f>>24,f>>16&255,f>>8&255,f&255])))}}De.types=void 0;De.HDLR_TYPES=void 0;De.STTS=void 0;De.STSC=void 0;De.STCO=void 0;De.STSZ=void 0;De.VMHD=void 0;De.SMHD=void 0;De.STSD=void 0;De.FTYP=void 0;De.DINF=void 0;const hh=9e4;function Jo(a,e,t=1,n=!1){const i=a*e*t;return n?Math.round(i):i}function mb(a,e,t=1,n=!1){return Jo(a,e,1/t,n)}function ur(a,e=!1){return Jo(a,1e3,1/hh,e)}function gb(a,e=1){return Jo(a,hh,1/e)}const yb=10*1e3,_b=1024,Ab=1152,vb=1536;let zi=null,Pa=null;function Ud(a,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:a?2:1,isNonSync:a?0:1}}}class rs{constructor(e,t,n,i){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=i,this.ISGenerated=!1,zi===null){const r=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);zi=r?parseInt(r[1]):0}if(Pa===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);Pa=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,i=e.reduce((s,r)=>{let d=r.pts,u=d-s;return u<-4294967296&&(t=!0,d=Wn(d,n),u=d-s),u>0?s:d},n);return t&&this.logger.debug("PTS rollover detected"),i}remux(e,t,n,i,s,r,d,u){let c,l,h,o,f,p,m=s,y=s;const _=e.pid>-1,S=t.pid>-1,b=t.samples.length,x=e.samples.length>0,L=d&&b>0||b>1;if((!_||x)&&(!S||L)||this.ISGenerated||d){if(this.ISGenerated){var P,T,k,I;const te=this.videoTrackConfig;(te&&(t.width!==te.width||t.height!==te.height||((P=t.pixelRatio)==null?void 0:P[0])!==((T=te.pixelRatio)==null?void 0:T[0])||((k=t.pixelRatio)==null?void 0:k[1])!==((I=te.pixelRatio)==null?void 0:I[1]))||!te&&L||this.nextAudioPts===null&&x)&&this.resetInitSegment()}this.ISGenerated||(h=this.generateIS(e,t,s,r));const F=this.isVideoContiguous;let V=-1,ne;if(L&&(V=bb(t.samples),!F&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,V>0){this.logger.warn(`[mp4-remuxer]: Dropped ${V} out of ${b} video samples due to a missing keyframe`);const te=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(V),t.dropped+=V,y+=(t.samples[0].pts-te)/t.inputTimeScale,ne=y}else V===-1&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${b} video samples`),p=!1);if(this.ISGenerated){if(x&&L){const te=this.getVideoStartPts(t.samples),Q=(Wn(e.samples[0].pts,te)-te)/t.inputTimeScale;m+=Math.max(0,Q),y+=Math.max(0,-Q)}if(x){if(e.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),h=this.generateIS(e,t,s,r)),l=this.remuxAudio(e,m,this.isAudioContiguous,r,S||L||u===bt.AUDIO?y:void 0),L){const te=l?l.endPTS-l.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),h=this.generateIS(e,t,s,r)),c=this.remuxVideo(t,y,F,te)}}else L&&(c=this.remuxVideo(t,y,F,0));c&&(c.firstKeyFrame=V,c.independent=V!==-1,c.firstKeyFramePTS=ne)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(f=fh(n,s,this._initPTS,this._initDTS)),i.samples.length&&(o=ph(i,s,this._initPTS))),{audio:l,video:c,initSegment:h,independent:p,text:o,id3:f}}generateIS(e,t,n,i){const s=e.samples,r=t.samples,d=this.typeSupported,u={},c=this._initPTS;let l=!c||i,h="audio/mp4",o,f,p,m;if(l&&(o=f=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":d.mpeg?(h="audio/mpeg",e.codec=""):d.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}u.audio={id:"audio",container:h,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&d.mpeg?new Uint8Array(0):De.initSegment([e]),metadata:{channelCount:e.channelCount}},l&&(m=e.id,p=e.inputTimeScale,!c||p!==c.timescale?o=f=s[0].pts-Math.round(p*n):l=!1)}if(t.sps&&t.pps&&r.length){if(t.timescale=t.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:De.initSegment([t]),metadata:{width:t.width,height:t.height}},l)if(m=t.id,p=t.inputTimeScale,!c||p!==c.timescale){const y=this.getVideoStartPts(r),_=Math.round(p*n);f=Math.min(f,Wn(r[0].dts,y)-_),o=Math.min(o,y-_)}else l=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(u).length)return this.ISGenerated=!0,l?(this._initPTS={baseTime:o,timescale:p},this._initDTS={baseTime:f,timescale:p}):o=p=void 0,{tracks:u,initPTS:o,timescale:p,trackId:m}}remuxVideo(e,t,n,i){const s=e.inputTimeScale,r=e.samples,d=[],u=r.length,c=this._initPTS;let l=this.nextAvcDts,h=8,o=this.videoSampleDuration,f,p,m=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,_=!1;if(!n||l===null){const M=t*s,A=r[0].pts-Wn(r[0].dts,r[0].pts);zi&&l!==null&&Math.abs(M-A-l)<15e3?n=!0:l=M-A}const S=c.baseTime*s/c.timescale;for(let M=0;M<u;M++){const A=r[M];A.pts=Wn(A.pts-S,l),A.dts=Wn(A.dts-S,l),A.dts<r[M>0?M-1:M].dts&&(_=!0)}_&&r.sort(function(M,A){const v=M.dts-A.dts,w=M.pts-A.pts;return v||w}),f=r[0].dts,p=r[r.length-1].dts;const b=p-f,x=b?Math.round(b/(u-1)):o||e.inputTimeScale/30;if(n){const M=f-l,A=M>x,v=M<-1;if((A||v)&&(A?this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ur(M,!0)} ms (${M}dts) hole between fragments detected at ${t.toFixed(3)}`):this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ur(-M,!0)} ms (${M}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!v||l>=r[0].pts||zi)){f=l;const w=r[0].pts-M;if(A)r[0].dts=f,r[0].pts=w;else{let R=!0;for(let C=0;C<r.length&&!(r[C].dts>w&&R);C++){const O=r[C].pts;if(r[C].dts-=M,r[C].pts-=M,C<r.length-1){const G=r[C+1].pts,z=r[C].pts,Y=G<=z,ie=G<=O;R=Y==ie}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${ur(w,!0)}/${ur(f,!0)}, delta: ${ur(M,!0)} ms`)}}f=Math.max(0,f);let L=0,N=0,P=f;for(let M=0;M<u;M++){const A=r[M],v=A.units,w=v.length;let R=0;for(let C=0;C<w;C++)R+=v[C].data.length;N+=R,L+=w,A.length=R,A.dts<P?(A.dts=P,P+=x/4|0||1):P=A.dts,m=Math.min(A.pts,m),y=Math.max(A.pts,y)}p=r[u-1].dts;const T=N+4*L+8;let k;try{k=new Uint8Array(T)}catch(M){this.observer.emit($.ERROR,$.ERROR,{type:xt.MUX_ERROR,details:Me.REMUX_ALLOC_ERROR,fatal:!1,error:M,bytes:T,reason:`fail allocating video mdat ${T}`});return}const I=new DataView(k.buffer);I.setUint32(0,T),k.set(De.types.mdat,4);let F=!1,V=Number.POSITIVE_INFINITY,ne=Number.POSITIVE_INFINITY,te=Number.NEGATIVE_INFINITY,Z=Number.NEGATIVE_INFINITY;for(let M=0;M<u;M++){const A=r[M],v=A.units;let w=0;for(let O=0,G=v.length;O<G;O++){const z=v[O],Y=z.data,ie=z.data.byteLength;I.setUint32(h,ie),h+=4,k.set(Y,h),h+=ie,w+=4+ie}let R;if(M<u-1)o=r[M+1].dts-A.dts,R=r[M+1].pts-A.pts;else{const O=this.config,G=M>0?A.dts-r[M-1].dts:x;if(R=M>0?A.pts-r[M-1].pts:x,O.stretchShortVideoTrack&&this.nextAudioPts!==null){const z=Math.floor(O.maxBufferHole*s),Y=(i?m+i*s:this.nextAudioPts)-A.pts;Y>z?(o=Y-G,o<0?o=G:F=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${Y/90} ms to the next segment; using duration ${o/90} ms for the last video frame.`)):o=G}else o=G}const C=Math.round(A.pts-A.dts);V=Math.min(V,o),te=Math.max(te,o),ne=Math.min(ne,R),Z=Math.max(Z,R),d.push(Ud(A.key,o,w,C))}if(d.length){if(zi){if(zi<70){const M=d[0].flags;M.dependsOn=2,M.isNonSync=0}}else if(Pa&&Z-ne<te-V&&x/te<.025&&d[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let M=f;for(let A=0,v=d.length;A<v;A++){const w=M+d[A].duration,R=M+d[A].cts;if(A<v-1){const C=w+d[A+1].cts;d[A].duration=C-R}else d[A].duration=A?d[A-1].duration:x;d[A].cts=0,M=w}}}o=F||!o?x:o,this.nextAvcDts=l=p+o,this.videoSampleDuration=o,this.isVideoContiguous=!0;const de={data1:De.moof(e.sequenceNumber++,f,nn(e,{samples:d})),data2:k,startPTS:m/s,endPTS:(y+o)/s,startDTS:f/s,endDTS:l/s,type:"video",hasAudio:!1,hasVideo:!0,nb:d.length,dropped:e.dropped};return e.samples=[],e.dropped=0,de}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return Ab;case"ac3":return vb;default:return _b}}remuxAudio(e,t,n,i,s){const r=e.inputTimeScale,d=e.samplerate?e.samplerate:r,u=r/d,c=this.getSamplesPerFrame(e),l=c*u,h=this._initPTS,o=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,f=[],p=s!==void 0;let m=e.samples,y=o?0:8,_=this.nextAudioPts||-1;const S=t*r,b=h.baseTime*r/h.timescale;if(this.isAudioContiguous=n=n||m.length&&_>0&&(i&&Math.abs(S-_)<9e3||Math.abs(Wn(m[0].pts-b,S)-_)<20*l),m.forEach(function(Q){Q.pts=Wn(Q.pts-b,S)}),!n||_<0){if(m=m.filter(Q=>Q.pts>=0),!m.length)return;s===0?_=0:i&&!p?_=Math.max(0,S):_=m[0].pts}if(e.segmentCodec==="aac"){const Q=this.config.maxAudioFramesDrift;for(let he=0,de=_;he<m.length;he++){const M=m[he],A=M.pts,v=A-de,w=Math.abs(1e3*v/r);if(v<=-Q*l&&p)he===0&&(this.logger.warn(`Audio frame @ ${(A/r).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*v/r)} ms.`),this.nextAudioPts=_=de=A);else if(v>=Q*l&&w<yb&&p){let R=Math.round(v/l);de=A-R*l,de<0&&(R--,de+=l),he===0&&(this.nextAudioPts=_=de),this.logger.warn(`[mp4-remuxer]: Injecting ${R} audio frame @ ${(de/r).toFixed(3)}s due to ${Math.round(1e3*v/r)} ms gap.`);for(let C=0;C<R;C++){const O=Math.max(de,0);let G=pb.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);G||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),G=M.unit.subarray()),m.splice(he,0,{unit:G,pts:O}),de+=l,he++}}M.pts=de,de+=l}}let x=null,L=null,N,P=0,T=m.length;for(;T--;)P+=m[T].unit.byteLength;for(let Q=0,he=m.length;Q<he;Q++){const de=m[Q],M=de.unit;let A=de.pts;if(L!==null){const w=f[Q-1];w.duration=Math.round((A-L)/u)}else if(n&&e.segmentCodec==="aac"&&(A=_),x=A,P>0){P+=y;try{N=new Uint8Array(P)}catch(w){this.observer.emit($.ERROR,$.ERROR,{type:xt.MUX_ERROR,details:Me.REMUX_ALLOC_ERROR,fatal:!1,error:w,bytes:P,reason:`fail allocating audio mdat ${P}`});return}o||(new DataView(N.buffer).setUint32(0,P),N.set(De.types.mdat,4))}else return;N.set(M,y);const v=M.byteLength;y+=v,f.push(Ud(!0,c,v,0)),L=A}const k=f.length;if(!k)return;const I=f[f.length-1];this.nextAudioPts=_=L+u*I.duration;const F=o?new Uint8Array(0):De.moof(e.sequenceNumber++,x/u,nn({},e,{samples:f}));e.samples=[];const V=x/r,ne=_/r,Z={data1:F,data2:N,startPTS:V,endPTS:ne,startDTS:V,endDTS:ne,type:"audio",hasAudio:!0,hasVideo:!1,nb:k};return this.isAudioContiguous=!0,Z}}function Wn(a,e){let t;if(e===null)return a;for(e<a?t=-8589934592:t=8589934592;Math.abs(a-e)>4294967296;)a+=t;return a}function bb(a){for(let e=0;e<a.length;e++)if(a[e].key)return e;return-1}function fh(a,e,t,n){const i=a.samples.length;if(!i)return;const s=a.inputTimeScale;for(let d=0;d<i;d++){const u=a.samples[d];u.pts=Wn(u.pts-t.baseTime*s/t.timescale,e*s)/s,u.dts=Wn(u.dts-n.baseTime*s/n.timescale,e*s)/s}const r=a.samples;return a.samples=[],{samples:r}}function ph(a,e,t){const n=a.samples.length;if(!n)return;const i=a.inputTimeScale;for(let r=0;r<n;r++){const d=a.samples[r];d.pts=Wn(d.pts-t.baseTime*i/t.timescale,e*i)/i}a.samples.sort((r,d)=>r.pts-d.pts);const s=a.samples;return a.samples=[],{samples:s}}class Sb{constructor(e,t,n,i){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1,this.logger=i}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,i){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(gA(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const i=this.initData=Eu(e);i.audio&&(t=$d(i.audio,ln.AUDIO,this.logger)),i.video&&(n=$d(i.video,ln.VIDEO,this.logger));const s={};i.audio&&i.video?s.audiovideo={container:"video/mp4",codec:t+","+n,supplemental:i.video.supplemental,initSegment:e,id:"main"}:i.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?s.video={container:"video/mp4",codec:n,supplemental:i.video.supplemental,initSegment:e,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,n,i,s,r){var d,u;let{initPTS:c,lastEndTime:l}=this;const h={audio:void 0,video:void 0,text:i,id3:n,initSegment:void 0};pt(l)||(l=this.lastEndTime=s||0);const o=t.samples;if(!(o!=null&&o.length))return h;const f={initPTS:void 0,timescale:void 0,trackId:void 0};let p=this.initData;if((d=p)!=null&&d.length||(this.generateInitSegment(o),p=this.initData),!((u=p)!=null&&u.length))return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),h;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const m=yA(o,p,this.logger),y=p.audio?m[p.audio.id]:null,_=p.video?m[p.video.id]:null,S=$r(_,1/0),b=$r(y,1/0),x=$r(_,0,!0),L=$r(y,0,!0);let N,P=s,T=0;if(y&&(!_||!c&&b<S||c&&c.trackId===p.audio.id)?(f.trackId=p.audio.id,N=y,T=L-b):_&&(f.trackId=p.video.id,N=_,T=x-S),N){const Q=N.timescale;P=N.start/Q,f.timescale=Q,c||(f.initPTS=N.start-s*Q,this.initPTS=c={baseTime:f.initPTS,timescale:Q,trackId:f.trackId})}(r||!c)&&(Eb(c,P,s,T)||f.timescale!==c.timescale)&&(f.initPTS=P-s,c&&c.timescale===1&&this.logger.warn(`Adjusting initPTS @${s} from ${c.baseTime/c.timescale} to ${f.initPTS}`),this.initPTS=c={baseTime:f.initPTS,timescale:1});const k=e?P-c.baseTime/c.timescale:l;_A(p,o,c.baseTime/c.timescale);const I=k+T;T>0?this.lastEndTime=I:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const F=!!p.audio,V=!!p.video;let ne="";F&&(ne+="audio"),V&&(ne+="video");const te={data1:o,startPTS:k,startDTS:k,endPTS:I,endDTS:I,type:ne,hasAudio:F,hasVideo:V,nb:1,dropped:0};h.audio=F&&!V?te:void 0,h.video=V?te:void 0;const Z=_==null?void 0:_.sampleCount;if(Z){const Q=_.keyFrameIndex,he=Q!==-1;te.nb=Z,te.dropped=Q===0||this.isVideoContiguous?0:he?Q:Z,te.independent=he,te.firstKeyFrame=Q,he&&_.keyFrameStart&&(te.firstKeyFramePTS=_.keyFrameStart-c.baseTime/c.timescale),this.isVideoContiguous||(h.independent=he),this.isVideoContiguous||(this.isVideoContiguous=he),te.dropped&&this.logger.warn(`fmp4 does not start with IDR: firstIDR ${Q}/${Z} dropped: ${te.dropped} pts: ${te.firstKeyFramePTS||"NA"}`)}return h.initSegment=f,h.id3=fh(n,s,c,c),i.samples.length&&(h.text=ph(i,s,c)),h}}function $r(a,e,t=!1){return(a==null?void 0:a.start)!==void 0?(a.start+(t?a.duration:0))/a.timescale:e}function Eb(a,e,t,n){if(a===null)return!0;const i=Math.max(n,1),s=e-a.baseTime/a.timescale;return Math.abs(s-t)>i}function $d(a,e,t){const n=a==null?void 0:a.codec;return n&&n.length>4?n:e===ln.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?As(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let _i;try{_i=self.performance.now.bind(self.performance)}catch{_i=Date.now}const ss=[{demux:cb,remux:Sb},{demux:Ti,remux:rs},{demux:ab,remux:rs},{demux:lb,remux:rs}];ss.splice(2,0,{demux:ob,remux:rs});class Gd{constructor(e,t,n,i,s,r){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=s,this.logger=r}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,i){const s=n.transmuxing;s.executeStart=_i();let r=new Uint8Array(e);const{currentTransmuxState:d,transmuxConfig:u}=this;i&&(this.currentTransmuxState=i);const{contiguous:c,discontinuity:l,trackSwitch:h,accurateTimeOffset:o,timeOffset:f,initSegmentChange:p}=i||d,{audioCodec:m,videoCodec:y,defaultInitPts:_,duration:S,initSegmentData:b}=u,x=Tb(r,t);if(x&&er(x.method)){const T=this.getDecrypter(),k=Vo(x.method);if(T.isSync()){let I=T.softwareDecrypt(r,x.key.buffer,x.iv.buffer,k);if(n.part>-1){const V=T.flush();I=V&&V.buffer}if(!I)return s.executeEnd=_i(),Oa(n);r=new Uint8Array(I)}else return this.asyncResult=!0,this.decryptionPromise=T.webCryptoDecrypt(r,x.key.buffer,x.iv.buffer,k).then(I=>{const F=this.push(I,null,n);return this.decryptionPromise=null,F}),this.decryptionPromise}const L=this.needsProbing(l,h);if(L){const T=this.configureTransmuxer(r);if(T)return this.logger.warn(`[transmuxer] ${T.message}`),this.observer.emit($.ERROR,$.ERROR,{type:xt.MEDIA_ERROR,details:Me.FRAG_PARSING_ERROR,fatal:!1,error:T,reason:T.message}),s.executeEnd=_i(),Oa(n)}(l||h||p||L)&&this.resetInitSegment(b,m,y,S,t),(l||p||L)&&this.resetInitialTimestamp(_),c||this.resetContiguity();const N=this.transmux(r,x,f,o,n);this.asyncResult=Tr(N);const P=this.currentTransmuxState;return P.contiguous=!0,P.discontinuity=!1,P.trackSwitch=!1,s.executeEnd=_i(),N}flush(e){const t=e.transmuxing;t.executeStart=_i();const{decrypter:n,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const r=[],{timeOffset:d}=i;if(n){const h=n.flush();h&&r.push(this.push(h.buffer,null,e))}const{demuxer:u,remuxer:c}=this;if(!u||!c){t.executeEnd=_i();const h=[Oa(e)];return this.asyncResult?Promise.resolve(h):h}const l=u.flush(d);return Tr(l)?(this.asyncResult=!0,l.then(h=>(this.flushRemux(r,h,e),r))):(this.flushRemux(r,l,e),this.asyncResult?Promise.resolve(r):r)}flushRemux(e,t,n){const{audioTrack:i,videoTrack:s,id3Track:r,textTrack:d}=t,{accurateTimeOffset:u,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===bt.MAIN?"level":"track"} ${n.level}`);const l=this.remuxer.remux(i,s,r,d,c,u,!0,this.id);e.push({remuxResult:l,chunkMeta:n}),n.transmuxing.executeEnd=_i()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,i,s){const{demuxer:r,remuxer:d}=this;!r||!d||(r.resetInitSegment(e,t,n,i),d.resetInitSegment(e,t,n,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,i,s){let r;return t&&t.method==="SAMPLE-AES"?r=this.transmuxSampleAes(e,t,n,i,s):r=this.transmuxUnencrypted(e,n,i,s),r}transmuxUnencrypted(e,t,n,i){const{audioTrack:s,videoTrack:r,id3Track:d,textTrack:u}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,r,d,u,t,n,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,n,i,s){return this.demuxer.demuxSampleAes(e,t,n).then(r=>({remuxResult:this.remuxer.remux(r.audioTrack,r.videoTrack,r.id3Track,r.textTrack,n,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:i}=this;let s;for(let h=0,o=ss.length;h<o;h++){var r;if((r=ss[h].demux)!=null&&r.probe(e,this.logger)){s=ss[h];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const d=this.demuxer,u=this.remuxer,c=s.remux,l=s.demux;(!u||!(u instanceof c))&&(this.remuxer=new c(n,t,i,this.logger)),(!d||!(d instanceof l))&&(this.demuxer=new l(n,t,i,this.logger),this.probe=l.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new $o(this.config)),e}}function Tb(a,e){let t=null;return a.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Oa=a=>({remuxResult:{},chunkMeta:a});function Tr(a){return"then"in a&&a.then instanceof Function}class xb{constructor(e,t,n,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=i,this.defaultInitPts=s||null}}class Cb{constructor(e,t,n,i,s,r){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=r}}let Vd=0;class mh{constructor(e,t,n,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Vd++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=u=>{const c=u.data,l=this.hls;if(!(!l||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var h;const o=(h=this.workerContext)==null?void 0:h.objectURL;o&&self.URL.revokeObjectURL(o);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{l.logger[c.data.logType]&&l.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,l.trigger(c.event,c.data);break}}},this.onWorkerError=u=>{if(!this.hls)return;const c=new Error(`${u.message}  (${u.filename}:${u.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger($.ERROR,{type:xt.OTHER_ERROR,details:Me.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;const r=(u,c)=>{c=c||{},c.frag=this.frag||void 0,u===$.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(u,c)};this.observer=new qo,this.observer.on($.FRAG_DECRYPTED,r),this.observer.on($.ERROR,r);const d=rd(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const u=this.hls.logger;if(s.workerPath||Dv()){try{s.workerPath?(u.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=Ov(s.workerPath)):(u.log(`injecting Web Worker for "${t}"`),this.workerContext=Pv());const{worker:l}=this.workerContext;l.addEventListener("message",this.onWorkerMessage),l.addEventListener("error",this.onWorkerError),l.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:d,id:t,config:An(s)})}catch(l){u.warn(`Error setting up "${t}" Web Worker, fallback to inline`,l),this.terminateWorker(),this.error=null,this.transmuxer=new Gd(this.observer,d,s,"",t,e.logger)}return}}this.transmuxer=new Gd(this.observer,d,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Vd++;const t=this.hls.config,n=rd(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:An(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Mv(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,i,s,r,d,u,c,l){var h,o;c.transmuxing.start=self.performance.now();const{instanceNo:f,transmuxer:p}=this,m=r?r.start:s.start,y=s.decryptdata,_=this.frag,S=!(_&&s.cc===_.cc),b=!(_&&c.level===_.level),x=_?c.sn-_.sn:-1,L=this.part?c.part-this.part.index:-1,N=x===0&&c.id>1&&c.id===(_==null?void 0:_.stats.chunkCount),P=!b&&(x===1||x===0&&(L===1||N&&L<=0)),T=self.performance.now();(b||x||s.stats.parsing.start===0)&&(s.stats.parsing.start=T),r&&(L||!P)&&(r.stats.parsing.start=T);const k=!(_&&((h=s.initSegment)==null?void 0:h.url)===((o=_.initSegment)==null?void 0:o.url)),I=new Cb(S,P,u,b,m,k);if(!P||S||k){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===bt.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${S}
        trackSwitch: ${b}
        contiguous: ${P}
        accurateTimeOffset: ${u}
        timeOffset: ${m}
        initSegmentChange: ${k}`);const F=new xb(n,i,t,d,l);this.configureTransmuxer(F)}if(this.frag=s,this.part=r,this.workerContext)this.workerContext.worker.postMessage({instanceNo:f,cmd:"demux",data:e,decryptdata:y,chunkMeta:c,state:I},e instanceof ArrayBuffer?[e]:[]);else if(p){const F=p.push(e,y,c,I);Tr(F)?F.then(V=>{this.handleTransmuxComplete(V)}).catch(V=>{this.transmuxerError(V,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(F)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const i=n.flush(e);Tr(i)?i.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger($.ERROR,{type:xt.MEDIA_ERROR,details:Me.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const jd=100;class wb extends Ho{constructor(e,t,n){super(e,t,n,"audio-stream-controller",bt.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on($.LEVEL_LOADED,this.onLevelLoaded,this),e.on($.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on($.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on($.BUFFER_RESET,this.onBufferReset,this),e.on($.BUFFER_CREATED,this.onBufferCreated,this),e.on($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on($.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on($.FRAG_LOADING,this.onFragLoading,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off($.LEVEL_LOADED,this.onLevelLoaded,this),e.off($.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off($.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off($.BUFFER_RESET,this.onBufferReset,this),e.off($.BUFFER_CREATED,this.onBufferCreated,this),e.off($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off($.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off($.FRAG_LOADING,this.onFragLoading,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:s}){if(n===bt.MAIN){const r=t.cc,d=this.fragCurrent;if(this.initPTS[r]={baseTime:i,timescale:s},this.log(`InitPTS for cc: ${r} found from main: ${i}/${s}`),this.mainAnchor=t,this.state===Ke.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==r)&&this.syncWithAnchor(t,u==null?void 0:u.frag)}else!this.hls.hasEnoughToStart&&d&&d.cc!==r?(d.abortRequests(),this.syncWithAnchor(t,d)):this.state===Ke.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const i=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&(i==null?void 0:i.cc)===t.cc)return;const s=(i||e).cc,r=this.getLevelDetails(),d=this.getLoadPosition(),u=Mu(r,s,d);u&&(this.log(`Waiting fragment cc (${t==null?void 0:t.cc}) cancelled because video is at cc ${e.cc}`),this.startFragRequested=!1,this.nextLoadPosition=u.start,this.resetLoadingState(),this.state===Ke.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=Ke.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(jd),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=Ke.IDLE):this.state=Ke.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case Ke.IDLE:this.doTickIdle();break;case Ke.WAITING_TRACK:{const{levels:t,trackId:n}=this,i=t==null?void 0:t[n],s=i==null?void 0:i.details;if(s&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(s))break;this.state=Ke.WAITING_INIT_PTS}break}case Ke.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),n=this.retryDate;if(!n||t>=n||(e=this.media)!=null&&e.seeking){const{levels:i,trackId:s}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((i==null?void 0:i[s])||null),this.state=Ke.IDLE}break}case Ke.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:n,part:i,cache:s,complete:r}=t,d=this.mainAnchor;if(this.initPTS[n.cc]!==void 0){this.waitingData=null,this.state=Ke.FRAG_LOADING;const u=s.flush().buffer,c={frag:n,part:i,payload:u,networkDetails:null};this._handleFragmentLoadProgress(c),r&&super._handleFragmentLoadComplete(c)}else d&&d.cc!==t.frag.cc&&this.syncWithAnchor(d,t.frag)}else this.state=Ke.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:i,trackId:s}=this,r=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!r.startFragPrefetch)||!(n!=null&&n[s]))return;const d=n[s],u=d.details;if(!u||this.waitForLive(d)||this.waitForCdnTuneIn(u)){this.state=Ke.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,ln.AUDIO,bt.AUDIO));const l=this.getFwdBufferInfo(c,bt.AUDIO);if(l===null)return;if(!this.switchingTrack&&this._streamEnded(l,u)){t.trigger($.BUFFER_EOS,{type:"audio"}),this.state=Ke.ENDED;return}const h=l.len,o=t.maxBufferLength,f=u.fragments,p=f[0].start,m=this.getLoadPosition(),y=this.flushing?m:l.end;if(this.switchingTrack&&i){const b=m;u.PTSKnown&&b<p&&(l.end>p||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=p+.05)}if(h>=o&&!this.switchingTrack&&y<f[f.length-1].start)return;let _=this.getNextFragment(y,u);if(_&&this.isLoopLoading(_,y)&&(_=this.getNextFragmentLoopLoading(_,u,l,bt.MAIN,o)),!_){this.bufferFlushed=!0;return}let S=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&S&&Pn(_)&&!_.endList&&(!u.live||!this.loadingParts&&y<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(S)===Rn.OK&&(this.mainFragLoading=S=null),S&&Pn(S))){if(_.start>S.end){const x=this.fragmentTracker.getFragAtPos(y,bt.MAIN);x&&x.end>S.end&&(S=x,this.mainFragLoading={frag:x,targetBufferTime:null})}if(_.start>S.end)return}this.loadFragment(_,d,y)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new Ar(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==Ke.STOPPED&&(this.setInterval(jd),this.state=Ke.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded($.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:i}=this,{details:s,id:r,groupId:d,track:u}=t;if(!i){this.warn(`Audio tracks reset while loading track ${r} "${u.name}" of "${d}"`);return}const c=this.mainDetails;if(!c||s.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==Ke.STOPPED&&(this.state=Ke.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${r} "${u.name}" of "${d}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const l=i[r];let h=0;if(s.live||(n=l.details)!=null&&n.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(l.details){var o;h=this.alignPlaylists(s,l.details,(o=this.levelLastLoaded)==null?void 0:o.details)}s.alignedSliding||(Yu(s,c),s.alignedSliding||xs(s,c),h=s.fragmentStart)}l.details=s,this.levelLastLoaded=l,this.startFragRequested||this.setStartPosition(c,h),this.hls.trigger($.AUDIO_TRACK_UPDATED,{details:s,id:r,groupId:t.groupId}),this.state===Ke.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=Ke.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:s}=e,{config:r,trackId:d,levels:u}=this;if(!u){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const c=u[d];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const l=c.details;if(!l){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const h=r.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let o=this.transmuxer;o||(o=this.transmuxer=new mh(this.hls,bt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const f=this.initPTS[n.cc],p=(t=n.initSegment)==null?void 0:t.data;if(f!==void 0){const y=i?i.index:-1,_=y!==-1,S=new Go(n.level,n.sn,n.stats.chunkCount,s.byteLength,y,_);o.push(s,p,h,"",n,i,l.totalduration,!1,S,f)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${l.startSN} ,${l.endSN}],track ${d}`);const{cache:m}=this.waitingData=this.waitingData||{frag:n,part:i,cache:new Xu,complete:!1};m.push(new Uint8Array(s)),this.state!==Ke.STOPPED&&(this.state=Ke.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===bt.MAIN&&Pn(t.frag)&&(this.mainFragLoading=t,this.state===Ke.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:i}=t;if(n.type!==bt.AUDIO){!this.audioOnly&&n.type===bt.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Pn(n)){this.fragPrevious=n;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger($.AUDIO_TRACK_SWITCHED,en({},s)))}this.fragBufferedComplete(n,i),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=Ke.ERROR;return}switch(t.details){case Me.FRAG_GAP:case Me.FRAG_PARSING_ERROR:case Me.FRAG_DECRYPT_ERROR:case Me.FRAG_LOAD_ERROR:case Me.FRAG_LOAD_TIMEOUT:case Me.KEY_LOAD_ERROR:case Me.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(bt.AUDIO,t);break;case Me.AUDIO_TRACK_LOAD_ERROR:case Me.AUDIO_TRACK_LOAD_TIMEOUT:case Me.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Ke.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===Vt.AUDIO_TRACK&&(this.state=Ke.IDLE);break;case Me.BUFFER_ADD_CODEC_ERROR:case Me.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.resetLoadingState();break;case Me.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Me.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==ln.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==ln.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===Ke.ENDED&&(this.state=Ke.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,bt.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:i}=this,{remuxResult:s,chunkMeta:r}=e,d=this.getCurrentContext(r);if(!d){this.resetWhenMissingContext(r);return}const{frag:u,part:c,level:l}=d,{details:h}=l,{audio:o,text:f,id3:p,initSegment:m}=s;if(this.fragContextChanged(u)||!h){this.fragmentTracker.removeFragment(u);return}if(this.state=Ke.PARSING,this.switchingTrack&&o&&this.completeAudioSwitch(this.switchingTrack),m!=null&&m.tracks){const y=u.initSegment||u;this._bufferInitSegment(l,m.tracks,y,r),i.trigger($.FRAG_PARSING_INIT_SEGMENT,{frag:y,id:n,tracks:m.tracks})}if(o){const{startPTS:y,endPTS:_,startDTS:S,endDTS:b}=o;c&&(c.elementaryStreams[ln.AUDIO]={startPTS:y,endPTS:_,startDTS:S,endDTS:b}),u.setElementaryStreamInfo(ln.AUDIO,y,_,S,b),this.bufferFragmentData(o,u,c,r)}if(p!=null&&(t=p.samples)!=null&&t.length){const y=nn({id:n,frag:u,details:h},p);i.trigger($.FRAG_PARSING_METADATA,y)}if(f){const y=nn({id:n,frag:u,details:h},f);i.trigger($.FRAG_PARSING_USERDATA,y)}}_bufferInitSegment(e,t,n,i){if(this.state!==Ke.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=bt.AUDIO;const r=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${r}/${s.codec}]`),r&&r.split(",").length===1&&(s.levelCodec=r),this.hls.trigger($.BUFFER_CODECS,t);const d=s.initSegment;if(d!=null&&d.byteLength){const u={type:"audio",frag:n,part:null,chunkMeta:i,parent:n.type,data:d};this.hls.trigger($.BUFFER_APPENDING,u)}this.tickImmediate()}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===Rn.NOT_LOADED||i===Rn.PARTIAL){var s;if(!Pn(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Ke.WAITING_INIT_PTS;const r=this.mainDetails;r&&r.fragmentStart!==t.details.fragmentStart&&xs(t.details,r)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:i,characteristics:s,audioCodec:r,channels:d}=this.bufferedTrack;Ni({name:t,lang:n,assocLang:i,characteristics:s,audioCodec:r,channels:d},e,Li)||(bs(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger($.AUDIO_TRACK_SWITCHED,en({},e))}}class Qo extends vi{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const i=t==null?void 0:t.renditionReports;if(i){let s=-1;for(let r=0;r<i.length;r++){const d=i[r];let u;try{u=new self.URL(d.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),u=d.URI||""}if(u===e){s=r;break}else u===e.substring(0,u.length)&&(s=r)}if(s!==-1){const r=i[s],d=parseInt(r["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let u=parseInt(r["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const l=Math.min(t.age-t.partTarget,t.targetduration);u>=0&&l>t.partTarget&&(u+=1)}const c=n&&ad(n);return new od(d,u>=0?u:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:i,stats:s}=t,r=self.performance.now(),d=s.loading.first?Math.max(0,r-s.loading.first):0;i.advancedDateTime=Date.now()-d;const u=this.hls.config.timelineOffset;if(u!==i.appliedTimelineOffset){const l=Math.max(u||0,0);i.appliedTimelineOffset=l,i.fragments.forEach(h=>{h.start=h.playlistOffset+l})}if(i.live||n!=null&&n.live){const l="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(n),n&&i.fragments.length>0){Sv(n,i);const S=i.playlistParsingError;if(S){this.warn(S);const b=this.hls;if(!b.config.ignorePlaylistParsingErrors){var c;const{networkDetails:x}=t;b.trigger($.ERROR,{type:xt.NETWORK_ERROR,details:Me.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:S,reason:S.message,level:t.level||void 0,parent:(c=i.fragments[0])==null?void 0:c.type,networkDetails:x,stats:s});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=s.loading.start);const h=this.hls.mainForwardBufferInfo,o=h?h.end-h.len:0,f=(i.edge-o)*1e3,p=Hu(i,f);if(i.requestScheduled+p<r?i.requestScheduled=r:i.requestScheduled+=p,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let m,y,_;if(i.canBlockReload&&i.endSN&&i.advanced){const S=this.hls.config.lowLatencyMode,b=i.lastPartSn,x=i.endSN,L=i.lastPartIndex,N=L!==-1,P=b===x;N?P?(y=x+1,_=S?0:L):(y=b,_=S?L+1:i.maxPartIndex):y=x+1;const T=i.age,k=T+i.ageHeader;let I=Math.min(k-i.partTarget,i.targetduration*1.5);if(I>0){if(k>i.targetduration*3)this.log(`Playlist last advanced ${T.toFixed(2)}s ago. Omitting segment and part directives.`),y=void 0,_=void 0;else if(n!=null&&n.tuneInGoal&&k-i.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${I} with playlist age: ${i.age}`),I=0;else{const F=Math.floor(I/i.targetduration);if(y+=F,_!==void 0){const V=Math.round(I%i.targetduration/i.partTarget);_+=V}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${T.toFixed(2)}s goal: ${I} skip sn ${F} to part ${_}`)}i.tuneInGoal=I}if(m=this.getDeliveryDirectives(i,t.deliveryDirectives,y,_),S||!P){i.requestScheduled=r,this.loadingPlaylist(l,m);return}}else(i.canBlockReload||i.canSkipUntil)&&(m=this.getDeliveryDirectives(i,t.deliveryDirectives,y,_));m&&y!==void 0&&i.canBlockReload&&(i.requestScheduled=s.loading.first+Math.max(p-d*2,p/2)),this.scheduleLoading(l,m,i)}else this.clearTimer()}scheduleLoading(e,t,n){const i=n||e.details;if(!i){this.loadingPlaylist(e,t);return}const s=self.performance.now(),r=i.requestScheduled;if(s>=r){this.loadingPlaylist(e,t);return}const d=r-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(d)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),d)}getDeliveryDirectives(e,t,n,i){let s=ad(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,i=t.part,s=ns.No),new od(n,i,s)}checkRetry(e){const t=e.details,n=Ss(e),i=e.errorAction,{action:s,retryCount:r=0,retryConfig:d}=i||{},u=!!i&&!!d&&(s===Fn.RetryRequest||!i.resolved&&s===Fn.SendAlternateToPenaltyBox);if(u){var c;if(r>=d.maxNumRetry)return!1;if(n&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${r+1}/${d.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const l=Uo(d,r);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),l),this.warn(`Retrying playlist loading ${r+1}/${d.maxNumRetry} after "${t}" in ${l}ms`)}e.levelRetry=!0,i.resolved=!0}return u}}function gh(a,e){if(a.length!==e.length)return!1;for(let t=0;t<a.length;t++)if(!xr(a[t].attrs,e[t].attrs))return!1;return!0}function xr(a,e,t){const n=a["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>a[i]!==e[i])}function ho(a,e){return e.label.toLowerCase()===a.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(a.lang||"").toLowerCase())}class kb extends Qo{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.LEVEL_LOADING,this.onLevelLoading,this),e.on($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on($.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.LEVEL_LOADING,this.onLevelLoading,this),e.off($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off($.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off($.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:i,details:s}=t,r=this.tracksInGroup[n];if(!r||r.groupId!==i){this.warn(`Audio track with id:${n} and group:${i} not found in active group ${r==null?void 0:r.groupId}`);return}const d=r.details;r.details=t.details,this.log(`Audio track ${n} "${r.name}" lang:${r.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,d)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,i=this.groupIds;let s=this.currentTrack;if(!n||(i==null?void 0:i.length)!==(n==null?void 0:n.length)||n!=null&&n.some(d=>(i==null?void 0:i.indexOf(d))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const d=this.tracks.filter(o=>!n||n.indexOf(o.groupId)!==-1);if(d.length)this.selectDefaultTrack&&!d.some(o=>o.default)&&(this.selectDefaultTrack=!1),d.forEach((o,f)=>{o.id=f});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=d;const u=this.hls.config.audioPreference;if(!s&&u){const o=li(u,d,Li);if(o>-1)s=d[o];else{const f=li(u,this.tracks);s=this.tracks[f]}}let c=this.findTrackId(s);c===-1&&s&&(c=this.findTrackId(null));const l={audioTracks:d};this.log(`Updating audio tracks, ${d.length} track(s) found in group(s): ${n==null?void 0:n.join(",")}`),this.hls.trigger($.AUDIO_TRACKS_UPDATED,l);const h=this.trackId;if(c!==-1&&h===-1)this.setAudioTrack(c);else if(d.length&&h===-1){var r;const o=new Error(`No audio track selected for current audio group-ID(s): ${(r=this.groupIds)==null?void 0:r.join(",")} track count: ${d.length}`);this.warn(o.message),this.hls.trigger($.ERROR,{type:xt.MEDIA_ERROR,details:Me.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:o})}}}onError(e,t){t.fatal||!t.context||t.context.type===Vt.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const i=this.currentTrack;if(i&&Ni(e,i,Li))return i;const s=li(e,this.tracksInGroup,Li);if(s>-1){const r=this.tracksInGroup[s];return this.setAudioTrack(s),r}else if(i){let r=t.loadLevel;r===-1&&(r=t.firstAutoLevel);const d=VA(e,t.levels,n,r,Li);if(d===-1)return null;t.nextLoadLevel=d}if(e.channels||e.audioCodec){const r=li(e,n);if(r>-1)return n[r]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e],s=i.details&&!i.details.live;if(e===this.trackId&&i===n&&s||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger($.AUDIO_TRACK_SWITCHING,en({},i)),s))return;const r=this.switchParams(i.url,n==null?void 0:n.details,i.details);this.loadPlaylist(r)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(!(this.selectDefaultTrack&&!i.default)&&(!e||Ni(e,i,Li)))return n}if(e){const{name:n,lang:i,assocLang:s,characteristics:r,audioCodec:d,channels:u}=e;for(let c=0;c<t.length;c++){const l=t[c];if(Ni({name:n,lang:i,assocLang:s,characteristics:r,audioCodec:d,channels:u},l,Li))return c}for(let c=0;c<t.length;c++){const l=t[c];if(xr(e.attrs,l.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const l=t[c];if(xr(e.attrs,l.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&bs(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),r=e.details,d=r==null?void 0:r.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${d&&r.live?" age "+d.toFixed(1)+(r.type&&" "+r.type||""):""} ${s}`),this.hls.trigger($.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:t||null,track:e})}}class Rb{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const i=this.queues[t];i.push(e),i.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(s){var n;if(i.onError(s),this.queues===null||this.tracks===null)return;const r=(n=this.tracks[e])==null?void 0:n.buffer;r!=null&&r.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],i=n==null?void 0:n.buffer;return i?`SourceBuffer${i.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const Hd=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,yh="HlsJsTrackRemovedError";class Ib extends Error{constructor(e){super(e),this.name=yh}}class Lb extends vi{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var i;this.hls&&((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:i,mediaSource:s}=this;n&&this.log("Media source opened"),!(!i||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger($.MEDIA_ATTACHED,{media:i,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:i}=this;n!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=aA(xi(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.BUFFER_RESET,this.onBufferReset,this),e.on($.BUFFER_APPENDING,this.onBufferAppending,this),e.on($.BUFFER_CODECS,this.onBufferCodecs,this),e.on($.BUFFER_EOS,this.onBufferEos,this),e.on($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on($.LEVEL_UPDATED,this.onLevelUpdated,this),e.on($.FRAG_PARSED,this.onFragParsed,this),e.on($.FRAG_CHANGED,this.onFragChanged,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.BUFFER_RESET,this.onBufferReset,this),e.off($.BUFFER_APPENDING,this.onBufferAppending,this),e.off($.BUFFER_CODECS,this.onBufferCodecs,this),e.off($.BUFFER_EOS,this.onBufferEos,this),e.off($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off($.LEVEL_UPDATED,this.onLevelUpdated,this),e.off($.FRAG_PARSED,this.onFragParsed,this),e.off($.FRAG_CHANGED,this.onFragChanged,this),e.off($.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const r=this.isQueued();(s||r)&&this.warn(`Transfering MediaSource with${r?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?nn(n,i.tracks):this.sourceBuffers.forEach(s=>{const[r]=s;r&&(n[r]=nn({},this.tracks[r]),this.removeBuffer(r)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media,i=xi(this.appendSource);if(this.transferData=this.overrides=void 0,n&&i){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const r=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(r),s)this._objectUrl=n.src,this.attachTransferred();else{const d=this._objectUrl=self.URL.createObjectURL(r);if(this.appendSource)try{n.removeAttribute("src");const u=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||u&&r instanceof u,qd(n),Db(n,d),n.load()}catch{n.src=d}else n.src=d}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,i=t.tracks,s=i?Object.keys(i):null,r=s?s.length:0,d=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(i&&s&&r){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${An(n,(u,c)=>u==="initSegment"?void 0:c)};
transfer tracks: ${An(i,(u,c)=>u==="initSegment"?void 0:c)}}`),!yu(i,n)){t.mediaSource=null,t.tracks=void 0;const u=e.currentTime,c=this.details,l=Math.max(u,(c==null?void 0:c.fragments[0].start)||0);if(l-u>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${u} -> ${l}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(n)}") start time: ${l} currentTime: ${u}`),this.onMediaDetaching($.MEDIA_DETACHING,{}),this.onMediaAttaching($.MEDIA_ATTACHING,t),e.currentTime=l;return}this.transferData=void 0,s.forEach(u=>{const c=u,l=i[c];if(l){const h=l.buffer;if(h){const o=this.fragmentTracker,f=l.id;if(o.hasFragments(f)||o.hasParts(f)){const y=Ft.getBuffered(h);o.detectEvictedFragments(c,y,f,null,!0)}const p=Ma(c),m=[c,h];this.sourceBuffers[p]=m,h.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,l)}}}),d(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),d()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:s,_objectUrl:r}=this;if(s){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([d])=>{d&&this.removeBuffer(d)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const d=s.readyState==="open";try{const u=s.sourceBuffers;for(let c=u.length;c--;)d&&u[c].abort(),s.removeSourceBuffer(u[c]);d&&s.endOfStream()}catch(u){this.warn(`onMediaDetaching: ${u.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),n||(r&&self.URL.revokeObjectURL(r),this.mediaSrc===r?(i.removeAttribute("src"),this.appendSource&&qd(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger($.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Ma(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Rb(this.tracks)}onBufferCodecs(e,t){const n=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const s="audiovideo"in t&&(n.audio||n.video)||n.audiovideo&&("audio"in t||"video"in t),r=!s&&this.sourceBufferCount&&this.media&&i.some(d=>!n[d]);if(s||r){this.warn(`Unsupported transition between "${Object.keys(n)}" and "${i}" SourceBuffers`);return}i.forEach(d=>{var u,c,l;const h=t[d],{id:o,codec:f,levelCodec:p,container:m,metadata:y,supplemental:_}=h;let S=n[d];const b=(u=this.transferData)==null||(c=u.tracks)==null?void 0:c[d],x=b!=null&&b.buffer?b:S,L=(x==null?void 0:x.pendingCodec)||(x==null?void 0:x.codec),N=x==null?void 0:x.levelCodec;S||(S=n[d]={buffer:void 0,listeners:[],codec:f,supplemental:_,container:m,levelCodec:p,metadata:y,id:o});const P=ts(L,N),T=P==null?void 0:P.replace(Hd,"$1");let k=ts(f,p);const I=(l=k)==null?void 0:l.replace(Hd,"$1");k&&P&&T!==I&&(d.slice(0,5)==="audio"&&(k=As(k,this.appendSource)),this.log(`switching codec ${L} to ${k}`),k!==(S.pendingCodec||S.codec)&&(S.pendingCodec=k),S.container=m,this.appendChangeType(d,m,k))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const i=`${t};codecs=${n}`,s={label:`change-type=${i}`,execute:()=>{const r=this.tracks[e];if(r){const d=r.buffer;d!=null&&d.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),d.changeType(i),r.codec=n,r.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:r=>{this.warn(`Failed to change ${e} SourceBuffer type`,r)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,i=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,bt.MAIN))==null?void 0:t.gap)===!0)return;const r={label:"block-audio",execute:()=>{var d;const u=this.tracks.video;(this.lastVideoAppendEnd>i||u!=null&&u.buffer&&Ft.isBuffered(u.buffer,i)||((d=this.fragmentTracker.getAppendedFrag(i,bt.MAIN))==null?void 0:d.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:d=>{this.warn("Error executing block-audio operation",d)}};this.blockedAudioAppend={op:r,frag:e},this.append(r,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:i,type:s,parent:r,frag:d,part:u,chunkMeta:c}=t,l=c.buffering[s],h=d.sn,o=self.performance.now();l.start=o;const f=d.stats.buffering,p=u?u.stats.buffering:null;f.start===0&&(f.start=o),p&&p.start===0&&(p.start=o);const m=n.audio;let y=!1;s==="audio"&&(m==null?void 0:m.container)==="audio/mpeg"&&(y=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const _=this.tracks.video,S=_==null?void 0:_.buffer;if(S&&h!=="initSegment"){const L=u||d,N=this.blockedAudioAppend;if(s==="audio"&&r!=="main"&&!this.blockedAudioAppend){const T=L.start+L.duration*.05,k=S.buffered,I=this.currentOp("video");!k.length&&!I?this.blockAudio(L):!I&&!Ft.isBuffered(S,T)&&this.lastVideoAppendEnd<T&&this.blockAudio(L)}else if(s==="video"){const P=L.end;if(N){const T=N.frag.start;(P>T||P<this.lastVideoAppendEnd||Ft.isBuffered(S,T))&&this.unblockAudio()}this.lastVideoAppendEnd=P}}const b=(u||d).start,x={label:`append-${s}`,execute:()=>{if(l.executeStart=self.performance.now(),y){const L=this.tracks[s];if(L){const N=L.buffer;if(N){const P=b-N.timestampOffset;Math.abs(P)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${b} (delta: ${P}) sn: ${h})`),N.timestampOffset=b)}}}this.appendExecutor(i,s)},onStart:()=>{},onComplete:()=>{const L=self.performance.now();l.executeEnd=l.end=L,f.first===0&&(f.first=L),p&&p.first===0&&(p.first=L);const N={};this.sourceBuffers.forEach(([P,T])=>{P&&(N[P]=Ft.getBuffered(T))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger($.BUFFER_APPENDED,{type:s,frag:d,part:u,chunkMeta:c,parent:d.type,timeRanges:N})},onError:L=>{var N;const P={type:xt.MEDIA_ERROR,parent:d.type,details:Me.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:d,part:u,chunkMeta:c,error:L,err:L,fatal:!1},T=(N=this.media)==null?void 0:N.error;if(L.code===DOMException.QUOTA_EXCEEDED_ERR)P.details=Me.BUFFER_FULL_ERROR;else if(L.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!T)P.errorAction=vr(!0);else if(L.name===yh&&this.sourceBufferCount===0)P.errorAction=vr(!0);else{const k=++this.appendErrors[s];this.warn(`Failed ${k}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${T||"no media error"})`),(k>=this.hls.config.appendErrorMaxRetry||T)&&(P.fatal=!0)}this.hls.trigger($.ERROR,P)}};this.append(x,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger($.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:n,startOffset:i,endOffset:s}=t;n?this.append(this.getFlushOp(n,i,s),n):this.sourceBuffers.forEach(([r])=>{r&&this.append(this.getFlushOp(r,i,s),r)})}onFragParsed(e,t){const{frag:n,part:i}=t,s=[],r=i?i.elementaryStreams:n.elementaryStreams;r[ln.AUDIOVIDEO]?s.push("audiovideo"):(r[ln.AUDIO]&&s.push("audio"),r[ln.VIDEO]&&s.push("video"));const d=()=>{const u=self.performance.now();n.stats.buffering.end=u,i&&(i.stats.buffering.end=u);const c=i?i.stats:n.stats;this.hls.trigger($.FRAG_BUFFERED,{frag:n,part:i,stats:c,id:n.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(d,s).catch(u=>{this.warn(`Fragment buffered callback ${u}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t,n;return e&&(!((t=this.tracks[e])!=null&&t.ended)||((n=this.tracks[e])==null?void 0:n.ending))})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([r])=>{if(r){const d=this.tracks[r];(!t.type||t.type===r)&&(d.ending=!0,d.ended||(d.ended=!0,this.log(`${r} buffer reached EOS`)))}});const i=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([r])=>{var d;return r&&!((d=this.tracks[r])!=null&&d.ended)})&&(i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:r}=this;if(!r||r.readyState!=="open"){r&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${r.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),r.endOfStream(),this.hls.trigger($.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger($.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){const e=this.getDurationAndRange();e&&this.blockUntilOpen(()=>this.updateMediaSource(e))}onError(e,t){if(t.details===Me.BUFFER_APPEND_ERROR&&t.frag){var n;const i=(n=t.errorAction)==null?void 0:n.nextAutoLevel;pt(i)&&i!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const i=e.config,s=n.currentTime,r=t.levelTargetDuration,d=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(pt(d)&&d>=0){const u=Math.max(d,r),c=Math.floor(s/r)*r-u;this.flushBackBuffer(s,r,c)}if(pt(i.frontBufferFlushThreshold)&&i.frontBufferFlushThreshold>0){const u=Math.max(i.maxBufferLength,i.frontBufferFlushThreshold),c=Math.max(u,r),l=Math.floor(s/r)*r+c;this.flushFrontBuffer(s,r,l)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([i,s])=>{if(s){const d=Ft.getBuffered(s);if(d.length>0&&n>d.start(0)){var r;this.hls.trigger($.BACK_BUFFER_REACHED,{bufferEnd:n});const u=this.tracks[i];if((r=this.details)!=null&&r.live)this.hls.trigger($.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(u!=null&&u.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger($.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:i})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([i,s])=>{if(s){const r=Ft.getBuffered(s),d=r.length;if(d<2)return;const u=r.start(d-1),c=r.end(d-1);if(n>u||e>=u&&e<=c)return;this.hls.trigger($.BUFFER_FLUSHING,{startOffset:u,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||(n==null?void 0:n.readyState)!=="open")return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&n.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),l=Math.max(c,i);return{duration:1/0,start:c,end:l}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return pt(s)?{duration:s}:null;const r=this.media.duration,d=pt(n.duration)?n.duration:0;return i>d&&i>r||!pt(r)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:n}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(pt(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${n}.`),i.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${An(n)}`),this.tracksReady){var i;const s=(i=this.transferData)==null?void 0:i.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const i=this.tracks[t];e[t]={buffer:n,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger($.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger($.ERROR,{type:xt.MEDIA_ERROR,details:Me.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const r=s,d=e[r];if(this.isPending(d)){const u=this.getTrackCodec(d,r),c=`${d.container};codecs=${u}`;d.codec=u,this.log(`creating sourceBuffer(${c})${this.currentOp(r)?" Queued":""} ${An(d)}`);try{const l=n.addSourceBuffer(c),h=Ma(r),o=[r,l];t[h]=o,d.buffer=l}catch(l){var i;this.error(`error while trying to add sourceBuffer: ${l.message}`),this.shiftAndExecuteNext(r),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[r],this.hls.trigger($.ERROR,{type:xt.MEDIA_ERROR,details:Me.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:l,sourceBufferName:r,mimeType:c,parent:d.id});return}this.trackSourceBuffer(r,d)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let i=e.codec;n&&(t==="video"||t==="audiovideo")&&io(n,"video")&&(i=kA(i,n));const s=ts(i,e.levelCodec);return s?t.slice(0,5)==="audio"?As(s,this.appendSource):s:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,r)=>{const d=r.removedRanges;d!=null&&d.length&&this.hls.trigger($.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n==null?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${i}`,t),this.hls.trigger($.ERROR,{type:xt.MEDIA_ERROR,details:Me.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const s=this.currentOp(e);s&&s.onError(i)}removeExecutor(e,t,n){const{media:i,mediaSource:s}=this,r=this.tracks[e],d=r==null?void 0:r.buffer;if(!i||!s||!d){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const u=pt(i.duration)?i.duration:1/0,c=pt(s.duration)?s.duration:1/0,l=Math.max(0,t),h=Math.min(n,u,c);h>l&&(!r.ending||r.ended)?(r.ended=!1,this.log(`Removing [${l},${h}] from the ${e} SourceBuffer`),d.remove(l,h)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],i=n==null?void 0:n.buffer;if(!i)throw new Ib(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,i=t.map(r=>this.appendBlocker(r));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(r=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const i=(n=this.tracks[t])==null?void 0:n.buffer;!i||i.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const i=this.tracks[e];if(!i)return;const s=i.buffer;if(!s)return;const r=n.bind(this,e);i.listeners.push({event:t,listener:r}),s.addEventListener(t,r)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(i=>{n.removeEventListener(i.event,i.listener)}),t.listeners.length=0)}}function qd(a){const e=a.querySelectorAll("source");[].slice.call(e).forEach(t=>{a.removeChild(t)})}function Db(a,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,a.appendChild(t)}function Ma(a){return a==="audio"?1:0}class Zo{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on($.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on($.BUFFER_CODECS,this.onBufferCodecs,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off($.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off($.BUFFER_CODECS,this.onBufferCodecs,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&pt(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,Zo.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const i=(d,u)=>u?d.width!==u.width||d.height!==u.height:!0;let s=e.length-1;const r=Math.max(t,n);for(let d=0;d<e.length;d+=1){const u=e[d];if((u.width>=r||u.height>=r)&&i(u,e[d+1])){s=d;break}}return s}}const Pb={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},$n=Pb,Ob={HLS:"h"},Mb=Ob,Bb="CMCD-Object",Fb="CMCD-Request",Nb="CMCD-Session",Ub="CMCD-Status",fr={OBJECT:Bb,REQUEST:Fb,SESSION:Nb,STATUS:Ub},$b={[fr.OBJECT]:["br","d","ot","tb"],[fr.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[fr.SESSION]:["cid","pr","sf","sid","st","v"],[fr.STATUS]:["bs","rtp"]};class or{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof or?n:new or(n))),this.value=e,this.params=t}}const Gb="Dict";function Vb(a){return Array.isArray(a)?JSON.stringify(a):a instanceof Map?"Map{}":a instanceof Set?"Set{}":typeof a=="object"?JSON.stringify(a):String(a)}function jb(a,e,t,n){return new Error(`failed to ${a} "${Vb(e)}" as ${t}`,{cause:n})}function ui(a,e,t){return jb("serialize",a,e,t)}class _h{constructor(e){this.description=e}}const zd="Bare Item",Hb="Boolean";function qb(a){if(typeof a!="boolean")throw ui(a,Hb);return a?"?1":"?0"}function zb(a){return btoa(String.fromCharCode(...a))}const Kb="Byte Sequence";function Wb(a){if(ArrayBuffer.isView(a)===!1)throw ui(a,Kb);return`:${zb(a)}:`}const Yb="Integer";function Xb(a){return a<-999999999999999||999999999999999<a}function Ah(a){if(Xb(a))throw ui(a,Yb);return a.toString()}function Jb(a){return`@${Ah(a.getTime()/1e3)}`}function vh(a,e){if(a<0)return-vh(-a,e);const t=Math.pow(10,e);if(Math.abs(a*t%1-.5)<Number.EPSILON){const i=Math.floor(a*t);return(i%2===0?i:i+1)/t}else return Math.round(a*t)/t}const Qb="Decimal";function Zb(a){const e=vh(a,3);if(Math.floor(Math.abs(e)).toString().length>12)throw ui(a,Qb);const t=e.toString();return t.includes(".")?t:`${t}.0`}const e1="String",t1=/[\x00-\x1f\x7f]+/;function n1(a){if(t1.test(a))throw ui(a,e1);return`"${a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function i1(a){return a.description||a.toString().slice(7,-1)}const r1="Token";function Kd(a){const e=i1(a);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw ui(e,r1);return e}function fo(a){switch(typeof a){case"number":if(!pt(a))throw ui(a,zd);return Number.isInteger(a)?Ah(a):Zb(a);case"string":return n1(a);case"symbol":return Kd(a);case"boolean":return qb(a);case"object":if(a instanceof Date)return Jb(a);if(a instanceof Uint8Array)return Wb(a);if(a instanceof _h)return Kd(a);default:throw ui(a,zd)}}const s1="Key";function po(a){if(/^[a-z*][a-z0-9\-_.*]*$/.test(a)===!1)throw ui(a,s1);return a}function el(a){return a==null?"":Object.entries(a).map(([e,t])=>t===!0?`;${po(e)}`:`;${po(e)}=${fo(t)}`).join("")}function bh(a){return a instanceof or?`${fo(a.value)}${el(a.params)}`:fo(a)}function a1(a){return`(${a.value.map(bh).join(" ")})${el(a.params)}`}function o1(a,e={whitespace:!0}){if(typeof a!="object")throw ui(a,Gb);const t=a instanceof Map?a.entries():Object.entries(a),n=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([i,s])=>{s instanceof or||(s=new or(s));let r=po(i);return s.value===!0?r+=el(s.params):(r+="=",Array.isArray(s.value)?r+=a1(s):r+=bh(s)),r}).join(`,${n}`)}function l1(a,e){return o1(a,e)}function d1(a){return a==="ot"||a==="sf"||a==="st"}function c1(a){return typeof a=="number"?pt(a):a!=null&&a!==""&&a!==!1}function u1(a,e){const t=new URL(a),n=new URL(e);if(t.origin!==n.origin)return a;const i=t.pathname.split("/").slice(1),s=n.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")}const as=a=>Math.round(a),h1=(a,e)=>(e!=null&&e.baseUrl&&(a=u1(a,e.baseUrl)),encodeURIComponent(a)),Gr=a=>as(a/100)*100,f1={br:as,d:as,bl:Gr,dl:Gr,mtp:Gr,nor:h1,rtp:Gr,tb:as};function p1(a,e){const t={};if(a==null||typeof a!="object")return t;const n=Object.keys(a).sort(),i=nn({},f1,e==null?void 0:e.formatters),s=e==null?void 0:e.filter;return n.forEach(r=>{if(s!=null&&s(r))return;let d=a[r];const u=i[r];u&&(d=u(d,e)),!(r==="v"&&d===1)&&(r=="pr"&&d===1||c1(d)&&(d1(r)&&typeof d=="string"&&(d=new _h(d)),t[r]=d))}),t}function Sh(a,e={}){return a?l1(p1(a,e),nn({whitespace:!1},e)):""}function m1(a,e={}){const t={};if(!a)return t;const n=Object.entries(a),i=Object.entries($b).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),s=n.reduce((r,d)=>{var u,c;const[l,h]=d,o=((u=i.find(f=>f[1].includes(l)))===null||u===void 0?void 0:u[0])||fr.REQUEST;return(c=r[o])!==null&&c!==void 0||(r[o]={}),r[o][l]=h,r},{});return Object.entries(s).reduce((r,[d,u])=>(r[d]=Sh(u,e),r),t)}function g1(a,e,t){return nn(a,m1(e,t))}const y1="CMCD";function _1(a,e={}){if(!a)return"";const t=Sh(a,e);return`${y1}=${encodeURIComponent(t)}`}const Wd=/CMCD=[^&#]+/;function A1(a,e,t){const n=_1(e,t);if(!n)return a;if(Wd.test(a))return a.replace(Wd,n);const i=a.includes("?")?"&":"?";return`${a}${i}${n}`}class v1{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:$n.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{const{frag:s,part:r}=i,d=this.hls.levels[s.level],u=this.getObjectType(s),c={d:(r||s).duration*1e3,ot:u};(u===$n.VIDEO||u===$n.AUDIO||u==$n.MUXED)&&(c.br=d.bitrate/1e3,c.tb=this.getTopBandwidth(u)/1e3,c.bl=this.getBufferLength(u));const l=r?this.getNextPart(r):this.getNextFrag(s);l!=null&&l.url&&l.url!==s.url&&(c.nor=l.url),this.apply(i,c)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHED,this.onMediaDetached,this),e.on($.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHED,this.onMediaDetached,this),e.off($.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,i;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:Mb.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){nn(t,this.createData());const n=t.ot===$n.INIT||t.ot===$n.VIDEO||t.ot===$n.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((r,d)=>(i.includes(d)&&(r[d]=t[d]),r),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),g1(e.headers,t,s)):e.url=A1(e.url,t,s)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const i=e.sn-n.startSN;return n.fragments[i+1]}}getNextPart(e){var t,n;const{index:i,fragment:s}=e,r=(t=this.hls.levels[s.level])==null||(n=t.details)==null?void 0:n.partList;if(r){const{sn:d}=s;for(let u=r.length-1;u>=0;u--){const c=r[u];if(c.index===i&&c.fragment.sn===d)return r[u+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return $n.TIMED_TEXT;if(e.sn==="initSegment")return $n.INIT;if(t==="audio")return $n.AUDIO;if(t==="main")return this.hls.audioTracks.length?$n.VIDEO:$n.MUXED}getTopBandwidth(e){let t=0,n;const i=this.hls;if(e===$n.AUDIO)n=i.audioTracks;else{const s=i.maxAutoLevel,r=s>-1?s+1:i.levels.length;n=i.levels.slice(0,r)}return n.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===$n.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:Ft.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,r,d){t(s),this.loader.load(s,r,d)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,r,d){t(s),this.loader.load(s,r,d)}}}}const b1=3e5;class S1 extends vi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_LOADED,this.onManifestLoaded,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_LOADED,this.onManifestLoaded,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===Fn.SendAlternateToPenaltyBox&&n.flags===ti.MoveAllAlternatesMatchingHost){const i=this.levels;let s=this._pathwayPriority,r=this.pathwayId;if(t.context){const{groupId:d,pathwayId:u,type:c}=t.context;d&&i?r=this.getPathwayForGroupId(d,c,r):u&&(r=u)}r in this.penalizedPathways||(this.penalizedPathways[r]=performance.now()),!s&&i&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),n.resolved=this.pathwayId!==r),n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${r} levels: ${i&&i.length} priorities: ${An(s)} penalized: ${An(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach(s=>{i-n[s]>b1&&delete n[s]});for(let s=0;s<e.length;s++){const r=e[s];if(r in n)continue;if(r===this.pathwayId)return;const d=this.hls.nextLoadLevel,u=this.hls.levels[d];if(t=this.getLevelsForPathway(r),t.length>0){this.log(`Setting Pathway to "${r}"`),this.pathwayId=r,Ku(t),this.hls.trigger($.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[d];u&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==u.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==u.bitrate&&this.log(`Unstable Pathways change from bitrate ${u.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=d);break}}}getPathwayForGroupId(e,t,n){const i=this.getLevelsForPathway(n).concat(this.levels||[]);for(let s=0;s<i.length;s++)if(t===Vt.AUDIO_TRACK&&i[s].hasAudioGroup(e)||t===Vt.SUBTITLE_TRACK&&i[s].hasSubtitleGroup(e))return i[s].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},i={};e.forEach(s=>{const{ID:r,"BASE-ID":d,"URI-REPLACEMENT":u}=s;if(t.some(l=>l.pathwayId===r))return;const c=this.getLevelsForPathway(d).map(l=>{const h=new Sn(l.attrs);h["PATHWAY-ID"]=r;const o=h.AUDIO&&`${h.AUDIO}_clone_${r}`,f=h.SUBTITLES&&`${h.SUBTITLES}_clone_${r}`;o&&(n[h.AUDIO]=o,h.AUDIO=o),f&&(i[h.SUBTITLES]=f,h.SUBTITLES=f);const p=Eh(l.uri,h["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",u),m=new Ar({attrs:h,audioCodec:l.audioCodec,bitrate:l.bitrate,height:l.height,name:l.name,url:p,videoCodec:l.videoCodec,width:l.width});if(l.audioGroups)for(let y=1;y<l.audioGroups.length;y++)m.addGroupId("audio",`${l.audioGroups[y]}_clone_${r}`);if(l.subtitleGroups)for(let y=1;y<l.subtitleGroups.length;y++)m.addGroupId("text",`${l.subtitleGroups[y]}_clone_${r}`);return m});t.push(...c),Yd(this.audioTracks,n,u,r),Yd(this.subtitleTracks,i,u,r)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const l=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+l)}const s={responseType:"json",url:i.href},r=t.steeringManifestLoadPolicy.default,d=r.errorRetry||r.timeoutRetry||{},u={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:d.maxNumRetry||0,retryDelay:d.retryDelayMs||0,maxRetryDelay:d.maxRetryDelayMs||0},c={onSuccess:(l,h,o,f)=>{this.log(`Loaded steering manifest: "${i}"`);const p=l.data;if((p==null?void 0:p.VERSION)!==1){this.log(`Steering VERSION ${p.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":m,"PATHWAY-CLONES":y,"PATHWAY-PRIORITY":_}=p;if(m)try{this.uri=new self.URL(m,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${m}`);return}this.scheduleRefresh(this.uri||o.url),y&&this.clonePathways(y);const S={steeringManifest:p,url:i.toString()};this.hls.trigger($.STEERING_MANIFEST_LOADED,S),_&&this.updatePathwayPriority(_)},onError:(l,h,o,f)=>{if(this.log(`Error loading steering manifest: ${l.code} ${l.text} (${h.url})`),this.stopLoad(),l.code===410){this.enabled=!1,this.log(`Steering manifest ${h.url} no longer available`);return}let p=this.timeToLoad*1e3;if(l.code===429){const m=this.loader;if(typeof(m==null?void 0:m.getResponseHeader)=="function"){const y=m.getResponseHeader("Retry-After");y&&(p=parseFloat(y)*1e3)}this.log(`Steering manifest ${h.url} rate limited`);return}this.scheduleRefresh(this.uri||h.url,p)},onTimeout:(l,h,o)=>{this.log(`Timeout loading steering manifest (${h.url})`),this.scheduleRefresh(this.uri||h.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,u,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const i=(n=this.hls)==null?void 0:n.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Yd(a,e,t,n){a&&Object.keys(e).forEach(i=>{const s=a.filter(r=>r.groupId===i).map(r=>{const d=nn({},r);return d.details=void 0,d.attrs=new Sn(d.attrs),d.url=d.attrs.URI=Eh(r.url,r.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),d.groupId=d.attrs["GROUP-ID"]=e[i],d.attrs["PATHWAY-ID"]=n,d});a.push(...s)})}function Eh(a,e,t,n){const{HOST:i,PARAMS:s,[t]:r}=n;let d;e&&(d=r==null?void 0:r[e],d&&(a=d));const u=new self.URL(a);return i&&!d&&(u.host=i),s&&Object.keys(s).sort().forEach(c=>{c&&u.searchParams.set(c,s[c])}),u.href}function Hn(a,e,t){Jn(a,e,t),a.addEventListener(e,t)}function Jn(a,e,t){a.removeEventListener(e,t)}class tr extends vi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=tr.CDMCleanupPromise?[tr.CDMCleanupPromise]:[],this.onMediaEncrypted=t=>{const{initDataType:n,initData:i}=t,s=`"${t.type}" event: init data type: "${n}"`;if(this.debug(s),i!==null){if(!this.keyFormatPromise){let r=Object.keys(this.keySystemAccessPromises);r.length||(r=hr(this.config));const d=r.map(Br).filter(u=>!!u);this.keyFormatPromise=this.getKeyFormatPromise(d)}this.keyFormatPromise.then(r=>{const d=is(r);let u,c;if(n==="sinf"){if(d!==tn.FAIRPLAY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${n}" for selected key-system ${d}`);return}const p=kn(new Uint8Array(i));try{const m=jo(JSON.parse(p).sinf),y=Tu(m);if(!y)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");u=new Uint8Array(y.subarray(8,24)),c=tn.FAIRPLAY}catch(m){this.warn(`${s} Failed to parse sinf: ${m}`);return}}else{if(d!==tn.WIDEVINE&&d!==tn.PLAYREADY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${n}" for selected key-system ${d}`);return}const p=TA(i),m=p.filter(_=>!!_.systemId&&wa(_.systemId)===d);m.length>1&&this.warn(`${s} Using first of ${m.length} pssh found for selected key-system ${d}`);const y=m[0];if(!y){p.length===0||p.some(_=>!_.systemId)?this.warn(`${s} contains incomplete or invalid pssh data`):this.log(`ignoring ${s} for ${p.map(_=>wa(_.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(c=wa(y.systemId),y.version===0&&y.data)if(c===tn.WIDEVINE){const _=y.data.length-22;u=new Uint8Array(y.data.subarray(_,_+16))}else c===tn.PLAYREADY&&(u=$u(y.data))}if(!c||!u)return;const l=ai.hexDump(u),{keyIdToKeySessionPromise:h,mediaKeySessions:o}=this;let f=h[l];for(let p=0;p<o.length;p++){const m=o[p],y=m.decryptdata;if(!y.keyId)continue;const _=ai.hexDump(y.keyId);if(l===_||y.uri.replace(/-/g,"").indexOf(l)!==-1){if(f=h[_],y.pssh)break;delete h[_],y.pssh=new Uint8Array(i),y.keyId=u,f=h[l]=f.then(()=>this.generateRequestWithPreferredKeySession(m,n,i,"encrypted-event-key-match")),f.catch(S=>this.handleError(S));break}}if(!f){if(c!==d){this.log(`Ignoring "${t.type}" event with ${c} init data for selected key-system ${d}`);return}f=h[l]=this.getKeySystemSelectionPromise([c]).then(({keySystem:p,mediaKeys:m})=>{var y;this.throwIfDestroyed();const _=new br("ISO-23001-7",l,(y=Br(p))!=null?y:"");return _.pssh=new Uint8Array(i),_.keyId=u,this.attemptSetMediaKeys(p,m).then(()=>{this.throwIfDestroyed();const S=this.createMediaKeySessionContext({decryptdata:_,keySystem:p,mediaKeys:m});return this.generateRequestWithPreferredKeySession(S,n,i,"encrypted-event-no-match")})}),f.catch(p=>this.handleError(p))}})}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on($.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on($.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on($.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on($.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on($.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off($.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off($.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off($.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off($.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off($.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,i=t[e];if(i)return i.licenseUrl;if(e===tn.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(r,d,u)=>!!r&&u.indexOf(r)===d,i=t.map(r=>r.audioCodec).filter(n),s=t.map(r=>r.videoCodec).filter(n);return i.length+s.length===0&&s.push("avc1.42e01e"),new Promise((r,d)=>{const u=c=>{const l=c.shift();this.getMediaKeysPromise(l,i,s).then(h=>r({keySystem:l,mediaKeys:h})).catch(h=>{c.length?u(c):h instanceof Kn?d(h):d(new Kn({type:xt.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_NO_ACCESS,error:h,fatal:!0},h.message))})};u(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${n}`;return Uu===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return n(e,t)}getMediaKeysPromise(e,t,n){const i=pv(e,t,n,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e];let r=s==null?void 0:s.keySystemAccess;if(!r){this.log(`Requesting encrypted media "${e}" key-system access with config: ${An(i)}`),r=this.requestMediaKeySystemAccess(e,i);const d=this.keySystemAccessPromises[e]={keySystemAccess:r};return r.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),r.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const c=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),d.mediaKeys=u.createMediaKeys().then(l=>(this.log(`Media-keys created for "${e}"`),d.hasMediaKeys=!0,c.then(h=>h?this.setMediaKeysServerCertificate(l,e,h):l))),d.mediaKeys.catch(l=>{this.error(`Failed to create media-keys for "${e}"}: ${l}`)}),d.mediaKeys})}return r.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${ai.hexDump(e.keyId||[])}`);const i=n.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),s="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return ai.hexDump(e.keyId)}updateKeySession(e,t){var n;const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${ai.hexDump(((n=e.decryptdata)==null?void 0:n.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),i.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Br(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>this.getKeySystemSelectionPromise(e).then(({keySystem:i})=>{const s=Br(i);s?t(s):n(new Error(`Unable to find format for key-system "${i}"`))}).catch(n))}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=hr(this.config),n=e.map(is).filter(i=>!!i&&t.indexOf(i)!==-1);return this.selectKeySystem(n)}loadKey(e){const t=e.keyInfo.decryptdata,n=this.getKeyIdString(t),i=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let s=this.keyIdToKeySessionPromise[n];return s||(s=this.getKeySystemForKeyPromise(t).then(({keySystem:d,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(d,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:d,mediaKeys:u,decryptdata:t}))))),(this.keyIdToKeySessionPromise[n]=s.then(d=>{const u="cenc",c=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(d,u,c,"playlist-key")})).catch(d=>this.handleError(d))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof Kn?this.hls.trigger($.ERROR,e.data):this.hls.trigger($.ERROR,{type:xt.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),n=this.keyIdToKeySessionPromise[t];if(!n){const i=is(e.keyFormat),s=i?[i]:hr(this.config);return this.attemptKeySystemAccess(s)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=hr(this.config)),e.length===0)throw new Kn({type:xt.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${An({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(n).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>n.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,n,i){var s,r;const d=(s=this.config.drmSystems)==null||(r=s[e.keySystem])==null?void 0:r.generateRequest;if(d)try{const p=d.call(this.hls,t,n,e);if(!p)throw new Error("Invalid response from configured generateRequest filter");t=p.initDataType,n=p.initData?p.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(p){var u;if(this.warn(p.message),(u=this.hls)!=null&&u.config.debug)throw p}if(n===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const c=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${c} (init data type: ${t} length: ${n?n.byteLength:null})`);const l=new qo,h=e._onmessage=p=>{const m=e.mediaKeysSession;if(!m){l.emit("error",new Error("invalid state"));return}const{messageType:y,message:_}=p;this.log(`"${y}" message event for session "${m.sessionId}" message size: ${_.byteLength}`),y==="license-request"||y==="license-renewal"?this.renewLicense(e,_).catch(S=>{l.eventNames().length?l.emit("error",S):this.handleError(S)}):y==="license-release"?e.keySystem===tn.FAIRPLAY&&(this.updateKeySession(e,ao("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${y}"`)},o=e._onkeystatuseschange=p=>{if(!e.mediaKeysSession){l.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const y=e.keyStatus;l.emit("keyStatus",y),y==="expired"&&(this.warn(`${e.keySystem} expired for key ${c}`),this.renewKeySession(e))};Hn(e.mediaKeysSession,"message",h),Hn(e.mediaKeysSession,"keystatuseschange",o);const f=new Promise((p,m)=>{l.on("error",m),l.on("keyStatus",y=>{y.startsWith("usable")?p():y==="output-restricted"?m(new Kn({type:xt.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):y==="internal-error"?m(new Kn({type:xt.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${y}"`)):y==="expired"?m(new Error("key expired while generating request")):this.warn(`unhandled key status change "${y}"`)})});return e.mediaKeysSession.generateRequest(t,n).then(()=>{var p;this.log(`Request generated for key-session "${(p=e.mediaKeysSession)==null?void 0:p.sessionId}" keyId: ${c}`)}).catch(p=>{throw new Kn({type:xt.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_NO_SESSION,error:p,fatal:!1},`Error generating key-session request: ${p}`)}).then(()=>f).catch(p=>{throw l.removeAllListeners(),this.removeSession(e),p}).then(()=>(l.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,n)=>{if(typeof n=="string"&&typeof t=="object"){const i=n;n=t,t=i}this.log(`key status change "${t}" for keyStatuses keyId: ${ai.hexDump("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))} session keyId: ${ai.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,n=t.loader,i=new n(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((r,d)=>{const u={responseType:"arraybuffer",url:s},c=t.certLoadPolicy.default,l={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(o,f,p,m)=>{r(o.data)},onError:(o,f,p,m)=>{d(new Kn({type:xt.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:en({url:u.url,data:void 0},o)},`"${e}" certificate request failed (${s}). Status: ${o.code} (${o.text})`))},onTimeout:(o,f,p)=>{d(new Kn({type:xt.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:{url:u.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(o,f,p)=>{d(new Error("aborted"))}};i.load(u,l,h)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((i,s)=>{e.setServerCertificate(n).then(r=>{this.log(`setServerCertificate ${r?"success":"not supported by CDM"} (${n==null?void 0:n.byteLength}) on "${t}"`),i(e)}).catch(r=>{s(new Kn({type:xt.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:r,fatal:!0},r.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(i=>{throw new Kn({type:xt.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:i,fatal:!0},i.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(n,"application/xml"),s=i.querySelectorAll("HttpHeader");if(s.length>0){let l;for(let h=0,o=s.length;h<o;h++){var r,d;l=s[h];const f=(r=l.querySelector("name"))==null?void 0:r.textContent,p=(d=l.querySelector("value"))==null?void 0:d.textContent;f&&p&&e.setRequestHeader(f,p)}}const u=i.querySelector("Challenge"),c=u==null?void 0:u.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return ao(atob(c))}setupLicenseXHR(e,t,n,i){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,n,i)}).catch(r=>{if(!n.decryptdata)throw r;return e.open("POST",t,!0),s.call(this.hls,e,t,n,i)}).then(r=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:r||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((i,s)=>{const r=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${r}`);const d=new XMLHttpRequest;d.responseType="arraybuffer",d.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(d.readyState===4)if(d.status===200){this._requestLicenseFailureCount=0;let u=d.response;this.log(`License received ${u instanceof ArrayBuffer?u.byteLength:u}`);const c=this.config.licenseResponseCallback;if(c)try{u=c.call(this.hls,d,r,e)}catch(l){this.error(l)}i(u)}else{const u=n.errorRetry,c=u?u.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||d.status>=400&&d.status<500)s(new Kn({type:xt.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:d,response:{url:r,data:void 0,code:d.status,text:d.statusText}},`License Request XHR failed (${r}). Status: ${d.status} (${d.statusText})`));else{const l=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${l} attempts left`),this.requestLicense(e,t).then(i,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=d,this.setupLicenseXHR(d,r,e,t).then(({xhr:u,licenseChallenge:c})=>{e.keySystem==tn.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(u,c)),u.send(c)})})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,Hn(n,"encrypted",this.onMediaEncrypted),Hn(n,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(Jn(e,"encrypted",this.onMediaEncrypted),Jn(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,br.clearKeyUriToKeyIdMap();const i=n.length;tr.CDMCleanupPromise=Promise.all(n.map(s=>this.removeSession(s)).concat(t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(s=>{var r;this.log(`Could not clear media keys: ${s}`),(r=this.hls)==null||r.trigger($.ERROR,{type:xt.OTHER_ERROR,details:Me.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${s}`)})}))).catch(s=>{var r;this.log(`Could not close sessions and clear media keys: ${s}`),(r=this.hls)==null||r.trigger($.ERROR,{type:xt.OTHER_ERROR,details:Me.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${s}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((i,s)=>(i.indexOf(s.keyFormat)===-1&&i.push(s.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{drmSystemOptions:s}=this.config;return(gv(s)?new Promise((d,u)=>{self.setTimeout(()=>u(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(d)}):Promise.resolve()).catch(d=>{var u;this.log(`Could not remove session: ${d}`),(u=this.hls)==null||u.trigger($.ERROR,{type:xt.OTHER_ERROR,details:Me.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>t.close()).catch(d=>{var u;this.log(`Could not close session: ${d}`),(u=this.hls)==null||u.trigger($.ERROR,{type:xt.OTHER_ERROR,details:Me.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}}}tr.CDMCleanupPromise=void 0;class Kn extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class E1{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on($.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on($.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off($.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off($.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const i=performance.now();if(t){if(this.lastTime){const s=i-this.lastTime,r=n-this.lastDroppedFrames,d=t-this.lastDecodedFrames,u=1e3*r/s,c=this.hls;if(c.trigger($.FPS_DROP,{currentDropped:r,currentDecoded:d,totalDroppedFrames:n}),u>0&&r>c.config.fpsDroppedMonitoringThreshold*d){let l=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+l),l>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=l)&&(l=l-1,c.trigger($.FPS_DROP_LEVEL_CAPPING,{level:l,droppedLevel:c.currentLevel}),c.autoLevelCapping=l,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function Th(a,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=a,e.dispatchEvent(t)}function xh(a,e){const t=a.mode;if(t==="disabled"&&(a.mode="hidden"),a.cues&&!a.cues.getCueById(e.id))try{if(a.addCue(e),!a.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){Jt.debug(`[texttrack-utils]: ${n}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,a.addCue(i)}catch(i){Jt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(a.mode=t)}function Xi(a,e){const t=a.mode;if(t==="disabled"&&(a.mode="hidden"),a.cues)for(let n=a.cues.length;n--;)e&&a.cues[n].removeEventListener("enter",e),a.removeCue(a.cues[n]);t==="disabled"&&(a.mode=t)}function mo(a,e,t,n){const i=a.mode;if(i==="disabled"&&(a.mode="hidden"),a.cues&&a.cues.length>0){const s=x1(a.cues,e,t);for(let r=0;r<s.length;r++)(!n||n(s[r]))&&a.removeCue(s[r])}i==="disabled"&&(a.mode=i)}function T1(a,e){if(e<=a[0].startTime)return 0;const t=a.length-1;if(e>a[t].endTime)return-1;let n=0,i=t,s;for(;n<=i;)if(s=Math.floor((i+n)/2),e<a[s].startTime)i=s-1;else if(e>a[s].startTime&&n<t)n=s+1;else return s;return a[n].startTime-e<e-a[i].startTime?n:i}function x1(a,e,t){const n=[],i=T1(a,e);if(i>-1)for(let s=i,r=a.length;s<r;s++){const d=a[s];if(d.startTime>=e&&d.endTime<=t)n.push(d);else if(d.startTime>t)return n}return n}function os(a){const e=[];for(let t=0;t<a.length;t++){const n=a[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(a[t])}return e}class C1 extends Qo{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=os(this.media.textTracks);for(let s=0;s<n.length;s++)if(n[s].mode==="hidden")t=n[s];else if(n[s].mode==="showing"){t=n[s];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.LEVEL_LOADING,this.onLevelLoading,this),e.on($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on($.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.LEVEL_LOADING,this.onLevelLoading,this),e.off($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off($.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off($.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;os(n.textTracks).forEach(r=>{Xi(r)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:i,details:s}=t,r=this.tracksInGroup[n];if(!r||r.groupId!==i){this.warn(`Subtitle track with id:${n} and group:${i} not found in active group ${r==null?void 0:r.groupId}`);return}const d=r.details;r.details=t.details,this.log(`Subtitle track ${n} "${r.name}" lang:${r.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,d)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,i=this.groupIds;let s=this.currentTrack;if(!n||(i==null?void 0:i.length)!==(n==null?void 0:n.length)||n!=null&&n.some(r=>(i==null?void 0:i.indexOf(r))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const r=this.tracks.filter(l=>!n||n.indexOf(l.groupId)!==-1);if(r.length)this.selectDefaultTrack&&!r.some(l=>l.default)&&(this.selectDefaultTrack=!1),r.forEach((l,h)=>{l.id=h});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=r;const d=this.hls.config.subtitlePreference;if(!s&&d){this.selectDefaultTrack=!1;const l=li(d,r);if(l>-1)s=r[l];else{const h=li(d,this.tracks);s=this.tracks[h]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));const c={subtitleTracks:r};this.log(`Updating subtitle tracks, ${r.length} track(s) found in "${n==null?void 0:n.join(",")}" group-id`),this.hls.trigger($.SUBTITLE_TRACKS_UPDATED,c),u!==-1&&this.trackId===-1&&this.setSubtitleTrack(u)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const s=t[i];if(!(n&&!s.default||!n&&!e)&&(!e||Ni(s,e)))return i}if(e){for(let i=0;i<t.length;i++){const s=t[i];if(xr(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const s=t[i];if(xr(e.attrs,s.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(ho(i,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Vt.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&Ni(e,n))return n;const i=li(e,this.tracksInGroup);if(i>-1){const s=this.tracksInGroup[i];return this.setSubtitleTrack(i),s}else{if(n)return null;{const s=li(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),r=e.details,d=r==null?void 0:r.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${d&&r.live?" age "+d.toFixed(1)+(r.type&&" "+r.type||""):""} ${s}`),this.hls.trigger($.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=os(e.textTracks),n=this.currentTrack;let i;if(n&&(i=t.filter(s=>ho(n,s))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==i&&(s.mode="disabled")}),i){const s=this.subtitleDisplay?"showing":"hidden";i.mode!==s&&(i.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!pt(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger($.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!i.details&&!i.details.live;if(e===this.trackId&&i===n&&s)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:r,groupId:d="",name:u,type:c,url:l}=i;this.hls.trigger($.SUBTITLE_TRACK_SWITCH,{id:r,groupId:d,name:u,type:c,url:l});const h=this.switchParams(i.url,n==null?void 0:n.details,i.details);this.loadPlaylist(h)}}function w1(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?s:s&3|8).toString(16)})}}}function gr(a){let e=5381,t=a.length;for(;t;)e=e*33^a.charCodeAt(--t);return(e>>>0).toString()}const nr=.025;let ws=function(a){return a[a.Point=0]="Point",a[a.Range=1]="Range",a}({});function k1(a,e,t){return`${a.identifier}-${t+1}-${gr(e)}`}class R1{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Ba(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=Ba(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=pt(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Ba(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<nr))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?ws.Range:ws.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return I1(this)}}function Ba(a,e){return a-e.start<e.duration/2&&!(Math.abs(a-(e.start+e.duration))<nr)?e.start:e.start+e.duration}function Ch(a,e,t){const n=new self.URL(a,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function Fa(a,e){for(;(t=a.assetList[++e])!=null&&t.error;)var t;return e}function I1(a){return`["${a.identifier}" ${a.cue.pre?"<pre>":a.cue.post?"<post>":""}${a.timelineStart.toFixed(2)}-${a.resumeTime.toFixed(2)}]`}function Wi(a){const e=a.timelineStart,t=a.duration||0;return`["${a.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class L1{constructor(e,t,n,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls.trigger($.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=n,this.assetItem=i;let r=i.uri;try{r=Ch(r,t.primarySessionId).href}catch{}s.loadSource(r);const d=()=>{this.hasDetails=!0};s.once($.LEVEL_LOADED,d),s.once($.AUDIO_TRACK_LOADED,d),s.once($.SUBTITLE_TRACK_LOADED,d),s.on($.MEDIA_ATTACHING,(u,{media:c})=>{this.removeMediaListeners(),this.mediaAttached=c,this.interstitial.playoutLimit&&(c.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on($.BUFFER_APPENDED,()=>{const h=this.bufferedEnd;this.reachedPlayout(h)&&(this._bufferedEosTime=h,s.trigger($.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){var e;return((e=this.interstitial)==null?void 0:e.appendInPlace)||!1}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const n=this.timelineOffset,i=Ft.bufferInfo(e,n,0);return this.getAssetTime(i.end)>=this._bufferedEosTime-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Ft.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}resetDetails(){const e=this.hls;if(this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){this.hls.on(e,t)}once(e,t,n){this.hls.once(e,t)}off(e,t,n){this.hls.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Wi(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Xd=.033;class D1 extends vi{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(s=i[n])!=null&&s.event;){var s;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let i=0;i<n.length;i++){let s=n[i];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return i}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let i=e;i<=t&&n[i];i++){const s=n[i].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var n;if(((n=t[i].event)==null?void 0:n.identifier)===e)return i}return-1}findAssetIndex(e,t){const n=e.assetList,i=n.length;if(i>1)for(let s=0;s<i;s++){const r=n[s];if(!r.error){const d=r.timelineStart;if(t===d||t>d&&t<d+(r.duration||0))return s}}return 0}get assetIdAtEnd(){var e,t;const n=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(n){const i=n.assetList,s=i[i.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:i}=n,s=this.events,r=this.parseDateRanges(i,{url:n.url},t),d=Object.keys(i),u=s?s.filter(c=>!d.includes(c.identifier)):[];r.length&&r.sort((c,l)=>{const h=c.cue.pre,o=c.cue.post,f=l.cue.pre,p=l.cue.post;if(h&&!f)return-1;if(f&&!h||o&&!p)return 1;if(p&&!o)return-1;if(!h&&!f&&!o&&!p){const m=c.startTime,y=l.startTime;if(m!==y)return m-y}return c.dateRange.tagOrder-l.dateRange.tagOrder}),this.events=r,u.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,u)}updateSchedule(e,t=[]){const n=this.events||[];if(n.length||t.length||this.length<2){const i=this.items,s=this.parseSchedule(n,e);(t.length||(i==null?void 0:i.length)!==s.length||s.some((d,u)=>Math.abs(d.playout.start-i[u].playout.start)>.005||Math.abs(d.playout.end-i[u].playout.end)>.005))&&(this.items=s,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,n){const i=[],s=Object.keys(e);for(let r=0;r<s.length;r++){const d=s[r],u=e[d];if(u.isInterstitial){let c=this.eventMap[d];c?c.setDateRange(u):(c=new R1(u,t),this.eventMap[d]=c,n===!1&&(c.appendInPlace=n)),i.push(c)}}return i}parseSchedule(e,t){const n=[],i=t.main.details,s=i.live?1/0:i.edge;let r=0;if(e=e.filter(u=>!u.error&&!(u.cue.once&&u.hasPlayed)),e.length){this.resolveOffsets(e,t);let u=0,c=0;if(e.forEach((l,h)=>{const o=l.cue.pre,f=l.cue.post,p=e[h-1]||null,m=l.appendInPlace,y=f?s:l.startOffset,_=l.duration,S=l.timelineOccupancy===ws.Range?_:0,b=l.resumptionOffset,x=(p==null?void 0:p.startTime)===y,L=y+l.cumulativeDuration;let N=m?L+_:y+b;if(o||!f&&y<=0){const T=c;c+=S,l.timelineStart=L;const k=r;r+=_,n.push({event:l,start:L,end:N,playout:{start:k,end:r},integrated:{start:T,end:c}})}else if(y<=s){if(!x){const I=y-u;if(I>Xd){const F=u,V=c;c+=I;const ne=r;r+=I;const te={previousEvent:e[h-1]||null,nextEvent:l,start:F,end:F+I,playout:{start:ne,end:r},integrated:{start:V,end:c}};n.push(te)}else I>0&&p&&(p.cumulativeDuration+=I,n[n.length-1].end=y)}f&&(N=L),l.timelineStart=L;const T=c;c+=S;const k=r;r+=_,n.push({event:l,start:L,end:N,playout:{start:k,end:r},integrated:{start:T,end:c}})}else return;const P=l.resumeTime;f||P>s?u=s:u=P}),u<s){var d;const l=u,h=c,o=s-u;c+=o;const f=r;r+=o,n.push({previousEvent:((d=n[n.length-1])==null?void 0:d.event)||null,nextEvent:null,start:u,end:l+o,playout:{start:f,end:r},integrated:{start:h,end:c}})}this.setDurations(s,r,c)}else n.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,i=n.live?1/0:n.edge;let s=0,r=-1;e.forEach((d,u)=>{const c=d.cue.pre,l=d.cue.post,h=c?0:l?i:d.startTime;this.updateAssetDurations(d),r===h?d.cumulativeDuration=s:(s=0,r=h),!l&&d.snapOptions.in&&(d.resumeAnchor=Ui(null,n.fragments,d.startOffset+d.resumptionOffset,0,0)||void 0),d.appendInPlace&&!d.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(d,t)||(d.appendInPlace=!1)),!d.appendInPlace&&u+1<e.length&&e[u+1].startTime-e[u].resumeTime<Xd&&(e[u+1].appendInPlace=!1,e[u+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${d}`));const f=pt(d.resumeOffset)?d.resumeOffset:d.duration;s+=f})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(n-i)>nr?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${i}`),!1):t?!Object.keys(t).some(r=>{const d=t[r].details,u=d.edge;if(n>=u)return this.log(`"${e.identifier}" resumption ${n} past ${r} playlist end ${u}`),!1;const c=Ui(null,d.fragments,n);if(!c)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${r} playlist (${d.fragStart}-${d.fragmentEnd})`),!0;const l=r==="audio"?.175:0;return Math.abs(c.start-n)<nr+l||Math.abs(c.end-n)<nr+l?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${r} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${n} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,i=!1,s=!1;e.assetList.forEach((r,d)=>{const u=t+n;r.startOffset=n,r.timelineStart=u,i||(i=r.duration===null),s||(s=!!r.error);const c=r.error?0:r.duration||0;n+=c}),i&&!s?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Si(a){return`[${a.event?'"'+a.event.identifier+'"':"primary"}: ${a.start.toFixed(2)}-${a.end.toFixed(2)}]`}class P1{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let i;try{i=Ch(n,this.hls.sessionId,e.baseUrl)}catch(o){const f=this.assignAssetListError(e,Me.ASSET_LIST_LOAD_ERROR,o,n);this.hls.trigger($.ERROR,f);return}t&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,r=s.loader,d=new r(s),u={responseType:"json",url:i.href},c=s.interstitialAssetListLoadPolicy.default,l={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(o,f,p,m)=>{const y=o.data,_=y==null?void 0:y.ASSETS;if(!Array.isArray(_)){const S=this.assignAssetListError(e,Me.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),p.url,f,m);this.hls.trigger($.ERROR,S);return}e.assetListResponse=y,this.hls.trigger($.ASSET_LIST_LOADED,{event:e,assetListResponse:y,networkDetails:m})},onError:(o,f,p,m)=>{const y=this.assignAssetListError(e,Me.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${o.code} ${o.text} (${f.url})`),f.url,m,p);this.hls.trigger($.ERROR,y)},onTimeout:(o,f,p)=>{const m=this.assignAssetListError(e,Me.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${f.url})`),f.url,o,p);this.hls.trigger($.ERROR,m)}};return d.load(u,l,h),this.hls.trigger($.ASSET_LIST_LOADING,{event:e}),d}assignAssetListError(e,t,n,i,s,r){return e.error=n,{type:xt.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:n,networkDetails:r,stats:s}}}function Jd(a){a==null||a.play().catch(()=>{})}class O1 extends vi{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;const i=n-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const r=i<=-.01;this.timelinePos=n,this.bufferedPos=n;const d=this.playingItem;if(!d){this.checkBuffer();return}if(r&&this.schedule.resetErrorsInRange(n,n-i)&&this.updateSchedule(),this.checkBuffer(),r&&n<d.start||n>=d.end){var u;const o=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(d)&&(u=this.media)!=null&&u.paused&&(this.shouldPlay=!1),!r){const f=this.findItemIndex(d);if(o>f){const p=this.schedule.findJumpRestrictedIndex(f+1,o);if(p>f){this.setSchedulePosition(p);return}}}this.setSchedulePosition(o);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(d)){const o=d.event.assetList[0];o&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,o))}return}const l=c.timelineStart,h=c.duration||0;(r&&n<l||n>=l+h)&&this.setScheduleToAssetAtTime(n,c)},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(n>=i.end){this.timelinePos=i.end;const d=this.findItemIndex(i);this.setSchedulePosition(d+1)}const s=this.playingAsset;if(!s)return;const r=s.timelineStart+(s.duration||0);n>=r&&this.setScheduleToAssetAtTime(n,s)},this.onScheduleUpdate=(n,i)=>{const s=this.schedule,r=this.playingItem,d=s.events||[],u=s.items||[],c=s.durations,l=n.map(p=>p.identifier),h=!!(d.length||l.length);(h||i)&&this.log(`INTERSTITIALS_UPDATED (${d.length}): ${d}
Schedule: ${u.map(p=>Si(p))} pos: ${this.timelinePos}`),l.length&&this.log(`Removed events ${l}`),this.playerQueue.forEach(p=>{if(p.interstitial.appendInPlace){const m=p.assetItem.timelineStart,y=p.timelineOffset-m;if(y)try{p.timelineOffset=m}catch(_){Math.abs(y)>nr&&this.warn(`${_} ("${p.assetId}" ${p.timelineOffset}->${m})`)}}});let o=null;if(r){const p=this.updateItem(r,this.timelinePos);this.itemsMatch(r,p)&&(this.playingItem=p,this.waitingItem=this.endedItem=null,o=()=>this.trimInPlace(p,r))}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const f=this.bufferingItem;if(f){const p=this.updateItem(f,this.bufferedPos);this.itemsMatch(f,p)?(this.bufferingItem=p,o||(o=()=>this.trimInPlace(p,f))):f.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(f.event,null))}if(n.forEach(p=>{p.assetList.forEach(m=>{this.clearAssetPlayer(m.identifier,null)})}),h||i){if(this.hls.trigger($.INTERSTITIALS_UPDATED,{events:d.slice(0),schedule:u.slice(0),durations:c,removedIds:l}),this.isInterstitial(r)&&l.includes(r.event.identifier)){this.warn(`Interstitial "${r.event.identifier}" removed while playing`),this.primaryFallback(r.event);return}o&&o(),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new P1(e),this.schedule=new D1(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.LEVEL_UPDATED,this.onLevelUpdated,this),e.on($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on($.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on($.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on($.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on($.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on($.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on($.BUFFER_APPENDED,this.onBufferAppended,this),e.on($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on($.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on($.MEDIA_ENDED,this.onMediaEnded,this),e.on($.ERROR,this.onError,this),e.on($.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.LEVEL_UPDATED,this.onLevelUpdated,this),e.off($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off($.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off($.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off($.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off($.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off($.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off($.BUFFER_CODECS,this.onBufferCodecs,this),e.off($.BUFFER_APPENDED,this.onBufferAppended,this),e.off($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off($.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off($.MEDIA_ENDED,this.onMediaEnded,this),e.off($.ERROR,this.onError,this),e.off($.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Jn(e,"play",this.onPlay),Jn(e,"pause",this.onPause),Jn(e,"seeking",this.onSeeking),Jn(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;Hn(n,"seeking",this.onSeeking),Hn(n,"timeupdate",this.onTimeupdate),Hn(n,"play",this.onPlay),Hn(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!i){this.clearScheduleState();const s=this.findItemIndex(n);this.setSchedulePosition(s)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(this.media=null,!n&&(i&&this.removeMediaListeners(i),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=h=>h&&e.getAssetPlayer(h.identifier),i=(h,o,f,p,m)=>{if(h){let y=h[o].start;const _=h.event;if(_){if(o==="playout"||_.timelineOccupancy!==ws.Point){const S=n(f);(S==null?void 0:S.interstitial)===_&&(y+=S.assetItem.startOffset+S[m])}}else{const S=p==="bufferedPos"?r():e[p];y+=S-h.start}return y}return 0},s=(h,o)=>{if(h!==0&&o!=="primary"&&e.schedule.length){var f;const p=e.schedule.findItemIndexAtTime(h),m=(f=e.schedule.items)==null?void 0:f[p];if(m){const y=m[o].start-m.start;return h+y}}return h},r=()=>{const h=e.bufferedPos;return h===Number.MAX_VALUE?d("primary"):Math.max(h,0)},d=h=>{var o;return(o=e.primaryDetails)!=null&&o.live?e.primaryDetails.edge:e.schedule.durations[h]},u=(h,o)=>{var f,p;const m=e.effectivePlayingItem;if(m!=null&&(f=m.event)!=null&&f.restrictions.skip)return;e.log(`seek to ${h} "${o}"`);const y=e.effectivePlayingItem,_=e.schedule.findItemIndexAtTime(h,o),S=(p=e.schedule.items)==null?void 0:p[_],b=e.getBufferingPlayer(),x=b==null?void 0:b.interstitial,L=x==null?void 0:x.appendInPlace,N=y&&e.itemsMatch(y,S);if(y&&(L||N)){const T=n(e.playingAsset),k=(T==null?void 0:T.media)||e.primaryMedia;if(k){const I=o==="primary"?k.currentTime:i(y,o,e.playingAsset,"timelinePos","currentTime"),F=h-I,V=(L?I:k.currentTime)+F;if(V>=0&&(!T||L||V<=T.duration)){k.currentTime=V;return}}}if(S){let T=h;if(o!=="primary"){const I=S[o].start,F=h-I;T=S.start+F}const k=!e.isInterstitial(S);if((!e.isInterstitial(y)||y.event.appendInPlace)&&(k||S.event.appendInPlace)){const I=e.media||(L?b==null?void 0:b.media:null);I&&(I.currentTime=T)}else if(y){const I=e.findItemIndex(y);if(_>I){const V=e.schedule.findJumpRestrictedIndex(I+1,_);if(V>I){e.setSchedulePosition(V);return}}let F=0;if(k)e.timelinePos=T,e.checkBuffer();else{var P;const V=S==null||(P=S.event)==null?void 0:P.assetList;if(V){const ne=h-(S[o]||S).start;for(let te=V.length;te--;){const Z=V[te];if(Z.duration&&ne>=Z.startOffset&&ne<Z.startOffset+Z.duration){F=te;break}}}}e.setSchedulePosition(_,F)}}},c=()=>{const h=e.effectivePlayingItem;if(e.isInterstitial(h))return h;const o=t();return e.isInterstitial(o)?o:null},l={get currentTime(){const h=c(),o=e.effectivePlayingItem;return o&&o===h?i(o,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-o.playout.start:0},set currentTime(h){const o=c(),f=e.effectivePlayingItem;f&&f===o&&u(h+f.playout.start,"playout")},get duration(){const h=c();return h?h.playout.end-h.playout.start:0},get assetPlayers(){var h;const o=(h=c())==null?void 0:h.event.assetList;return o?o.map(f=>e.getAssetPlayer(f.identifier)):[]},get playingIndex(){var h;const o=(h=c())==null?void 0:h.event;return o&&e.effectivePlayingAsset?o.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};this.manager={get events(){var h,o;return((h=e.schedule)==null||(o=h.events)==null?void 0:o.slice(0))||[]},get schedule(){var h,o;return((h=e.schedule)==null||(o=h.items)==null?void 0:o.slice(0))||[]},get interstitialPlayer(){return c()?l:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const h=t();return e.findItemIndex(h)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const h=e.effectivePlayingItem;return e.findItemIndex(h)},primary:{get bufferedEnd(){return r()},get currentTime(){const h=e.timelinePos;return h>0?h:0},set currentTime(h){u(h,"primary")},get duration(){return d("primary")},get seekableStart(){var h;return((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(h){u(h,"integrated")},get duration(){return d("integrated")},get seekableStart(){var h;return s(((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0,"integrated")}},skip:()=>{const h=e.effectivePlayingItem,o=h==null?void 0:h.event;if(o&&!o.restrictions.skip){const f=e.findItemIndex(h);if(o.appendInPlace){const p=h.playout.start+h.event.duration;u(p+.001,"playout")}else e.advanceAfterAssetEnded(o,f,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t,n;if(this.mediaSelection===null)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(s=this.primaryMedia);const r=(n=s)==null?void 0:n.currentTime;if(!(r===void 0||!pt(r)))return r}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,i=e.media;if(n&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${An(s)}`),this.detachedData=s}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var n,i;if(e.media===t)return;let s=null;const r=this.hls,d=e!==r,u=d&&e.interstitial.appendInPlace,c=(n=this.detachedData)==null?void 0:n.mediaSource;let l;if(r.media)u&&(s=r.transferMedia(),this.detachedData=s),l="Primary";else if(c){const f=this.getBufferingPlayer();f?(s=f.transferMedia(),l=`${f}`):l="detached MediaSource"}else l="detached media";if(!s){if(c)s=this.detachedData,this.log(`using detachedData: MediaSource ${An(s)}`);else if(!this.detachedData||r.media===t){const f=this.playerQueue;f.length>1&&f.forEach(p=>{if(d&&p.interstitial.appendInPlace!==u){const m=p.interstitial;this.clearInterstitial(p.interstitial,null),m.appendInPlace=!1,m.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${m}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const h=s&&"mediaSource"in s&&((i=s.mediaSource)==null?void 0:i.readyState)!=="closed",o=h&&s?s:t;if(this.log(`${h?"transfering MediaSource":"attaching media"} to ${d?e:"Primary"} from ${l}`),o===s){const f=d&&e.assetId===this.schedule.assetIdAtEnd;o.overrides={duration:this.schedule.duration,endOfStream:!d||f,cueRemoval:!d}}e.attachMedia(o)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,i=this.effectivePlayingItem;if(n===-1){const s=this.hls.startPosition;if(this.timelinePos=s,t.length&&t[0].cue.pre){const r=e.findEventIndex(t[0].identifier);this.setSchedulePosition(r)}else if(s>=0||!this.primaryLive){const r=this.timelinePos=s>0?s:0,d=e.findItemIndexAtTime(r);this.setSchedulePosition(d)}}else if(i&&!this.playingItem){const s=e.findItemIndex(i);this.setSchedulePosition(s)}}advanceAfterAssetEnded(e,t,n){const i=Fa(e,n);if(!e.isAssetPastPlayoutLimit(i))this.setSchedulePosition(t,i);else{const s=this.schedule.items;if(s){const r=t+1,d=s.length;if(r>=d){this.setSchedulePosition(-1);return}const u=e.resumeTime;this.timelinePos<u&&(this.timelinePos=u,this.checkBuffer()),this.setSchedulePosition(r)}}}setScheduleToAssetAtTime(e,t){const n=this.schedule,i=t.parentIdentifier,s=n.getEvent(i);if(s){const r=n.findEventIndex(i),d=n.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,r,d-1)}}setSchedulePosition(e,t){const n=this.schedule.items;if(!n||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const i=e>=0?n[e]:null,s=this.playingItem,r=this.playingLastItem;if(this.isInterstitial(s)){var d;const c=s.event,l=this.playingAsset,h=l==null?void 0:l.identifier,o=h?this.getAssetPlayer(h):null;if(o&&h&&(!this.eventItemsMatch(s,i)||t!==void 0&&h!==((d=c.assetList)==null?void 0:d[t].identifier))){var u;const f=c.findAssetIndex(l);this.log(`INTERSTITIAL_ASSET_ENDED ${f+1}/${c.assetList.length} ${Wi(l)}`),this.endedAsset=l,this.playingAsset=null,this.hls.trigger($.INTERSTITIAL_ASSET_ENDED,{asset:l,assetListIndex:f,event:c,schedule:n.slice(0),scheduleIndex:e,player:o}),this.retreiveMediaSource(h,i),o.media&&!((u=this.detachedData)!=null&&u.mediaSource)&&o.detachMedia()}if(!this.eventItemsMatch(s,i)&&(this.endedItem=s,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${c} ${Si(s)}`),c.hasPlayed=!0,this.hls.trigger($.INTERSTITIAL_ENDED,{event:c,schedule:n.slice(0),scheduleIndex:e}),c.cue.once)){this.updateSchedule();const f=this.schedule.items;if(i&&f){const p=this.schedule.findItemIndex(i);this.advanceSchedule(p,f,t,s,r)}return}}this.advanceSchedule(e,n,t,s,r)}advanceSchedule(e,t,n,i,s){const r=e>=0?t[e]:null,d=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(c=>{const l=c.interstitial,h=this.schedule.findEventIndex(l.identifier);(h<e||h>e+1)&&this.clearInterstitial(l,r)}),this.isInterstitial(r)){this.timelinePos=Math.min(Math.max(this.timelinePos,r.start),r.end);const c=r.event;if(n===void 0){n=this.schedule.findAssetIndex(c,this.timelinePos);const f=Fa(c,n-1);if(c.isAssetPastPlayoutLimit(f)){this.advanceAfterAssetEnded(c,e,n);return}n=f}const l=this.waitingItem;this.assetsBuffered(r,d)||this.setBufferingItem(r);let h=this.preloadAssets(c,n);if(this.eventItemsMatch(r,l||i)||(this.waitingItem=r,this.log(`INTERSTITIAL_STARTED ${Si(r)} ${c.appendInPlace?"append in place":""}`),this.hls.trigger($.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${c}`);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!d){this.log(`Waiting for attachMedia to start Interstitial ${c}`);return}this.waitingItem=this.endedItem=null,this.playingItem=r;const o=c.assetList[n];if(!o){const f=t[e+1],p=this.media;f&&p&&!this.isInterstitial(f)&&p.currentTime<f.start&&(p.currentTime=this.timelinePos=f.start),this.advanceAfterAssetEnded(c,e,n||0);return}if(h||(h=this.getAssetPlayer(o.identifier)),h===null||h.destroyed){const f=c.assetList.length;this.warn(`asset ${n+1}/${f} player destroyed ${c}`),h=this.createAssetPlayer(c,o,n)}if(!this.eventItemsMatch(r,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(o))return;this.startAssetPlayer(h,n,t,e,d),this.shouldPlay&&Jd(h.media)}else r!==null?(this.resumePrimary(r,e,i),this.shouldPlay&&Jd(this.hls.media)):s&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Si(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let r=this.timelinePos;(r<e.start||r>=e.end)&&(r=this.getPrimaryResumption(e,t),this.timelinePos=r),this.attachPrimary(r,e)}if(!n)return;const s=this.schedule.items;s&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Si(e)}`),this.hls.trigger($.INTERSTITIALS_PRIMARY_RESUMED,{schedule:s.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const i=this.primaryDetails;if(t===0)return this.hls.startPosition;if(i&&(n<i.fragmentStart||n>i.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Ft.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,i),n&&this.startLoadingPrimaryAt(e,n)),n||(this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((n=i.mainForwardBufferInfo)==null?void 0:n.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off($.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on($.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1)return;const n=this.hls.levels[t.level],i=en(en({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=en(en({},this.altSelection),{},{audio:n});return}const s=en(en({},i),{},{audio:n});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=en(en({},this.altSelection),{},{subtitles:n});return}const s=en(en({},i),{},{subtitles:n});this.mediaSelection=s}onAudioTrackSwitching(e,t){const n=dd(t);this.playerQueue.forEach(i=>i.hls.setAudioOption(t)||i.hls.setAudioOption(n))}onSubtitleTrackSwitch(e,t){const n=dd(t);this.playerQueue.forEach(i=>i.hls.setSubtitleOption(t)||t.id!==-1&&i.hls.setSubtitleOption(n))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let i=0;i<t.length;i++){const s=t[i];if(s.cue.post){var n;const r=this.schedule.findEventIndex(s.identifier),d=(n=this.schedule.items)==null?void 0:n[r];this.isInterstitial(d)&&this.eventItemsMatch(d,this.bufferingItem)&&this.bufferedToItem(d,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){const n=this.schedule.items;if(e&&n){const i=this.findItemIndex(e,t);return n[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,r)=>{e.event.isAssetPastPlayoutLimit(r)&&this.clearAssetPlayer(s.identifier,null)});const n=e.end+.25,i=Ft.bufferInfo(this.primaryMedia,n,0);(i.end>n||(i.nextStart||0)>n)&&(this.attachPrimary(n,null),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const n=Ft.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=n.len<1),this.updateBufferedPos(n.end,t,e)}updateBufferedPos(e,t,n){const i=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const r=this.playingItem,d=this.findItemIndex(r);let u=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var c,l;const h=this.findItemIndex(s),o=Math.min(h+1,t.length-1),f=t[o];if((u===-1&&s&&e>=s.end||(c=f.event)!=null&&c.appendInPlace&&e+.01>=f.start)&&(u=o),o-d>1&&(s==null||(l=s.event)==null?void 0:l.appendInPlace)===!1)return;if(this.bufferedPos=e,u>h&&u>d)this.bufferedToItem(f);else{const p=this.primaryDetails;this.primaryLive&&p&&e>p.edge-p.targetduration&&f.start<p.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else n&&r&&!this.itemsMatch(r,s)&&(u===d?this.bufferedToItem(r):u===d+1&&this.bufferedToItem(t[u]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const s=this.getAssetPlayer(i.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:i,events:s}=n;if(!i||!s)return t;const r=this.isInterstitial(e),d=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const u=d?d.remaining:t?t.end-this.timelinePos:0;this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Si(e)}`+(t?` (${u.toFixed(2)} remaining)`:"")),this.playbackDisabled||(r?e.event.assetList.forEach(c=>{const l=this.getAssetPlayer(c.identifier);l&&l.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering()))),this.hls.trigger($.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,i=n.assetList.length===0&&!n.assetListLoader,s=n.cue.once;if(i||!s){const r=this.preloadAssets(n,t);if(r!=null&&r.interstitial.appendInPlace){const d=n.assetList[t],u=this.primaryMedia;d&&u&&this.bufferAssetPlayer(r,u)}}}preloadAssets(e,t){const n=e.assetUrl,i=e.assetList.length,s=i===0&&!e.assetListLoader,r=e.cue.once;if(s){const u=e.timelineStart;if(e.appendInPlace){var d;const o=this.playingItem;!this.isInterstitial(o)&&(o==null||(d=o.nextEvent)==null?void 0:d.identifier)===e.identifier&&this.flushFrontBuffer(u+.25)}let c,l=0;if(!this.playingItem&&this.primaryLive&&(l=this.hls.startPosition,l===-1&&(l=this.hls.liveSyncPosition||0)),l&&!(e.cue.pre||e.cue.post)){const o=l-u;o>0&&(c=Math.round(o*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:i} ${e}${c?` live-start: ${l} start-offset: ${c}`:""}`),n)return this.createAsset(e,0,0,u,e.duration,n);const h=this.assetListLoader.loadAssetList(e,c);h&&(e.assetListLoader=h)}else if(!r&&i){for(let u=t;u<i;u++){const c=e.assetList[u],l=this.getAssetPlayerQueueIndex(c.identifier);(l===-1||this.playerQueue[l].destroyed)&&!c.error&&this.createAssetPlayer(e,c,u)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(i=>{this.hls.trigger($.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,i,s,r){const d={parentIdentifier:e.identifier,identifier:k1(e,r,t),duration:s,startOffset:n,timelineStart:i,uri:r};return this.createAssetPlayer(e,d,t)}createAssetPlayer(e,t,n){const i=this.hls,s=i.userConfig;let r=s.videoPreference;const d=i.loadLevelObj||i.levels[i.currentLevel];(r||d)&&(r=nn({},r),d.videoCodec&&(r.videoCodec=d.videoCodec),d.videoRange&&(r.allowedVideoRanges=[d.videoRange]));const u=i.audioTracks[i.audioTrack],c=i.subtitleTracks[i.subtitleTrack];let l=0;if(this.primaryLive||e.appendInPlace){const b=this.timelinePos-t.timelineStart;if(b>1){const x=t.duration;x&&b<x&&(l=b)}}const h=t.identifier,o=en(en({},s),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:h,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:l,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:r,audioPreference:u||s.audioPreference,subtitlePreference:c||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(o.timelineOffset=t.timelineStart));const f=o.cmcd;f!=null&&f.sessionId&&f.contentId&&(o.cmcd=nn({},f,{contentId:gr(t.uri)})),this.getAssetPlayer(h)&&this.warn(`Duplicate date range identifier ${e} and asset ${h}`);const p=new L1(this.HlsPlayerClass,o,e,t);this.playerQueue.push(p),e.assetList[n]=t;const m=b=>{if(b.live){const N=new Error(`Interstitials MUST be VOD assets ${e}`),P={fatal:!0,type:xt.OTHER_ERROR,details:Me.INTERSTITIAL_ASSET_ITEM_ERROR,error:N};this.handleAssetItemError(P,e,this.schedule.findEventIndex(e.identifier),n,N.message);return}const x=b.edge-b.fragmentStart,L=t.duration;(L===null||x>L)&&(this.log(`Interstitial asset "${h}" duration change ${L} > ${x}`),t.duration=x,this.updateSchedule())};p.on($.LEVEL_UPDATED,(b,{details:x})=>m(x)),p.on($.LEVEL_PTS_UPDATED,(b,{details:x})=>m(x));const y=(b,x)=>{const L=this.getAssetPlayer(h);if(L&&x.tracks){L.off($.BUFFER_CODECS,y),L.tracks=x.tracks;const N=this.primaryMedia;this.bufferingAsset===L.assetItem&&N&&!L.media&&this.bufferAssetPlayer(L,N)}};p.on($.BUFFER_CODECS,y);const _=()=>{var b;const x=this.getAssetPlayer(h);if(this.log(`buffered to end of asset ${x}`),!x)return;const L=this.schedule.findEventIndex(e.identifier),N=(b=this.schedule.items)==null?void 0:b[L];if(this.isInterstitial(N)){const T=e.findAssetIndex(t),k=Fa(e,T);if(!e.isAssetPastPlayoutLimit(k))this.bufferedToItem(N,k);else{var P;const I=(P=this.schedule.items)==null?void 0:P[L+1];I&&this.bufferedToItem(I)}}};p.on($.BUFFERED_TO_END,_);const S=b=>()=>{if(!this.getAssetPlayer(h))return;this.shouldPlay=!0;const L=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,L,b)};return p.once($.MEDIA_ENDED,S(n)),p.once($.PLAYOUT_LIMIT_REACHED,S(1/0)),p.on($.ERROR,(b,x)=>{const L=this.getAssetPlayer(h);if(x.details===Me.BUFFER_STALLED_ERROR){if(L!=null&&L.media){const N=L.currentTime,P=L.duration-N;N&&e.appendInPlace&&P/L.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${h} ${e} at ${L.media.currentTime}`),_()):(this.warn(`Stalled at ${N} of ${N+P} in asset ${h} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(x,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${x.error} ${e}`)}),p.on($.DESTROYING,()=>{if(!this.getAssetPlayer(h))return;const x=new Error(`Asset player destroyed unexpectedly ${h}`),L={fatal:!0,type:xt.OTHER_ERROR,details:Me.INTERSTITIAL_ASSET_ITEM_ERROR,error:x};this.handleAssetItemError(L,e,this.schedule.findEventIndex(e.identifier),n,x.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Wi(t)}`),this.hls.trigger($.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:p}),p}clearInterstitial(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){this.log(`clear asset player "${e}" toSegment: ${t&&Si(t)}`);const i=this.playerQueue[n];this.transferMediaFromPlayer(i,t),this.playerQueue.splice(n,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,i,s){const{interstitial:r,assetItem:d,assetId:u}=e,c=r.assetList.length,l=this.playingAsset;this.endedAsset=null,this.playingAsset=d,(!l||l.identifier!==u)&&(l&&(this.clearAssetPlayer(l.identifier,n[i]),delete l.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${Wi(d)}`),this.hls.trigger($.INTERSTITIAL_ASSET_STARTED,{asset:d,assetListIndex:t,event:r,schedule:n.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var n,i;const{interstitial:s,assetItem:r}=e,d=this.schedule.findEventIndex(s.identifier),u=(n=this.schedule.items)==null?void 0:n[d];if(!u)return;this.setBufferingItem(u),this.bufferingAsset=r;const c=this.getBufferingPlayer();if(c===e)return;const l=s.appendInPlace;if(l&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const h=(c==null?void 0:c.tracks)||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(l&&r!==this.playingAsset){if(!e.tracks)return;if(h&&!yu(h,e.tracks)){const o=new Error(`Asset ${Wi(r)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(h)}')`),f={fatal:!0,type:xt.OTHER_ERROR,details:Me.INTERSTITIAL_ASSET_ITEM_ERROR,error:o},p=s.findAssetIndex(r);this.handleAssetItemError(f,s,d,p,o.message);return}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,n,i,s){if(e.details===Me.BUFFER_STALLED_ERROR)return;const r=t.assetList[i];this.warn(`INTERSTITIAL_ASSET_ERROR ${r&&Wi(r)} ${e.error}`);const d=r==null?void 0:r.identifier,u=this.getAssetPlayerQueueIndex(d),c=this.playerQueue[u]||null,l=this.schedule.items,h=nn({},e,{fatal:!1,errorAction:vr(!0),asset:r,assetListIndex:i,event:t,schedule:l,scheduleIndex:n,player:c});if(this.hls.trigger($.INTERSTITIAL_ASSET_ERROR,h),!e.fatal)return;const o=this.playingAsset,f=new Error(s);if(r&&(this.clearAssetPlayer(d,null),r.error=f),!t.assetList.some(p=>!p.error))t.error=f;else if(t.appendInPlace){for(let p=i;p<t.assetList.length;p++)this.resetAssetPlayer(t.assetList[p].identifier);this.updateSchedule()}t.error?this.primaryFallback(t):o&&o.identifier===d&&this.advanceAfterAssetEnded(t,n,i)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;if(this.updateSchedule(),n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${n?Si(n):"<none>"} error: ${e.error}`);let i=this.timelinePos;i===-1&&(i=this.hls.startPosition);const s=this.updateItem(n,i);this.itemsMatch(n,s)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));const r=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(r)}else this.checkStart()}onAssetListLoaded(e,t){var n;const i=t.event,s=i.identifier,r=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(s))return;const d=i.timelineStart,u=i.duration;let c=0;r.forEach((p,m)=>{const y=parseFloat(p.DURATION);this.createAsset(i,m,c,d+c,y,p.URI),c+=y}),i.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${u}) ${i}`);const l=this.waitingItem,h=(l==null?void 0:l.event.identifier)===s;this.updateSchedule();const o=(n=this.bufferingItem)==null?void 0:n.event;if(h){var f;const p=this.schedule.findEventIndex(s),m=(f=this.schedule.items)==null?void 0:f[p];if(m){if(!this.playingItem&&this.timelinePos>m.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==p){i.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${i}`),this.primaryFallback(i);return}this.setBufferingItem(m)}this.setSchedulePosition(p)}else if((o==null?void 0:o.identifier)===s&&o.appendInPlace){const p=i.assetList[0],m=this.getAssetPlayer(p.identifier),y=this.primaryMedia;p&&m&&y&&this.bufferAssetPlayer(m,y)}}onError(e,t){switch(t.details){case Me.ASSET_LIST_PARSING_ERROR:case Me.ASSET_LIST_LOAD_ERROR:case Me.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&this.primaryFallback(n);break}case Me.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Qd=500;class M1 extends Ho{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",bt.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on($.LEVEL_LOADED,this.onLevelLoaded,this),e.on($.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on($.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on($.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on($.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on($.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off($.LEVEL_LOADED,this.onLevelLoaded,this),e.off($.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off($.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off($.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off($.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off($.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=Ke.IDLE,this.setInterval(Qd),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:i}=t;if(Pn(n)&&(this.fragPrevious=n),this.state=Ke.IDLE,!i)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let r;const d=n.start;for(let c=0;c<s.length;c++)if(d>=s[c].start&&d<=s[c].end){r=s[c];break}const u=n.start+n.duration;r?r.end=u:(r={start:d,end:u},s.push(r)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:i}=t;if(n===0&&i!==Number.POSITIVE_INFINITY){const s=i-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(r=>{for(let d=0;d<r.length;){if(r[d].end<=s){r.shift();continue}else if(r[d].start<s)r[d].start=s;else break;d++}}),this.fragmentTracker.removeFragmentsInRange(n,s,bt.SUBTITLE)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===bt.SUBTITLE&&(t.details===Me.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Ke.STOPPED&&(this.state=Ke.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&gh(this.levels,t)){this.levels=t.map(n=>new Ar(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const i=new Ar(n);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,bt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==Ke.STOPPED&&this.setInterval(Qd)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:i,levels:s}=this,{details:r,id:d}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${d}`);return}const u=s[d];if(d>=s.length||!u)return;this.log(`Subtitle track ${d} loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(r.live||(n=u.details)!=null&&n.live){const h=this.mainDetails;if(r.deltaUpdateFailed||!h)return;const o=h.fragments[0];if(!u.details)r.hasProgramDateTime&&h.hasProgramDateTime?(xs(r,h),c=r.fragmentStart):o&&(c=o.start,lo(r,c));else{var l;c=this.alignPlaylists(r,u.details,(l=this.levelLastLoaded)==null?void 0:l.details),c===0&&o&&(c=o.start,lo(r,c))}}u.details=r,this.levelLastLoaded=u,d===i&&(this.hls.trigger($.SUBTITLE_TRACK_UPDATED,{details:r,id:d,groupId:t.groupId}),this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===Ke.IDLE&&(Ui(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),u.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&i!=null&&i.key&&i.iv&&er(i.method)){const r=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer,Vo(i.method)).catch(d=>{throw s.trigger($.ERROR,{type:xt.MEDIA_ERROR,details:Me.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:t}),d}).then(d=>{const u=performance.now();s.trigger($.FRAG_DECRYPTED,{frag:t,payload:d,stats:{tstart:r,tdecrypt:u}})}).catch(d=>{this.warn(`${d.name}: ${d.message}`),this.state=Ke.IDLE})}}doTick(){if(!this.media){this.state=Ke.IDLE;return}if(this.state===Ke.IDLE){const{currentTrackId:e,levels:t}=this,n=t==null?void 0:t[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:i}=this,s=this.getLoadPosition(),r=Ft.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,i.maxBufferHole),{end:d,len:u}=r,c=n.details,l=this.hls.maxBufferLength+c.levelTargetDuration;if(u>l)return;const h=c.fragments,o=h.length,f=c.edge;let p=null;const m=this.fragPrevious;if(d<f){const S=i.maxFragLookUpTolerance,b=d>f-S?0:S;p=Ui(m,h,Math.max(h[0].start,d),b),!p&&m&&m.start<h[0].start&&(p=h[0])}else p=h[o-1];if(p=this.filterReplacedPrimary(p,n.details),!p)return;const y=p.sn-c.startSN,_=h[y-1];if(_&&_.cc===p.cc&&this.fragmentTracker.getState(_)===Rn.NOT_LOADED&&(p=_),this.fragmentTracker.getState(p)===Rn.NOT_LOADED){const S=this.mapToInitFragWhenRequired(p);S&&this.loadFragment(S,n,d)}}}loadFragment(e,t,n){Pn(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new B1(this.tracksBuffered[this.currentTrackId]||[])}}class B1{constructor(e){this.buffered=void 0;const t=(n,i,s)=>{if(i=i>>>0,i>s-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const F1={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},wh=a=>String.fromCharCode(F1[a]||a),ei=15,gi=100,N1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},U1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},$1={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},G1={25:2,26:4,29:6,30:8,31:10,27:13,28:15},V1=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class j1{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;Jt.log(`${this.time} [${e}] ${n}`)}}}const Ii=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class kh{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const i=t[n];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class H1{constructor(){this.uchar=" ",this.penState=new kh}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class q1{constructor(e){this.chars=[],this.pos=0,this.currPenState=new kh,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<gi;t++)this.chars.push(new H1);this.logger=e}equals(e){for(let t=0;t<gi;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<gi;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<gi;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>gi&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=gi)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=wh(e);if(this.pos>=gi){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<gi;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<gi;n++){const i=this.chars[n].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Na{constructor(e){this.rows=[],this.currRow=ei-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<ei;t++)this.rows.push(new q1(e));this.logger=e}reset(){for(let e=0;e<ei;e++)this.rows[e].clear();this.currRow=ei-1}equals(e){let t=!0;for(let n=0;n<ei;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<ei;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<ei;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+An(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let d=0;d<ei;d++)this.rows[d].clear();const s=this.currRow+1-this.nrRollUpRows,r=this.lastOutputScreen;if(r){const d=r.rows[s].cueStartTime,u=this.logger.time;if(d!==null&&u!==null&&d<u)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(r.rows[s+c])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,r=Math.max(s-1,0);n.setCursor(e.indent),e.color=n.chars[r].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+An(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",i=-1;for(let s=0;s<ei;s++){const r=this.rows[s].getTextString();r&&(i=s+1,e?t.push("Row "+i+": '"+r+"'"):t.push(r.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class Zd{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Na(n),this.nonDisplayedMemory=new Na(n),this.lastOutputScreen=new Na(n),this.currRollUpRow=this.displayedMemory.rows[ei-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[ei-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[n]}this.logger.log(2,"MIDROW: "+An(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class ec{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=K1(),this.logger=void 0;const i=this.logger=new j1;this.channels=[null,new Zd(e,t,i),new Zd(e+1,n,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const i=t[n]&127,s=t[n+1]&127;let r=!1,d=null;if(i===0&&s===0)continue;this.logger.log(3,()=>"["+Ii([t[n],t[n+1]])+"] -> ("+Ii([i,s])+")");const u=this.cmdHistory;if(i>=16&&i<=31){if(z1(i,s,u)){Vr(null,null,u),this.logger.log(3,()=>"Repeated command ("+Ii([i,s])+") is dropped");continue}Vr(i,s,this.cmdHistory),r=this.parseCmd(i,s),r||(r=this.parseMidrow(i,s)),r||(r=this.parsePAC(i,s)),r||(r=this.parseBackgroundAttributes(i,s))}else Vr(null,null,u);if(!r&&(d=this.parseChars(i,s),d)){const l=this.currentChannel;l&&l>0?this.channels[l].insertChars(d):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!r&&!d&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Ii([i,s])+" orig: "+Ii([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(n||i))return!1;const s=e===20||e===21||e===23?1:2,r=this.channels[s];return e===20||e===21||e===28||e===29?t===32?r.ccRCL():t===33?r.ccBS():t===34?r.ccAOF():t===35?r.ccAON():t===36?r.ccDER():t===37?r.ccRU(2):t===38?r.ccRU(3):t===39?r.ccRU(4):t===40?r.ccFON():t===41?r.ccRDC():t===42?r.ccTR():t===43?r.ccRTD():t===44?r.ccEDM():t===45?r.ccCR():t===46?r.ccENM():t===47&&r.ccEOC():r.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[n];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Ii([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(i||s))return!1;const r=e<=23?1:2;t>=64&&t<=95?n=r===1?N1[e]:$1[e]:n=r===1?U1[e]:G1[e];const d=this.channels[r];return d?(d.setPAC(this.interpretPAC(n,t)),this.currentChannel=r,!0):!1}interpretPAC(e,t){let n;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,i.underline=(n&1)===1,n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((n-16)/2)*4,i}parseChars(e,t){let n,i=null,s=null;if(e>=25?(n=2,s=e-8):(n=1,s=e),s>=17&&s<=19){let r;s===17?r=t+80:s===18?r=t+112:r=t+144,this.logger.log(2,()=>"Special char '"+wh(r)+"' in channel "+n),i=[r]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+Ii(i).join(",")),i}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(n||i))return!1;let s;const r={};e===16||e===24?(s=Math.floor((t-32)/2),r.background=V1[s],t%2===1&&(r.background=r.background+"_semi")):t===45?r.background="transparent":(r.foreground="black",t===47&&(r.underline=!0));const d=e<=23?1:2;return this.channels[d].setBkgData(r),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Vr(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function Vr(a,e,t){t.a=a,t.b=e}function z1(a,e,t){return t.a===a&&t.b===e}function K1(){return{a:null,b:null}}var tl=function(){if(Ts!=null&&Ts.VTTCue)return self.VTTCue;const a=["","lr","rl"],e=["start","middle","end","left","right"];function t(d,u){if(typeof u!="string"||!Array.isArray(d))return!1;const c=u.toLowerCase();return~d.indexOf(c)?c:!1}function n(d){return t(a,d)}function i(d){return t(e,d)}function s(d,...u){let c=1;for(;c<arguments.length;c++){const l=arguments[c];for(const h in l)d[h]=l[h]}return d}function r(d,u,c){const l=this,h={enumerable:!0};l.hasBeenReset=!1;let o="",f=!1,p=d,m=u,y=c,_=null,S="",b=!0,x="auto",L="start",N=50,P="middle",T=50,k="middle";Object.defineProperty(l,"id",s({},h,{get:function(){return o},set:function(I){o=""+I}})),Object.defineProperty(l,"pauseOnExit",s({},h,{get:function(){return f},set:function(I){f=!!I}})),Object.defineProperty(l,"startTime",s({},h,{get:function(){return p},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");p=I,this.hasBeenReset=!0}})),Object.defineProperty(l,"endTime",s({},h,{get:function(){return m},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");m=I,this.hasBeenReset=!0}})),Object.defineProperty(l,"text",s({},h,{get:function(){return y},set:function(I){y=""+I,this.hasBeenReset=!0}})),Object.defineProperty(l,"region",s({},h,{get:function(){return _},set:function(I){_=I,this.hasBeenReset=!0}})),Object.defineProperty(l,"vertical",s({},h,{get:function(){return S},set:function(I){const F=n(I);if(F===!1)throw new SyntaxError("An invalid or illegal string was specified.");S=F,this.hasBeenReset=!0}})),Object.defineProperty(l,"snapToLines",s({},h,{get:function(){return b},set:function(I){b=!!I,this.hasBeenReset=!0}})),Object.defineProperty(l,"line",s({},h,{get:function(){return x},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");x=I,this.hasBeenReset=!0}})),Object.defineProperty(l,"lineAlign",s({},h,{get:function(){return L},set:function(I){const F=i(I);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");L=F,this.hasBeenReset=!0}})),Object.defineProperty(l,"position",s({},h,{get:function(){return N},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");N=I,this.hasBeenReset=!0}})),Object.defineProperty(l,"positionAlign",s({},h,{get:function(){return P},set:function(I){const F=i(I);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");P=F,this.hasBeenReset=!0}})),Object.defineProperty(l,"size",s({},h,{get:function(){return T},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");T=I,this.hasBeenReset=!0}})),Object.defineProperty(l,"align",s({},h,{get:function(){return k},set:function(I){const F=i(I);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");k=F,this.hasBeenReset=!0}})),l.displayState=void 0}return r.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},r}();class W1{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Rh(a){function e(n,i,s,r){return(n|0)*3600+(i|0)*60+(s|0)+parseFloat(r||0)}const t=a.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class Y1{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function Ih(a,e,t,n){const i=n?a.split(n):[a];for(const s in i){if(typeof i[s]!="string")continue;const r=i[s].split(t);if(r.length!==2)continue;const d=r[0],u=r[1];e(d,u)}}const go=new tl(0,0,""),jr=go.align==="middle"?"middle":"center";function X1(a,e,t){const n=a;function i(){const d=Rh(a);if(d===null)throw new Error("Malformed timestamp: "+n);return a=a.replace(/^[^\sa-zA-Z-]+/,""),d}function s(d,u){const c=new Y1;Ih(d,function(o,f){let p;switch(o){case"region":for(let m=t.length-1;m>=0;m--)if(t[m].id===f){c.set(o,t[m].region);break}break;case"vertical":c.alt(o,f,["rl","lr"]);break;case"line":p=f.split(","),c.integer(o,p[0]),c.percent(o,p[0])&&c.set("snapToLines",!1),c.alt(o,p[0],["auto"]),p.length===2&&c.alt("lineAlign",p[1],["start",jr,"end"]);break;case"position":p=f.split(","),c.percent(o,p[0]),p.length===2&&c.alt("positionAlign",p[1],["start",jr,"end","line-left","line-right","auto"]);break;case"size":c.percent(o,f);break;case"align":c.alt(o,f,["start",jr,"end","left","right"]);break}},/:/,/\s/),u.region=c.get("region",null),u.vertical=c.get("vertical","");let l=c.get("line","auto");l==="auto"&&go.line===-1&&(l=-1),u.line=l,u.lineAlign=c.get("lineAlign","start"),u.snapToLines=c.get("snapToLines",!0),u.size=c.get("size",100),u.align=c.get("align",jr);let h=c.get("position","auto");h==="auto"&&go.position===50&&(h=u.align==="start"||u.align==="left"?0:u.align==="end"||u.align==="right"?100:50),u.position=h}function r(){a=a.replace(/^\s+/,"")}if(r(),e.startTime=i(),r(),a.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);a=a.slice(3),r(),e.endTime=i(),r(),s(a,e)}function Lh(a){return a.replace(/<br(?: \/)?>/gi,`
`)}class J1{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new W1,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let s=t.buffer,r=0;for(s=Lh(s);r<s.length&&s[r]!=="\r"&&s[r]!==`
`;)++r;const d=s.slice(0,r);return s[r]==="\r"&&++r,s[r]===`
`&&++r,t.buffer=s.slice(r),d}function i(s){Ih(s,function(r,d){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=n();const d=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(d!=null&&d[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let r=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:s=n(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new tl(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{X1(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const d=s.indexOf("-->")!==-1;if(!s||d&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const Q1=/\r\n|\n\r|\n|\r/g,Ua=function(e,t,n=0){return e.slice(n,n+t.length)===t},Z1=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!pt(t)||!pt(n)||!pt(i)||!pt(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*i,t+=60*60*1e3*s,t};function nl(a,e,t){return gr(a.toString())+gr(e.toString())+gr(t)}const eS=function(e,t,n){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(r=s)!=null&&r.new;){var r;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=n};function tS(a,e,t,n,i,s,r){const d=new J1,u=qn(new Uint8Array(a)).trim().replace(Q1,`
`).split(`
`),c=[],l=e?gb(e.baseTime,e.timescale):0;let h="00:00.000",o=0,f=0,p,m=!0;d.oncue=function(y){const _=t[n];let S=t.ccOffset;const b=(o-l)/9e4;if(_!=null&&_.new&&(f!==void 0?S=t.ccOffset=_.start:eS(t,n,b)),b){if(!e){p=new Error("Missing initPTS for VTT MPEGTS");return}S=b-t.presentationOffset}const x=y.endTime-y.startTime,L=Wn((y.startTime+S-f)*9e4,i*9e4)/9e4;y.startTime=Math.max(L,0),y.endTime=Math.max(L+x,0);const N=y.text.trim();y.text=decodeURIComponent(encodeURIComponent(N)),y.id||(y.id=nl(y.startTime,y.endTime,N)),y.endTime>0&&c.push(y)},d.onparsingerror=function(y){p=y},d.onflush=function(){if(p){r(p);return}s(c)},u.forEach(y=>{if(m)if(Ua(y,"X-TIMESTAMP-MAP=")){m=!1,y.slice(16).split(",").forEach(_=>{Ua(_,"LOCAL:")?h=_.slice(6):Ua(_,"MPEGTS:")&&(o=parseInt(_.slice(7)))});try{f=Z1(h)/1e3}catch(_){p=_}return}else y===""&&(m=!1);d.parse(y+`
`)}),d.flush()}const $a="stpp.ttml.im1t",Dh=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Ph=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,nS={left:"start",center:"center",right:"end",start:"start",end:"end"};function tc(a,e,t,n){const i=Nt(new Uint8Array(a),["mdat"]);if(i.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const s=i.map(d=>qn(d)),r=mb(e.baseTime,1,e.timescale);try{s.forEach(d=>t(iS(d,r)))}catch(d){n(d)}}function iS(a,e){const i=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},r=Object.keys(s).reduce((h,o)=>(h[o]=i.getAttribute(`ttp:${o}`)||s[o],h),{}),d=i.getAttribute("xml:space")!=="preserve",u=nc(Ga(i,"styling","style")),c=nc(Ga(i,"layout","region")),l=Ga(i,"body","[begin]");return[].map.call(l,h=>{const o=Oh(h,d);if(!o||!h.hasAttribute("begin"))return null;const f=ja(h.getAttribute("begin"),r),p=ja(h.getAttribute("dur"),r);let m=ja(h.getAttribute("end"),r);if(f===null)throw ic(h);if(m===null){if(p===null)throw ic(h);m=f+p}const y=new tl(f-e,m-e,o);y.id=nl(y.startTime,y.endTime,y.text);const _=c[h.getAttribute("region")],S=u[h.getAttribute("style")],b=rS(_,S,u),{textAlign:x}=b;if(x){const L=nS[x];L&&(y.lineAlign=L),y.align=x}return nn(y,b),y}).filter(h=>h!==null)}function Ga(a,e,t){const n=a.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function nc(a){return a.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function Oh(a,e){return[].slice.call(a.childNodes).reduce((t,n,i)=>{var s;return n.nodeName==="br"&&i?t+`
`:(s=n.childNodes)!=null&&s.length?Oh(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function rS(a,e,t){const n="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],r=a!=null&&a.hasAttribute("style")?a.getAttribute("style"):null;return r&&t.hasOwnProperty(r)&&(i=t[r]),s.reduce((d,u)=>{const c=Va(e,n,u)||Va(a,n,u)||Va(i,n,u);return c&&(d[u]=c),d},{})}function Va(a,e,t){return a&&a.hasAttributeNS(e,t)?a.getAttributeNS(e,t):null}function ic(a){return new Error(`Could not parse ttml timestamp ${a}`)}function ja(a,e){if(!a)return null;let t=Rh(a);return t===null&&(Dh.test(a)?t=sS(a,e):Ph.test(a)&&(t=aS(a,e))),t}function sS(a,e){const t=Dh.exec(a),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function aS(a,e){const t=Ph.exec(a),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class Hr{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class oS{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=sc(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_LOADED,this.onManifestLoaded,this),e.on($.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on($.FRAG_LOADING,this.onFragLoading,this),e.on($.FRAG_LOADED,this.onFragLoaded,this),e.on($.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on($.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on($.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on($.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on($.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_LOADED,this.onManifestLoaded,this),e.off($.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off($.FRAG_LOADING,this.onFragLoading,this),e.off($.FRAG_LOADED,this.onFragLoaded,this),e.off($.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off($.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off($.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off($.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off($.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Hr(this,"textTrack1"),t=new Hr(this,"textTrack2"),n=new Hr(this,"textTrack3"),i=new Hr(this,"textTrack4");this.cea608Parser1=new ec(1,e,t),this.cea608Parser2=new ec(3,n,i)}addCues(e,t,n,i,s){let r=!1;for(let d=s.length;d--;){const u=s[d],c=lS(u[0],u[1],t,n);if(c>=0&&(u[0]=Math.min(u[0],t),u[1]=Math.max(u[1],n),r=!0,c/(n-t)>.5))return}if(r||s.push([t,n]),this.config.renderTextTracksNatively){const d=this.captionsTracks[e];this.Cues.newCue(d,t,n,i)}else{const d=this.Cues.newCue(null,t,n,i);this.hls.trigger($.CUES_PARSED,{type:"captions",cues:d,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:s}){const{unparsedVttFrags:r}=this;n===bt.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:s}),r.length&&(this.unparsedVttFrags=[],r.forEach(d=>{this.onFragLoaded($.FRAG_LOADED,d)}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let i=0;i<n.textTracks.length;i++){const s=n.textTracks[i];if(rc(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:i}=this,{label:s,languageCode:r}=t[e],d=this.getExistingTrack(s,r);if(d)n[e]=d,Xi(n[e]),Th(n[e],i);else{const u=this.createTextTrack("captions",s,r);u&&(u[e]=!0,n[e]=u)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,i={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger($.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,n){const i=this.media;if(i)return i.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:i}=this;Object.keys(i).forEach(s=>{Xi(i[s]),delete i[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=sc(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)Xi(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],i=n.some(s=>s.textCodec===$a);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(gh(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const r=this.media,d=r?os(r.textTracks):null;if(this.tracks.forEach((u,c)=>{let l;if(d){let h=null;for(let o=0;o<d.length;o++)if(d[o]&&rc(d[o],u)){h=d[o],d[o]=null;break}h&&(l=h)}if(l)Xi(l);else{const h=Mh(u);l=this.createTextTrack(h,u.name,u.lang),l&&(l.mode="disabled")}l&&this.textTracks.push(l)}),d!=null&&d.length){const u=d.filter(c=>c!==null).map(c=>c.label);u.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${u.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const r=this.tracks.map(d=>({label:d.name,kind:d.type.toLowerCase(),default:d.default,subtitleTrack:d}));this.hls.trigger($.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:r})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const i=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!i)return;const s=`textTrack${i[1]}`,r=this.captionsProperties[s];r&&(r.label=n.name,n.lang&&(r.languageCode=n.lang),r.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===bt.MAIN){var n,i;const{cea608Parser1:s,cea608Parser2:r,lastSn:d}=this,{cc:u,sn:c}=t.frag,l=(n=(i=t.part)==null?void 0:i.index)!=null?n:-1;s&&r&&(c!==d+1||c===d&&l!==this.lastPartIndex+1||u!==this.lastCc)&&(s.reset(),r.reset()),this.lastCc=u,this.lastSn=c,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:n,payload:i}=t;if(n.type===bt.SUBTITLE)if(i.byteLength){const s=n.decryptdata,r="stats"in t;if(s==null||!s.encrypted||r){const d=this.tracks[n.level],u=this.vttCCs;u[n.cc]||(u[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),d&&d.textCodec===$a?this._parseIMSC1(n,i):this._parseVTTs(t)}}else this.hls.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;tc(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),n.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{n.logger.log(`Failed to parse IMSC1: ${i}`),n.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:n,payload:i}=e,{initPTS:s,unparsedVttFrags:r}=this,d=s.length-1;if(!s[n.cc]&&d===-1){r.push(e);return}const u=this.hls,c=(t=n.initSegment)!=null&&t.data?Qn(n.initSegment.data,new Uint8Array(i)).buffer:i;tS(c,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,l=>{this._appendCues(l,n.level),u.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},l=>{const h=l.message==="Missing initPTS for VTT MPEGTS";h?r.push(e):this._fallbackToIMSC1(n,i),u.logger.log(`Failed to parse VTT cue: ${l}`),!(h&&d>n.cc)&&u.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:l})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||tc(t,this.initPTS[e.cc],()=>{n.textCodec=$a,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(s=>xh(i,s))}else{const i=this.tracks[t];if(!i)return;const s=i.default?"default":"subtitles"+t;n.trigger($.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===bt.SUBTITLE&&this.onFragLoaded($.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:i}=t;if(!(n.type===bt.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let s=0;s<i.length;s++){const r=i[s].bytes;if(r){this.cea608Parser1||this.initCea608Parsers();const d=this.extractCea608Data(r);this.cea608Parser1.addData(i[s].pts,d[0]),this.cea608Parser2.addData(i[s].pts,d[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:i,type:s}){const{media:r}=this;if(!(!r||r.currentTime<n)){if(!s||s==="video"){const{captionsTracks:d}=this;Object.keys(d).forEach(u=>mo(d[u],t,n))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:d}=this;Object.keys(d).forEach(u=>mo(d[u],t,i))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let i=2;for(let s=0;s<n;s++){const r=e[i++],d=127&e[i++],u=127&e[i++];if(d===0&&u===0)continue;if((4&r)!==0){const l=3&r;(l===0||l===1)&&(t[l].push(d),t[l].push(u))}}return t}}function Mh(a){return a.characteristics&&/transcribes-spoken-dialog/gi.test(a.characteristics)&&/describes-music-and-sound/gi.test(a.characteristics)?"captions":"subtitles"}function rc(a,e){return!!a&&a.kind===Mh(e)&&ho(e,a)}function lS(a,e,t,n){return Math.min(e,n)-Math.max(a,t)}function sc(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const dS=/\s/,cS={newCue(a,e,t,n){const i=[];let s,r,d,u,c;const l=self.VTTCue||self.TextTrackCue;for(let o=0;o<n.rows.length;o++)if(s=n.rows[o],d=!0,u=0,c="",!s.isEmpty()){var h;for(let m=0;m<s.chars.length;m++)dS.test(s.chars[m].uchar)&&d?u++:(c+=s.chars[m].uchar,d=!1);s.cueStartTime=e,e===t&&(t+=1e-4),u>=16?u--:u++;const f=Lh(c.trim()),p=nl(e,t,f);a!=null&&(h=a.cues)!=null&&h.getCueById(p)||(r=new l(e,t,f),r.id=p,r.line=o+1,r.align="left",r.position=10+Math.min(80,Math.floor(u*8/32)*10),i.push(r))}return a&&i.length&&(i.sort((o,f)=>o.line==="auto"||f.line==="auto"?0:o.line>8&&f.line>8?f.line-o.line:o.line-f.line),i.forEach(o=>xh(a,o))),i}};function uS(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const hS=/(\d+)-(\d+)\/(\d+)/;class ac{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||gS,this.controller=new self.AbortController,this.stats=new Fo}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const s=fS(e,this.controller.signal),r=e.responseType==="arraybuffer",d=r?"byteLength":"length",{maxTimeToFirstByteMs:u,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=u&&pt(u)?u:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(Tr(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(h=>{var o;this.response=this.loader=h;const f=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},c-(f-i.loading.start)),!h.ok){const{status:m,statusText:y}=h;throw new yS(y||"fetch, bad network response",m,h)}i.loading.first=f,i.total=mS(h.headers)||i.total;const p=(o=this.callbacks)==null?void 0:o.onProgress;return p&&pt(t.highWaterMark)?this.loadProgressively(h,i,e,t.highWaterMark,p):r?h.arrayBuffer():e.responseType==="json"?h.json():h.text()}).then(h=>{var o,f;const p=this.response;if(!p)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const m=h[d];m&&(i.loaded=i.total=m);const y={url:p.url,data:h,code:p.status},_=(o=this.callbacks)==null?void 0:o.onProgress;_&&!pt(t.highWaterMark)&&_(i,e,h,p),(f=this.callbacks)==null||f.onSuccess(y,i,e,p)}).catch(h=>{var o;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const f=h&&h.code||0,p=h?h.message:null;(o=this.callbacks)==null||o.onError({code:f,text:p},e,h?h.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,i=0,s){const r=new Xu,d=e.body.getReader(),u=()=>d.read().then(c=>{if(c.done)return r.dataLength&&s(t,n,r.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const l=c.value,h=l.length;return t.loaded+=h,h<i||r.dataLength?(r.push(l),r.dataLength>=i&&s(t,n,r.flush().buffer,e)):s(t,n,l.buffer,e),u()}).catch(()=>Promise.reject());return u()}}function fS(a,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(nn({},a.headers))};return a.rangeEnd&&t.headers.set("Range","bytes="+a.rangeStart+"-"+String(a.rangeEnd-1)),t}function pS(a){const e=hS.exec(a);if(e)return parseInt(e[2])-parseInt(e[1])+1}function mS(a){const e=a.get("Content-Range");if(e){const n=pS(e);if(pt(n))return n}const t=a.get("Content-Length");if(t)return parseInt(t)}function gS(a,e){return new self.Request(a.url,e)}class yS extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const _S=/^age:\s*[\d.]+\s*$/im;class Bh{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Fo,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return s(n,t.url)}).catch(r=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),s(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(r=>{var d;(d=this.callbacks)==null||d.onError({code:n.status,text:r.message},t,n,i)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:r}=n.loadPolicy;if(i)for(const d in i)e.setRequestHeader(d,i[d]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&pt(s)?s:r,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const i=t.readyState,s=this.config;if(!n.aborted&&i>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,l=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const p=l??t.response;if(p!=null){var r,d;n.loading.end=Math.max(self.performance.now(),n.loading.first);const m=t.responseType==="arraybuffer"?p.byteLength:p.length;n.loaded=n.total=m,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const y=(r=this.callbacks)==null?void 0:r.onProgress;y&&y(n,e,p,t);const _={url:t.responseURL,data:p,code:c};(d=this.callbacks)==null||d.onSuccess(_,n,e,t);return}}const h=s.loadPolicy.errorRetry,o=n.retry,f={url:e.url,data:void 0,code:c};if(Es(h,o,!1,f))this.retry(h);else{var u;Jt.error(`${c} while loading ${e.url}`),(u=this.callbacks)==null||u.onError({code:c,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Es(e,t,!0))this.retry(e);else{var n;Jt.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=Uo(e,n.retry),n.retry++,Jt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&_S.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const AS={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},vS=en(en({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Bh,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:jA,bufferController:Lb,capLevelController:Zo,errorController:WA,fpsController:E1,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Uu,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:AS},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},bS()),{},{subtitleStreamController:M1,subtitleTrackController:C1,timelineController:oS,audioStreamController:wb,audioTrackController:kb,emeController:tr,cmcdController:v1,contentSteeringController:S1,interstitialsController:O1});function bS(){return{cueHandler:cS,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function SS(a,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=yo(a),i=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(r=>{const d=`${r==="level"?"playlist":r}LoadPolicy`,u=e[d]===void 0,c=[];s.forEach(l=>{const h=`${r}Loading${l}`,o=e[h];if(o!==void 0&&u){c.push(h);const f=n[d].default;switch(e[d]={default:f},l){case"TimeOut":f.maxLoadTimeMs=o,f.maxTimeToFirstByteMs=o;break;case"MaxRetry":f.errorRetry.maxNumRetry=o,f.timeoutRetry.maxNumRetry=o;break;case"RetryDelay":f.errorRetry.retryDelayMs=o,f.timeoutRetry.retryDelayMs=o;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=o,f.timeoutRetry.maxRetryDelayMs=o;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${d}": ${An(e[d])}`)}),en(en({},n),e)}function yo(a){return a&&typeof a=="object"?Array.isArray(a)?a.map(yo):Object.keys(a).reduce((e,t)=>(e[t]=yo(a[t]),e),{}):a}function ES(a,e){const t=a.loader;t!==ac&&t!==Bh?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1):uS()&&(a.loader=ac,a.progressive=!0,a.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const ls=2,TS=.1,xS=.05,CS=100;class wS extends Bu{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger($.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(CS),this.mediaSource=t.mediaSource;const n=this.media=t.media;Hn(n,"playing",this.onMediaPlaying),Hn(n,"waiting",this.onMediaWaiting),Hn(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(Jn(n,"playing",this.onMediaPlaying),Jn(n,"waiting",this.onMediaWaiting),Jn(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,i;const s=(n=this.hls)==null?void 0:n.config;if(!s)return;const r=this.media;if(!r)return;const{seeking:d}=r,u=this.seeking&&!d,c=!this.seeking&&d,l=r.paused&&!d||r.ended||r.playbackRate===0;if(this.seeking=d,e!==t){t&&(this.ended=0),this.moved=!0,d||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!l&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||u){u&&this.stallResolved(e);return}if(l){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&r.ended&&this.hls&&(this.ended=e||1,this.hls.trigger($.MEDIA_ENDED,{stalled:!1}));return}if(!Ft.getBuffered(r).length){this.nudgeRetry=0;return}const h=Ft.bufferInfo(r,e,0),o=h.nextStart||0,f=this.fragmentTracker;if(d&&f&&this.hls){const N=oc(this.hls.inFlightFragments,e),P=h.len>ls,T=!o||N||o-e>ls&&!f.getPartialFragment(e);if(P||T)return;this.moved=!1}const p=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&f){if(!(h.len>0)&&!o)return;const P=Math.max(o,h.start||0)-e,k=!!(p!=null&&p.live)?p.targetduration*2:ls,I=f.getPartialFragment(e);if(P>0&&(P<=k||I)){r.paused||this._trySkipBufferHole(I);return}}const m=s.detectStallWithCurrentTimeMs,y=self.performance.now(),_=this.waiting;let S=this.stalled;if(S===null)if(_>0&&y-_<m)S=this.stalled=_;else{this.stalled=y;return}const b=y-S;if(!d&&(b>=m||_)&&this.hls){var x;if(((x=this.mediaSource)==null?void 0:x.readyState)==="ended"&&!(p!=null&&p.live)&&Math.abs(e-((p==null?void 0:p.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger($.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(h),!this.media||!this.hls)return}const L=Ft.bufferInfo(r,e,s.maxBufferHole);this._tryFixBufferStall(L,b,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger($.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&i&&i.length>1&&e>i.end(0)){const s=Ft.bufferedInfo(Ft.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const r=Ft.timeRangesToArray(i),d=Ft.bufferedInfo(r,t,0).bufferedIndex;if(d>-1&&d<r.length-1){const u=Ft.bufferedInfo(r,e,0).bufferedIndex,c=r[d].end,l=r[d+1].start;if((u===-1||u>d)&&l-c<1&&e-c<2){const h=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${l} buffered index: ${u}`);this.warn(h.message),this.media.currentTime+=1e-6;const o=this.fragmentTracker.getPartialFragment(e)||void 0,f=Ft.bufferInfo(this.media,e,0);this.hls.trigger($.ERROR,{type:xt.MEDIA_ERROR,details:Me.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:h,reason:h.message,frag:o,buffer:f.len,bufferInfo:f})}}}}}_tryFixBufferStall(e,t,n){var i,s;const{fragmentTracker:r,media:d}=this,u=(i=this.hls)==null?void 0:i.config;if(!d||!r||!u)return;const c=(s=this.hls)==null?void 0:s.latestLevelDetails,l=r.getPartialFragment(n);if((l||c!=null&&c.live&&n<c.fragmentStart)&&(this._trySkipBufferHole(l)||!this.media))return;const h=e.buffered,o=this.adjacentTraversal(e,n);(h&&h.length>1&&e.len>u.maxBufferHole||e.nextStart&&(e.nextStart-n<u.maxBufferHole||o))&&(t>u.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,i=e.nextStart;if(n&&i){const s=n.getFragAtPos(t,bt.MAIN),r=n.getFragAtPos(i,bt.MAIN);if(s&&r)return r.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:i,stalled:s}=this;if(!i&&s!==null&&n&&t){this.stallReported=!0;const r=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${An(e)})`);this.warn(r.message),t.trigger($.ERROR,{type:xt.MEDIA_ERROR,details:Me.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:i}=this,s=(t=this.hls)==null?void 0:t.config;if(!i||!n||!s)return 0;const r=i.currentTime,d=Ft.bufferInfo(i,r,0),u=r<d.start?d.start:d.nextStart;if(u&&this.hls){const l=d.len<=s.maxBufferHole,h=d.len>0&&d.len<1&&i.readyState<3,o=u-r;if(o>0&&(l||h)){if(o>s.maxBufferHole){let p=!1;if(r===0){const m=n.getAppendedFrag(0,bt.MAIN);m&&u<m.end&&(p=!0)}if(!p){const m=e||n.getAppendedFrag(r,bt.MAIN);if(m){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||oc(this.hls.inFlightFragments,u))return 0;let _=!1,S=m.end;for(;S<u;){const b=n.getPartialFragment(S);if(b)S+=b.duration;else{_=!0;break}}if(_)return 0}}}const f=Math.max(u+xS,r+TS);if(this.warn(`skipping hole, adjusting currentTime from ${r} to ${f}`),this.moved=!0,i.currentTime=f,!(e!=null&&e.gap)){const p=new Error(`fragment loaded with buffer holes, seeking from ${r} to ${f}`);this.hls.trigger($.ERROR,{type:xt.MEDIA_ERROR,details:Me.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:e||void 0,buffer:d.len,bufferInfo:d})}return f}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:i}=this,s=t==null?void 0:t.config;if(!n||!s)return 0;const r=n.currentTime;if(this.nudgeRetry++,i<s.nudgeMaxRetry){const d=r+(i+1)*s.nudgeOffset,u=new Error(`Nudging 'currentTime' from ${r} to ${d}`);this.warn(u.message),n.currentTime=d,t.trigger($.ERROR,{type:xt.MEDIA_ERROR,details:Me.BUFFER_NUDGE_ON_STALL,error:u,fatal:!1,buffer:e.len,bufferInfo:e})}else{const d=new Error(`Playhead still not moving while enough data buffered @${r} after ${s.nudgeMaxRetry} nudges`);this.error(d.message),t.trigger($.ERROR,{type:xt.MEDIA_ERROR,details:Me.BUFFER_STALLED_ERROR,error:d,fatal:!0,buffer:e.len,bufferInfo:e})}}}function oc(a,e){const t=lc(a.main);if(t&&t.start<=e)return t;const n=lc(a.audio);return n&&n.start<=e?n:null}function lc(a){if(!a)return null;switch(a.state){case Ke.IDLE:case Ke.STOPPED:case Ke.ENDED:case Ke.ERROR:return null}return a.frag}const kS=.25;function _o(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function dc(a,e,t,n,i){let s=new a(e,t,"");try{s.value=n,i&&(s.type=i)}catch{s=new a(e,t,An(i?en({type:i},n):n))}return s}const qr=(()=>{const a=_o();try{a&&new a(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function RS(a){return Uint8Array.from(a.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class IS{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger($.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on($.LEVEL_UPDATED,this.onLevelUpdated,this),e.on($.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off($.LEVEL_UPDATED,this.onLevelUpdated,this),e.off($.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Xi(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return Th(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:i}}}=this;if(!n&&!i)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const r=_o();if(r)for(let d=0;d<s.length;d++){const u=s[d].type;if(u===Vn.emsg&&!n||!i)continue;const c=ih(s[d].data);if(c){const l=s[d].pts;let h=l+s[d].duration;h>qr&&(h=qr),h-l<=0&&(h=l+kS);for(let f=0;f<c.length;f++){const p=c[f];if(!rh(p)){this.updateId3CueEnds(l,u);const m=dc(r,l,h,p,u);m&&this.id3Track.addCue(m)}}}}}updateId3CueEnds(e,t){var n;const i=(n=this.id3Track)==null?void 0:n.cues;if(i)for(let s=i.length;s--;){const r=i[s];r.type===t&&r.startTime<e&&r.endTime===qr&&(r.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:i}){const{id3Track:s,hls:r}=this;if(!r)return;const{config:{enableEmsgMetadataCues:d,enableID3MetadataCues:u}}=r;if(s&&(d||u)){let c;i==="audio"?c=l=>l.type===Vn.audioId3&&u:i==="video"?c=l=>l.type===Vn.emsg&&d:c=l=>l.type===Vn.audioId3&&u||l.type===Vn.emsg&&d,mo(s,t,n,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:n}=this,{dateRanges:i}=e,s=Object.keys(i);let r=this.dateRangeCuesAppended;if(n&&t){var d;if((d=n.cues)!=null&&d.length){const l=Object.keys(r).filter(h=>!s.includes(h));for(let h=l.length;h--;){const o=l[h],f=r[o].cues;delete r[o],Object.keys(f).forEach(p=>{try{const m=f[p];m.removeEventListener("enter",this.onEventCueEnter),n.removeCue(m)}catch{}})}}else r=this.dateRangeCuesAppended={}}const u=e.fragments[e.fragments.length-1];if(s.length===0||!pt(u==null?void 0:u.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const c=_o();for(let l=0;l<s.length;l++){const h=s[l],o=i[h],f=o.startTime,p=r[h],m=(p==null?void 0:p.cues)||{};let y=(p==null?void 0:p.durationKnown)||!1,_=qr;const{duration:S,endDate:b}=o;if(b&&S!==null)_=f+S,y=!0;else if(o.endOnNext&&!y){const L=s.reduce((N,P)=>{if(P!==o.id){const T=i[P];if(T.class===o.class&&T.startDate>o.startDate&&(!N||o.startDate<N.startDate))return T}return N},null);L&&(_=L.startTime,y=!0)}const x=Object.keys(o.attr);for(let L=0;L<x.length;L++){const N=x[L];if(!ov(N))continue;const P=m[N];if(P)y&&!p.durationKnown?P.endTime=_:Math.abs(P.startTime-f)>.01&&(P.startTime=f,P.endTime=_);else if(c){let T=o.attr[N];lv(N)&&(T=RS(T));const I=dc(c,f,_,{key:N,data:T},Vn.dateRange);I&&(I.id=h,this.id3Track.addCue(I),m[N]=I,this.hls.config.interstitialsController&&(N==="X-ASSET-LIST"||N==="X-ASSET-URL")&&I.addEventListener("enter",this.onEventCueEnter))}}r[h]={cues:m,dateRange:o,durationKnown:y}}}}class LS{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:r}=this.config;if(!s||r===1||!n.live)return;const d=this.targetLatency;if(d===null)return;const u=i-d,c=Math.min(this.maxLatency,d+n.targetduration);if(u<c&&u>.05&&this.forwardBufferLength>1){const h=Math.min(2,Math.max(1,r)),o=Math.round(2/(1+Math.exp(-.75*u-this.edgeStalled))*20)/20,f=Math.min(h,Math.max(1,o));this.changeMediaPlaybackRate(t,f)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:r,lowLatencyMode:d}=this.config,u=this.hls.userConfig;let c=d&&n||t;(this._targetLatencyUpdated||u.liveSyncDuration||u.liveSyncDurationCount||c===0)&&(c=s!==void 0?s:r*i);const l=i;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,l)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const i=n.edge,s=e-t-this.edgeStalled,r=i-n.totalduration,d=i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(r,s),d)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.LEVEL_UPDATED,this.onLevelUpdated,this),e.on($.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.LEVEL_UPDATED,this.onLevelUpdated,this),e.off($.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===Me.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,i;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class DS extends Qo{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_LOADED,this.onManifestLoaded,this),e.on($.LEVEL_LOADED,this.onLevelLoaded,this),e.on($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this),e.on($.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_LOADED,this.onManifestLoaded,this),e.off($.LEVEL_LOADED,this.onLevelLoaded,this),e.off($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this),e.off($.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,i=[],s={},r={};let d=!1,u=!1,c=!1;t.levels.forEach(l=>{const h=l.attrs;let{audioCodec:o,videoCodec:f}=l;o&&(l.audioCodec=o=As(o,n)||void 0),f&&(f=l.videoCodec=RA(f));const{width:p,height:m,unknownCodecs:y}=l;let _=y?y.length:0;if(y)for(let I=_;I--;){const F=y[I];this.isAudioSupported(F)?(l.audioCodec=o=o?`${o},${F}`:F,_--,sr.audio[o.substring(0,4)]=2):this.isVideoSupported(F)&&(l.videoCodec=f=f?`${f},${F}`:F,_--,sr.video[f.substring(0,4)]=2)}if(d||(d=!!(p&&m)),u||(u=!!f),c||(c=!!o),_||o&&!this.isAudioSupported(o)||f&&!this.isVideoSupported(f)){this.log(`Some or all CODECS not supported "${h.CODECS}"`);return}const{CODECS:S,"FRAME-RATE":b,"HDCP-LEVEL":x,"PATHWAY-ID":L,RESOLUTION:N,"VIDEO-RANGE":P}=h,k=`${`${L||"."}-`}${l.bitrate}-${N}-${b}-${S}-${P}-${x}`;if(s[k])if(s[k].uri!==l.url&&!l.attrs["PATHWAY-ID"]){const I=r[k]+=1;l.attrs["PATHWAY-ID"]=new Array(I+1).join(".");const F=this.createLevel(l);s[k]=F,i.push(F)}else s[k].addGroupId("audio",h.AUDIO),s[k].addGroupId("text",h.SUBTITLES);else{const I=this.createLevel(l);s[k]=I,r[k]=1,i.push(I)}}),this.filterAndSortMediaOptions(i,t,d,u,c)}createLevel(e){const t=new Ar(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(i.message),t.supportedResult=Lu(i,[])}return t}isAudioSupported(e){return io(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return io(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,i,s){let r=[],d=[],u=e;if((n||i)&&s&&(u=u.filter(({videoCodec:y,videoRange:_,width:S,height:b})=>(!!y||!!(S&&b))&&OA(_))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let y="no level with compatible codecs found in manifest",_=y;t.levels.length&&(_=`one or more CODECS in variant not supported: ${An(t.levels.map(b=>b.attrs.CODECS).filter((b,x,L)=>L.indexOf(b)===x))}`,this.warn(_),y+=` (${_})`);const S=new Error(y);this.hls.trigger($.ERROR,{type:xt.MEDIA_ERROR,details:Me.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:S,reason:_})}});return}t.audioTracks&&(r=t.audioTracks.filter(y=>!y.audioCodec||this.isAudioSupported(y.audioCodec)),cc(r)),t.subtitles&&(d=t.subtitles,cc(d));const c=u.slice(0);u.sort((y,_)=>{if(y.attrs["HDCP-LEVEL"]!==_.attrs["HDCP-LEVEL"])return(y.attrs["HDCP-LEVEL"]||"")>(_.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&y.height!==_.height)return y.height-_.height;if(y.frameRate!==_.frameRate)return y.frameRate-_.frameRate;if(y.videoRange!==_.videoRange)return vs.indexOf(y.videoRange)-vs.indexOf(_.videoRange);if(y.videoCodec!==_.videoCodec){const S=id(y.videoCodec),b=id(_.videoCodec);if(S!==b)return b-S}if(y.uri===_.uri&&y.codecSet!==_.codecSet){const S=_s(y.codecSet),b=_s(_.codecSet);if(S!==b)return b-S}return y.averageBitrate!==_.averageBitrate?y.averageBitrate-_.averageBitrate:0});let l=c[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==c.length)){for(let y=0;y<c.length;y++)if(c[y].pathwayId===u[0].pathwayId){l=c[y];break}}this._levels=u;for(let y=0;y<u.length;y++)if(u[y]===l){var h;this._firstLevel=y;const _=l.bitrate,S=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${_}`),((h=this.hls.userConfig)==null?void 0:h.abrEwmaDefaultEstimate)===void 0){const b=Math.min(_,this.hls.config.abrEwmaDefaultEstimateMax);b>S&&S===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=b)}break}const o=s&&!i,f=this.hls.config,p=!!(f.audioStreamController&&f.audioTrackController),m={levels:u,audioTracks:r,subtitleTracks:d,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:i,altAudio:p&&!o&&r.some(y=>!!y.url)};this.hls.trigger($.MANIFEST_PARSED,m)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const l=new Error("invalid level idx"),h=e<0;if(this.hls.trigger($.ERROR,{type:xt.OTHER_ERROR,details:Me.LEVEL_SWITCH_ERROR,level:e,fatal:h,error:l,reason:l.message}),h)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,r=t[e],d=r.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=r,n===e&&i&&s===d)return;this.log(`Switching to level ${e} (${r.height?r.height+"p ":""}${r.videoRange?r.videoRange+" ":""}${r.codecSet?r.codecSet+" ":""}@${r.bitrate})${d?" with Pathway "+d:""} from level ${n}${s?" with Pathway "+s:""}`);const u={level:e,attrs:r.attrs,details:r.details,bitrate:r.bitrate,averageBitrate:r.averageBitrate,maxBitrate:r.maxBitrate,realBitrate:r.realBitrate,width:r.width,height:r.height,codecSet:r.codecSet,audioCodec:r.audioCodec,videoCodec:r.videoCodec,audioGroups:r.audioGroups,subtitleGroups:r.subtitleGroups,loaded:r.loaded,loadError:r.loadError,fragmentError:r.fragmentError,name:r.name,id:r.id,uri:r.uri,url:r.url,urlId:0,audioGroupIds:r.audioGroupIds,textGroupIds:r.textGroupIds};this.hls.trigger($.LEVEL_SWITCHING,u);const c=r.details;if(!c||c.live){const l=this.switchParams(r.uri,i==null?void 0:i.details,c);this.loadPlaylist(l)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(i=>t.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===Vt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===bt.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(s=>!!n[s]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var n;const{level:i,details:s}=t,r=t.levelInfo;if(!r){var d;this.warn(`Invalid level index ${i}`),(d=t.deliveryDirectives)!=null&&d.skip&&(s.deltaUpdateFailed=!0);return}if(r===this.currentLevel||t.withoutMultiVariant){r.fragmentError===0&&(r.loadError=0);let u=r.details;u===t.details&&u.advanced&&(u=void 0),this.playlistLoaded(i,t,u)}else(n=t.deliveryDirectives)!=null&&n.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],r=e.details,d=r==null?void 0:r.age;this.log(`Loading level index ${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${d&&r.live?" age "+d.toFixed(1)+(r.type&&" "+r.type||""):""} ${n}`),this.hls.trigger($.LEVEL_LOADING,{url:n,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((s,r)=>r!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(d=>d.level=-1)),!1));Ku(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=n.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger($.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger($.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function cc(a){const e={};a.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function Fh(){return self.SourceBuffer||self.WebKitSourceBuffer}function Nh(){if(!xi())return!1;const e=Fh();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function PS(){if(!Nh())return!1;const a=xi();return typeof(a==null?void 0:a.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>a.isTypeSupported(_r(e,"video")))||["mp4a.40.2","fLaC"].some(e=>a.isTypeSupported(_r(e,"audio"))))}function OS(){var a;const e=Fh();return typeof(e==null||(a=e.prototype)==null?void 0:a.changeType)=="function"}const MS=100;class BS extends Ho{constructor(e,t,n){super(e,t,n,"stream-controller",bt.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,s=i?i.currentTime:null;if(s===null||!pt(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const r=this.getFwdBufferInfoAtPos(i,s,bt.MAIN,0);if(r===null||r.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${r?r.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.LEVEL_LOADING,this.onLevelLoading,this),e.on($.LEVEL_LOADED,this.onLevelLoaded,this),e.on($.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on($.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on($.BUFFER_CREATED,this.onBufferCreated,this),e.on($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.LEVEL_LOADED,this.onLevelLoaded,this),e.off($.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off($.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off($.BUFFER_CREATED,this.onBufferCreated,this),e.off($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:i}=this;if(this.stopLoad(),this.setInterval(MS),this.level=-1,!this.startFragRequested){let s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.firstAutoLevel),i.nextLoadLevel=s,this.level=i.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=Ke.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=Ke.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Ke.WAITING_LEVEL:{const{levels:t,level:n}=this,i=t==null?void 0:t[n],s=i==null?void 0:i.details;if(s&&(!s.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(s))break;this.state=Ke.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=Ke.IDLE;break}break}case Ke.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),n=this.retryDate;if(!n||t>=n||(e=this.media)!=null&&e.seeking){const{levels:i,level:s}=this,r=i==null?void 0:i[s];this.resetStartWhenNotLoaded(r||null),this.state=Ke.IDLE}}break}this.state===Ke.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:i}=this;if(t===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[s]))return;const r=n[s],d=this.getMainFwdBufferInfo();if(d===null)return;const u=this.getLevelDetails();if(u&&this._streamEnded(d,u)){const m={};this.altAudio===2&&(m.type="video"),this.hls.trigger($.BUFFER_EOS,m),this.state=Ke.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const c=r.details;if(!c||this.state===Ke.WAITING_LEVEL||this.waitForLive(r)){this.level=s,this.state=Ke.WAITING_LEVEL,this.startFragRequested=!1;return}const l=d.len,h=this.getMaxBufferLength(r.maxBitrate);if(l>=h)return;this.backtrackFragment&&this.backtrackFragment.start>d.end&&(this.backtrackFragment=null);const o=this.backtrackFragment?this.backtrackFragment.start:d.end;let f=this.getNextFragment(o,c);if(this.couldBacktrack&&!this.fragPrevious&&f&&Pn(f)&&this.fragmentTracker.getState(f)!==Rn.OK){var p;const y=((p=this.backtrackFragment)!=null?p:f).sn-c.startSN,_=c.fragments[y-1];_&&f.cc===_.cc&&(f=_,this.fragmentTracker.removeFragment(_))}else this.backtrackFragment&&d.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,o)){if(!f.gap){const y=this.audioOnly&&!this.altAudio?ln.AUDIO:ln.VIDEO,_=(y===ln.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;_&&this.afterBufferFlushed(_,y,bt.MAIN)}f=this.getNextFragmentLoopLoading(f,c,d,bt.MAIN,h)}f&&(f.initSegment&&!f.initSegment.data&&!this.bitrateTest&&(f=f.initSegment),this.loadFragment(f,r,o))}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);i===Rn.NOT_LOADED||i===Rn.PARTIAL?Pn(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,bt.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const d=this.getMainFwdBufferInfo();if(!d||d.len<s.targetduration*2)return}if(!t.paused&&e){const d=this.hls.nextLoadLevel,u=e[d],c=this.fragLastKbps;c&&this.fragCurrent?n=this.fragCurrent.duration*u.maxBitrate/(1e3*c)+1:n=0}else n=0;const r=this.getBufferedFrag(t.currentTime+n);if(r){const d=this.followingBufferedFrag(r);if(d){this.abortCurrentFrag();const u=d.maxStartPTS?d.maxStartPTS:d.start,c=d.duration,l=Math.max(r.end,u+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(l,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Ke.KEY_LOADING:case Ke.FRAG_LOADING:case Ke.FRAG_LOADING_WAITING_RETRY:case Ke.PARSING:case Ke.PARSED:this.state=Ke.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;Hn(n,"playing",this.onMediaPlaying),Hn(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(Jn(n,"playing",this.onMediaPlaying),Jn(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger($.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,i=!1;t.levels.forEach(s=>{const r=s.audioCodec;r&&(n=n||r.indexOf("mp4a.40.2")!==-1,i=i||r.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=n&&i&&!OS(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==Ke.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=Ke.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:i,startFragRequested:s}=this,r=t.level,d=t.details,u=d.totalduration;if(!i){this.warn(`Levels were reset while loading level ${r}`);return}this.log(`Level ${r} loaded [${d.startSN},${d.endSN}]${d.lastPartSn?`[part-${d.lastPartSn}-${d.lastPartIndex}]`:""}, cc [${d.startCC}, ${d.endCC}] duration:${u}`);const c=t.levelInfo,l=this.fragCurrent;l&&(this.state===Ke.FRAG_LOADING||this.state===Ke.FRAG_LOADING_WAITING_RETRY)&&l.level!==t.level&&l.loader&&this.abortCurrentFrag();let h=0;if(d.live||(n=c.details)!=null&&n.live){var o;if(this.checkLiveUpdate(d),d.deltaUpdateFailed)return;h=this.alignPlaylists(d,c.details,(o=this.levelLastLoaded)==null?void 0:o.details)}if(c.details=d,this.levelLastLoaded=c,s||this.setStartPosition(d,h),this.hls.trigger($.LEVEL_UPDATED,{details:d,level:r}),this.state===Ke.WAITING_LEVEL){if(this.waitForCdnTuneIn(d))return;this.state=Ke.IDLE}s&&d.live&&this.synchronizeToLiveEdge(d),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const i=this.hls.liveSyncPosition,s=this.getLoadPosition(),r=e.fragmentStart,d=e.edge,u=s>=r-t.maxFragLookUpTolerance&&s<=d;if(i!==null&&n.duration>i&&(s<i||!u)){const l=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!u&&n.readyState<4||s<d-l)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),n.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${d}, reset currentTime to : ${i.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const h=Ft.bufferInfo(n,i,0);if(!(h!=null&&(c=h.buffered)!=null&&c.length)){n.currentTime=i;return}if(h.start<=s){n.currentTime=i;return}const{nextStart:f}=Ft.bufferedInfo(h.buffered,s,0);f&&(n.currentTime=f)}else n.currentTime=i}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:s}=e,{levels:r}=this;if(!r){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const d=r[n.level];if(!d){this.warn(`Level ${n.level} not found on progress`);return}const u=d.details;if(!u){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const c=d.videoCodec,l=u.PTSKnown||!u.live,h=(t=n.initSegment)==null?void 0:t.data,o=this._getAudioCodec(d),f=this.transmuxer=this.transmuxer||new mh(this.hls,bt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=i?i.index:-1,m=p!==-1,y=new Go(n.level,n.sn,n.stats.chunkCount,s.byteLength,p,m),_=this.initPTS[n.cc];f.push(s,h,o,c,n,i,u.totalduration,l,y,_)}onAudioTrackSwitching(e,t){const n=this.hls,i=this.altAudio===2;if(bs(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const r=this.fragCurrent;r&&(this.log("Switching to main audio track, cancel main fragment load"),r.abortRequests(),this.fragmentTracker.removeFragment(r)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.fragmentTracker.removeAllFragments(),n.once($.BUFFER_FLUSHED,()=>{var r;(r=this.hls)==null||r.trigger($.AUDIO_TRACK_SWITCHED,t)}),n.trigger($.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger($.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=bs(t.url,this.hls);if(n){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let i,s,r=!1;for(const d in n){const u=n[d];if(u.id==="main"){if(s=d,i=u,d==="video"){const c=n[d];c&&(this.videoBuffer=c.buffer)}}else r=!0}r&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:i}=t,s=n.type===bt.MAIN;if(s){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===Ke.PARSED&&(this.state=Ke.IDLE);return}const d=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*d.total/(d.buffering.end-d.loading.first)),Pn(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}const r=this.media;r&&(!this._hasEnoughToStart&&Ft.getBuffered(r).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=Ke.ERROR;return}switch(t.details){case Me.FRAG_GAP:case Me.FRAG_PARSING_ERROR:case Me.FRAG_DECRYPT_ERROR:case Me.FRAG_LOAD_ERROR:case Me.FRAG_LOAD_TIMEOUT:case Me.KEY_LOAD_ERROR:case Me.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(bt.MAIN,t);break;case Me.LEVEL_LOAD_ERROR:case Me.LEVEL_LOAD_TIMEOUT:case Me.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Ke.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===Vt.LEVEL&&(this.state=Ke.IDLE);break;case Me.BUFFER_ADD_CODEC_ERROR:case Me.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.resetLoadingState();break;case Me.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case Me.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=Ke.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==ln.AUDIO||!this.altAudio){const n=(t===ln.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,bt.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const i=this.timelineOffset;i&&n&&(n+=i);const s=this.getLevelDetails(),r=Ft.getBuffered(e),d=r.length?r.start(0):0,u=d-n,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||u>0&&(u<c||this.loadingParts&&u<2*((s==null?void 0:s.partTarget)||0)))&&(this.log(`adjusting start position by ${u} to match buffer start`),n+=u,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${d}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:i}=this,s=n==null?void 0:n.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=Ke.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const r=s.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),i.trigger($.FRAG_LOADED,n),s.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const n=this.playlistType,{hls:i}=this,{remuxResult:s,chunkMeta:r}=e,d=this.getCurrentContext(r);if(!d){this.resetWhenMissingContext(r);return}const{frag:u,part:c,level:l}=d,{video:h,text:o,id3:f,initSegment:p}=s,{details:m}=l,y=this.altAudio?void 0:s.audio;if(this.fragContextChanged(u)){this.fragmentTracker.removeFragment(u);return}if(this.state=Ke.PARSING,p){if(p!=null&&p.tracks){const b=u.initSegment||u;this._bufferInitSegment(l,p.tracks,b,r),i.trigger($.FRAG_PARSING_INIT_SEGMENT,{frag:b,id:n,tracks:p.tracks})}const _=p.initPTS,S=p.timescale;pt(_)&&(this.initPTS[u.cc]={baseTime:_,timescale:S},i.trigger($.INIT_PTS_FOUND,{frag:u,id:n,initPTS:_,timescale:S}))}if(h&&m){y&&h.type==="audiovideo"&&this.logMuxedErr(u);const _=m.fragments[u.sn-1-m.startSN],S=u.sn===m.startSN,b=!_||u.cc>_.cc;if(s.independent!==!1){const{startPTS:x,endPTS:L,startDTS:N,endDTS:P}=h;if(c)c.elementaryStreams[h.type]={startPTS:x,endPTS:L,startDTS:N,endDTS:P};else if(h.firstKeyFrame&&h.independent&&r.id===1&&!b&&(this.couldBacktrack=!0),h.dropped&&h.independent){const T=this.getMainFwdBufferInfo(),k=(T?T.end:this.getLoadPosition())+this.config.maxBufferHole,I=h.firstKeyFramePTS?h.firstKeyFramePTS:x;if(!S&&k<I-this.config.maxBufferHole&&!b){this.backtrack(u);return}else b&&(u.gap=!0);u.setElementaryStreamInfo(h.type,u.start,L,u.start,P,!0)}else S&&x-(m.appliedTimelineOffset||0)>ls&&(u.gap=!0);u.setElementaryStreamInfo(h.type,x,L,N,P),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(h,u,c,r,S||b)}else if(S||b)u.gap=!0;else{this.backtrack(u);return}}if(y){const{startPTS:_,endPTS:S,startDTS:b,endDTS:x}=y;c&&(c.elementaryStreams[ln.AUDIO]={startPTS:_,endPTS:S,startDTS:b,endDTS:x}),u.setElementaryStreamInfo(ln.AUDIO,_,S,b,x),this.bufferFragmentData(y,u,c,r)}if(m&&f!=null&&(t=f.samples)!=null&&t.length){const _={id:n,frag:u,details:m,samples:f.samples};i.trigger($.FRAG_PARSING_METADATA,_)}if(m&&o){const _={id:n,frag:u,details:m,samples:o.samples};i.trigger($.FRAG_PARSING_USERDATA,_)}}logMuxedErr(e){this.warn(`${Pn(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,i){if(this.state!==Ke.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:s,video:r,audiovideo:d}=t;if(s){let c=ts(s.codec,e.audioCodec);c==="mp4a"&&(c="mp4a.40.5");const l=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){c&&(c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5");const h=s.metadata;h&&"channelCount"in h&&(h.channelCount||1)!==1&&l.indexOf("firefox")===-1&&(c="mp4a.40.5")}c&&c.indexOf("mp4a.40.5")!==-1&&l.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log(`Android: force audio codec to ${c}`)),e.audioCodec&&e.audioCodec!==c&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${c}"`),s.levelCodec=c,s.id=bt.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${c||""}/${e.audioCodec||""}/${s.codec}]`),delete t.audiovideo}if(r){r.levelCodec=e.videoCodec,r.id=bt.MAIN;const c=r.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":r.codec="hvc1.1.6.L120.90";break;case"av01":r.codec="av01.0.04M.08";break;case"avc1":r.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${r.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${r.codec!==c?" parsed-corrected="+r.codec:""}${r.supplemental?" supplemental="+r.supplemental:""}`),delete t.audiovideo}d&&(this.log(`Init audiovideo buffer, container:${d.container}, codecs[level/parsed]=[${e.codecs}/${d.codec}]`),delete t.video,delete t.audio);const u=Object.keys(t);if(u.length){if(this.hls.trigger($.BUFFER_CODECS,t),!this.hls)return;u.forEach(c=>{const h=t[c].initSegment;h!=null&&h.byteLength&&this.hls.trigger($.BUFFER_APPENDING,{type:c,data:h,frag:n,part:null,chunkMeta:i,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,bt.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e==null?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Ke.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(Ft.isBuffered(e,n)?t=this.getAppendedFrag(n):Ft.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s)&&(this.fragPlaying=t,this.hls.trigger($.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger($.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return pt(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(pt(t)){const n=this.getLevelDetails(),i=this.currentFrag||(n?Ui(null,n.fragments,t):null);if(i){const s=i.programDateTime;if(s!==null){const r=s+(t-i.start)*1e3;return new Date(r)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class FS{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[n].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=Me.KEY_LOAD_ERROR,n,i,s){return new yi({type:xt.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:n,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length){const{sn:n,cc:i}=e;for(let s=0;s<t.length;s++){const r=t[s];if(i<=r.cc&&(n==="initSegment"||r.sn==="initSegment"||n<r.sn))return this.emeController.selectKeySystemFormat(r).then(d=>{if(r.setKeyFormat(d),this.emeController&&this.config.requireKeySystemAccessOnStart){const u=is(d);if(u)return this.emeController.getKeySystemAccess([u])}})}}else if(this.config.requireKeySystemAccessOnStart){const n=hr(this.config);if(n.length)return this.emeController.getKeySystemAccess(n)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,i;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,Me.KEY_LOAD_ERROR,c))}const r=s.uri;if(!r)return Promise.reject(this.createKeyLoadError(e,Me.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${r}"`)));let d=this.keyUriToKeyInfo[r];if((n=d)!=null&&n.decryptdata.key)return s.key=d.decryptdata.key,Promise.resolve({frag:e,keyInfo:d});if((i=d)!=null&&i.keyLoadPromise){var u;switch((u=d.mediaKeySessionContext)==null?void 0:u.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return d.keyLoadPromise.then(c=>(s.key=c.keyInfo.decryptdata.key,{frag:e,keyInfo:d}))}}switch(d=this.keyUriToKeyInfo[r]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(d,e):this.loadKeyEME(d,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(d,e);default:return Promise.reject(this.createKeyLoadError(e,Me.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const i=this.emeController.loadKey(n);if(i)return(e.keyLoadPromise=i.then(s=>(e.mediaKeySessionContext=s,n))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,i=n.loader,s=new i(n);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((r,d)=>{const u={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=n.keyLoadPolicy.default,l={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(o,f,p,m)=>{const{frag:y,keyInfo:_,url:S}=p;if(!y.decryptdata||_!==this.keyUriToKeyInfo[S])return d(this.createKeyLoadError(y,Me.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),m));_.decryptdata.key=y.decryptdata.key=new Uint8Array(o.data),y.keyLoader=null,_.loader=null,r({frag:y,keyInfo:_})},onError:(o,f,p,m)=>{this.resetLoader(f),d(this.createKeyLoadError(t,Me.KEY_LOAD_ERROR,new Error(`HTTP Error ${o.code} loading key ${o.text}`),p,en({url:u.url,data:void 0},o)))},onTimeout:(o,f,p)=>{this.resetLoader(f),d(this.createKeyLoadError(t,Me.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(o,f,p)=>{this.resetLoader(f),d(this.createKeyLoadError(t,Me.INTERNAL_ABORTED,new Error("key loading aborted"),p))}};s.load(u,l,h)})}resetLoader(e){const{frag:t,keyInfo:n,url:i}=e,s=n.loader;t.keyLoader===s&&(t.keyLoader=null,n.loader=null),delete this.keyUriToKeyInfo[i],s&&s.destroy()}}function uc(a){const{type:e}=a;switch(e){case Vt.AUDIO_TRACK:return bt.AUDIO;case Vt.SUBTITLE_TRACK:return bt.SUBTITLE;default:return bt.MAIN}}function Ha(a,e){let t=a.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class NS{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.LEVEL_LOADING,this.onLevelLoading,this),e.on($.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on($.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on($.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.LEVEL_LOADING,this.onLevelLoading,this),e.off($.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off($.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off($.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,i=t.loader,s=n||i,r=new s(t);return this.loaders[e.type]=r,r}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Vt.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:i,pathwayId:s,url:r,deliveryDirectives:d,levelInfo:u}=t;this.load({id:n,level:i,pathwayId:s,responseType:"text",type:Vt.LEVEL,url:r,deliveryDirectives:d,levelOrTrack:u})}onAudioTrackLoading(e,t){const{id:n,groupId:i,url:s,deliveryDirectives:r,track:d}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:Vt.AUDIO_TRACK,url:s,deliveryDirectives:r,levelOrTrack:d})}onSubtitleTrackLoading(e,t){const{id:n,groupId:i,url:s,deliveryDirectives:r,track:d}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:Vt.SUBTITLE_TRACK,url:s,deliveryDirectives:r,levelOrTrack:d})}onLevelsUpdated(e,t){const n=this.loaders[Vt.LEVEL];if(n){const i=n.context;i&&!t.levels.some(s=>s===i.levelOrTrack)&&(n.abort(),delete this.loaders[Vt.LEVEL])}}load(e){var t;const n=this.hls.config;let i=this.getInternalLoader(e);if(i){const c=this.hls.logger,l=i.context;if(l&&l.levelOrTrack===e.levelOrTrack&&(l.url===e.url||l.deliveryDirectives&&!e.deliveryDirectives)){l.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${l.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let s;if(e.type===Vt.MANIFEST?s=n.manifestLoadPolicy.default:s=nn({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),pt((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===Vt.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===Vt.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===Vt.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const l=c.partTarget,h=c.targetduration;if(l&&h){const o=Math.max(l*3,h*.8)*1e3;s=nn({},s,{maxTimeToFirstByteMs:Math.min(o,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(o,s.maxTimeToFirstByteMs)})}}}const r=s.errorRetry||s.timeoutRetry||{},d={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:r.maxNumRetry||0,retryDelay:r.retryDelayMs||0,maxRetryDelay:r.maxRetryDelayMs||0},u={onSuccess:(c,l,h,o)=>{const f=this.getInternalLoader(h);this.resetInternalLoader(h.type);const p=c.data;if(p.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(c,h,new Error("no EXTM3U delimiter"),o||null,l);return}l.parsing.start=performance.now(),di.isMediaPlaylist(p)||h.type!==Vt.MANIFEST?this.handleTrackOrLevelPlaylist(c,l,h,o||null,f):this.handleMasterPlaylist(c,l,h,o)},onError:(c,l,h,o)=>{this.handleNetworkError(l,h,!1,c,o)},onTimeout:(c,l,h)=>{this.handleNetworkError(l,h,!0,void 0,c)}};i.load(e,d,u)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,i){const s=this.hls,r=e.data,d=Ha(e,n),u=di.parseMasterPlaylist(r,d);if(u.playlistParsingError){this.handleManifestParsingError(e,n,u.playlistParsingError,i,t);return}const{contentSteering:c,levels:l,sessionData:h,sessionKeys:o,startTimeOffset:f,variableList:p}=u;this.variableList=p;const{AUDIO:m=[],SUBTITLES:y,"CLOSED-CAPTIONS":_}=di.parseMasterPlaylistMedia(r,d,u);m.length&&!m.some(b=>!b.url)&&l[0].audioCodec&&!l[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Sn({}),bitrate:0,url:""})),s.trigger($.MANIFEST_LOADED,{levels:l,audioTracks:m,subtitles:y,captions:_,contentSteering:c,url:d,stats:t,networkDetails:i,sessionData:h,sessionKeys:o,startTimeOffset:f,variableList:p})}handleTrackOrLevelPlaylist(e,t,n,i,s){const r=this.hls,{id:d,level:u,type:c}=n,l=Ha(e,n),h=pt(u)?u:pt(d)?d:0,o=uc(n),f=di.parseLevelPlaylist(e.data,l,h,o,0,this.variableList);if(c===Vt.MANIFEST){const p={attrs:new Sn({}),bitrate:0,details:f,name:"",url:l};f.requestScheduled=t.loading.start+Hu(f,0),r.trigger($.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:l,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=f,this.handlePlaylistLoaded(f,e,t,n,i,s)}handleManifestParsingError(e,t,n,i,s){this.hls.trigger($.ERROR,{type:xt.NETWORK_ERROR,details:Me.MANIFEST_PARSING_ERROR,fatal:t.type===Vt.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,n=!1,i,s){let r=`A network ${n?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===Vt.LEVEL?r+=`: ${e.level} id: ${e.id}`:(e.type===Vt.AUDIO_TRACK||e.type===Vt.SUBTITLE_TRACK)&&(r+=` id: ${e.id} group-id: "${e.groupId}"`);const d=new Error(r);this.hls.logger.warn(`[playlist-loader]: ${r}`);let u=Me.UNKNOWN,c=!1;const l=this.getInternalLoader(e);switch(e.type){case Vt.MANIFEST:u=n?Me.MANIFEST_LOAD_TIMEOUT:Me.MANIFEST_LOAD_ERROR,c=!0;break;case Vt.LEVEL:u=n?Me.LEVEL_LOAD_TIMEOUT:Me.LEVEL_LOAD_ERROR,c=!1;break;case Vt.AUDIO_TRACK:u=n?Me.AUDIO_TRACK_LOAD_TIMEOUT:Me.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case Vt.SUBTITLE_TRACK:u=n?Me.SUBTITLE_TRACK_LOAD_TIMEOUT:Me.SUBTITLE_LOAD_ERROR,c=!1;break}l&&this.resetInternalLoader(e.type);const h={type:xt.NETWORK_ERROR,details:u,fatal:c,url:e.url,loader:l,context:e,error:d,networkDetails:t,stats:s};if(i){const o=(t==null?void 0:t.url)||e.url;h.response=en({url:o,data:void 0},i)}this.hls.trigger($.ERROR,h)}handlePlaylistLoaded(e,t,n,i,s,r){const d=this.hls,{type:u,level:c,id:l,groupId:h,deliveryDirectives:o}=i,f=Ha(t,i),p=uc(i),m=typeof i.level=="number"&&p===bt.MAIN?c:void 0;if(!e.fragments.length){const _=e.playlistParsingError=new Error("No Segments found in Playlist");d.trigger($.ERROR,{type:xt.NETWORK_ERROR,details:Me.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:_,reason:_.message,response:t,context:i,level:m,parent:p,networkDetails:s,stats:n});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const y=e.playlistParsingError;if(y){if(this.hls.logger.warn(y),!d.config.ignorePlaylistParsingErrors){d.trigger($.ERROR,{type:xt.NETWORK_ERROR,details:Me.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:y,reason:y.message,response:t,context:i,level:m,parent:p,networkDetails:s,stats:n});return}e.playlistParsingError=null}switch(e.live&&r&&(r.getCacheAge&&(e.ageHeader=r.getCacheAge()||0),(!r.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),u){case Vt.MANIFEST:case Vt.LEVEL:d.trigger($.LEVEL_LOADED,{details:e,levelInfo:i.levelOrTrack||d.levels[0],level:m||0,id:l||0,stats:n,networkDetails:s,deliveryDirectives:o,withoutMultiVariant:u===Vt.MANIFEST});break;case Vt.AUDIO_TRACK:d.trigger($.AUDIO_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:l||0,groupId:h||"",stats:n,networkDetails:s,deliveryDirectives:o});break;case Vt.SUBTITLE_TRACK:d.trigger($.SUBTITLE_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:l||0,groupId:h||"",stats:n,networkDetails:s,deliveryDirectives:o});break}}}class Ai{static get version(){return Sr}static isMSESupported(){return Nh()}static isSupported(){return PS()}static getMediaSource(){return xi()}static get Events(){return $}static get MetadataSchema(){return Vn}static get ErrorTypes(){return xt}static get ErrorDetails(){return Me}static get DefaultConfig(){return Ai.defaultConfig?Ai.defaultConfig:vS}static set DefaultConfig(e){Ai.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new qo,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=sA(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=SS(Ai.DefaultConfig,e,t);this.userConfig=e,n.progressive&&ES(n,t);const{abrController:i,bufferController:s,capLevelController:r,errorController:d,fpsController:u}=n,c=new d(this),l=this.abrController=new i(this),h=new YA(this),o=n.interstitialsController,f=o?this.interstitialsController=new o(this,Ai):null,p=this.bufferController=new s(this,h),m=this.capLevelController=new r(this),y=new u(this),_=new NS(this),S=n.contentSteeringController,b=S?new S(this):null,x=this.levelController=new DS(this,b),L=new IS(this),N=new FS(this.config),P=this.streamController=new BS(this,h,N),T=this.gapController=new wS(this,h);m.setStreamController(P),y.setStreamController(P);const k=[_,x,P];f&&k.splice(1,0,f),b&&k.splice(1,0,b),this.networkControllers=k;const I=[l,p,T,m,y,L,h];this.audioTrackController=this.createController(n.audioTrackController,k);const F=n.audioStreamController;F&&k.push(this.audioStreamController=new F(this,h,N)),this.subtitleTrackController=this.createController(n.subtitleTrackController,k);const V=n.subtitleStreamController;V&&k.push(this.subtititleStreamController=new V(this,h,N)),this.createController(n.timelineController,I),N.emeController=this.emeController=this.createController(n.emeController,I),this.cmcdController=this.createController(n.cmcdController,I),this.latencyController=this.createController(LS,I),this.coreComponents=I,k.push(c);const ne=c.onErrorOut;typeof ne=="function"&&this.on($.ERROR,ne,c),this.on($.MANIFEST_LOADED,_.onManifestLoaded,_)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,i){this._emitter.off(e,t,n,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const i=e===$.ERROR;this.trigger($.ERROR,{type:xt.OTHER_ERROR,details:Me.INTERNAL_EXCEPTION,fatal:i,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger($.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger($.ERROR,{type:xt.OTHER_ERROR,details:Me.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,i=t?e:{media:n};this._media=n,this.trigger($.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger($.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger($.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,i=this._url=Bo.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&n&&(n!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger($.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[bt.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[bt.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[bt.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=w1()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){PA(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let i=0;i<n;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,n)for(let s=i;s--;){const r=e[s].attrs["HDCP-LEVEL"];if(r&&r<=n)return s}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=Pu(t);return Du(e,n,navigator.mediaCapabilities)}}Ai.defaultConfig=void 0;var Uh={exports:{}};(function(a,e){(function(t,n){a.exports=n()})(window,function(){return function(t){var n={};function i(s){if(n[s])return n[s].exports;var r=n[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=n,i.d=function(s,r,d){i.o(s,r)||Object.defineProperty(s,r,{enumerable:!0,get:d})},i.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},i.t=function(s,r){if(1&r&&(s=i(s)),8&r||4&r&&typeof s=="object"&&s&&s.__esModule)return s;var d=Object.create(null);if(i.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:s}),2&r&&typeof s!="string")for(var u in s)i.d(d,u,(function(c){return s[c]}).bind(null,u));return d},i.n=function(s){var r=s&&s.__esModule?function(){return s.default}:function(){return s};return i.d(r,"a",r),r},i.o=function(s,r){return Object.prototype.hasOwnProperty.call(s,r)},i.p="",i(i.s=25)}([function(t,n,i){var s=i(10),r=i.n(s),d=function(){function u(){}return u.e=function(c,l){c&&!u.FORCE_GLOBAL_TAG||(c=u.GLOBAL_TAG);var h="[".concat(c,"] > ").concat(l);u.ENABLE_CALLBACK&&u.emitter.emit("log","error",h),u.ENABLE_ERROR&&(console.error?console.error(h):console.warn?console.warn(h):console.log(h))},u.i=function(c,l){c&&!u.FORCE_GLOBAL_TAG||(c=u.GLOBAL_TAG);var h="[".concat(c,"] > ").concat(l);u.ENABLE_CALLBACK&&u.emitter.emit("log","info",h),u.ENABLE_INFO&&(console.info?console.info(h):console.log(h))},u.w=function(c,l){c&&!u.FORCE_GLOBAL_TAG||(c=u.GLOBAL_TAG);var h="[".concat(c,"] > ").concat(l);u.ENABLE_CALLBACK&&u.emitter.emit("log","warn",h),u.ENABLE_WARN&&(console.warn?console.warn(h):console.log(h))},u.d=function(c,l){c&&!u.FORCE_GLOBAL_TAG||(c=u.GLOBAL_TAG);var h="[".concat(c,"] > ").concat(l);u.ENABLE_CALLBACK&&u.emitter.emit("log","debug",h),u.ENABLE_DEBUG&&(console.debug?console.debug(h):console.log(h))},u.v=function(c,l){c&&!u.FORCE_GLOBAL_TAG||(c=u.GLOBAL_TAG);var h="[".concat(c,"] > ").concat(l);u.ENABLE_CALLBACK&&u.emitter.emit("log","verbose",h),u.ENABLE_VERBOSE&&console.log(h)},u}();d.GLOBAL_TAG="mpegts.js",d.FORCE_GLOBAL_TAG=!1,d.ENABLE_ERROR=!0,d.ENABLE_INFO=!0,d.ENABLE_WARN=!0,d.ENABLE_DEBUG=!0,d.ENABLE_VERBOSE=!0,d.ENABLE_CALLBACK=!1,d.emitter=new r.a,n.a=d},function(t,n,i){var s;(function(r){r.IO_ERROR="io_error",r.DEMUX_ERROR="demux_error",r.INIT_SEGMENT="init_segment",r.MEDIA_SEGMENT="media_segment",r.LOADING_COMPLETE="loading_complete",r.RECOVERED_EARLY_EOF="recovered_early_eof",r.MEDIA_INFO="media_info",r.METADATA_ARRIVED="metadata_arrived",r.SCRIPTDATA_ARRIVED="scriptdata_arrived",r.TIMED_ID3_METADATA_ARRIVED="timed_id3_metadata_arrived",r.SYNCHRONOUS_KLV_METADATA_ARRIVED="synchronous_klv_metadata_arrived",r.ASYNCHRONOUS_KLV_METADATA_ARRIVED="asynchronous_klv_metadata_arrived",r.SMPTE2038_METADATA_ARRIVED="smpte2038_metadata_arrived",r.SCTE35_METADATA_ARRIVED="scte35_metadata_arrived",r.PES_PRIVATE_DATA_DESCRIPTOR="pes_private_data_descriptor",r.PES_PRIVATE_DATA_ARRIVED="pes_private_data_arrived",r.STATISTICS_INFO="statistics_info",r.RECOMMEND_SEEKPOINT="recommend_seekpoint"})(s||(s={})),n.a=s},function(t,n,i){i.d(n,"c",function(){return r}),i.d(n,"b",function(){return d}),i.d(n,"a",function(){return u});var s=i(3),r={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},d={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},u=function(){function c(l){this._type=l||"undefined",this._status=r.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return c.prototype.destroy=function(){this._status=r.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},c.prototype.isWorking=function(){return this._status===r.kConnecting||this._status===r.kBuffering},Object.defineProperty(c.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(l){this._onContentLengthKnown=l},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(l){this._onURLRedirect=l},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(l){this._onDataArrival=l},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onError",{get:function(){return this._onError},set:function(l){this._onError=l},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onComplete",{get:function(){return this._onComplete},set:function(l){this._onComplete=l},enumerable:!1,configurable:!0}),c.prototype.open=function(l,h){throw new s.c("Unimplemented abstract function!")},c.prototype.abort=function(){throw new s.c("Unimplemented abstract function!")},c}()},function(t,n,i){i.d(n,"d",function(){return d}),i.d(n,"a",function(){return u}),i.d(n,"b",function(){return c}),i.d(n,"c",function(){return l});var s,r=(s=function(h,o){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,p){f.__proto__=p}||function(f,p){for(var m in p)Object.prototype.hasOwnProperty.call(p,m)&&(f[m]=p[m])})(h,o)},function(h,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function f(){this.constructor=h}s(h,o),h.prototype=o===null?Object.create(o):(f.prototype=o.prototype,new f)}),d=function(){function h(o){this._message=o}return Object.defineProperty(h.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),h.prototype.toString=function(){return this.name+": "+this.message},h}(),u=function(h){function o(f){return h.call(this,f)||this}return r(o,h),Object.defineProperty(o.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),o}(d),c=function(h){function o(f){return h.call(this,f)||this}return r(o,h),Object.defineProperty(o.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),o}(d),l=function(h){function o(f){return h.call(this,f)||this}return r(o,h),Object.defineProperty(o.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),o}(d)},function(t,n,i){var s;(function(r){r.ERROR="error",r.LOADING_COMPLETE="loading_complete",r.RECOVERED_EARLY_EOF="recovered_early_eof",r.MEDIA_INFO="media_info",r.METADATA_ARRIVED="metadata_arrived",r.SCRIPTDATA_ARRIVED="scriptdata_arrived",r.TIMED_ID3_METADATA_ARRIVED="timed_id3_metadata_arrived",r.SYNCHRONOUS_KLV_METADATA_ARRIVED="synchronous_klv_metadata_arrived",r.ASYNCHRONOUS_KLV_METADATA_ARRIVED="asynchronous_klv_metadata_arrived",r.SMPTE2038_METADATA_ARRIVED="smpte2038_metadata_arrived",r.SCTE35_METADATA_ARRIVED="scte35_metadata_arrived",r.PES_PRIVATE_DATA_DESCRIPTOR="pes_private_data_descriptor",r.PES_PRIVATE_DATA_ARRIVED="pes_private_data_arrived",r.STATISTICS_INFO="statistics_info",r.DESTROYING="destroying"})(s||(s={})),n.a=s},function(t,n,i){var s={};(function(){var r=self.navigator.userAgent.toLowerCase(),d=/(edge)\/([\w.]+)/.exec(r)||/(opr)[\/]([\w.]+)/.exec(r)||/(chrome)[ \/]([\w.]+)/.exec(r)||/(iemobile)[\/]([\w.]+)/.exec(r)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(r)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(r)||/(webkit)[ \/]([\w.]+)/.exec(r)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(r)||/(msie) ([\w.]+)/.exec(r)||r.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(r)||r.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(r)||[],u=/(ipad)/.exec(r)||/(ipod)/.exec(r)||/(windows phone)/.exec(r)||/(iphone)/.exec(r)||/(kindle)/.exec(r)||/(android)/.exec(r)||/(windows)/.exec(r)||/(mac)/.exec(r)||/(linux)/.exec(r)||/(cros)/.exec(r)||[],c={browser:d[5]||d[3]||d[1]||"",version:d[2]||d[4]||"0",majorVersion:d[4]||d[2]||"0",platform:u[0]||""},l={};if(c.browser){l[c.browser]=!0;var h=c.majorVersion.split(".");l.version={major:parseInt(c.majorVersion,10),string:c.version},h.length>1&&(l.version.minor=parseInt(h[1],10)),h.length>2&&(l.version.build=parseInt(h[2],10))}c.platform&&(l[c.platform]=!0),(l.chrome||l.opr||l.safari)&&(l.webkit=!0),(l.rv||l.iemobile)&&(l.rv&&delete l.rv,c.browser="msie",l.msie=!0),l.edge&&(delete l.edge,c.browser="msedge",l.msedge=!0),l.opr&&(c.browser="opera",l.opera=!0),l.safari&&l.android&&(c.browser="android",l.android=!0);for(var o in l.name=c.browser,l.platform=c.platform,s)s.hasOwnProperty(o)&&delete s[o];Object.assign(s,l)})(),n.a=s},function(t,n,i){n.a={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},function(t,n,i){var s;(function(r){r.ERROR="error",r.SOURCE_OPEN="source_open",r.UPDATE_END="update_end",r.BUFFER_FULL="buffer_full",r.START_STREAMING="start_streaming",r.END_STREAMING="end_streaming"})(s||(s={})),n.a=s},function(t,n,i){var s=i(3),r=function(){function d(u){this.TAG="ExpGolomb",this._buffer=u,this._buffer_index=0,this._total_bytes=u.byteLength,this._total_bits=8*u.byteLength,this._current_word=0,this._current_word_bits_left=0}return d.prototype.destroy=function(){this._buffer=null},d.prototype._fillCurrentWord=function(){var u=this._total_bytes-this._buffer_index;if(u<=0)throw new s.a("ExpGolomb: _fillCurrentWord() but no bytes available");var c=Math.min(4,u),l=new Uint8Array(4);l.set(this._buffer.subarray(this._buffer_index,this._buffer_index+c)),this._current_word=new DataView(l.buffer).getUint32(0,!1),this._buffer_index+=c,this._current_word_bits_left=8*c},d.prototype.readBits=function(u){if(u>32)throw new s.b("ExpGolomb: readBits() bits exceeded max 32bits!");if(u<=this._current_word_bits_left){var c=this._current_word>>>32-u;return this._current_word<<=u,this._current_word_bits_left-=u,c}var l=this._current_word_bits_left?this._current_word:0;l>>>=32-this._current_word_bits_left;var h=u-this._current_word_bits_left;this._fillCurrentWord();var o=Math.min(h,this._current_word_bits_left),f=this._current_word>>>32-o;return this._current_word<<=o,this._current_word_bits_left-=o,l=l<<o|f},d.prototype.readBool=function(){return this.readBits(1)===1},d.prototype.readByte=function(){return this.readBits(8)},d.prototype._skipLeadingZero=function(){var u;for(u=0;u<this._current_word_bits_left;u++)if(this._current_word&2147483648>>>u)return this._current_word<<=u,this._current_word_bits_left-=u,u;return this._fillCurrentWord(),u+this._skipLeadingZero()},d.prototype.readUEG=function(){var u=this._skipLeadingZero();return this.readBits(u+1)-1},d.prototype.readSEG=function(){var u=this.readUEG();return 1&u?u+1>>>1:-1*(u>>>1)},d}();n.a=r},function(t,n,i){var s=i(10),r=i.n(s),d=i(0),u=function(){function c(){}return Object.defineProperty(c,"forceGlobalTag",{get:function(){return d.a.FORCE_GLOBAL_TAG},set:function(l){d.a.FORCE_GLOBAL_TAG=l,c._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(c,"globalTag",{get:function(){return d.a.GLOBAL_TAG},set:function(l){d.a.GLOBAL_TAG=l,c._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(c,"enableAll",{get:function(){return d.a.ENABLE_VERBOSE&&d.a.ENABLE_DEBUG&&d.a.ENABLE_INFO&&d.a.ENABLE_WARN&&d.a.ENABLE_ERROR},set:function(l){d.a.ENABLE_VERBOSE=l,d.a.ENABLE_DEBUG=l,d.a.ENABLE_INFO=l,d.a.ENABLE_WARN=l,d.a.ENABLE_ERROR=l,c._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(c,"enableDebug",{get:function(){return d.a.ENABLE_DEBUG},set:function(l){d.a.ENABLE_DEBUG=l,c._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(c,"enableVerbose",{get:function(){return d.a.ENABLE_VERBOSE},set:function(l){d.a.ENABLE_VERBOSE=l,c._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(c,"enableInfo",{get:function(){return d.a.ENABLE_INFO},set:function(l){d.a.ENABLE_INFO=l,c._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(c,"enableWarn",{get:function(){return d.a.ENABLE_WARN},set:function(l){d.a.ENABLE_WARN=l,c._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(c,"enableError",{get:function(){return d.a.ENABLE_ERROR},set:function(l){d.a.ENABLE_ERROR=l,c._notifyChange()},enumerable:!1,configurable:!0}),c.getConfig=function(){return{globalTag:d.a.GLOBAL_TAG,forceGlobalTag:d.a.FORCE_GLOBAL_TAG,enableVerbose:d.a.ENABLE_VERBOSE,enableDebug:d.a.ENABLE_DEBUG,enableInfo:d.a.ENABLE_INFO,enableWarn:d.a.ENABLE_WARN,enableError:d.a.ENABLE_ERROR,enableCallback:d.a.ENABLE_CALLBACK}},c.applyConfig=function(l){d.a.GLOBAL_TAG=l.globalTag,d.a.FORCE_GLOBAL_TAG=l.forceGlobalTag,d.a.ENABLE_VERBOSE=l.enableVerbose,d.a.ENABLE_DEBUG=l.enableDebug,d.a.ENABLE_INFO=l.enableInfo,d.a.ENABLE_WARN=l.enableWarn,d.a.ENABLE_ERROR=l.enableError,d.a.ENABLE_CALLBACK=l.enableCallback},c._notifyChange=function(){var l=c.emitter;if(l.listenerCount("change")>0){var h=c.getConfig();l.emit("change",h)}},c.registerListener=function(l){c.emitter.addListener("change",l)},c.removeListener=function(l){c.emitter.removeListener("change",l)},c.addLogListener=function(l){d.a.emitter.addListener("log",l),d.a.emitter.listenerCount("log")>0&&(d.a.ENABLE_CALLBACK=!0,c._notifyChange())},c.removeLogListener=function(l){d.a.emitter.removeListener("log",l),d.a.emitter.listenerCount("log")===0&&(d.a.ENABLE_CALLBACK=!1,c._notifyChange())},c}();u.emitter=new r.a,n.a=u},function(t,n,i){var s,r=typeof Reflect=="object"?Reflect:null,d=r&&typeof r.apply=="function"?r.apply:function(x,L,N){return Function.prototype.apply.call(x,L,N)};s=r&&typeof r.ownKeys=="function"?r.ownKeys:Object.getOwnPropertySymbols?function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:function(x){return Object.getOwnPropertyNames(x)};var u=Number.isNaN||function(x){return x!=x};function c(){c.init.call(this)}t.exports=c,t.exports.once=function(x,L){return new Promise(function(N,P){function T(I){x.removeListener(L,k),P(I)}function k(){typeof x.removeListener=="function"&&x.removeListener("error",T),N([].slice.call(arguments))}b(x,L,k,{once:!0}),L!=="error"&&function(I,F,V){typeof I.on=="function"&&b(I,"error",F,V)}(x,T,{once:!0})})},c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var l=10;function h(x){if(typeof x!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}function o(x){return x._maxListeners===void 0?c.defaultMaxListeners:x._maxListeners}function f(x,L,N,P){var T,k,I,F;if(h(N),(k=x._events)===void 0?(k=x._events=Object.create(null),x._eventsCount=0):(k.newListener!==void 0&&(x.emit("newListener",L,N.listener?N.listener:N),k=x._events),I=k[L]),I===void 0)I=k[L]=N,++x._eventsCount;else if(typeof I=="function"?I=k[L]=P?[N,I]:[I,N]:P?I.unshift(N):I.push(N),(T=o(x))>0&&I.length>T&&!I.warned){I.warned=!0;var V=new Error("Possible EventEmitter memory leak detected. "+I.length+" "+String(L)+" listeners added. Use emitter.setMaxListeners() to increase limit");V.name="MaxListenersExceededWarning",V.emitter=x,V.type=L,V.count=I.length,F=V,console&&console.warn&&console.warn(F)}return x}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function m(x,L,N){var P={fired:!1,wrapFn:void 0,target:x,type:L,listener:N},T=p.bind(P);return T.listener=N,P.wrapFn=T,T}function y(x,L,N){var P=x._events;if(P===void 0)return[];var T=P[L];return T===void 0?[]:typeof T=="function"?N?[T.listener||T]:[T]:N?function(k){for(var I=new Array(k.length),F=0;F<I.length;++F)I[F]=k[F].listener||k[F];return I}(T):S(T,T.length)}function _(x){var L=this._events;if(L!==void 0){var N=L[x];if(typeof N=="function")return 1;if(N!==void 0)return N.length}return 0}function S(x,L){for(var N=new Array(L),P=0;P<L;++P)N[P]=x[P];return N}function b(x,L,N,P){if(typeof x.on=="function")P.once?x.once(L,N):x.on(L,N);else{if(typeof x.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x);x.addEventListener(L,function T(k){P.once&&x.removeEventListener(L,T),N(k)})}}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(x){if(typeof x!="number"||x<0||u(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");l=x}}),c.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(x){if(typeof x!="number"||x<0||u(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this},c.prototype.getMaxListeners=function(){return o(this)},c.prototype.emit=function(x){for(var L=[],N=1;N<arguments.length;N++)L.push(arguments[N]);var P=x==="error",T=this._events;if(T!==void 0)P=P&&T.error===void 0;else if(!P)return!1;if(P){var k;if(L.length>0&&(k=L[0]),k instanceof Error)throw k;var I=new Error("Unhandled error."+(k?" ("+k.message+")":""));throw I.context=k,I}var F=T[x];if(F===void 0)return!1;if(typeof F=="function")d(F,this,L);else{var V=F.length,ne=S(F,V);for(N=0;N<V;++N)d(ne[N],this,L)}return!0},c.prototype.addListener=function(x,L){return f(this,x,L,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(x,L){return f(this,x,L,!0)},c.prototype.once=function(x,L){return h(L),this.on(x,m(this,x,L)),this},c.prototype.prependOnceListener=function(x,L){return h(L),this.prependListener(x,m(this,x,L)),this},c.prototype.removeListener=function(x,L){var N,P,T,k,I;if(h(L),(P=this._events)===void 0)return this;if((N=P[x])===void 0)return this;if(N===L||N.listener===L)--this._eventsCount==0?this._events=Object.create(null):(delete P[x],P.removeListener&&this.emit("removeListener",x,N.listener||L));else if(typeof N!="function"){for(T=-1,k=N.length-1;k>=0;k--)if(N[k]===L||N[k].listener===L){I=N[k].listener,T=k;break}if(T<0)return this;T===0?N.shift():function(F,V){for(;V+1<F.length;V++)F[V]=F[V+1];F.pop()}(N,T),N.length===1&&(P[x]=N[0]),P.removeListener!==void 0&&this.emit("removeListener",x,I||L)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(x){var L,N,P;if((N=this._events)===void 0)return this;if(N.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):N[x]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete N[x]),this;if(arguments.length===0){var T,k=Object.keys(N);for(P=0;P<k.length;++P)(T=k[P])!=="removeListener"&&this.removeAllListeners(T);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(L=N[x])=="function")this.removeListener(x,L);else if(L!==void 0)for(P=L.length-1;P>=0;P--)this.removeListener(x,L[P]);return this},c.prototype.listeners=function(x){return y(this,x,!0)},c.prototype.rawListeners=function(x){return y(this,x,!1)},c.listenerCount=function(x,L){return typeof x.listenerCount=="function"?x.listenerCount(L):_.call(x,L)},c.prototype.listenerCount=_,c.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]}},function(t,n,i){i.d(n,"b",function(){return d}),i.d(n,"a",function(){return u});var s=i(2),r=i(6),d={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},u={NETWORK_EXCEPTION:s.b.EXCEPTION,NETWORK_STATUS_CODE_INVALID:s.b.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:s.b.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:s.b.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:r.a.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:r.a.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:r.a.CODEC_UNSUPPORTED}},function(t,n,i){i.d(n,"d",function(){return s}),i.d(n,"b",function(){return r}),i.d(n,"a",function(){return d}),i.d(n,"c",function(){return u});var s=function(c,l,h,o,f){this.dts=c,this.pts=l,this.duration=h,this.originalDts=o,this.isSyncPoint=f,this.fileposition=null},r=function(){function c(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return c.prototype.appendSyncPoint=function(l){l.isSyncPoint=!0,this.syncPoints.push(l)},c}(),d=function(){function c(){this._list=[]}return c.prototype.clear=function(){this._list=[]},c.prototype.appendArray=function(l){var h=this._list;l.length!==0&&(h.length>0&&l[0].originalDts<h[h.length-1].originalDts&&this.clear(),Array.prototype.push.apply(h,l))},c.prototype.getLastSyncPointBeforeDts=function(l){if(this._list.length==0)return null;var h=this._list,o=0,f=h.length-1,p=0,m=0,y=f;for(l<h[0].dts&&(o=0,m=y+1);m<=y;){if((p=m+Math.floor((y-m)/2))===f||l>=h[p].dts&&l<h[p+1].dts){o=p;break}h[p].dts<l?m=p+1:y=p-1}return this._list[o]},c}(),u=function(){function c(l){this._type=l,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(c.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),c.prototype.isEmpty=function(){return this._list.length===0},c.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},c.prototype._searchNearestSegmentBefore=function(l){var h=this._list;if(h.length===0)return-2;var o=h.length-1,f=0,p=0,m=o,y=0;if(l<h[0].originalBeginDts)return y=-1;for(;p<=m;){if((f=p+Math.floor((m-p)/2))===o||l>h[f].lastSample.originalDts&&l<h[f+1].originalBeginDts){y=f;break}h[f].originalBeginDts<l?p=f+1:m=f-1}return y},c.prototype._searchNearestSegmentAfter=function(l){return this._searchNearestSegmentBefore(l)+1},c.prototype.append=function(l){var h=this._list,o=l,f=this._lastAppendLocation,p=0;f!==-1&&f<h.length&&o.originalBeginDts>=h[f].lastSample.originalDts&&(f===h.length-1||f<h.length-1&&o.originalBeginDts<h[f+1].originalBeginDts)?p=f+1:h.length>0&&(p=this._searchNearestSegmentBefore(o.originalBeginDts)+1),this._lastAppendLocation=p,this._list.splice(p,0,o)},c.prototype.getLastSegmentBefore=function(l){var h=this._searchNearestSegmentBefore(l);return h>=0?this._list[h]:null},c.prototype.getLastSampleBefore=function(l){var h=this.getLastSegmentBefore(l);return h!=null?h.lastSample:null},c.prototype.getLastSyncPointBefore=function(l){for(var h=this._searchNearestSegmentBefore(l),o=this._list[h].syncPoints;o.length===0&&h>0;)h--,o=this._list[h].syncPoints;return o.length>0?o[o.length-1]:null},c}()},function(t,n,i){var s=function(){function r(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return r.prototype.isComplete=function(){var d=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,u=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&d&&u},r.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},r.prototype.getNearestKeyframe=function(d){if(this.keyframesIndex==null)return null;var u=this.keyframesIndex,c=this._search(u.times,d);return{index:c,milliseconds:u.times[c],fileposition:u.filepositions[c]}},r.prototype._search=function(d,u){var c=0,l=d.length-1,h=0,o=0,f=l;for(u<d[0]&&(c=0,o=f+1);o<=f;){if((h=o+Math.floor((f-o)/2))===l||u>=d[h]&&u<d[h+1]){c=h;break}d[h]<u?o=h+1:f=h-1}return c},r}();n.a=s},function(t,n,i){var s,r=i(0),d=i(13),u=i(3),c=function(){function X(){}return X.prototype.destroy=function(){this.onError=null,this.onMediaInfo=null,this.onMetaDataArrived=null,this.onTrackMetadata=null,this.onDataAvailable=null,this.onTimedID3Metadata=null,this.onSynchronousKLVMetadata=null,this.onAsynchronousKLVMetadata=null,this.onSMPTE2038Metadata=null,this.onSCTE35Metadata=null,this.onPESPrivateData=null,this.onPESPrivateDataDescriptor=null},X}(),l=function(){this.program_pmt_pid={}};(function(X){X[X.kMPEG1Audio=3]="kMPEG1Audio",X[X.kMPEG2Audio=4]="kMPEG2Audio",X[X.kPESPrivateData=6]="kPESPrivateData",X[X.kADTSAAC=15]="kADTSAAC",X[X.kLOASAAC=17]="kLOASAAC",X[X.kAC3=129]="kAC3",X[X.kEAC3=135]="kEAC3",X[X.kMetadata=21]="kMetadata",X[X.kSCTE35=134]="kSCTE35",X[X.kH264=27]="kH264",X[X.kH265=36]="kH265"})(s||(s={}));var h,o=function(){this.pid_stream_type={},this.common_pids={h264:void 0,h265:void 0,av1:void 0,adts_aac:void 0,loas_aac:void 0,opus:void 0,ac3:void 0,eac3:void 0,mp3:void 0},this.pes_private_data_pids={},this.timed_id3_pids={},this.synchronous_klv_pids={},this.asynchronous_klv_pids={},this.scte_35_pids={},this.smpte2038_pids={}},f=function(){},p=function(){},m=function(){this.slices=[],this.total_length=0,this.expected_length=0,this.file_position=0};(function(X){X[X.kUnspecified=0]="kUnspecified",X[X.kSliceNonIDR=1]="kSliceNonIDR",X[X.kSliceDPA=2]="kSliceDPA",X[X.kSliceDPB=3]="kSliceDPB",X[X.kSliceDPC=4]="kSliceDPC",X[X.kSliceIDR=5]="kSliceIDR",X[X.kSliceSEI=6]="kSliceSEI",X[X.kSliceSPS=7]="kSliceSPS",X[X.kSlicePPS=8]="kSlicePPS",X[X.kSliceAUD=9]="kSliceAUD",X[X.kEndOfSequence=10]="kEndOfSequence",X[X.kEndOfStream=11]="kEndOfStream",X[X.kFiller=12]="kFiller",X[X.kSPSExt=13]="kSPSExt",X[X.kReserved0=14]="kReserved0"})(h||(h={}));var y,_,S=function(){},b=function(X){var re=X.data.byteLength;this.type=X.type,this.data=new Uint8Array(4+re),new DataView(this.data.buffer).setUint32(0,re),this.data.set(X.data,4)},x=function(){function X(re){this.TAG="H264AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=re,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&r.a.e(this.TAG,"Could not find H264 startcode until payload end!")}return X.prototype.findNextStartCodeOffset=function(re){for(var K=re,j=this.data_;;){if(K+3>=j.byteLength)return this.eof_flag_=!0,j.byteLength;var oe=j[K+0]<<24|j[K+1]<<16|j[K+2]<<8|j[K+3],_e=j[K+0]<<16|j[K+1]<<8|j[K+2];if(oe===1||_e===1)return K;K++}},X.prototype.readNextNaluPayload=function(){for(var re=this.data_,K=null;K==null&&!this.eof_flag_;){var j=this.current_startcode_offset_,oe=31&re[j+=(re[j]<<24|re[j+1]<<16|re[j+2]<<8|re[j+3])===1?4:3],_e=(128&re[j])>>>7,ae=this.findNextStartCodeOffset(j);if(this.current_startcode_offset_=ae,!(oe>=h.kReserved0)&&_e===0){var Te=re.subarray(j,ae);(K=new S).type=oe,K.data=Te}}return K},X}(),L=function(){function X(re,K,j){var oe=8+re.byteLength+1+2+K.byteLength,_e=!1;re[3]!==66&&re[3]!==77&&re[3]!==88&&(_e=!0,oe+=4);var ae=this.data=new Uint8Array(oe);ae[0]=1,ae[1]=re[1],ae[2]=re[2],ae[3]=re[3],ae[4]=255,ae[5]=225;var Te=re.byteLength;ae[6]=Te>>>8,ae[7]=255&Te;var Ee=8;ae.set(re,8),ae[Ee+=Te]=1;var ye=K.byteLength;ae[Ee+1]=ye>>>8,ae[Ee+2]=255&ye,ae.set(K,Ee+3),Ee+=3+ye,_e&&(ae[Ee]=252|j.chroma_format_idc,ae[Ee+1]=248|j.bit_depth_luma-8,ae[Ee+2]=248|j.bit_depth_chroma-8,ae[Ee+3]=0,Ee+=4)}return X.prototype.getData=function(){return this.data},X}(),N=i(23),P=i(8);(function(X){X[X.kNull=0]="kNull",X[X.kAACMain=1]="kAACMain",X[X.kAAC_LC=2]="kAAC_LC",X[X.kAAC_SSR=3]="kAAC_SSR",X[X.kAAC_LTP=4]="kAAC_LTP",X[X.kAAC_SBR=5]="kAAC_SBR",X[X.kAAC_Scalable=6]="kAAC_Scalable",X[X.kLayer1=32]="kLayer1",X[X.kLayer2=33]="kLayer2",X[X.kLayer3=34]="kLayer3"})(y||(y={})),function(X){X[X.k96000Hz=0]="k96000Hz",X[X.k88200Hz=1]="k88200Hz",X[X.k64000Hz=2]="k64000Hz",X[X.k48000Hz=3]="k48000Hz",X[X.k44100Hz=4]="k44100Hz",X[X.k32000Hz=5]="k32000Hz",X[X.k24000Hz=6]="k24000Hz",X[X.k22050Hz=7]="k22050Hz",X[X.k16000Hz=8]="k16000Hz",X[X.k12000Hz=9]="k12000Hz",X[X.k11025Hz=10]="k11025Hz",X[X.k8000Hz=11]="k8000Hz",X[X.k7350Hz=12]="k7350Hz"}(_||(_={}));var T,k,I=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],F=(T=function(X,re){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(K,j){K.__proto__=j}||function(K,j){for(var oe in j)Object.prototype.hasOwnProperty.call(j,oe)&&(K[oe]=j[oe])})(X,re)},function(X,re){if(typeof re!="function"&&re!==null)throw new TypeError("Class extends value "+String(re)+" is not a constructor or null");function K(){this.constructor=X}T(X,re),X.prototype=re===null?Object.create(re):(K.prototype=re.prototype,new K)}),V=function(){},ne=function(X){function re(){return X!==null&&X.apply(this,arguments)||this}return F(re,X),re}(V),te=function(){function X(re){this.TAG="AACADTSParser",this.data_=re,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&r.a.e(this.TAG,"Could not found ADTS syncword until payload end")}return X.prototype.findNextSyncwordOffset=function(re){for(var K=re,j=this.data_;;){if(K+7>=j.byteLength)return this.eof_flag_=!0,j.byteLength;if((j[K+0]<<8|j[K+1])>>>4===4095)return K;K++}},X.prototype.readNextAACFrame=function(){for(var re=this.data_,K=null;K==null&&!this.eof_flag_;){var j=this.current_syncword_offset_,oe=(8&re[j+1])>>>3,_e=(6&re[j+1])>>>1,ae=1&re[j+1],Te=(192&re[j+2])>>>6,Ee=(60&re[j+2])>>>2,ye=(1&re[j+2])<<2|(192&re[j+3])>>>6,Re=(3&re[j+3])<<11|re[j+4]<<3|(224&re[j+5])>>>5;if(re[j+6],j+Re>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var Oe=ae===1?7:9,Ne=Re-Oe;j+=Oe;var qe=this.findNextSyncwordOffset(j+Ne);if(this.current_syncword_offset_=qe,(oe===0||oe===1)&&_e===0){var ft=re.subarray(j,j+Ne);(K=new V).audio_object_type=Te+1,K.sampling_freq_index=Ee,K.sampling_frequency=I[Ee],K.channel_config=ye,K.data=ft}}return K},X.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},X.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},X}(),Z=function(){function X(re){this.TAG="AACLOASParser",this.data_=re,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&r.a.e(this.TAG,"Could not found LOAS syncword until payload end")}return X.prototype.findNextSyncwordOffset=function(re){for(var K=re,j=this.data_;;){if(K+1>=j.byteLength)return this.eof_flag_=!0,j.byteLength;if((j[K+0]<<3|j[K+1]>>>5)===695)return K;K++}},X.prototype.getLATMValue=function(re){for(var K=re.readBits(2),j=0,oe=0;oe<=K;oe++)j<<=8,j|=re.readByte();return j},X.prototype.readNextAACFrame=function(re){for(var K=this.data_,j=null;j==null&&!this.eof_flag_;){var oe=this.current_syncword_offset_,_e=(31&K[oe+1])<<8|K[oe+2];if(oe+3+_e>=this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var ae=new P.a(K.subarray(oe+3,oe+3+_e)),Te=null;if(ae.readBool()){if(re==null){r.a.w(this.TAG,"StreamMuxConfig Missing"),this.current_syncword_offset_=this.findNextSyncwordOffset(oe+3+_e),ae.destroy();continue}Te=re}else{var Ee=ae.readBool();if(Ee&&ae.readBool()){r.a.e(this.TAG,"audioMuxVersionA is Not Supported"),ae.destroy();break}if(Ee&&this.getLATMValue(ae),!ae.readBool()){r.a.e(this.TAG,"allStreamsSameTimeFraming zero is Not Supported"),ae.destroy();break}if(ae.readBits(6)!==0){r.a.e(this.TAG,"more than 2 numSubFrames Not Supported"),ae.destroy();break}if(ae.readBits(4)!==0){r.a.e(this.TAG,"more than 2 numProgram Not Supported"),ae.destroy();break}if(ae.readBits(3)!==0){r.a.e(this.TAG,"more than 2 numLayer Not Supported"),ae.destroy();break}var ye=Ee?this.getLATMValue(ae):0,Re=ae.readBits(5);ye-=5;var Oe=ae.readBits(4);ye-=4;var Ne=ae.readBits(4);ye-=4,ae.readBits(3),(ye-=3)>0&&ae.readBits(ye);var qe=ae.readBits(3);if(qe!==0){r.a.e(this.TAG,"frameLengthType = ".concat(qe,". Only frameLengthType = 0 Supported")),ae.destroy();break}ae.readByte();var ft=ae.readBool();if(ft)if(Ee)this.getLATMValue(ae);else{for(var St=0;;){St<<=8;var Yt=ae.readBool();if(St+=ae.readByte(),!Yt)break}console.log(St)}ae.readBool()&&ae.readByte(),(Te=new ne).audio_object_type=Re,Te.sampling_freq_index=Oe,Te.sampling_frequency=I[Te.sampling_freq_index],Te.channel_config=Ne,Te.other_data_present=ft}for(var ce=0;;){var me=ae.readByte();if(ce+=me,me!==255)break}for(var H=new Uint8Array(ce),B=0;B<ce;B++)H[B]=ae.readByte();(j=new ne).audio_object_type=Te.audio_object_type,j.sampling_freq_index=Te.sampling_freq_index,j.sampling_frequency=I[Te.sampling_freq_index],j.channel_config=Te.channel_config,j.other_data_present=Te.other_data_present,j.data=H,this.current_syncword_offset_=this.findNextSyncwordOffset(oe+3+_e)}return j},X.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},X.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},X}(),Q=function(X){var re=null,K=X.audio_object_type,j=X.audio_object_type,oe=X.sampling_freq_index,_e=X.channel_config,ae=0,Te=navigator.userAgent.toLowerCase();Te.indexOf("firefox")!==-1?oe>=6?(j=5,re=new Array(4),ae=oe-3):(j=2,re=new Array(2),ae=oe):Te.indexOf("android")!==-1?(j=2,re=new Array(2),ae=oe):(j=5,ae=oe,re=new Array(4),oe>=6?ae=oe-3:_e===1&&(j=2,re=new Array(2),ae=oe)),re[0]=j<<3,re[0]|=(15&oe)>>>1,re[1]=(15&oe)<<7,re[1]|=(15&_e)<<3,j===5&&(re[1]|=(15&ae)>>>1,re[2]=(1&ae)<<7,re[2]|=8,re[3]=0),this.config=re,this.sampling_rate=I[oe],this.channel_count=_e,this.codec_mimetype="mp4a.40."+j,this.original_codec_mimetype="mp4a.40."+K},he=function(){},de=function(){};(function(X){X[X.kSpliceNull=0]="kSpliceNull",X[X.kSpliceSchedule=4]="kSpliceSchedule",X[X.kSpliceInsert=5]="kSpliceInsert",X[X.kTimeSignal=6]="kTimeSignal",X[X.kBandwidthReservation=7]="kBandwidthReservation",X[X.kPrivateCommand=255]="kPrivateCommand"})(k||(k={}));var M,A=function(X){var re=X.readBool();return re?(X.readBits(6),{time_specified_flag:re,pts_time:4*X.readBits(31)+X.readBits(2)}):(X.readBits(7),{time_specified_flag:re})},v=function(X){var re=X.readBool();return X.readBits(6),{auto_return:re,duration:4*X.readBits(31)+X.readBits(2)}},w=function(X,re){var K=re.readBits(8);return X?{component_tag:K}:{component_tag:K,splice_time:A(re)}},R=function(X){return{component_tag:X.readBits(8),utc_splice_time:X.readBits(32)}},C=function(X){var re=X.readBits(32),K=X.readBool();X.readBits(7);var j={splice_event_id:re,splice_event_cancel_indicator:K};if(K)return j;if(j.out_of_network_indicator=X.readBool(),j.program_splice_flag=X.readBool(),j.duration_flag=X.readBool(),X.readBits(5),j.program_splice_flag)j.utc_splice_time=X.readBits(32);else{j.component_count=X.readBits(8),j.components=[];for(var oe=0;oe<j.component_count;oe++)j.components.push(R(X))}return j.duration_flag&&(j.break_duration=v(X)),j.unique_program_id=X.readBits(16),j.avail_num=X.readBits(8),j.avails_expected=X.readBits(8),j},O=function(X,re,K,j){return{descriptor_tag:X,descriptor_length:re,identifier:K,provider_avail_id:j.readBits(32)}},G=function(X,re,K,j){var oe=j.readBits(8),_e=j.readBits(3);j.readBits(5);for(var ae="",Te=0;Te<_e;Te++)ae+=String.fromCharCode(j.readBits(8));return{descriptor_tag:X,descriptor_length:re,identifier:K,preroll:oe,dtmf_count:_e,DTMF_char:ae}},z=function(X){var re=X.readBits(8);return X.readBits(7),{component_tag:re,pts_offset:4*X.readBits(31)+X.readBits(2)}},Y=function(X,re,K,j){var oe=j.readBits(32),_e=j.readBool();j.readBits(7);var ae={descriptor_tag:X,descriptor_length:re,identifier:K,segmentation_event_id:oe,segmentation_event_cancel_indicator:_e};if(_e)return ae;if(ae.program_segmentation_flag=j.readBool(),ae.segmentation_duration_flag=j.readBool(),ae.delivery_not_restricted_flag=j.readBool(),ae.delivery_not_restricted_flag?j.readBits(5):(ae.web_delivery_allowed_flag=j.readBool(),ae.no_regional_blackout_flag=j.readBool(),ae.archive_allowed_flag=j.readBool(),ae.device_restrictions=j.readBits(2)),!ae.program_segmentation_flag){ae.component_count=j.readBits(8),ae.components=[];for(var Te=0;Te<ae.component_count;Te++)ae.components.push(z(j))}ae.segmentation_duration_flag&&(ae.segmentation_duration=j.readBits(40)),ae.segmentation_upid_type=j.readBits(8),ae.segmentation_upid_length=j.readBits(8);var Ee=new Uint8Array(ae.segmentation_upid_length);for(Te=0;Te<ae.segmentation_upid_length;Te++)Ee[Te]=j.readBits(8);return ae.segmentation_upid=Ee.buffer,ae.segmentation_type_id=j.readBits(8),ae.segment_num=j.readBits(8),ae.segments_expected=j.readBits(8),ae.segmentation_type_id!==52&&ae.segmentation_type_id!==54&&ae.segmentation_type_id!==56&&ae.segmentation_type_id!==58||(ae.sub_segment_num=j.readBits(8),ae.sub_segments_expected=j.readBits(8)),ae},ie=function(X,re,K,j){return{descriptor_tag:X,descriptor_length:re,identifier:K,TAI_seconds:j.readBits(48),TAI_ns:j.readBits(32),UTC_offset:j.readBits(16)}},se=function(X){return{component_tag:X.readBits(8),ISO_code:String.fromCharCode(X.readBits(8),X.readBits(8),X.readBits(8)),Bit_Stream_Mode:X.readBits(3),Num_Channels:X.readBits(4),Full_Srvc_Audio:X.readBool()}},Se=function(X,re,K,j){for(var oe=j.readBits(4),_e=[],ae=0;ae<oe;ae++)_e.push(se(j));return{descriptor_tag:X,descriptor_length:re,identifier:K,audio_count:oe,components:_e}},we=function(X){var re=new P.a(X),K=re.readBits(8),j=re.readBool(),oe=re.readBool();re.readBits(2);var _e=re.readBits(12),ae=re.readBits(8),Te=re.readBool(),Ee=re.readBits(6),ye=4*re.readBits(31)+re.readBits(2),Re=re.readBits(8),Oe=re.readBits(12),Ne=re.readBits(12),qe=re.readBits(8),ft=null;qe===k.kSpliceNull?ft={}:qe===k.kSpliceSchedule?ft=function(le){for(var ke=le.readBits(8),Fe=[],Le=0;Le<ke;Le++)Fe.push(C(le));return{splice_count:ke,events:Fe}}(re):qe===k.kSpliceInsert?ft=function(le){var ke=le.readBits(32),Fe=le.readBool();le.readBits(7);var Le={splice_event_id:ke,splice_event_cancel_indicator:Fe};if(Fe)return Le;if(Le.out_of_network_indicator=le.readBool(),Le.program_splice_flag=le.readBool(),Le.duration_flag=le.readBool(),Le.splice_immediate_flag=le.readBool(),le.readBits(4),Le.program_splice_flag&&!Le.splice_immediate_flag&&(Le.splice_time=A(le)),!Le.program_splice_flag){Le.component_count=le.readBits(8),Le.components=[];for(var Be=0;Be<Le.component_count;Be++)Le.components.push(w(Le.splice_immediate_flag,le))}return Le.duration_flag&&(Le.break_duration=v(le)),Le.unique_program_id=le.readBits(16),Le.avail_num=le.readBits(8),Le.avails_expected=le.readBits(8),Le}(re):qe===k.kTimeSignal?ft=function(le){return{splice_time:A(le)}}(re):qe===k.kBandwidthReservation?ft={}:qe===k.kPrivateCommand?ft=function(le,ke){for(var Fe=String.fromCharCode(ke.readBits(8),ke.readBits(8),ke.readBits(8),ke.readBits(8)),Le=new Uint8Array(le-4),Be=0;Be<le-4;Be++)Le[Be]=ke.readBits(8);return{identifier:Fe,private_data:Le.buffer}}(Ne,re):re.readBits(8*Ne);for(var St=[],Yt=re.readBits(16),ce=0;ce<Yt;){var me=re.readBits(8),H=re.readBits(8),B=String.fromCharCode(re.readBits(8),re.readBits(8),re.readBits(8),re.readBits(8));me===0?St.push(O(me,H,B,re)):me===1?St.push(G(me,H,B,re)):me===2?St.push(Y(me,H,B,re)):me===3?St.push(ie(me,H,B,re)):me===4?St.push(Se(me,H,B,re)):re.readBits(8*(H-4)),ce+=2+H}var g={table_id:K,section_syntax_indicator:j,private_indicator:oe,section_length:_e,protocol_version:ae,encrypted_packet:Te,encryption_algorithm:Ee,pts_adjustment:ye,cw_index:Re,tier:Oe,splice_command_length:Ne,splice_command_type:qe,splice_command:ft,descriptor_loop_length:Yt,splice_descriptors:St,E_CRC32:Te?re.readBits(32):void 0,CRC32:re.readBits(32)};if(qe===k.kSpliceInsert){var U=ft;if(U.splice_event_cancel_indicator)return{splice_command_type:qe,detail:g,data:X};if(U.program_splice_flag&&!U.splice_immediate_flag){var ee=U.duration_flag?U.break_duration.auto_return:void 0,J=U.duration_flag?U.break_duration.duration/90:void 0;return U.splice_time.time_specified_flag?{splice_command_type:qe,pts:(ye+U.splice_time.pts_time)%Math.pow(2,33),auto_return:ee,duraiton:J,detail:g,data:X}:{splice_command_type:qe,auto_return:ee,duraiton:J,detail:g,data:X}}return{splice_command_type:qe,auto_return:ee=U.duration_flag?U.break_duration.auto_return:void 0,duraiton:J=U.duration_flag?U.break_duration.duration/90:void 0,detail:g,data:X}}if(qe===k.kTimeSignal){var pe=ft;return pe.splice_time.time_specified_flag?{splice_command_type:qe,pts:(ye+pe.splice_time.pts_time)%Math.pow(2,33),detail:g,data:X}:{splice_command_type:qe,detail:g,data:X}}return{splice_command_type:qe,detail:g,data:X}};(function(X){X[X.kSliceIDR_W_RADL=19]="kSliceIDR_W_RADL",X[X.kSliceIDR_N_LP=20]="kSliceIDR_N_LP",X[X.kSliceCRA_NUT=21]="kSliceCRA_NUT",X[X.kSliceVPS=32]="kSliceVPS",X[X.kSliceSPS=33]="kSliceSPS",X[X.kSlicePPS=34]="kSlicePPS",X[X.kSliceAUD=35]="kSliceAUD"})(M||(M={}));var Pe=function(){},Ge=function(X){var re=X.data.byteLength;this.type=X.type,this.data=new Uint8Array(4+re),new DataView(this.data.buffer).setUint32(0,re),this.data.set(X.data,4)},it=function(){function X(re){this.TAG="H265AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=re,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&r.a.e(this.TAG,"Could not find H265 startcode until payload end!")}return X.prototype.findNextStartCodeOffset=function(re){for(var K=re,j=this.data_;;){if(K+3>=j.byteLength)return this.eof_flag_=!0,j.byteLength;var oe=j[K+0]<<24|j[K+1]<<16|j[K+2]<<8|j[K+3],_e=j[K+0]<<16|j[K+1]<<8|j[K+2];if(oe===1||_e===1)return K;K++}},X.prototype.readNextNaluPayload=function(){for(var re=this.data_,K=null;K==null&&!this.eof_flag_;){var j=this.current_startcode_offset_,oe=re[j+=(re[j]<<24|re[j+1]<<16|re[j+2]<<8|re[j+3])===1?4:3]>>1&63,_e=(128&re[j])>>>7,ae=this.findNextStartCodeOffset(j);if(this.current_startcode_offset_=ae,_e===0){var Te=re.subarray(j,ae);(K=new Pe).type=oe,K.data=Te}}return K},X}(),Ie=function(){function X(re,K,j,oe){var _e=23+(5+re.byteLength)+(5+K.byteLength)+(5+j.byteLength),ae=this.data=new Uint8Array(_e);ae[0]=1,ae[1]=(3&oe.general_profile_space)<<6|(oe.general_tier_flag?1:0)<<5|31&oe.general_profile_idc,ae[2]=oe.general_profile_compatibility_flags_1,ae[3]=oe.general_profile_compatibility_flags_2,ae[4]=oe.general_profile_compatibility_flags_3,ae[5]=oe.general_profile_compatibility_flags_4,ae[6]=oe.general_constraint_indicator_flags_1,ae[7]=oe.general_constraint_indicator_flags_2,ae[8]=oe.general_constraint_indicator_flags_3,ae[9]=oe.general_constraint_indicator_flags_4,ae[10]=oe.general_constraint_indicator_flags_5,ae[11]=oe.general_constraint_indicator_flags_6,ae[12]=oe.general_level_idc,ae[13]=240|(3840&oe.min_spatial_segmentation_idc)>>8,ae[14]=255&oe.min_spatial_segmentation_idc,ae[15]=252|3&oe.parallelismType,ae[16]=252|3&oe.chroma_format_idc,ae[17]=248|7&oe.bit_depth_luma_minus8,ae[18]=248|7&oe.bit_depth_chroma_minus8,ae[19]=0,ae[20]=0,ae[21]=(3&oe.constant_frame_rate)<<6|(7&oe.num_temporal_layers)<<3|(oe.temporal_id_nested?1:0)<<2|3,ae[22]=3,ae[23]=128|M.kSliceVPS,ae[24]=0,ae[25]=1,ae[26]=(65280&re.byteLength)>>8,ae[27]=(255&re.byteLength)>>0,ae.set(re,28),ae[23+(5+re.byteLength)+0]=128|M.kSliceSPS,ae[23+(5+re.byteLength)+1]=0,ae[23+(5+re.byteLength)+2]=1,ae[23+(5+re.byteLength)+3]=(65280&K.byteLength)>>8,ae[23+(5+re.byteLength)+4]=(255&K.byteLength)>>0,ae.set(K,23+(5+re.byteLength)+5),ae[23+(5+re.byteLength+5+K.byteLength)+0]=128|M.kSlicePPS,ae[23+(5+re.byteLength+5+K.byteLength)+1]=0,ae[23+(5+re.byteLength+5+K.byteLength)+2]=1,ae[23+(5+re.byteLength+5+K.byteLength)+3]=(65280&j.byteLength)>>8,ae[23+(5+re.byteLength+5+K.byteLength)+4]=(255&j.byteLength)>>0,ae.set(j,23+(5+re.byteLength+5+K.byteLength)+5)}return X.prototype.getData=function(){return this.data},X}(),rt=i(15),tt=function(){},xe=function(){},ht=function(){},_t=[[64,64,80,80,96,96,112,112,128,128,160,160,192,192,224,224,256,256,320,320,384,384,448,448,512,512,640,640,768,768,896,896,1024,1024,1152,1152,1280,1280],[69,70,87,88,104,105,121,122,139,140,174,175,208,209,243,244,278,279,348,349,417,418,487,488,557,558,696,697,835,836,975,976,1114,1115,1253,1254,1393,1394],[96,96,120,120,144,144,168,168,192,192,240,240,288,288,336,336,384,384,480,480,576,576,672,672,768,768,960,960,1152,1152,1344,1344,1536,1536,1728,1728,1920,1920]],et=function(){function X(re){this.TAG="AC3Parser",this.data_=re,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&r.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return X.prototype.findNextSyncwordOffset=function(re){for(var K=re,j=this.data_;;){if(K+7>=j.byteLength)return this.eof_flag_=!0,j.byteLength;if((j[K+0]<<8|j[K+1]<<0)===2935)return K;K++}},X.prototype.readNextAC3Frame=function(){for(var re=this.data_,K=null;K==null&&!this.eof_flag_;){var j=this.current_syncword_offset_,oe=re[j+4]>>6,_e=[48e3,44200,33e3][oe],ae=63&re[j+4],Te=2*_t[oe][ae];if(isNaN(Te)||j+Te>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var Ee=this.findNextSyncwordOffset(j+Te);this.current_syncword_offset_=Ee;var ye=re[j+5]>>3,Re=7&re[j+5],Oe=re[j+6]>>5,Ne=0;1&Oe&&Oe!==1&&(Ne+=2),4&Oe&&(Ne+=2),Oe===2&&(Ne+=2);var qe=(re[j+6]<<8|re[j+7]<<0)>>12-Ne&1,ft=[2,1,2,3,3,4,4,5][Oe]+qe;(K=new ht).sampling_frequency=_e,K.channel_count=ft,K.channel_mode=Oe,K.bit_stream_identification=ye,K.low_frequency_effects_channel_on=qe,K.bit_stream_mode=Re,K.frame_size_code=ae,K.data=re.subarray(j,j+Te)}return K},X.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},X.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},X}(),Ve=function(X){var re;re=[X.sampling_rate_code<<6|X.bit_stream_identification<<1|X.bit_stream_mode>>2,(3&X.bit_stream_mode)<<6|X.channel_mode<<3|X.low_frequency_effects_channel_on<<2|X.frame_size_code>>4,X.frame_size_code<<4&224],this.config=re,this.sampling_rate=X.sampling_frequency,this.bit_stream_identification=X.bit_stream_identification,this.bit_stream_mode=X.bit_stream_mode,this.low_frequency_effects_channel_on=X.low_frequency_effects_channel_on,this.channel_count=X.channel_count,this.channel_mode=X.channel_mode,this.codec_mimetype="ac-3",this.original_codec_mimetype="ac-3"},fe=function(){},be=function(){function X(re){this.TAG="EAC3Parser",this.data_=re,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&r.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return X.prototype.findNextSyncwordOffset=function(re){for(var K=re,j=this.data_;;){if(K+7>=j.byteLength)return this.eof_flag_=!0,j.byteLength;if((j[K+0]<<8|j[K+1]<<0)===2935)return K;K++}},X.prototype.readNextEAC3Frame=function(){for(var re=this.data_,K=null;K==null&&!this.eof_flag_;){var j=this.current_syncword_offset_,oe=new P.a(re.subarray(j+2)),_e=(oe.readBits(2),oe.readBits(3),oe.readBits(11)+1<<1),ae=oe.readBits(2),Te=null,Ee=null;ae===3?(Te=[24e3,22060,16e3][ae=oe.readBits(2)],Ee=3):(Te=[48e3,44100,32e3][ae],Ee=oe.readBits(2));var ye=oe.readBits(3),Re=oe.readBits(1),Oe=oe.readBits(5);if(j+_e>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var Ne=this.findNextSyncwordOffset(j+_e);this.current_syncword_offset_=Ne;var qe=[2,1,2,3,3,4,4,5][ye]+Re;oe.destroy(),(K=new fe).sampling_frequency=Te,K.channel_count=qe,K.channel_mode=ye,K.bit_stream_identification=Oe,K.low_frequency_effects_channel_on=Re,K.frame_size=_e,K.num_blks=[1,2,3,6][Ee],K.data=re.subarray(j,j+_e)}return K},X.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},X.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},X}(),Ue=function(X){var re,K=Math.floor(X.frame_size*X.sampling_frequency/(16*X.num_blks));re=[255&K,248&K,X.sampling_rate_code<<6|X.bit_stream_identification<<1|0,0|X.channel_mode<<1|X.low_frequency_effects_channel_on<<0,0],this.config=re,this.sampling_rate=X.sampling_frequency,this.bit_stream_identification=X.bit_stream_identification,this.num_blks=X.num_blks,this.low_frequency_effects_channel_on=X.low_frequency_effects_channel_on,this.channel_count=X.channel_count,this.channel_mode=X.channel_mode,this.codec_mimetype="ec-3",this.original_codec_mimetype="ec-3"},ge=function(){},Je=function(){function X(re){this.TAG="AV1OBUInMpegTsParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=re,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&r.a.e(this.TAG,"Could not find AV1 startcode until payload end!")}return X._ebsp2rbsp=function(re){for(var K=re,j=K.byteLength,oe=new Uint8Array(j),_e=0,ae=0;ae<j;ae++)ae>=2&&K[ae]===3&&K[ae-1]===0&&K[ae-2]===0||(oe[_e]=K[ae],_e++);return new Uint8Array(oe.buffer,0,_e)},X.prototype.findNextStartCodeOffset=function(re){for(var K=re,j=this.data_;;){if(K+2>=j.byteLength)return this.eof_flag_=!0,j.byteLength;if((j[K+0]<<16|j[K+1]<<8|j[K+2])===1)return K;K++}},X.prototype.readNextOBUPayload=function(){for(var re=this.data_,K=null;K==null&&!this.eof_flag_;){var j=this.current_startcode_offset_+3,oe=this.findNextStartCodeOffset(j);this.current_startcode_offset_=oe,K=X._ebsp2rbsp(re.subarray(j,oe))}return K},X}(),ut=i(16),st=function(){var X=function(re,K){return(X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(j,oe){j.__proto__=oe}||function(j,oe){for(var _e in oe)Object.prototype.hasOwnProperty.call(oe,_e)&&(j[_e]=oe[_e])})(re,K)};return function(re,K){if(typeof K!="function"&&K!==null)throw new TypeError("Class extends value "+String(K)+" is not a constructor or null");function j(){this.constructor=re}X(re,K),re.prototype=K===null?Object.create(K):(j.prototype=K.prototype,new j)}}(),We=function(){return(We=Object.assign||function(X){for(var re,K=1,j=arguments.length;K<j;K++)for(var oe in re=arguments[K])Object.prototype.hasOwnProperty.call(re,oe)&&(X[oe]=re[oe]);return X}).apply(this,arguments)},gt=function(X){function re(K,j){var oe=X.call(this)||this;return oe.TAG="TSDemuxer",oe.first_parse_=!0,oe.media_info_=new d.a,oe.timescale_=90,oe.duration_=0,oe.current_pmt_pid_=-1,oe.program_pmt_map_={},oe.pes_slice_queues_={},oe.section_slice_queues_={},oe.video_metadata_={vps:void 0,sps:void 0,pps:void 0,av1c:void 0,details:void 0},oe.audio_metadata_={codec:void 0,audio_object_type:void 0,sampling_freq_index:void 0,sampling_frequency:void 0,channel_config:void 0},oe.last_pcr_base_=NaN,oe.timestamp_offset_=0,oe.audio_last_sample_pts_=void 0,oe.aac_last_incomplete_data_=null,oe.has_video_=!1,oe.has_audio_=!1,oe.video_init_segment_dispatched_=!1,oe.audio_init_segment_dispatched_=!1,oe.video_metadata_changed_=!1,oe.loas_previous_frame=null,oe.video_track_={type:"video",id:1,sequenceNumber:0,samples:[],length:0},oe.audio_track_={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},oe.preferred_secondary_audio=!1,oe.ts_packet_size_=K.ts_packet_size,oe.sync_offset_=K.sync_offset,oe.config_=j,oe}return st(re,X),re.prototype.destroy=function(){this.media_info_=null,this.pes_slice_queues_=null,this.section_slice_queues_=null,this.video_metadata_=null,this.audio_metadata_=null,this.aac_last_incomplete_data_=null,this.video_track_=null,this.audio_track_=null,X.prototype.destroy.call(this)},re.probe=function(K){var j=new Uint8Array(K),oe=-1,_e=188;if(j.byteLength<=3*_e)return{needMoreData:!0};for(;oe===-1;){for(var ae=Math.min(1e3,j.byteLength-3*_e),Te=0;Te<ae;){if(j[Te]===71&&j[Te+_e]===71&&j[Te+2*_e]===71){oe=Te;break}Te++}if(oe===-1)if(_e===188)_e=192;else{if(_e!==192)break;_e=204}}return oe===-1?{match:!1}:(_e===192&&oe>=4?(r.a.v("TSDemuxer","ts_packet_size = 192, m2ts mode"),oe-=4):_e===204&&r.a.v("TSDemuxer","ts_packet_size = 204, RS encoded MPEG2-TS stream"),{match:!0,consumed:0,ts_packet_size:_e,sync_offset:oe})},re.prototype.bindDataSource=function(K){return K.onDataArrival=this.parseChunks.bind(this),this},re.prototype.resetMediaInfo=function(){this.media_info_=new d.a},re.prototype.parseChunks=function(K,j){if(!(this.onError&&this.onMediaInfo&&this.onTrackMetadata&&this.onDataAvailable))throw new u.a("onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var oe=0;for(this.first_parse_&&(this.first_parse_=!1,oe=this.sync_offset_);oe+this.ts_packet_size_<=K.byteLength;){var _e=j+oe;this.ts_packet_size_===192&&(oe+=4);var ae=new Uint8Array(K,oe,188),Te=ae[0];if(Te!==71){r.a.e(this.TAG,"sync_byte = ".concat(Te,", not 0x47"));break}var Ee=(64&ae[1])>>>6,ye=(ae[1],(31&ae[1])<<8|ae[2]),Re=(48&ae[3])>>>4,Oe=15&ae[3],Ne=!(!this.pmt_||this.pmt_.pcr_pid!==ye),qe={},ft=4;if(Re==2||Re==3){var St=ae[4];if(St>0&&(Ne||Re==3)&&(qe.discontinuity_indicator=(128&ae[5])>>>7,qe.random_access_indicator=(64&ae[5])>>>6,qe.elementary_stream_priority_indicator=(32&ae[5])>>>5,(16&ae[5])>>>4)){var Yt=300*this.getPcrBase(ae)+((1&ae[10])<<8|ae[11]);this.last_pcr_=Yt}if(Re==2||5+St===188){oe+=188,this.ts_packet_size_===204&&(oe+=16);continue}ft=5+St}if(Re==1||Re==3){if(ye===0||ye===this.current_pmt_pid_||this.pmt_!=null&&this.pmt_.pid_stream_type[ye]===s.kSCTE35){var ce=188-ft;this.handleSectionSlice(K,oe+ft,ce,{pid:ye,file_position:_e,payload_unit_start_indicator:Ee,continuity_conunter:Oe,random_access_indicator:qe.random_access_indicator})}else if(this.pmt_!=null&&this.pmt_.pid_stream_type[ye]!=null){ce=188-ft;var me=this.pmt_.pid_stream_type[ye];ye!==this.pmt_.common_pids.h264&&ye!==this.pmt_.common_pids.h265&&ye!==this.pmt_.common_pids.av1&&ye!==this.pmt_.common_pids.adts_aac&&ye!==this.pmt_.common_pids.loas_aac&&ye!==this.pmt_.common_pids.ac3&&ye!==this.pmt_.common_pids.eac3&&ye!==this.pmt_.common_pids.opus&&ye!==this.pmt_.common_pids.mp3&&this.pmt_.pes_private_data_pids[ye]!==!0&&this.pmt_.timed_id3_pids[ye]!==!0&&this.pmt_.synchronous_klv_pids[ye]!==!0&&this.pmt_.asynchronous_klv_pids[ye]!==!0||this.handlePESSlice(K,oe+ft,ce,{pid:ye,stream_type:me,file_position:_e,payload_unit_start_indicator:Ee,continuity_conunter:Oe,random_access_indicator:qe.random_access_indicator})}}oe+=188,this.ts_packet_size_===204&&(oe+=16)}return this.dispatchAudioVideoMediaSegment(),oe},re.prototype.handleSectionSlice=function(K,j,oe,_e){var ae=new Uint8Array(K,j,oe),Te=this.section_slice_queues_[_e.pid];if(_e.payload_unit_start_indicator){var Ee=ae[0];if(Te!=null&&Te.total_length!==0){var ye=new Uint8Array(K,j+1,Math.min(oe,Ee));Te.slices.push(ye),Te.total_length+=ye.byteLength,Te.total_length===Te.expected_length?this.emitSectionSlices(Te,_e):this.clearSlices(Te,_e)}for(var Re=1+Ee;Re<ae.byteLength&&ae[Re+0]!==255;){var Oe=(15&ae[Re+1])<<8|ae[Re+2];this.section_slice_queues_[_e.pid]=new m,(Te=this.section_slice_queues_[_e.pid]).expected_length=Oe+3,Te.file_position=_e.file_position,Te.random_access_indicator=_e.random_access_indicator,ye=new Uint8Array(K,j+Re,Math.min(oe-Re,Te.expected_length-Te.total_length)),Te.slices.push(ye),Te.total_length+=ye.byteLength,Te.total_length===Te.expected_length?this.emitSectionSlices(Te,_e):Te.total_length>=Te.expected_length&&this.clearSlices(Te,_e),Re+=ye.byteLength}}else Te!=null&&Te.total_length!==0&&(ye=new Uint8Array(K,j,Math.min(oe,Te.expected_length-Te.total_length)),Te.slices.push(ye),Te.total_length+=ye.byteLength,Te.total_length===Te.expected_length?this.emitSectionSlices(Te,_e):Te.total_length>=Te.expected_length&&this.clearSlices(Te,_e))},re.prototype.handlePESSlice=function(K,j,oe,_e){var ae=new Uint8Array(K,j,oe),Te=ae[0]<<16|ae[1]<<8|ae[2],Ee=(ae[3],ae[4]<<8|ae[5]);if(_e.payload_unit_start_indicator){if(Te!==1)return void r.a.e(this.TAG,"handlePESSlice: packet_start_code_prefix should be 1 but with value ".concat(Te));var ye=this.pes_slice_queues_[_e.pid];ye&&(ye.expected_length===0||ye.expected_length===ye.total_length?this.emitPESSlices(ye,_e):this.clearSlices(ye,_e)),this.pes_slice_queues_[_e.pid]=new m,this.pes_slice_queues_[_e.pid].file_position=_e.file_position,this.pes_slice_queues_[_e.pid].random_access_indicator=_e.random_access_indicator}if(this.pes_slice_queues_[_e.pid]!=null){var Re=this.pes_slice_queues_[_e.pid];Re.slices.push(ae),_e.payload_unit_start_indicator&&(Re.expected_length=Ee===0?0:Ee+6),Re.total_length+=ae.byteLength,Re.expected_length>0&&Re.expected_length===Re.total_length?this.emitPESSlices(Re,_e):Re.expected_length>0&&Re.expected_length<Re.total_length&&this.clearSlices(Re,_e)}},re.prototype.emitSectionSlices=function(K,j){for(var oe=new Uint8Array(K.total_length),_e=0,ae=0;_e<K.slices.length;_e++){var Te=K.slices[_e];oe.set(Te,ae),ae+=Te.byteLength}K.slices=[],K.expected_length=-1,K.total_length=0;var Ee=new p;Ee.pid=j.pid,Ee.data=oe,Ee.file_position=K.file_position,Ee.random_access_indicator=K.random_access_indicator,this.parseSection(Ee)},re.prototype.emitPESSlices=function(K,j){for(var oe=new Uint8Array(K.total_length),_e=0,ae=0;_e<K.slices.length;_e++){var Te=K.slices[_e];oe.set(Te,ae),ae+=Te.byteLength}K.slices=[],K.expected_length=-1,K.total_length=0;var Ee=new f;Ee.pid=j.pid,Ee.data=oe,Ee.stream_type=j.stream_type,Ee.file_position=K.file_position,Ee.random_access_indicator=K.random_access_indicator,this.parsePES(Ee)},re.prototype.clearSlices=function(K,j){K.slices=[],K.expected_length=-1,K.total_length=0},re.prototype.parseSection=function(K){var j=K.data,oe=K.pid;oe===0?this.parsePAT(j):oe===this.current_pmt_pid_?this.parsePMT(j):this.pmt_!=null&&this.pmt_.scte_35_pids[oe]&&this.parseSCTE35(j)},re.prototype.parsePES=function(K){var j=K.data,oe=j[0]<<16|j[1]<<8|j[2],_e=j[3],ae=j[4]<<8|j[5];if(oe===1)if(_e!==188&&_e!==190&&_e!==191&&_e!==240&&_e!==241&&_e!==255&&_e!==242&&_e!==248){j[6];var Te=(192&j[7])>>>6,Ee=j[8],ye=void 0,Re=void 0;Te!==2&&Te!==3||(ye=this.getTimestamp(j,9),Re=Te===3?this.getTimestamp(j,14):ye);var Oe=9+Ee,Ne=void 0;if(ae!==0){if(ae<3+Ee)return void r.a.v(this.TAG,"Malformed PES: PES_packet_length < 3 + PES_header_data_length");Ne=ae-3-Ee}else Ne=j.byteLength-Oe;var qe=j.subarray(Oe,Oe+Ne);switch(K.stream_type){case s.kMPEG1Audio:case s.kMPEG2Audio:this.parseMP3Payload(qe,ye);break;case s.kPESPrivateData:this.pmt_.common_pids.av1===K.pid?this.parseAV1Payload(qe,ye,Re,K.file_position,K.random_access_indicator):this.pmt_.common_pids.opus===K.pid?this.parseOpusPayload(qe,ye):this.pmt_.common_pids.ac3===K.pid?this.parseAC3Payload(qe,ye):this.pmt_.common_pids.eac3===K.pid?this.parseEAC3Payload(qe,ye):this.pmt_.asynchronous_klv_pids[K.pid]?this.parseAsynchronousKLVMetadataPayload(qe,K.pid,_e):this.pmt_.smpte2038_pids[K.pid]?this.parseSMPTE2038MetadataPayload(qe,ye,Re,K.pid,_e):this.parsePESPrivateDataPayload(qe,ye,Re,K.pid,_e);break;case s.kADTSAAC:this.parseADTSAACPayload(qe,ye);break;case s.kLOASAAC:this.parseLOASAACPayload(qe,ye);break;case s.kAC3:this.parseAC3Payload(qe,ye);break;case s.kEAC3:this.parseEAC3Payload(qe,ye);break;case s.kMetadata:this.pmt_.timed_id3_pids[K.pid]?this.parseTimedID3MetadataPayload(qe,ye,Re,K.pid,_e):this.pmt_.synchronous_klv_pids[K.pid]&&this.parseSynchronousKLVMetadataPayload(qe,ye,Re,K.pid,_e);break;case s.kH264:this.parseH264Payload(qe,ye,Re,K.file_position,K.random_access_indicator);break;case s.kH265:this.parseH265Payload(qe,ye,Re,K.file_position,K.random_access_indicator)}}else(_e===188||_e===191||_e===240||_e===241||_e===255||_e===242||_e===248)&&K.stream_type===s.kPESPrivateData&&(Oe=6,Ne=void 0,Ne=ae!==0?ae:j.byteLength-Oe,qe=j.subarray(Oe,Oe+Ne),this.parsePESPrivateDataPayload(qe,void 0,void 0,K.pid,_e));else r.a.e(this.TAG,"parsePES: packet_start_code_prefix should be 1 but with value ".concat(oe))},re.prototype.parsePAT=function(K){var j=K[0];if(j===0){var oe=(15&K[1])<<8|K[2],_e=(K[3],K[4],(62&K[5])>>>1),ae=1&K[5],Te=K[6],Ee=(K[7],null);if(ae===1&&Te===0)(Ee=new l).version_number=_e;else if((Ee=this.pat_)==null)return;for(var ye=oe-5-4,Re=-1,Oe=-1,Ne=8;Ne<8+ye;Ne+=4){var qe=K[Ne]<<8|K[Ne+1],ft=(31&K[Ne+2])<<8|K[Ne+3];qe===0?Ee.network_pid=ft:(Ee.program_pmt_pid[qe]=ft,Re===-1&&(Re=qe),Oe===-1&&(Oe=ft))}ae===1&&Te===0&&(this.pat_==null&&r.a.v(this.TAG,"Parsed first PAT: ".concat(JSON.stringify(Ee))),this.pat_=Ee,this.current_program_=Re,this.current_pmt_pid_=Oe)}else r.a.e(this.TAG,"parsePAT: table_id ".concat(j," is not corresponded to PAT!"))},re.prototype.parsePMT=function(K){var j=K[0];if(j===2){var oe=(15&K[1])<<8|K[2],_e=K[3]<<8|K[4],ae=(62&K[5])>>>1,Te=1&K[5],Ee=K[6],ye=(K[7],null);if(Te===1&&Ee===0)(ye=new o).program_number=_e,ye.version_number=ae,this.program_pmt_map_[_e]=ye;else if((ye=this.program_pmt_map_[_e])==null)return;ye.pcr_pid=(31&K[8])<<8|K[9];for(var Re=(15&K[10])<<8|K[11],Oe=12+Re,Ne=oe-9-Re-4,qe=Oe;qe<Oe+Ne;){var ft=K[qe],St=(31&K[qe+1])<<8|K[qe+2],Yt=(15&K[qe+3])<<8|K[qe+4];ye.pid_stream_type[St]=ft;var ce=ye.common_pids.h264||ye.common_pids.h265,me=ye.common_pids.adts_aac||ye.common_pids.loas_aac||ye.common_pids.ac3||ye.common_pids.eac3||ye.common_pids.opus||ye.common_pids.mp3;if(ft!==s.kH264||ce)if(ft!==s.kH265||ce)if(ft!==s.kADTSAAC||me&&!this.preferred_secondary_audio)if(ft!==s.kLOASAAC||me&&!this.preferred_secondary_audio)if(ft!==s.kAC3||me&&!this.preferred_secondary_audio)if(ft!==s.kEAC3||me&&!this.preferred_secondary_audio)if(ft!==s.kMPEG1Audio&&ft!==s.kMPEG2Audio||me&&!this.preferred_secondary_audio)if(ft===s.kPESPrivateData){if(ye.pes_private_data_pids[St]=!0,Yt>0){for(var H=qe+5;H<qe+5+Yt;){var B=K[H+0],g=K[H+1];if(B===5){var U=String.fromCharCode.apply(String,Array.from(K.subarray(H+2,H+2+g)));U==="VANC"?ye.smpte2038_pids[St]=!0:U==="AV01"?ye.common_pids.av1=St:U==="Opus"?ye.common_pids.opus=St:U==="KLVA"&&(ye.asynchronous_klv_pids[St]=!0)}else if(B===127){if(St===ye.common_pids.opus){var ee=null;if(K[H+2]===128&&(ee=K[H+3]),ee==null){r.a.e(this.TAG,"Not Supported Opus channel count.");continue}var J={codec:"opus",channel_count:15&ee?15&ee:2,channel_config_code:ee,sample_rate:48e3},pe={codec:"opus",meta:J};(this.audio_init_segment_dispatched_==0||this.detectAudioMetadataChange(pe))&&(this.audio_metadata_=J,this.dispatchAudioMediaSegment(!0),this.dispatchAudioInitSegment(pe))}}else B===128&&St===ye.common_pids.av1&&(this.video_metadata_.av1c=K.subarray(H+2,H+2+g));H+=2+g}var le=K.subarray(qe+5,qe+5+Yt);this.dispatchPESPrivateDataDescriptor(St,ft,le)}}else if(ft===s.kMetadata){if(Yt>0)for(H=qe+5;H<qe+5+Yt;){B=K[H+0];var ke=K[H+1];if(B===38){var Fe=K[H+2]<<8|K[H+3]<<0,Le=null;Fe===65535&&(Le=String.fromCharCode.apply(String,Array.from(K.subarray(H+4,H+4+4))));var Be=null;if(K[H+4+(Fe===65535?4:0)]===255){var Xe=4+(Fe===65535?4:0)+1;Be=String.fromCharCode.apply(String,Array.from(K.subarray(H+Xe,H+Xe+4)))}Le==="ID3 "&&Be==="ID3 "?ye.timed_id3_pids[St]=!0:Be==="KLVA"&&(ye.synchronous_klv_pids[St]=!0)}H+=2+ke}}else ft===s.kSCTE35&&(ye.scte_35_pids[St]=!0);else ye.common_pids.mp3=St;else ye.common_pids.eac3=St;else ye.common_pids.ac3=St;else ye.common_pids.loas_aac=St;else ye.common_pids.adts_aac=St;else ye.common_pids.h265=St;else ye.common_pids.h264=St;qe+=5+Yt}_e===this.current_program_&&(this.pmt_==null&&r.a.v(this.TAG,"Parsed first PMT: ".concat(JSON.stringify(ye))),this.pmt_=ye,(ye.common_pids.h264||ye.common_pids.h265||ye.common_pids.av1)&&(this.has_video_=!0),(ye.common_pids.adts_aac||ye.common_pids.loas_aac||ye.common_pids.ac3||ye.common_pids.opus||ye.common_pids.mp3)&&(this.has_audio_=!0))}else r.a.e(this.TAG,"parsePMT: table_id ".concat(j," is not corresponded to PMT!"))},re.prototype.parseSCTE35=function(K){var j=we(K);if(j.pts!=null){var oe=Math.floor(j.pts/this.timescale_);j.pts=oe}else j.nearest_pts=this.getNearestTimestampMilliseconds();this.onSCTE35Metadata&&this.onSCTE35Metadata(j)},re.prototype.parseAV1Payload=function(K,j,oe,_e,ae){for(var Te=new Je(K),Ee=null,ye=[],Re=0,Oe=!1,Ne=null;(Ee=Te.readNextOBUPayload())!=null;){if((Ne=ut.a.parseOBUs(Ee,this.video_metadata_.details))&&Ne.keyframe===!0)if(this.video_init_segment_dispatched_){if(this.detectVideoMetadataChange(null,Ne)===!0){var qe;this.video_metadata_changed_=!0,this.dispatchVideoMediaSegment(!0),(qe=new Uint8Array(new ArrayBuffer(this.video_metadata_.av1c.byteLength+Ne.sequence_header_data.byteLength))).set(this.video_metadata_.av1c,0),qe.set(Ne.sequence_header_data,this.video_metadata_.av1c.byteLength),Ne.av1c=qe,this.dispatchVideoInitSegment()}}else(qe=new Uint8Array(new ArrayBuffer(this.video_metadata_.av1c.byteLength+Ne.sequence_header_data.byteLength))).set(this.video_metadata_.av1c,0),qe.set(Ne.sequence_header_data,this.video_metadata_.av1c.byteLength),Ne.av1c=qe,this.video_metadata_.details=Ne,this.dispatchVideoInitSegment();this.video_metadata_.details=Ne,Oe||(Oe=Ne.keyframe),ye.push({data:Ee}),Re+=Ee.byteLength}var ft=Math.floor(j/this.timescale_),St=Math.floor(oe/this.timescale_);if(ye.length){var Yt=this.video_track_,ce={units:ye,length:Re,isKeyframe:Oe,dts:St,pts:ft,cts:ft-St,file_position:_e};Yt.samples.push(ce),Yt.length+=Re}},re.prototype.parseH264Payload=function(K,j,oe,_e,ae){for(var Te=new x(K),Ee=null,ye=[],Re=0,Oe=!1;(Ee=Te.readNextNaluPayload())!=null;){var Ne=new b(Ee);if(Ne.type===h.kSliceSPS){var qe=N.a.parseSPS(Ee.data);this.video_init_segment_dispatched_?this.detectVideoMetadataChange(Ne,qe)===!0&&(r.a.v(this.TAG,"H264: Critical h264 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:Ne,pps:void 0,av1c:void 0,details:qe}):(this.video_metadata_.sps=Ne,this.video_metadata_.details=qe)}else Ne.type===h.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(this.video_metadata_.pps=Ne,this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(!0),this.dispatchVideoInitSegment())):(Ne.type===h.kSliceIDR||Ne.type===h.kSliceNonIDR&&ae===1)&&(Oe=!0);this.video_init_segment_dispatched_&&(ye.push(Ne),Re+=Ne.data.byteLength)}var ft=Math.floor(j/this.timescale_),St=Math.floor(oe/this.timescale_);if(ye.length){var Yt=this.video_track_,ce={units:ye,length:Re,isKeyframe:Oe,dts:St,pts:ft,cts:ft-St,file_position:_e};Yt.samples.push(ce),Yt.length+=Re}},re.prototype.parseH265Payload=function(K,j,oe,_e,ae){for(var Te=new it(K),Ee=null,ye=[],Re=0,Oe=!1;(Ee=Te.readNextNaluPayload())!=null;){var Ne=new Ge(Ee);if(Ne.type===M.kSliceVPS){if(!this.video_init_segment_dispatched_){var qe=rt.a.parseVPS(Ee.data);this.video_metadata_.vps=Ne,this.video_metadata_.details=We(We({},this.video_metadata_.details),qe)}}else Ne.type===M.kSliceSPS?(qe=rt.a.parseSPS(Ee.data),this.video_init_segment_dispatched_?this.detectVideoMetadataChange(Ne,qe)===!0&&(r.a.v(this.TAG,"H265: Critical h265 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:Ne,pps:void 0,av1c:void 0,details:qe}):(this.video_metadata_.sps=Ne,this.video_metadata_.details=We(We({},this.video_metadata_.details),qe))):Ne.type===M.kSlicePPS?(!this.video_init_segment_dispatched_||this.video_metadata_changed_)&&(qe=rt.a.parsePPS(Ee.data),this.video_metadata_.pps=Ne,this.video_metadata_.details=We(We({},this.video_metadata_.details),qe),this.video_metadata_.vps&&this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(!0),this.dispatchVideoInitSegment())):Ne.type!==M.kSliceIDR_W_RADL&&Ne.type!==M.kSliceIDR_N_LP&&Ne.type!==M.kSliceCRA_NUT||(Oe=!0);this.video_init_segment_dispatched_&&(ye.push(Ne),Re+=Ne.data.byteLength)}var ft=Math.floor(j/this.timescale_),St=Math.floor(oe/this.timescale_);if(ye.length){var Yt=this.video_track_,ce={units:ye,length:Re,isKeyframe:Oe,dts:St,pts:ft,cts:ft-St,file_position:_e};Yt.samples.push(ce),Yt.length+=Re}},re.prototype.detectVideoMetadataChange=function(K,j){if(j.codec_mimetype!==this.video_metadata_.details.codec_mimetype)return r.a.v(this.TAG,"Video: Codec mimeType changed from "+"".concat(this.video_metadata_.details.codec_mimetype," to ").concat(j.codec_mimetype)),!0;if(j.codec_size.width!==this.video_metadata_.details.codec_size.width||j.codec_size.height!==this.video_metadata_.details.codec_size.height){var oe=this.video_metadata_.details.codec_size,_e=j.codec_size;return r.a.v(this.TAG,"Video: Coded Resolution changed from "+"".concat(oe.width,"x").concat(oe.height," to ").concat(_e.width,"x").concat(_e.height)),!0}return j.present_size.width!==this.video_metadata_.details.present_size.width&&(r.a.v(this.TAG,"Video: Present resolution width changed from "+"".concat(this.video_metadata_.details.present_size.width," to ").concat(j.present_size.width)),!0)},re.prototype.isInitSegmentDispatched=function(){return this.has_video_&&this.has_audio_?this.video_init_segment_dispatched_&&this.audio_init_segment_dispatched_:this.has_video_&&!this.has_audio_?this.video_init_segment_dispatched_:!(this.has_video_||!this.has_audio_)&&this.audio_init_segment_dispatched_},re.prototype.dispatchVideoInitSegment=function(){var K=this.video_metadata_.details,j={type:"video"};j.id=this.video_track_.id,j.timescale=1e3,j.duration=this.duration_,j.codecWidth=K.codec_size.width,j.codecHeight=K.codec_size.height,j.presentWidth=K.present_size.width,j.presentHeight=K.present_size.height,j.profile=K.profile_string,j.level=K.level_string,j.bitDepth=K.bit_depth,j.chromaFormat=K.chroma_format,j.sarRatio=K.sar_ratio,j.frameRate=K.frame_rate;var oe=j.frameRate.fps_den,_e=j.frameRate.fps_num;if(j.refSampleDuration=oe/_e*1e3,j.codec=K.codec_mimetype,this.video_metadata_.av1c)j.av1c=this.video_metadata_.av1c,this.video_init_segment_dispatched_==0&&r.a.v(this.TAG,"Generated first AV1 for mimeType: ".concat(j.codec));else if(this.video_metadata_.vps){var ae=this.video_metadata_.vps.data.subarray(4),Te=this.video_metadata_.sps.data.subarray(4),Ee=this.video_metadata_.pps.data.subarray(4),ye=new Ie(ae,Te,Ee,K);j.hvcc=ye.getData(),this.video_init_segment_dispatched_==0&&r.a.v(this.TAG,"Generated first HEVCDecoderConfigurationRecord for mimeType: ".concat(j.codec))}else{Te=this.video_metadata_.sps.data.subarray(4),Ee=this.video_metadata_.pps.data.subarray(4);var Re=new L(Te,Ee,K);j.avcc=Re.getData(),this.video_init_segment_dispatched_==0&&r.a.v(this.TAG,"Generated first AVCDecoderConfigurationRecord for mimeType: ".concat(j.codec))}this.onTrackMetadata("video",j),this.video_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var Oe=this.media_info_;Oe.hasVideo=!0,Oe.width=j.codecWidth,Oe.height=j.codecHeight,Oe.fps=j.frameRate.fps,Oe.profile=j.profile,Oe.level=j.level,Oe.refFrames=K.ref_frames,Oe.chromaFormat=K.chroma_format_string,Oe.sarNum=j.sarRatio.width,Oe.sarDen=j.sarRatio.height,Oe.videoCodec=j.codec,Oe.hasAudio&&Oe.audioCodec?Oe.mimeType='video/mp2t; codecs="'.concat(Oe.videoCodec,",").concat(Oe.audioCodec,'"'):Oe.mimeType='video/mp2t; codecs="'.concat(Oe.videoCodec,'"'),Oe.isComplete()&&this.onMediaInfo(Oe)},re.prototype.dispatchVideoMediaSegment=function(K){K===void 0&&(K=!1),this.isInitSegmentDispatched()&&(this.video_track_.length||K)&&this.onDataAvailable(null,this.video_track_,K)},re.prototype.dispatchAudioMediaSegment=function(K){K===void 0&&(K=!1),this.isInitSegmentDispatched()&&(this.audio_track_.length||K)&&this.onDataAvailable(this.audio_track_,null,K)},re.prototype.dispatchAudioVideoMediaSegment=function(){this.isInitSegmentDispatched()&&(this.audio_track_.length||this.video_track_.length)&&this.onDataAvailable(this.audio_track_,this.video_track_)},re.prototype.parseADTSAACPayload=function(K,j){if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var oe=new Uint8Array(K.byteLength+this.aac_last_incomplete_data_.byteLength);oe.set(this.aac_last_incomplete_data_,0),oe.set(K,this.aac_last_incomplete_data_.byteLength),K=oe}var _e,ae;if(j!=null&&(ae=j/this.timescale_),this.audio_metadata_.codec==="aac"){if(j==null&&this.audio_last_sample_pts_!=null)_e=1024/this.audio_metadata_.sampling_frequency*1e3,ae=this.audio_last_sample_pts_+_e;else if(j==null)return void r.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.audio_last_sample_pts_){_e=1024/this.audio_metadata_.sampling_frequency*1e3;var Te=this.audio_last_sample_pts_+_e;Math.abs(Te-ae)>1&&(r.a.w(this.TAG,"AAC: Detected pts overlapped, "+"expected: ".concat(Te,"ms, PES pts: ").concat(ae,"ms")),ae=Te)}}for(var Ee,ye=new te(K),Re=null,Oe=ae;(Re=ye.readNextAACFrame())!=null;){_e=1024/Re.sampling_frequency*1e3;var Ne={codec:"aac",data:Re};(this.audio_init_segment_dispatched_==0||this.detectAudioMetadataChange(Ne))&&(this.audio_metadata_={codec:"aac",audio_object_type:Re.audio_object_type,sampling_freq_index:Re.sampling_freq_index,sampling_frequency:Re.sampling_frequency,channel_config:Re.channel_config},this.dispatchAudioMediaSegment(!0),this.dispatchAudioInitSegment(Ne)),Ee=Oe;var qe=Math.floor(Oe),ft={unit:Re.data,length:Re.data.byteLength,pts:qe,dts:qe};this.audio_track_.samples.push(ft),this.audio_track_.length+=Re.data.byteLength,Oe+=_e}ye.hasIncompleteData()&&(this.aac_last_incomplete_data_=ye.getIncompleteData()),Ee&&(this.audio_last_sample_pts_=Ee)}},re.prototype.parseLOASAACPayload=function(K,j){var oe;if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var _e=new Uint8Array(K.byteLength+this.aac_last_incomplete_data_.byteLength);_e.set(this.aac_last_incomplete_data_,0),_e.set(K,this.aac_last_incomplete_data_.byteLength),K=_e}var ae,Te;if(j!=null&&(Te=j/this.timescale_),this.audio_metadata_.codec==="aac"){if(j==null&&this.audio_last_sample_pts_!=null)ae=1024/this.audio_metadata_.sampling_frequency*1e3,Te=this.audio_last_sample_pts_+ae;else if(j==null)return void r.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.audio_last_sample_pts_){ae=1024/this.audio_metadata_.sampling_frequency*1e3;var Ee=this.audio_last_sample_pts_+ae;Math.abs(Ee-Te)>1&&(r.a.w(this.TAG,"AAC: Detected pts overlapped, "+"expected: ".concat(Ee,"ms, PES pts: ").concat(Te,"ms")),Te=Ee)}}for(var ye,Re=new Z(K),Oe=null,Ne=Te;(Oe=Re.readNextAACFrame((oe=this.loas_previous_frame)!==null&&oe!==void 0?oe:void 0))!=null;){this.loas_previous_frame=Oe,ae=1024/Oe.sampling_frequency*1e3;var qe={codec:"aac",data:Oe};(this.audio_init_segment_dispatched_==0||this.detectAudioMetadataChange(qe))&&(this.audio_metadata_={codec:"aac",audio_object_type:Oe.audio_object_type,sampling_freq_index:Oe.sampling_freq_index,sampling_frequency:Oe.sampling_frequency,channel_config:Oe.channel_config},this.dispatchAudioMediaSegment(!0),this.dispatchAudioInitSegment(qe)),ye=Ne;var ft=Math.floor(Ne),St={unit:Oe.data,length:Oe.data.byteLength,pts:ft,dts:ft};this.audio_track_.samples.push(St),this.audio_track_.length+=Oe.data.byteLength,Ne+=ae}Re.hasIncompleteData()&&(this.aac_last_incomplete_data_=Re.getIncompleteData()),ye&&(this.audio_last_sample_pts_=ye)}},re.prototype.parseAC3Payload=function(K,j){if(!this.has_video_||this.video_init_segment_dispatched_){var oe,_e;if(j!=null&&(_e=j/this.timescale_),this.audio_metadata_.codec==="ac-3"){if(j==null&&this.audio_last_sample_pts_!=null)oe=1536/this.audio_metadata_.sampling_frequency*1e3,_e=this.audio_last_sample_pts_+oe;else if(j==null)return void r.a.w(this.TAG,"AC3: Unknown pts")}for(var ae,Te=new et(K),Ee=null,ye=_e;(Ee=Te.readNextAC3Frame())!=null;){oe=1536/Ee.sampling_frequency*1e3;var Re={codec:"ac-3",data:Ee};(this.audio_init_segment_dispatched_==0||this.detectAudioMetadataChange(Re))&&(this.audio_metadata_={codec:"ac-3",sampling_frequency:Ee.sampling_frequency,bit_stream_identification:Ee.bit_stream_identification,bit_stream_mode:Ee.bit_stream_mode,low_frequency_effects_channel_on:Ee.low_frequency_effects_channel_on,channel_mode:Ee.channel_mode},this.dispatchAudioMediaSegment(!0),this.dispatchAudioInitSegment(Re)),ae=ye;var Oe=Math.floor(ye),Ne={unit:Ee.data,length:Ee.data.byteLength,pts:Oe,dts:Oe};this.audio_track_.samples.push(Ne),this.audio_track_.length+=Ee.data.byteLength,ye+=oe}ae&&(this.audio_last_sample_pts_=ae)}},re.prototype.parseEAC3Payload=function(K,j){if(!this.has_video_||this.video_init_segment_dispatched_){var oe,_e;if(j!=null&&(_e=j/this.timescale_),this.audio_metadata_.codec==="ec-3"){if(j==null&&this.audio_last_sample_pts_!=null)oe=256*this.audio_metadata_.num_blks/this.audio_metadata_.sampling_frequency*1e3,_e=this.audio_last_sample_pts_+oe;else if(j==null)return void r.a.w(this.TAG,"EAC3: Unknown pts")}for(var ae,Te=new be(K),Ee=null,ye=_e;(Ee=Te.readNextEAC3Frame())!=null;){oe=1536/Ee.sampling_frequency*1e3;var Re={codec:"ec-3",data:Ee};(this.audio_init_segment_dispatched_==0||this.detectAudioMetadataChange(Re))&&(this.audio_metadata_={codec:"ec-3",sampling_frequency:Ee.sampling_frequency,bit_stream_identification:Ee.bit_stream_identification,low_frequency_effects_channel_on:Ee.low_frequency_effects_channel_on,num_blks:Ee.num_blks,channel_mode:Ee.channel_mode},this.dispatchAudioMediaSegment(!0),this.dispatchAudioInitSegment(Re)),ae=ye;var Oe=Math.floor(ye),Ne={unit:Ee.data,length:Ee.data.byteLength,pts:Oe,dts:Oe};this.audio_track_.samples.push(Ne),this.audio_track_.length+=Ee.data.byteLength,ye+=oe}ae&&(this.audio_last_sample_pts_=ae)}},re.prototype.parseOpusPayload=function(K,j){if(!this.has_video_||this.video_init_segment_dispatched_){var oe,_e;if(j!=null&&(_e=j/this.timescale_),this.audio_metadata_.codec==="opus"){if(j==null&&this.audio_last_sample_pts_!=null)oe=20,_e=this.audio_last_sample_pts_+oe;else if(j==null)return void r.a.w(this.TAG,"Opus: Unknown pts")}for(var ae,Te=_e,Ee=0;Ee<K.length;){oe=20;for(var ye=(16&K[Ee+1])!=0,Re=(8&K[Ee+1])!=0,Oe=Ee+2,Ne=0;K[Oe]===255;)Ne+=255,Oe+=1;Ne+=K[Oe],Oe+=1,Oe+=ye?2:0,Oe+=Re?2:0,ae=Te;var qe=Math.floor(Te),ft=K.slice(Oe,Oe+Ne),St={unit:ft,length:ft.byteLength,pts:qe,dts:qe};this.audio_track_.samples.push(St),this.audio_track_.length+=ft.byteLength,Te+=oe,Ee=Oe+Ne}ae&&(this.audio_last_sample_pts_=ae)}},re.prototype.parseMP3Payload=function(K,j){if(!this.has_video_||this.video_init_segment_dispatched_){var oe=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],_e=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],ae=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],Te=K[1]>>>3&3,Ee=(6&K[1])>>1,ye=(240&K[2])>>>4,Re=(12&K[2])>>>2,Oe=(K[3]>>>6&3)!==3?2:1,Ne=0,qe=34;switch(Te){case 0:Ne=[11025,12e3,8e3,0][Re];break;case 2:Ne=[22050,24e3,16e3,0][Re];break;case 3:Ne=[44100,48e3,32e3,0][Re]}switch(Ee){case 1:qe=34,ye<ae.length&&ae[ye];break;case 2:qe=33,ye<_e.length&&_e[ye];break;case 3:qe=32,ye<oe.length&&oe[ye]}var ft=new xe;ft.object_type=qe,ft.sample_rate=Ne,ft.channel_count=Oe,ft.data=K;var St={codec:"mp3",data:ft};this.audio_init_segment_dispatched_==0&&(this.audio_metadata_={codec:"mp3",object_type:qe,sample_rate:Ne,channel_count:Oe},this.dispatchAudioMediaSegment(!0),this.dispatchAudioInitSegment(St));var Yt={unit:K,length:K.byteLength,pts:j/this.timescale_,dts:j/this.timescale_};this.audio_track_.samples.push(Yt),this.audio_track_.length+=K.byteLength}},re.prototype.detectAudioMetadataChange=function(K){if(K.codec!==this.audio_metadata_.codec)return r.a.v(this.TAG,"Audio: Audio Codecs changed from "+"".concat(this.audio_metadata_.codec," to ").concat(K.codec)),!0;if(K.codec==="aac"&&this.audio_metadata_.codec==="aac"){if((j=K.data).audio_object_type!==this.audio_metadata_.audio_object_type)return r.a.v(this.TAG,"AAC: AudioObjectType changed from "+"".concat(this.audio_metadata_.audio_object_type," to ").concat(j.audio_object_type)),!0;if(j.sampling_freq_index!==this.audio_metadata_.sampling_freq_index)return r.a.v(this.TAG,"AAC: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sampling_freq_index," to ").concat(j.sampling_freq_index)),!0;if(j.channel_config!==this.audio_metadata_.channel_config)return r.a.v(this.TAG,"AAC: Channel configuration changed from "+"".concat(this.audio_metadata_.channel_config," to ").concat(j.channel_config)),!0}else if(K.codec==="ac-3"&&this.audio_metadata_.codec==="ac-3"){var j;if((j=K.data).sampling_frequency!==this.audio_metadata_.sampling_frequency)return r.a.v(this.TAG,"AC3: Sampling Frequency changed from "+"".concat(this.audio_metadata_.sampling_frequency," to ").concat(j.sampling_frequency)),!0;if(j.bit_stream_identification!==this.audio_metadata_.bit_stream_identification)return r.a.v(this.TAG,"AC3: Bit Stream Identification changed from "+"".concat(this.audio_metadata_.bit_stream_identification," to ").concat(j.bit_stream_identification)),!0;if(j.bit_stream_mode!==this.audio_metadata_.bit_stream_mode)return r.a.v(this.TAG,"AC3: BitStream Mode changed from "+"".concat(this.audio_metadata_.bit_stream_mode," to ").concat(j.bit_stream_mode)),!0;if(j.channel_mode!==this.audio_metadata_.channel_mode)return r.a.v(this.TAG,"AC3: Channel Mode changed from "+"".concat(this.audio_metadata_.channel_mode," to ").concat(j.channel_mode)),!0;if(j.low_frequency_effects_channel_on!==this.audio_metadata_.low_frequency_effects_channel_on)return r.a.v(this.TAG,"AC3: Low Frequency Effects Channel On changed from "+"".concat(this.audio_metadata_.low_frequency_effects_channel_on," to ").concat(j.low_frequency_effects_channel_on)),!0}else if(K.codec==="opus"&&this.audio_metadata_.codec==="opus"){if((oe=K.meta).sample_rate!==this.audio_metadata_.sample_rate)return r.a.v(this.TAG,"Opus: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sample_rate," to ").concat(oe.sample_rate)),!0;if(oe.channel_count!==this.audio_metadata_.channel_count)return r.a.v(this.TAG,"Opus: Channel count changed from "+"".concat(this.audio_metadata_.channel_count," to ").concat(oe.channel_count)),!0}else if(K.codec==="mp3"&&this.audio_metadata_.codec==="mp3"){var oe;if((oe=K.data).object_type!==this.audio_metadata_.object_type)return r.a.v(this.TAG,"MP3: AudioObjectType changed from "+"".concat(this.audio_metadata_.object_type," to ").concat(oe.object_type)),!0;if(oe.sample_rate!==this.audio_metadata_.sample_rate)return r.a.v(this.TAG,"MP3: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sample_rate," to ").concat(oe.sample_rate)),!0;if(oe.channel_count!==this.audio_metadata_.channel_count)return r.a.v(this.TAG,"MP3: Channel count changed from "+"".concat(this.audio_metadata_.channel_count," to ").concat(oe.channel_count)),!0}return!1},re.prototype.dispatchAudioInitSegment=function(K){var j={type:"audio"};if(j.id=this.audio_track_.id,j.timescale=1e3,j.duration=this.duration_,this.audio_metadata_.codec==="aac"){var oe=K.codec==="aac"?K.data:null,_e=new Q(oe);j.audioSampleRate=_e.sampling_rate,j.channelCount=_e.channel_count,j.codec=_e.codec_mimetype,j.originalCodec=_e.original_codec_mimetype,j.config=_e.config,j.refSampleDuration=1024/j.audioSampleRate*j.timescale}else if(this.audio_metadata_.codec==="ac-3"){var ae=K.codec==="ac-3"?K.data:null,Te=new Ve(ae);j.audioSampleRate=Te.sampling_rate,j.channelCount=Te.channel_count,j.codec=Te.codec_mimetype,j.originalCodec=Te.original_codec_mimetype,j.config=Te.config,j.refSampleDuration=1536/j.audioSampleRate*j.timescale}else if(this.audio_metadata_.codec==="ec-3"){var Ee=K.codec==="ec-3"?K.data:null,ye=new Ue(Ee);j.audioSampleRate=ye.sampling_rate,j.channelCount=ye.channel_count,j.codec=ye.codec_mimetype,j.originalCodec=ye.original_codec_mimetype,j.config=ye.config,j.refSampleDuration=256*ye.num_blks/j.audioSampleRate*j.timescale}else this.audio_metadata_.codec==="opus"?(j.audioSampleRate=this.audio_metadata_.sample_rate,j.channelCount=this.audio_metadata_.channel_count,j.channelConfigCode=this.audio_metadata_.channel_config_code,j.codec="opus",j.originalCodec="opus",j.config=void 0,j.refSampleDuration=20):this.audio_metadata_.codec==="mp3"&&(j.audioSampleRate=this.audio_metadata_.sample_rate,j.channelCount=this.audio_metadata_.channel_count,j.codec="mp3",j.originalCodec="mp3",j.config=void 0);this.audio_init_segment_dispatched_==0&&r.a.v(this.TAG,"Generated first AudioSpecificConfig for mimeType: ".concat(j.codec)),this.onTrackMetadata("audio",j),this.audio_init_segment_dispatched_=!0;var Re=this.media_info_;Re.hasAudio=!0,Re.audioCodec=j.originalCodec,Re.audioSampleRate=j.audioSampleRate,Re.audioChannelCount=j.channelCount,Re.hasVideo&&Re.videoCodec?Re.mimeType='video/mp2t; codecs="'.concat(Re.videoCodec,",").concat(Re.audioCodec,'"'):Re.mimeType='video/mp2t; codecs="'.concat(Re.audioCodec,'"'),Re.isComplete()&&this.onMediaInfo(Re)},re.prototype.dispatchPESPrivateDataDescriptor=function(K,j,oe){var _e=new de;_e.pid=K,_e.stream_type=j,_e.descriptor=oe,this.onPESPrivateDataDescriptor&&this.onPESPrivateDataDescriptor(_e)},re.prototype.parsePESPrivateDataPayload=function(K,j,oe,_e,ae){var Te=new he;if(Te.pid=_e,Te.stream_id=ae,Te.len=K.byteLength,Te.data=K,j!=null){var Ee=Math.floor(j/this.timescale_);Te.pts=Ee}else Te.nearest_pts=this.getNearestTimestampMilliseconds();if(oe!=null){var ye=Math.floor(oe/this.timescale_);Te.dts=ye}this.onPESPrivateData&&this.onPESPrivateData(Te)},re.prototype.parseTimedID3MetadataPayload=function(K,j,oe,_e,ae){var Te=new he;if(Te.pid=_e,Te.stream_id=ae,Te.len=K.byteLength,Te.data=K,j!=null){var Ee=Math.floor(j/this.timescale_);Te.pts=Ee}if(oe!=null){var ye=Math.floor(oe/this.timescale_);Te.dts=ye}this.onTimedID3Metadata&&this.onTimedID3Metadata(Te)},re.prototype.parseSynchronousKLVMetadataPayload=function(K,j,oe,_e,ae){var Te=new ge;if(Te.pid=_e,Te.stream_id=ae,Te.len=K.byteLength,Te.data=K,j!=null){var Ee=Math.floor(j/this.timescale_);Te.pts=Ee}if(oe!=null){var ye=Math.floor(oe/this.timescale_);Te.dts=ye}Te.access_units=function(Re){for(var Oe=[],Ne=0;Ne+5<Re.byteLength;){var qe=Re[Ne+0],ft=Re[Ne+1],St=Re[Ne+2],Yt=Re[Ne+3]<<8|Re[Ne+4]<<0,ce=Re.slice(Ne+5,Ne+5+Yt);Oe.push({service_id:qe,sequence_number:ft,flags:St,data:ce}),Ne+=5+Yt}return Oe}(K),this.onSynchronousKLVMetadata&&this.onSynchronousKLVMetadata(Te)},re.prototype.parseAsynchronousKLVMetadataPayload=function(K,j,oe){var _e=new he;_e.pid=j,_e.stream_id=oe,_e.len=K.byteLength,_e.data=K,this.onAsynchronousKLVMetadata&&this.onAsynchronousKLVMetadata(_e)},re.prototype.parseSMPTE2038MetadataPayload=function(K,j,oe,_e,ae){var Te=new tt;if(Te.pid=_e,Te.stream_id=ae,Te.len=K.byteLength,Te.data=K,j!=null){var Ee=Math.floor(j/this.timescale_);Te.pts=Ee}if(Te.nearest_pts=this.getNearestTimestampMilliseconds(),oe!=null){var ye=Math.floor(oe/this.timescale_);Te.dts=ye}Te.ancillaries=function(Re){for(var Oe=new P.a(Re),Ne=0,qe=[];Ne+=6,Oe.readBits(6)===0;){var ft=Oe.readBool();Ne+=1;var St=Oe.readBits(11);Ne+=11;var Yt=Oe.readBits(12);Ne+=12;var ce=255&Oe.readBits(10);Ne+=10;var me=255&Oe.readBits(10);Ne+=10;var H=255&Oe.readBits(10);Ne+=10;for(var B=new Uint8Array(H),g=0;g<H;g++){var U=255&Oe.readBits(10);Ne+=10,B[g]=U}Oe.readBits(10),Ne+=10;var ee="User Defined";ce===65?me===7&&(ee="SCTE-104"):ce===95?me===220?ee="ARIB STD-B37 (1SEG)":me===221?ee="ARIB STD-B37 (ANALOG)":me===222?ee="ARIB STD-B37 (SD)":me===223&&(ee="ARIB STD-B37 (HD)"):ce===97&&(me===1?ee="EIA-708":me===2&&(ee="EIA-608")),qe.push({yc_indicator:ft,line_number:St,horizontal_offset:Yt,did:ce,sdid:me,user_data:B,description:ee,information:{}}),Oe.readBits(8-(Ne-Math.floor(Ne/8))%8),Ne+=(8-(Ne-Math.floor(Ne/8)))%8}return Oe.destroy(),Oe=null,qe}(K),this.onSMPTE2038Metadata&&this.onSMPTE2038Metadata(Te)},re.prototype.getNearestTimestampMilliseconds=function(){return this.audio_last_sample_pts_!=null?Math.floor(this.audio_last_sample_pts_):this.last_pcr_!=null?Math.floor(this.last_pcr_/300/this.timescale_):void 0},re.prototype.getPcrBase=function(K){var j=33554432*K[6]+131072*K[7]+512*K[8]+2*K[9]+(128&K[10])/128+this.timestamp_offset_;return j+4294967296<this.last_pcr_base_&&(j+=8589934592,this.timestamp_offset_+=8589934592),this.last_pcr_base_=j,j},re.prototype.getTimestamp=function(K,j){var oe=536870912*(14&K[j])+4194304*(255&K[j+1])+16384*(254&K[j+2])+128*(255&K[j+3])+(254&K[j+4])/2+this.timestamp_offset_;return oe+4294967296<this.last_pcr_base_&&(oe+=8589934592),oe},re}(c);n.a=gt},function(t,n,i){var s=i(8),r=function(){function d(){}return d._ebsp2rbsp=function(u){for(var c=u,l=c.byteLength,h=new Uint8Array(l),o=0,f=0;f<l;f++)f>=2&&c[f]===3&&c[f-1]===0&&c[f-2]===0||(h[o]=c[f],o++);return new Uint8Array(h.buffer,0,o)},d.parseVPS=function(u){var c=d._ebsp2rbsp(u),l=new s.a(c);return l.readByte(),l.readByte(),l.readBits(4),l.readBits(2),l.readBits(6),{num_temporal_layers:l.readBits(3)+1,temporal_id_nested:l.readBool()}},d.parseSPS=function(u){var c=d._ebsp2rbsp(u),l=new s.a(c);l.readByte(),l.readByte();for(var h=0,o=0,f=0,p=0,m=(l.readBits(4),l.readBits(3)),y=(l.readBool(),l.readBits(2)),_=l.readBool(),S=l.readBits(5),b=l.readByte(),x=l.readByte(),L=l.readByte(),N=l.readByte(),P=l.readByte(),T=l.readByte(),k=l.readByte(),I=l.readByte(),F=l.readByte(),V=l.readByte(),ne=l.readByte(),te=[],Z=[],Q=0;Q<m;Q++)te.push(l.readBool()),Z.push(l.readBool());if(m>0)for(Q=m;Q<8;Q++)l.readBits(2);for(Q=0;Q<m;Q++)te[Q]&&(l.readByte(),l.readByte(),l.readByte(),l.readByte(),l.readByte(),l.readByte(),l.readByte(),l.readByte(),l.readByte(),l.readByte(),l.readByte()),Z[Q]&&l.readByte();l.readUEG();var he=l.readUEG();he==3&&l.readBits(1);var de=l.readUEG(),M=l.readUEG();l.readBool()&&(h+=l.readUEG(),o+=l.readUEG(),f+=l.readUEG(),p+=l.readUEG());var A=l.readUEG(),v=l.readUEG(),w=l.readUEG();for(Q=l.readBool()?0:m;Q<=m;Q++)l.readUEG(),l.readUEG(),l.readUEG();if(l.readUEG(),l.readUEG(),l.readUEG(),l.readUEG(),l.readUEG(),l.readUEG(),l.readBool()&&l.readBool())for(var R=0;R<4;R++)for(var C=0;C<(R===3?2:6);C++)if(l.readBool()){var O=Math.min(64,1<<4+(R<<1));for(R>1&&l.readSEG(),Q=0;Q<O;Q++)l.readSEG()}else l.readUEG();l.readBool(),l.readBool(),l.readBool()&&(l.readByte(),l.readUEG(),l.readUEG(),l.readBool());var G=l.readUEG(),z=0;for(Q=0;Q<G;Q++){var Y=!1;if(Q!==0&&(Y=l.readBool()),Y){Q===G&&l.readUEG(),l.readBool(),l.readUEG();for(var ie=0,se=0;se<=z;se++){var Se=l.readBool(),we=!1;Se||(we=l.readBool()),(Se||we)&&ie++}z=ie}else{var Pe=l.readUEG(),Ge=l.readUEG();for(z=Pe+Ge,se=0;se<Pe;se++)l.readUEG(),l.readBool();for(se=0;se<Ge;se++)l.readUEG(),l.readBool()}}if(l.readBool()){var it=l.readUEG();for(Q=0;Q<it;Q++){for(se=0;se<w+4;se++)l.readBits(1);l.readBits(1)}}var Ie=0,rt=1,tt=1,xe=!1,ht=1,_t=1,et=(l.readBool(),l.readBool(),2),Ve=2,fe=2;if(l.readBool()){if(l.readBool()){var be=l.readByte();be>0&&be<=16?(rt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][be-1],tt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][be-1]):be===255&&(rt=l.readBits(16),tt=l.readBits(16))}if(l.readBool()&&l.readBool(),l.readBool()&&(l.readBits(3),l.readBool(),l.readBool()&&(et=l.readByte(),Ve=l.readByte(),fe=l.readByte())),l.readBool()&&(l.readUEG(),l.readUEG()),l.readBool(),l.readBool(),l.readBool(),l.readBool()&&(l.readUEG(),l.readUEG(),l.readUEG(),l.readUEG()),l.readBool()&&(ht=l.readBits(32),_t=l.readBits(32),l.readBool()&&l.readUEG(),l.readBool())){var Ue=!1,ge=!1,Je=!1;for(Ue=l.readBool(),ge=l.readBool(),(Ue||ge)&&((Je=l.readBool())&&(l.readByte(),l.readBits(5),l.readBool(),l.readBits(5)),l.readBits(4),l.readBits(4),Je&&l.readBits(4),l.readBits(5),l.readBits(5),l.readBits(5)),Q=0;Q<=m;Q++){var ut=l.readBool();xe=ut;var st=!0,We=1;ut||(st=l.readBool());var gt=!1;if(st?l.readUEG():gt=l.readBool(),gt||(We=l.readUEG()+1),Ue){for(se=0;se<We;se++)l.readUEG(),l.readUEG(),Je&&(l.readUEG(),l.readUEG());l.readBool()}if(ge){for(se=0;se<We;se++)l.readUEG(),l.readUEG(),Je&&(l.readUEG(),l.readUEG());l.readBool()}}}l.readBool()&&(l.readBool(),l.readBool(),l.readBool(),Ie=l.readUEG(),l.readUEG(),l.readUEG(),l.readUEG(),l.readUEG())}l.readBool();var X="hvc1.".concat(S,".1.L").concat(ne,".B0"),re=de-(h+o)*(he===1||he===2?2:1),K=M-(f+p)*(he===1?2:1),j=1;return rt!==1&&tt!==1&&(j=rt/tt),l.destroy(),l=null,{codec_mimetype:X,profile_string:d.getProfileString(S),level_string:d.getLevelString(ne),profile_idc:S,bit_depth:A+8,ref_frames:1,chroma_format:he,chroma_format_string:d.getChromaFormatString(he),general_level_idc:ne,general_profile_space:y,general_tier_flag:_,general_profile_idc:S,general_profile_compatibility_flags_1:b,general_profile_compatibility_flags_2:x,general_profile_compatibility_flags_3:L,general_profile_compatibility_flags_4:N,general_constraint_indicator_flags_1:P,general_constraint_indicator_flags_2:T,general_constraint_indicator_flags_3:k,general_constraint_indicator_flags_4:I,general_constraint_indicator_flags_5:F,general_constraint_indicator_flags_6:V,min_spatial_segmentation_idc:Ie,constant_frame_rate:0,chroma_format_idc:he,bit_depth_luma_minus8:A,bit_depth_chroma_minus8:v,colour_primaries:et,transfer_characteristics:Ve,matrix_coeffs:fe,frame_rate:{fixed:xe,fps:_t/ht,fps_den:ht,fps_num:_t},sar_ratio:{width:rt,height:tt},codec_size:{width:re,height:K},present_size:{width:re*j,height:K}}},d.parsePPS=function(u){var c=d._ebsp2rbsp(u),l=new s.a(c);l.readByte(),l.readByte(),l.readUEG(),l.readUEG(),l.readBool(),l.readBool(),l.readBits(3),l.readBool(),l.readBool(),l.readUEG(),l.readUEG(),l.readSEG(),l.readBool(),l.readBool(),l.readBool()&&l.readUEG(),l.readSEG(),l.readSEG(),l.readBool(),l.readBool(),l.readBool(),l.readBool();var h=l.readBool(),o=l.readBool(),f=1;return o&&h?f=0:o?f=3:h&&(f=2),{parallelismType:f}},d.getChromaFormatString=function(u){switch(u){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}},d.getProfileString=function(u){switch(u){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}},d.getLevelString=function(u){return(u/30).toFixed(1)},d}();n.a=r},function(t,n,i){var s=i(8),r=function(){return(r=Object.assign||function(u){for(var c,l=1,h=arguments.length;l<h;l++)for(var o in c=arguments[l])Object.prototype.hasOwnProperty.call(c,o)&&(u[o]=c[o]);return u}).apply(this,arguments)},d=function(){function u(){}return u.parseOBUs=function(c,l){for(var h=0;h<c.byteLength;){var o=h,f=(c[h],(120&c[h])>>3),p=(4&c[h])!=0,m=(2&c[h])!=0;c[h],h+=1,p&&(h+=1);var y=Number.POSITIVE_INFINITY;if(m){y=0;for(var _=0;;_++){var S=c[h++];if(y|=(127&S)<<7*_,(128&S)==0)break}}console.log(f),f===1?l=r(r({},u.parseSeuqneceHeader(c.subarray(h,h+y))),{sequence_header_data:c.subarray(o,h+y)}):(f==3&&l||f==6&&l)&&(l=u.parseOBUFrameHeader(c.subarray(h,h+y),0,0,l)),h+=y}return l},u.parseSeuqneceHeader=function(c){var l=new s.a(c),h=l.readBits(3),o=(l.readBool(),l.readBool()),f=!0,p=0,m=1,y=void 0,_=[];if(o)_.push({operating_point_idc:0,level:l.readBits(5),tier:0});else{if(l.readBool()){var S=l.readBits(32),b=l.readBits(32),x=l.readBool();if(x){for(var L=0;l.readBits(1)===0;)L+=1;L>=32||(1<<L)-1+l.readBits(L)}(p=b)/(m=S),f=x,l.readBool()&&(l.readBits(5),l.readBits(32),y=l.readBits(5),l.readBits(5))}for(var N=l.readBool(),P=l.readBits(5),T=0;T<=P;T++){var k=l.readBits(12),I=l.readBits(5),F=I>7?l.readBits(1):0;_.push({operating_point_idc:k,level:I,tier:F}),N&&l.readBool()&&l.readBits(4)}}var V=_[0],ne=V.level,te=V.tier,Z=l.readBits(4),Q=l.readBits(4),he=l.readBits(Z+1)+1,de=l.readBits(Q+1)+1,M=!1;o||(M=l.readBool()),M&&(l.readBits(4),l.readBits(4)),l.readBool(),l.readBool(),l.readBool();var A=!1,v=2,w=2,R=0;o||(l.readBool(),l.readBool(),l.readBool(),l.readBool(),(A=l.readBool())&&(l.readBool(),l.readBool()),(v=l.readBool()?2:l.readBits(1))?w=l.readBool()?2:l.readBits(1):w=2,A?R=l.readBits(3)+1:R=0);var C=l.readBool(),O=(l.readBool(),l.readBool(),l.readBool()),G=8;h===2&&O?G=l.readBool()?12:10:G=O?10:8;var z=!1;h!==1&&(z=l.readBool()),l.readBool()&&(l.readBits(8),l.readBits(8),l.readBits(8));var Y=1,ie=1;return z?(l.readBits(1),Y=1,ie=1):(l.readBits(1),h==0?(Y=1,ie=1):h==1?(Y=0,ie=0):G==12?l.readBits(1)&&l.readBits(1):(Y=1,ie=0),Y&&ie&&l.readBits(2),l.readBits(1)),l.readBool(),l.destroy(),l=null,{codec_mimetype:"av01.".concat(h,".").concat(u.getLevelString(ne,te),".").concat(G.toString(10).padStart(2,"0")),level:ne,tier:te,level_string:u.getLevelString(ne,te),profile_idc:h,profile_string:"".concat(h),bit_depth:G,ref_frames:1,chroma_format:u.getChromaFormat(z,Y,ie),chroma_format_string:u.getChromaFormatString(z,Y,ie),sequence_header:{frame_id_numbers_present_flag:M,additional_frame_id_length_minus_1:void 0,delta_frame_id_length_minus_2:void 0,reduced_still_picture_header:o,decoder_model_info_present_flag:!1,operating_points:_,buffer_removal_time_length_minus_1:y,equal_picture_interval:f,seq_force_screen_content_tools:v,seq_force_integer_mv:w,enable_order_hint:A,order_hint_bits:R,enable_superres:C,frame_width_bit:Z+1,frame_height_bit:Q+1,max_frame_width:he,max_frame_height:de},keyframe:void 0,frame_rate:{fixed:f,fps:p/m,fps_den:m,fps_num:p}}},u.parseOBUFrameHeader=function(c,l,h,o){var f=o.sequence_header,p=new s.a(c),m=(f.max_frame_width,f.max_frame_height,0);f.frame_id_numbers_present_flag&&(m=f.additional_frame_id_length_minus_1+f.delta_frame_id_length_minus_2+3);var y=0,_=!0,S=!0,b=!1;if(!f.reduced_still_picture_header){if(p.readBool())return o;_=(y=p.readBits(2))===2||y===0,(S=p.readBool())&&f.decoder_model_info_present_flag&&f.equal_picture_interval,S&&p.readBool(),b=!!(y===3||y===0&&S)||p.readBool()}o.keyframe=_,p.readBool();var x=f.seq_force_screen_content_tools;f.seq_force_screen_content_tools===2&&(x=p.readBits(1)),x&&(f.seq_force_integer_mv,f.seq_force_integer_mv==2&&p.readBits(1)),f.frame_id_numbers_present_flag&&p.readBits(m);var L=!1;if(L=y==3||!f.reduced_still_picture_header&&p.readBool(),p.readBits(f.order_hint_bits),_||b||p.readBits(3),f.decoder_model_info_present_flag&&p.readBool()){for(var N=0;N<=f.operating_points_cnt_minus_1;N++)if(f.operating_points[N].decoder_model_present_for_this_op[N]){var P=f.operating_points[N].operating_point_idc;(P===0||P>>l&1&&P>>h+8&1)&&p.readBits(f.buffer_removal_time_length_minus_1+1)}}var T=255;if(y===3||y==0&&S||(T=p.readBits(8)),(_||T!==255)&&b&&f.enable_order_hint)for(var k=0;k<8;k++)p.readBits(f.order_hint_bits);if(_){var I=u.frameSizeAndRenderSize(p,L,f);o.codec_size={width:I.FrameWidth,height:I.FrameHeight},o.present_size={width:I.RenderWidth,height:I.RenderHeight},o.sar_ratio={width:I.RenderWidth/I.FrameWidth,height:I.RenderHeight/I.FrameHeight}}return p.destroy(),p=null,o},u.frameSizeAndRenderSize=function(c,l,h){var o=h.max_frame_width,f=h.max_frame_height;l&&(o=c.readBits(h.frame_width_bit)+1,f=c.readBits(h.frame_height_bit)+1);var p=!1;h.enable_superres&&(p=c.readBool());var m=8;p&&(m=c.readBits(3)+9);var y=o;o=Math.floor((8*y+m/2)/m);var _=y,S=f;if(c.readBool()){var b=c.readBits(16)+1,x=c.readBits(16)+1;_=c.readBits(b)+1,S=c.readBits(x)+1}return{UpscaledWidth:y,FrameWidth:o,FrameHeight:f,RenderWidth:_,RenderHeight:S}},u.getLevelString=function(c,l){return"".concat(c.toString(10).padStart(2,"0")).concat(l===0?"M":"H")},u.getChromaFormat=function(c,l,h){return c?0:l===0&&h===0?3:l===1&&h===0?2:l===1&&h===1?1:Number.NaN},u.getChromaFormatString=function(c,l,h){return c?"4:0:0":l===0&&h===0?"4:4:4":l===1&&h===0?"4:2:2":l===1&&h===1?"4:2:0":"Unknown"},u}();n.a=d},function(t,n,i){var s,r=i(0),d=function(){function P(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return P.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},P.prototype.addBytes=function(T){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=T,this._totalBytes+=T):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=T,this._totalBytes+=T):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=T,this._totalBytes+=T,this._lastCheckpoint=this._now())},Object.defineProperty(P.prototype,"currentKBps",{get:function(){this.addBytes(0);var T=(this._now()-this._lastCheckpoint)/1e3;return T==0&&(T=1),this._intervalBytes/T/1024},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"averageKBps",{get:function(){var T=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/T/1024},enumerable:!1,configurable:!0}),P}(),u=i(2),c=i(5),l=i(3),h=(s=function(P,T){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,I){k.__proto__=I}||function(k,I){for(var F in I)Object.prototype.hasOwnProperty.call(I,F)&&(k[F]=I[F])})(P,T)},function(P,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function k(){this.constructor=P}s(P,T),P.prototype=T===null?Object.create(T):(k.prototype=T.prototype,new k)}),o=function(P){function T(k,I){var F=P.call(this,"fetch-stream-loader")||this;return F.TAG="FetchStreamLoader",F._seekHandler=k,F._config=I,F._needStash=!0,F._requestAbort=!1,F._abortController=null,F._contentLength=null,F._receivedLength=0,F}return h(T,P),T.isSupported=function(){try{var k=c.a.msedge&&c.a.version.minor>=15048,I=!c.a.msedge||k;return self.fetch&&self.ReadableStream&&I}catch{return!1}},T.prototype.destroy=function(){this.isWorking()&&this.abort(),P.prototype.destroy.call(this)},T.prototype.open=function(k,I){var F=this;this._dataSource=k,this._range=I;var V=k.url;this._config.reuseRedirectedURL&&k.redirectedURL!=null&&(V=k.redirectedURL);var ne=this._seekHandler.getConfig(V,I),te=new self.Headers;if(typeof ne.headers=="object"){var Z=ne.headers;for(var Q in Z)Z.hasOwnProperty(Q)&&te.append(Q,Z[Q])}var he={method:"GET",headers:te,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var Q in this._config.headers)te.append(Q,this._config.headers[Q]);k.cors===!1&&(he.mode="same-origin"),k.withCredentials&&(he.credentials="include"),k.referrerPolicy&&(he.referrerPolicy=k.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,he.signal=this._abortController.signal),this._status=u.c.kConnecting,self.fetch(ne.url,he).then(function(de){if(F._requestAbort)return F._status=u.c.kIdle,void de.body.cancel();if(de.ok&&de.status>=200&&de.status<=299){if(de.url!==ne.url&&F._onURLRedirect){var M=F._seekHandler.removeURLParameters(de.url);F._onURLRedirect(M)}var A=de.headers.get("Content-Length");return A!=null&&(F._contentLength=parseInt(A),F._contentLength!==0&&F._onContentLengthKnown&&F._onContentLengthKnown(F._contentLength)),F._pump.call(F,de.body.getReader())}if(F._status=u.c.kError,!F._onError)throw new l.d("FetchStreamLoader: Http code invalid, "+de.status+" "+de.statusText);F._onError(u.b.HTTP_STATUS_CODE_INVALID,{code:de.status,msg:de.statusText})}).catch(function(de){if(!F._abortController||!F._abortController.signal.aborted){if(F._status=u.c.kError,!F._onError)throw de;F._onError(u.b.EXCEPTION,{code:-1,msg:de.message})}})},T.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==u.c.kBuffering||!c.a.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},T.prototype._pump=function(k){var I=this;return k.read().then(function(F){if(F.done)if(I._contentLength!==null&&I._receivedLength<I._contentLength){I._status=u.c.kError;var V=u.b.EARLY_EOF,ne={code:-1,msg:"Fetch stream meet Early-EOF"};if(!I._onError)throw new l.d(ne.msg);I._onError(V,ne)}else I._status=u.c.kComplete,I._onComplete&&I._onComplete(I._range.from,I._range.from+I._receivedLength-1);else{if(I._abortController&&I._abortController.signal.aborted)return void(I._status=u.c.kComplete);if(I._requestAbort===!0)return I._status=u.c.kComplete,k.cancel();I._status=u.c.kBuffering;var te=F.value.buffer,Z=I._range.from+I._receivedLength;I._receivedLength+=te.byteLength,I._onDataArrival&&I._onDataArrival(te,Z,I._receivedLength),I._pump(k)}}).catch(function(F){if(I._abortController&&I._abortController.signal.aborted)I._status=u.c.kComplete;else if(F.code!==11||!c.a.msedge){I._status=u.c.kError;var V=0,ne=null;if(F.code!==19&&F.message!=="network error"||!(I._contentLength===null||I._contentLength!==null&&I._receivedLength<I._contentLength)?(V=u.b.EXCEPTION,ne={code:F.code,msg:F.message}):(V=u.b.EARLY_EOF,ne={code:F.code,msg:"Fetch stream meet Early-EOF"}),!I._onError)throw new l.d(ne.msg);I._onError(V,ne)}})},T}(u.a),f=function(){var P=function(T,k){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,F){I.__proto__=F}||function(I,F){for(var V in F)Object.prototype.hasOwnProperty.call(F,V)&&(I[V]=F[V])})(T,k)};return function(T,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function I(){this.constructor=T}P(T,k),T.prototype=k===null?Object.create(k):(I.prototype=k.prototype,new I)}}(),p=function(P){function T(k,I){var F=P.call(this,"xhr-moz-chunked-loader")||this;return F.TAG="MozChunkedLoader",F._seekHandler=k,F._config=I,F._needStash=!0,F._xhr=null,F._requestAbort=!1,F._contentLength=null,F._receivedLength=0,F}return f(T,P),T.isSupported=function(){try{var k=new XMLHttpRequest;return k.open("GET","https://example.com",!0),k.responseType="moz-chunked-arraybuffer",k.responseType==="moz-chunked-arraybuffer"}catch(I){return r.a.w("MozChunkedLoader",I.message),!1}},T.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),P.prototype.destroy.call(this)},T.prototype.open=function(k,I){this._dataSource=k,this._range=I;var F=k.url;this._config.reuseRedirectedURL&&k.redirectedURL!=null&&(F=k.redirectedURL);var V=this._seekHandler.getConfig(F,I);this._requestURL=V.url;var ne=this._xhr=new XMLHttpRequest;if(ne.open("GET",V.url,!0),ne.responseType="moz-chunked-arraybuffer",ne.onreadystatechange=this._onReadyStateChange.bind(this),ne.onprogress=this._onProgress.bind(this),ne.onloadend=this._onLoadEnd.bind(this),ne.onerror=this._onXhrError.bind(this),k.withCredentials&&(ne.withCredentials=!0),typeof V.headers=="object"){var te=V.headers;for(var Z in te)te.hasOwnProperty(Z)&&ne.setRequestHeader(Z,te[Z])}if(typeof this._config.headers=="object"){te=this._config.headers;for(var Z in te)te.hasOwnProperty(Z)&&ne.setRequestHeader(Z,te[Z])}this._status=u.c.kConnecting,ne.send()},T.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=u.c.kComplete},T.prototype._onReadyStateChange=function(k){var I=k.target;if(I.readyState===2){if(I.responseURL!=null&&I.responseURL!==this._requestURL&&this._onURLRedirect){var F=this._seekHandler.removeURLParameters(I.responseURL);this._onURLRedirect(F)}if(I.status!==0&&(I.status<200||I.status>299)){if(this._status=u.c.kError,!this._onError)throw new l.d("MozChunkedLoader: Http code invalid, "+I.status+" "+I.statusText);this._onError(u.b.HTTP_STATUS_CODE_INVALID,{code:I.status,msg:I.statusText})}else this._status=u.c.kBuffering}},T.prototype._onProgress=function(k){if(this._status!==u.c.kError){this._contentLength===null&&k.total!==null&&k.total!==0&&(this._contentLength=k.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var I=k.target.response,F=this._range.from+this._receivedLength;this._receivedLength+=I.byteLength,this._onDataArrival&&this._onDataArrival(I,F,this._receivedLength)}},T.prototype._onLoadEnd=function(k){this._requestAbort!==!0?this._status!==u.c.kError&&(this._status=u.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},T.prototype._onXhrError=function(k){this._status=u.c.kError;var I=0,F=null;if(this._contentLength&&k.loaded<this._contentLength?(I=u.b.EARLY_EOF,F={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(I=u.b.EXCEPTION,F={code:-1,msg:k.constructor.name+" "+k.type}),!this._onError)throw new l.d(F.msg);this._onError(I,F)},T}(u.a),m=function(){var P=function(T,k){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,F){I.__proto__=F}||function(I,F){for(var V in F)Object.prototype.hasOwnProperty.call(F,V)&&(I[V]=F[V])})(T,k)};return function(T,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function I(){this.constructor=T}P(T,k),T.prototype=k===null?Object.create(k):(I.prototype=k.prototype,new I)}}(),y=(function(P){function T(k,I){var F=P.call(this,"xhr-msstream-loader")||this;return F.TAG="MSStreamLoader",F._seekHandler=k,F._config=I,F._needStash=!0,F._xhr=null,F._reader=null,F._totalRange=null,F._currentRange=null,F._currentRequestURL=null,F._currentRedirectedURL=null,F._contentLength=null,F._receivedLength=0,F._bufferLimit=16777216,F._lastTimeBufferSize=0,F._isReconnecting=!1,F}m(T,P),T.isSupported=function(){try{if(self.MSStream===void 0||self.MSStreamReader===void 0)return!1;var k=new XMLHttpRequest;return k.open("GET","https://example.com",!0),k.responseType="ms-stream",k.responseType==="ms-stream"}catch(I){return r.a.w("MSStreamLoader",I.message),!1}},T.prototype.destroy=function(){this.isWorking()&&this.abort(),this._reader&&(this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr=null),P.prototype.destroy.call(this)},T.prototype.open=function(k,I){this._internalOpen(k,I,!1)},T.prototype._internalOpen=function(k,I,F){this._dataSource=k,F?this._currentRange=I:this._totalRange=I;var V=k.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?V=this._currentRedirectedURL:k.redirectedURL!=null&&(V=k.redirectedURL));var ne=this._seekHandler.getConfig(V,I);this._currentRequestURL=ne.url;var te=this._reader=new self.MSStreamReader;te.onprogress=this._msrOnProgress.bind(this),te.onload=this._msrOnLoad.bind(this),te.onerror=this._msrOnError.bind(this);var Z=this._xhr=new XMLHttpRequest;if(Z.open("GET",ne.url,!0),Z.responseType="ms-stream",Z.onreadystatechange=this._xhrOnReadyStateChange.bind(this),Z.onerror=this._xhrOnError.bind(this),k.withCredentials&&(Z.withCredentials=!0),typeof ne.headers=="object"){var Q=ne.headers;for(var he in Q)Q.hasOwnProperty(he)&&Z.setRequestHeader(he,Q[he])}if(typeof this._config.headers=="object"){Q=this._config.headers;for(var he in Q)Q.hasOwnProperty(he)&&Z.setRequestHeader(he,Q[he])}this._isReconnecting?this._isReconnecting=!1:this._status=u.c.kConnecting,Z.send()},T.prototype.abort=function(){this._internalAbort(),this._status=u.c.kComplete},T.prototype._internalAbort=function(){this._reader&&(this._reader.readyState===1&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.abort(),this._xhr.onreadystatechange=null,this._xhr=null)},T.prototype._xhrOnReadyStateChange=function(k){var I=k.target;if(I.readyState===2)if(I.status>=200&&I.status<=299){if(this._status=u.c.kBuffering,I.responseURL!=null){var F=this._seekHandler.removeURLParameters(I.responseURL);I.responseURL!==this._currentRequestURL&&F!==this._currentRedirectedURL&&(this._currentRedirectedURL=F,this._onURLRedirect&&this._onURLRedirect(F))}var V=I.getResponseHeader("Content-Length");if(V!=null&&this._contentLength==null){var ne=parseInt(V);ne>0&&(this._contentLength=ne,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength))}}else{if(this._status=u.c.kError,!this._onError)throw new l.d("MSStreamLoader: Http code invalid, "+I.status+" "+I.statusText);this._onError(u.b.HTTP_STATUS_CODE_INVALID,{code:I.status,msg:I.statusText})}else if(I.readyState===3&&I.status>=200&&I.status<=299){this._status=u.c.kBuffering;var te=I.response;this._reader.readAsArrayBuffer(te)}},T.prototype._xhrOnError=function(k){this._status=u.c.kError;var I=u.b.EXCEPTION,F={code:-1,msg:k.constructor.name+" "+k.type};if(!this._onError)throw new l.d(F.msg);this._onError(I,F)},T.prototype._msrOnProgress=function(k){var I=k.target.result;if(I!=null){var F=I.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=I.byteLength;var V=this._totalRange.from+this._receivedLength;this._receivedLength+=F.byteLength,this._onDataArrival&&this._onDataArrival(F,V,this._receivedLength),I.byteLength>=this._bufferLimit&&(r.a.v(this.TAG,"MSStream buffer exceeded max size near ".concat(V+F.byteLength,", reconnecting...")),this._doReconnectIfNeeded())}else this._doReconnectIfNeeded()},T.prototype._doReconnectIfNeeded=function(){if(this._contentLength==null||this._receivedLength<this._contentLength){this._isReconnecting=!0,this._lastTimeBufferSize=0,this._internalAbort();var k={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,k,!0)}},T.prototype._msrOnLoad=function(k){this._status=u.c.kComplete,this._onComplete&&this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1)},T.prototype._msrOnError=function(k){this._status=u.c.kError;var I=0,F=null;if(this._contentLength&&this._receivedLength<this._contentLength?(I=u.b.EARLY_EOF,F={code:-1,msg:"MSStream meet Early-Eof"}):(I=u.b.EARLY_EOF,F={code:-1,msg:k.constructor.name+" "+k.type}),!this._onError)throw new l.d(F.msg);this._onError(I,F)}}(u.a),function(){var P=function(T,k){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,F){I.__proto__=F}||function(I,F){for(var V in F)Object.prototype.hasOwnProperty.call(F,V)&&(I[V]=F[V])})(T,k)};return function(T,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function I(){this.constructor=T}P(T,k),T.prototype=k===null?Object.create(k):(I.prototype=k.prototype,new I)}}()),_=function(P){function T(k,I){var F=P.call(this,"xhr-range-loader")||this;return F.TAG="RangeLoader",F._seekHandler=k,F._config=I,F._needStash=!1,F._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],F._currentChunkSizeKB=384,F._currentSpeedNormalized=0,F._zeroSpeedChunkCount=0,F._xhr=null,F._speedSampler=new d,F._requestAbort=!1,F._waitForTotalLength=!1,F._totalLengthReceived=!1,F._currentRequestURL=null,F._currentRedirectedURL=null,F._currentRequestRange=null,F._totalLength=null,F._contentLength=null,F._receivedLength=0,F._lastTimeLoaded=0,F}return y(T,P),T.isSupported=function(){try{var k=new XMLHttpRequest;return k.open("GET","https://example.com",!0),k.responseType="arraybuffer",k.responseType==="arraybuffer"}catch(I){return r.a.w("RangeLoader",I.message),!1}},T.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),P.prototype.destroy.call(this)},Object.defineProperty(T.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),T.prototype.open=function(k,I){this._dataSource=k,this._range=I,this._status=u.c.kConnecting;var F=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(F=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||F?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},T.prototype._openSubRange=function(){var k=1024*this._currentChunkSizeKB,I=this._range.from+this._receivedLength,F=I+k;this._contentLength!=null&&F-this._range.from>=this._contentLength&&(F=this._range.from+this._contentLength-1),this._currentRequestRange={from:I,to:F},this._internalOpen(this._dataSource,this._currentRequestRange)},T.prototype._internalOpen=function(k,I){this._lastTimeLoaded=0;var F=k.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?F=this._currentRedirectedURL:k.redirectedURL!=null&&(F=k.redirectedURL));var V=this._seekHandler.getConfig(F,I);this._currentRequestURL=V.url;var ne=this._xhr=new XMLHttpRequest;if(ne.open("GET",V.url,!0),ne.responseType="arraybuffer",ne.onreadystatechange=this._onReadyStateChange.bind(this),ne.onprogress=this._onProgress.bind(this),ne.onload=this._onLoad.bind(this),ne.onerror=this._onXhrError.bind(this),k.withCredentials&&(ne.withCredentials=!0),typeof V.headers=="object"){var te=V.headers;for(var Z in te)te.hasOwnProperty(Z)&&ne.setRequestHeader(Z,te[Z])}if(typeof this._config.headers=="object"){te=this._config.headers;for(var Z in te)te.hasOwnProperty(Z)&&ne.setRequestHeader(Z,te[Z])}ne.send()},T.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=u.c.kComplete},T.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},T.prototype._onReadyStateChange=function(k){var I=k.target;if(I.readyState===2){if(I.responseURL!=null){var F=this._seekHandler.removeURLParameters(I.responseURL);I.responseURL!==this._currentRequestURL&&F!==this._currentRedirectedURL&&(this._currentRedirectedURL=F,this._onURLRedirect&&this._onURLRedirect(F))}if(I.status>=200&&I.status<=299){if(this._waitForTotalLength)return;this._status=u.c.kBuffering}else{if(this._status=u.c.kError,!this._onError)throw new l.d("RangeLoader: Http code invalid, "+I.status+" "+I.statusText);this._onError(u.b.HTTP_STATUS_CODE_INVALID,{code:I.status,msg:I.statusText})}}},T.prototype._onProgress=function(k){if(this._status!==u.c.kError){if(this._contentLength===null){var I=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,I=!0;var F=k.total;this._internalAbort(),F!=null&F!==0&&(this._totalLength=F)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,I)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var V=k.loaded-this._lastTimeLoaded;this._lastTimeLoaded=k.loaded,this._speedSampler.addBytes(V)}},T.prototype._normalizeSpeed=function(k){var I=this._chunkSizeKBList,F=I.length-1,V=0,ne=0,te=F;if(k<I[0])return I[0];for(;ne<=te;){if((V=ne+Math.floor((te-ne)/2))===F||k>=I[V]&&k<I[V+1])return I[V];I[V]<k?ne=V+1:te=V-1}},T.prototype._onLoad=function(k){if(this._status!==u.c.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var I=this._speedSampler.lastSecondKBps;if(I===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(I=this._speedSampler.currentKBps)),I!==0){var F=this._normalizeSpeed(I);this._currentSpeedNormalized!==F&&(this._currentSpeedNormalized=F,this._currentChunkSizeKB=F)}var V=k.target.response,ne=this._range.from+this._receivedLength;this._receivedLength+=V.byteLength;var te=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():te=!0,this._onDataArrival&&this._onDataArrival(V,ne,this._receivedLength),te&&(this._status=u.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},T.prototype._onXhrError=function(k){this._status=u.c.kError;var I=0,F=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(I=u.b.EARLY_EOF,F={code:-1,msg:"RangeLoader meet Early-Eof"}):(I=u.b.EXCEPTION,F={code:-1,msg:k.constructor.name+" "+k.type}),!this._onError)throw new l.d(F.msg);this._onError(I,F)},T}(u.a),S=function(){var P=function(T,k){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,F){I.__proto__=F}||function(I,F){for(var V in F)Object.prototype.hasOwnProperty.call(F,V)&&(I[V]=F[V])})(T,k)};return function(T,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function I(){this.constructor=T}P(T,k),T.prototype=k===null?Object.create(k):(I.prototype=k.prototype,new I)}}(),b=function(P){function T(){var k=P.call(this,"websocket-loader")||this;return k.TAG="WebSocketLoader",k._needStash=!0,k._ws=null,k._requestAbort=!1,k._receivedLength=0,k}return S(T,P),T.isSupported=function(){try{return self.WebSocket!==void 0}catch{return!1}},T.prototype.destroy=function(){this._ws&&this.abort(),P.prototype.destroy.call(this)},T.prototype.open=function(k){try{var I=this._ws=new self.WebSocket(k.url);I.binaryType="arraybuffer",I.onopen=this._onWebSocketOpen.bind(this),I.onclose=this._onWebSocketClose.bind(this),I.onmessage=this._onWebSocketMessage.bind(this),I.onerror=this._onWebSocketError.bind(this),this._status=u.c.kConnecting}catch(V){this._status=u.c.kError;var F={code:V.code,msg:V.message};if(!this._onError)throw new l.d(F.msg);this._onError(u.b.EXCEPTION,F)}},T.prototype.abort=function(){var k=this._ws;!k||k.readyState!==0&&k.readyState!==1||(this._requestAbort=!0,k.close()),this._ws=null,this._status=u.c.kComplete},T.prototype._onWebSocketOpen=function(k){this._status=u.c.kBuffering},T.prototype._onWebSocketClose=function(k){this._requestAbort!==!0?(this._status=u.c.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},T.prototype._onWebSocketMessage=function(k){var I=this;if(k.data instanceof ArrayBuffer)this._dispatchArrayBuffer(k.data);else if(k.data instanceof Blob){var F=new FileReader;F.onload=function(){I._dispatchArrayBuffer(F.result)},F.readAsArrayBuffer(k.data)}else{this._status=u.c.kError;var V={code:-1,msg:"Unsupported WebSocket message type: "+k.data.constructor.name};if(!this._onError)throw new l.d(V.msg);this._onError(u.b.EXCEPTION,V)}},T.prototype._dispatchArrayBuffer=function(k){var I=k,F=this._receivedLength;this._receivedLength+=I.byteLength,this._onDataArrival&&this._onDataArrival(I,F,this._receivedLength)},T.prototype._onWebSocketError=function(k){this._status=u.c.kError;var I={code:k.code,msg:k.message};if(!this._onError)throw new l.d(I.msg);this._onError(u.b.EXCEPTION,I)},T}(u.a),x=function(){function P(T){this._zeroStart=T||!1}return P.prototype.getConfig=function(T,k){var I={};if(k.from!==0||k.to!==-1){var F=void 0;F=k.to!==-1?"bytes=".concat(k.from.toString(),"-").concat(k.to.toString()):"bytes=".concat(k.from.toString(),"-"),I.Range=F}else this._zeroStart&&(I.Range="bytes=0-");return{url:T,headers:I}},P.prototype.removeURLParameters=function(T){return T},P}(),L=function(){function P(T,k){this._startName=T,this._endName=k}return P.prototype.getConfig=function(T,k){var I=T;if(k.from!==0||k.to!==-1){var F=!0;I.indexOf("?")===-1&&(I+="?",F=!1),F&&(I+="&"),I+="".concat(this._startName,"=").concat(k.from.toString()),k.to!==-1&&(I+="&".concat(this._endName,"=").concat(k.to.toString()))}return{url:I,headers:{}}},P.prototype.removeURLParameters=function(T){var k=T.split("?")[0],I=void 0,F=T.indexOf("?");F!==-1&&(I=T.substring(F+1));var V="";if(I!=null&&I.length>0)for(var ne=I.split("&"),te=0;te<ne.length;te++){var Z=ne[te].split("="),Q=te>0;Z[0]!==this._startName&&Z[0]!==this._endName&&(Q&&(V+="&"),V+=ne[te])}return V.length===0?k:k+"?"+V},P}(),N=function(){function P(T,k,I){this.TAG="IOController",this._config=k,this._extraData=I,this._stashInitialSize=65536,k.stashInitialSize!=null&&k.stashInitialSize>0&&(this._stashInitialSize=k.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=Math.max(this._stashSize,3145728),this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,k.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=T,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(T.url),this._refTotalLength=T.filesize?T.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new d,this._speedNormalizeList=[32,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return P.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},P.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},P.prototype.isPaused=function(){return this._paused},Object.defineProperty(P.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"extraData",{get:function(){return this._extraData},set:function(T){this._extraData=T},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(T){this._onDataArrival=T},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(T){this._onSeeked=T},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"onError",{get:function(){return this._onError},set:function(T){this._onError=T},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"onComplete",{get:function(){return this._onComplete},set:function(T){this._onComplete=T},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(T){this._onRedirect=T},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(T){this._onRecoveredEarlyEof=T},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"currentSpeed",{get:function(){return this._loaderClass===_?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),P.prototype._selectSeekHandler=function(){var T=this._config;if(T.seekType==="range")this._seekHandler=new x(this._config.rangeLoadZeroStart);else if(T.seekType==="param"){var k=T.seekParamStart||"bstart",I=T.seekParamEnd||"bend";this._seekHandler=new L(k,I)}else{if(T.seekType!=="custom")throw new l.b("Invalid seekType in config: ".concat(T.seekType));if(typeof T.customSeekHandler!="function")throw new l.b("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new T.customSeekHandler}},P.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=b;else if(o.isSupported())this._loaderClass=o;else if(p.isSupported())this._loaderClass=p;else{if(!_.isSupported())throw new l.d("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=_}},P.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},P.prototype.open=function(T){this._currentRange={from:0,to:-1},T&&(this._currentRange.from=T),this._speedSampler.reset(),T||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},P.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},P.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},P.prototype.resume=function(){if(this._paused){this._paused=!1;var T=this._resumeFrom;this._resumeFrom=0,this._internalSeek(T,!0)}},P.prototype.seek=function(T){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(T,!0)},P.prototype._internalSeek=function(T,k){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(k),this._loader.destroy(),this._loader=null;var I={from:T,to:-1};this._currentRange={from:I.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,I),this._onSeeked&&this._onSeeked()},P.prototype.updateUrl=function(T){if(!T||typeof T!="string"||T.length===0)throw new l.b("Url must be a non-empty string!");this._dataSource.url=T},P.prototype._expandBuffer=function(T){for(var k=this._stashSize;k+1048576<T;)k*=2;if((k+=1048576)!==this._bufferSize){var I=new ArrayBuffer(k);if(this._stashUsed>0){var F=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(I,0,k).set(F,0)}this._stashBuffer=I,this._bufferSize=k}},P.prototype._normalizeSpeed=function(T){var k=this._speedNormalizeList,I=k.length-1,F=0,V=0,ne=I;if(T<k[0])return k[0];for(;V<=ne;){if((F=V+Math.floor((ne-V)/2))===I||T>=k[F]&&T<k[F+1])return k[F];k[F]<T?V=F+1:ne=F-1}},P.prototype._adjustStashSize=function(T){var k=0;(k=this._config.isLive?T/8:T<512?T:T>=512&&T<=1024?Math.floor(1.5*T):2*T)>8192&&(k=8192);var I=1024*k+1048576;this._bufferSize<I&&this._expandBuffer(I),this._stashSize=1024*k},P.prototype._dispatchChunks=function(T,k){return this._currentRange.to=k+T.byteLength-1,this._onDataArrival(T,k)},P.prototype._onURLRedirect=function(T){this._redirectedURL=T,this._onRedirect&&this._onRedirect(T)},P.prototype._onContentLengthKnown=function(T){T&&this._fullRequestFlag&&(this._totalLength=T,this._fullRequestFlag=!1)},P.prototype._onLoaderChunkArrival=function(T,k,I){if(!this._onDataArrival)throw new l.a("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(T.byteLength);var F=this._speedSampler.lastSecondKBps;if(F!==0){var V=this._normalizeSpeed(F);this._speedNormalized!==V&&(this._speedNormalized=V,this._adjustStashSize(V))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=k),this._stashUsed+T.byteLength<=this._stashSize)(Z=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(T),this._stashUsed),this._stashUsed+=T.byteLength;else if(Z=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var ne=this._stashBuffer.slice(0,this._stashUsed);(Q=this._dispatchChunks(ne,this._stashByteStart))<ne.byteLength?Q>0&&(he=new Uint8Array(ne,Q),Z.set(he,0),this._stashUsed=he.byteLength,this._stashByteStart+=Q):(this._stashUsed=0,this._stashByteStart+=Q),this._stashUsed+T.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+T.byteLength),Z=new Uint8Array(this._stashBuffer,0,this._bufferSize)),Z.set(new Uint8Array(T),this._stashUsed),this._stashUsed+=T.byteLength}else(Q=this._dispatchChunks(T,k))<T.byteLength&&((te=T.byteLength-Q)>this._bufferSize&&(this._expandBuffer(te),Z=new Uint8Array(this._stashBuffer,0,this._bufferSize)),Z.set(new Uint8Array(T,Q),0),this._stashUsed+=te,this._stashByteStart=k+Q);else if(this._stashUsed===0){var te;(Q=this._dispatchChunks(T,k))<T.byteLength&&((te=T.byteLength-Q)>this._bufferSize&&this._expandBuffer(te),(Z=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(T,Q),0),this._stashUsed+=te,this._stashByteStart=k+Q)}else{var Z,Q;if(this._stashUsed+T.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+T.byteLength),(Z=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(T),this._stashUsed),this._stashUsed+=T.byteLength,(Q=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&Q>0){var he=new Uint8Array(this._stashBuffer,Q);Z.set(he,0)}this._stashUsed-=Q,this._stashByteStart+=Q}}},P.prototype._flushStashBuffer=function(T){if(this._stashUsed>0){var k=this._stashBuffer.slice(0,this._stashUsed),I=this._dispatchChunks(k,this._stashByteStart),F=k.byteLength-I;if(I<k.byteLength){if(!T){if(I>0){var V=new Uint8Array(this._stashBuffer,0,this._bufferSize),ne=new Uint8Array(k,I);V.set(ne,0),this._stashUsed=ne.byteLength,this._stashByteStart+=I}return 0}r.a.w(this.TAG,"".concat(F," bytes unconsumed data remain when flush buffer, dropped"))}return this._stashUsed=0,this._stashByteStart=0,F}return 0},P.prototype._onLoaderComplete=function(T,k){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},P.prototype._onLoaderError=function(T,k){switch(r.a.e(this.TAG,"Loader error, code = ".concat(k.code,", msg = ").concat(k.msg)),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,T=u.b.UNRECOVERABLE_EARLY_EOF),T){case u.b.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var I=this._currentRange.to+1;return void(I<this._totalLength&&(r.a.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(I,!1)))}T=u.b.UNRECOVERABLE_EARLY_EOF;break;case u.b.UNRECOVERABLE_EARLY_EOF:case u.b.CONNECTING_TIMEOUT:case u.b.HTTP_STATUS_CODE_INVALID:case u.b.EXCEPTION:}if(!this._onError)throw new l.d("IOException: "+k.msg);this._onError(T,k)},P}();n.a=N},function(t,n,i){var s=i(10),r=i.n(s),d=i(0),u=i(5),c=i(13);function l(A,v,w){var R=A;if(v+w<R.length){for(;w--;)if((192&R[++v])!=128)return!1;return!0}return!1}var h,o=function(A){for(var v=[],w=A,R=0,C=A.length;R<C;)if(w[R]<128)v.push(String.fromCharCode(w[R])),++R;else{if(!(w[R]<192)){if(w[R]<224){if(l(w,R,1)&&(O=(31&w[R])<<6|63&w[R+1])>=128){v.push(String.fromCharCode(65535&O)),R+=2;continue}}else if(w[R]<240){if(l(w,R,2)&&(O=(15&w[R])<<12|(63&w[R+1])<<6|63&w[R+2])>=2048&&(63488&O)!=55296){v.push(String.fromCharCode(65535&O)),R+=3;continue}}else if(w[R]<248){var O;if(l(w,R,3)&&(O=(7&w[R])<<18|(63&w[R+1])<<12|(63&w[R+2])<<6|63&w[R+3])>65536&&O<1114112){O-=65536,v.push(String.fromCharCode(O>>>10|55296)),v.push(String.fromCharCode(1023&O|56320)),R+=4;continue}}}v.push("�"),++R}return v.join("")},f=i(3),p=(h=new ArrayBuffer(2),new DataView(h).setInt16(0,256,!0),new Int16Array(h)[0]===256),m=function(){function A(){}return A.parseScriptData=function(v,w,R){var C={};try{var O=A.parseValue(v,w,R),G=A.parseValue(v,w+O.size,R-O.size);C[O.data]=G.data}catch(z){d.a.e("AMF",z.toString())}return C},A.parseObject=function(v,w,R){if(R<3)throw new f.a("Data not enough when parse ScriptDataObject");var C=A.parseString(v,w,R),O=A.parseValue(v,w+C.size,R-C.size),G=O.objectEnd;return{data:{name:C.data,value:O.data},size:C.size+O.size,objectEnd:G}},A.parseVariable=function(v,w,R){return A.parseObject(v,w,R)},A.parseString=function(v,w,R){if(R<2)throw new f.a("Data not enough when parse String");var C=new DataView(v,w,R).getUint16(0,!p);return{data:C>0?o(new Uint8Array(v,w+2,C)):"",size:2+C}},A.parseLongString=function(v,w,R){if(R<4)throw new f.a("Data not enough when parse LongString");var C=new DataView(v,w,R).getUint32(0,!p);return{data:C>0?o(new Uint8Array(v,w+4,C)):"",size:4+C}},A.parseDate=function(v,w,R){if(R<10)throw new f.a("Data size invalid when parse Date");var C=new DataView(v,w,R),O=C.getFloat64(0,!p),G=C.getInt16(8,!p);return{data:new Date(O+=60*G*1e3),size:10}},A.parseValue=function(v,w,R){if(R<1)throw new f.a("Data not enough when parse Value");var C,O=new DataView(v,w,R),G=1,z=O.getUint8(0),Y=!1;try{switch(z){case 0:C=O.getFloat64(1,!p),G+=8;break;case 1:C=!!O.getUint8(1),G+=1;break;case 2:var ie=A.parseString(v,w+1,R-1);C=ie.data,G+=ie.size;break;case 3:C={};var se=0;for((16777215&O.getUint32(R-4,!p))==9&&(se=3);G<R-4;){var Se=A.parseObject(v,w+G,R-G-se);if(Se.objectEnd)break;C[Se.data.name]=Se.data.value,G+=Se.size}G<=R-3&&(16777215&O.getUint32(G-1,!p))===9&&(G+=3);break;case 8:for(C={},G+=4,se=0,(16777215&O.getUint32(R-4,!p))==9&&(se=3);G<R-8;){var we=A.parseVariable(v,w+G,R-G-se);if(we.objectEnd)break;C[we.data.name]=we.data.value,G+=we.size}G<=R-3&&(16777215&O.getUint32(G-1,!p))===9&&(G+=3);break;case 9:C=void 0,G=1,Y=!0;break;case 10:C=[];var Pe=O.getUint32(1,!p);G+=4;for(var Ge=0;Ge<Pe;Ge++){var it=A.parseValue(v,w+G,R-G);C.push(it.data),G+=it.size}break;case 11:var Ie=A.parseDate(v,w+1,R-1);C=Ie.data,G+=Ie.size;break;case 12:var rt=A.parseString(v,w+1,R-1);C=rt.data,G+=rt.size;break;default:G=R,d.a.w("AMF","Unsupported AMF value type "+z)}}catch(tt){d.a.e("AMF",tt.toString())}return{data:C,size:G,objectEnd:Y}},A}(),y=i(23),_=i(6),S=i(15);function b(A){return A.byteOffset%2==0&&A.byteLength%2==0}function x(A){return A.byteOffset%4==0&&A.byteLength%4==0}function L(A,v){for(var w=0;w<A.length;w++)if(A[w]!==v[w])return!1;return!0}var N=function(A,v){return A.byteLength===v.byteLength&&(x(A)&&x(v)?function(w,R){return L(new Uint32Array(w.buffer,w.byteOffset,w.byteLength/4),new Uint32Array(R.buffer,R.byteOffset,R.byteLength/4))}(A,v):b(A)&&b(v)?function(w,R){return L(new Uint16Array(w.buffer,w.byteOffset,w.byteLength/2),new Uint16Array(R.buffer,R.byteOffset,R.byteLength/2))}(A,v):function(w,R){return L(w,R)}(A,v))},P=i(16),T=i(8),k=function(){function A(v,w){this.TAG="FLVDemuxer",this._config=w,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=v.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=v.hasAudioTrack,this._hasVideo=v.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new c.a,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var R=new ArrayBuffer(2);return new DataView(R).setInt16(0,256,!0),new Int16Array(R)[0]===256}()}return A.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},A.probe=function(v){var w=new Uint8Array(v);if(w.byteLength<9)return{needMoreData:!0};var R={match:!1};if(w[0]!==70||w[1]!==76||w[2]!==86||w[3]!==1)return R;var C,O,G=(4&w[4])>>>2!=0,z=(1&w[4])!=0,Y=(C=w)[O=5]<<24|C[O+1]<<16|C[O+2]<<8|C[O+3];return Y<9?R:{match:!0,consumed:Y,dataOffset:Y,hasAudioTrack:G,hasVideoTrack:z}},A.prototype.bindDataSource=function(v){return v.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(A.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(v){this._onTrackMetadata=v},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(v){this._onMediaInfo=v},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(v){this._onMetaDataArrived=v},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(v){this._onScriptDataArrived=v},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onError",{get:function(){return this._onError},set:function(v){this._onError=v},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(v){this._onDataAvailable=v},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(v){this._timestampBase=v},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"overridedDuration",{get:function(){return this._duration},set:function(v){this._durationOverrided=!0,this._duration=v,this._mediaInfo.duration=v},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"overridedHasAudio",{set:function(v){this._hasAudioFlagOverrided=!0,this._hasAudio=v,this._mediaInfo.hasAudio=v},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"overridedHasVideo",{set:function(v){this._hasVideoFlagOverrided=!0,this._hasVideo=v,this._mediaInfo.hasVideo=v},enumerable:!1,configurable:!0}),A.prototype.resetMediaInfo=function(){this._mediaInfo=new c.a},A.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},A.prototype.parseChunks=function(v,w){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new f.a("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var R=0,C=this._littleEndian;if(w===0){if(!(v.byteLength>13))return 0;R=A.probe(v).dataOffset}for(this._firstParse&&(this._firstParse=!1,w+R!==this._dataOffset&&d.a.w(this.TAG,"First time parsing but chunk byteStart invalid!"),(O=new DataView(v,R)).getUint32(0,!C)!==0&&d.a.w(this.TAG,"PrevTagSize0 !== 0 !!!"),R+=4);R<v.byteLength;){this._dispatch=!0;var O=new DataView(v,R);if(R+11+4>v.byteLength)break;var G=O.getUint8(0),z=16777215&O.getUint32(0,!C);if(R+11+z+4>v.byteLength)break;if(G===8||G===9||G===18){var Y=O.getUint8(4),ie=O.getUint8(5),se=O.getUint8(6)|ie<<8|Y<<16|O.getUint8(7)<<24;16777215&O.getUint32(7,!C)&&d.a.w(this.TAG,"Meet tag which has StreamID != 0!");var Se=R+11;switch(G){case 8:this._parseAudioData(v,Se,z,se);break;case 9:this._parseVideoData(v,Se,z,se,w+R);break;case 18:this._parseScriptData(v,Se,z)}var we=O.getUint32(11+z,!C);we!==11+z&&d.a.w(this.TAG,"Invalid PrevTagSize ".concat(we)),R+=11+z+4}else d.a.w(this.TAG,"Unsupported tag type ".concat(G,", skipped")),R+=11+z+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),R},A.prototype._parseScriptData=function(v,w,R){var C=m.parseScriptData(v,w,R);if(C.hasOwnProperty("onMetaData")){if(C.onMetaData==null||typeof C.onMetaData!="object")return void d.a.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&d.a.w(this.TAG,"Found another onMetaData tag!"),this._metadata=C;var O=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},O)),typeof O.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=O.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof O.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=O.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof O.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=O.audiodatarate),typeof O.videodatarate=="number"&&(this._mediaInfo.videoDataRate=O.videodatarate),typeof O.width=="number"&&(this._mediaInfo.width=O.width),typeof O.height=="number"&&(this._mediaInfo.height=O.height),typeof O.duration=="number"){if(!this._durationOverrided){var G=Math.floor(O.duration*this._timescale);this._duration=G,this._mediaInfo.duration=G}}else this._mediaInfo.duration=0;if(typeof O.framerate=="number"){var z=Math.floor(1e3*O.framerate);if(z>0){var Y=z/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=Y,this._referenceFrameRate.fps_num=z,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=Y}}if(typeof O.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var ie=O.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(ie),O.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=O,d.a.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(C).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},C))},A.prototype._parseKeyframesIndex=function(v){for(var w=[],R=[],C=1;C<v.times.length;C++){var O=this._timestampBase+Math.floor(1e3*v.times[C]);w.push(O),R.push(v.filepositions[C])}return{times:w,filepositions:R}},A.prototype._parseAudioData=function(v,w,R,C){if(R<=1)d.a.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(this._hasAudioFlagOverrided!==!0||this._hasAudio!==!1){this._littleEndian;var O=new DataView(v,w,R).getUint8(0),G=O>>>4;if(G!==9)if(G===2||G===10){var z=0,Y=(12&O)>>>2;if(Y>=0&&Y<=4){z=this._flvSoundRateTable[Y];var ie=1&O,se=this._audioMetadata,Se=this._audioTrack;if(se||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(se=this._audioMetadata={}).type="audio",se.id=Se.id,se.timescale=this._timescale,se.duration=this._duration,se.audioSampleRate=z,se.channelCount=ie===0?1:2),G===10){var we=this._parseAACAudioData(v,w+1,R-1);if(we==null)return;if(we.packetType===0){if(se.config){if(N(we.data.config,se.config))return;d.a.w(this.TAG,"AudioSpecificConfig has been changed, re-generate initialization segment")}var Pe=we.data;se.audioSampleRate=Pe.samplingRate,se.channelCount=Pe.channelCount,se.codec=Pe.codec,se.originalCodec=Pe.originalCodec,se.config=Pe.config,se.refSampleDuration=1024/se.audioSampleRate*se.timescale,d.a.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",se),(Ie=this._mediaInfo).audioCodec=se.originalCodec,Ie.audioSampleRate=se.audioSampleRate,Ie.audioChannelCount=se.channelCount,Ie.hasVideo?Ie.videoCodec!=null&&(Ie.mimeType='video/x-flv; codecs="'+Ie.videoCodec+","+Ie.audioCodec+'"'):Ie.mimeType='video/x-flv; codecs="'+Ie.audioCodec+'"',Ie.isComplete()&&this._onMediaInfo(Ie)}else if(we.packetType===1){var Ge=this._timestampBase+C,it={unit:we.data,length:we.data.byteLength,dts:Ge,pts:Ge};Se.samples.push(it),Se.length+=we.data.length}else d.a.e(this.TAG,"Flv: Unsupported AAC data type ".concat(we.packetType))}else if(G===2){if(!se.codec){var Ie;if((Pe=this._parseMP3AudioData(v,w+1,R-1,!0))==null)return;se.audioSampleRate=Pe.samplingRate,se.channelCount=Pe.channelCount,se.codec=Pe.codec,se.originalCodec=Pe.originalCodec,se.refSampleDuration=1152/se.audioSampleRate*se.timescale,d.a.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",se),(Ie=this._mediaInfo).audioCodec=se.codec,Ie.audioSampleRate=se.audioSampleRate,Ie.audioChannelCount=se.channelCount,Ie.audioDataRate=Pe.bitRate,Ie.hasVideo?Ie.videoCodec!=null&&(Ie.mimeType='video/x-flv; codecs="'+Ie.videoCodec+","+Ie.audioCodec+'"'):Ie.mimeType='video/x-flv; codecs="'+Ie.audioCodec+'"',Ie.isComplete()&&this._onMediaInfo(Ie)}var rt=this._parseMP3AudioData(v,w+1,R-1,!1);if(rt==null)return;Ge=this._timestampBase+C;var tt={unit:rt,length:rt.byteLength,dts:Ge,pts:Ge};Se.samples.push(tt),Se.length+=rt.length}}else this._onError(_.a.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+Y)}else this._onError(_.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+G);else{if(R<=5)return void d.a.w(this.TAG,"Flv: Invalid audio packet, missing AudioFourCC in Ehnanced FLV payload!");var xe=15&O,ht=String.fromCharCode.apply(String,new Uint8Array(v,w,R).slice(1,5));switch(ht){case"Opus":this._parseOpusAudioPacket(v,w+5,R-5,C,xe);break;case"fLaC":this._parseFlacAudioPacket(v,w+5,R-5,C,xe);break;default:this._onError(_.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec: "+ht)}}}},A.prototype._parseAACAudioData=function(v,w,R){if(!(R<=1)){var C={},O=new Uint8Array(v,w,R);return C.packetType=O[0],O[0]===0?C.data=this._parseAACAudioSpecificConfig(v,w+1,R-1):C.data=O.subarray(1),C}d.a.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},A.prototype._parseAACAudioSpecificConfig=function(v,w,R){var C,O,G=new Uint8Array(v,w,R),z=null,Y=0,ie=null;if(Y=C=G[0]>>>3,(O=(7&G[0])<<1|G[1]>>>7)<0||O>=this._mpegSamplingRates.length)this._onError(_.a.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var se=this._mpegSamplingRates[O],Se=(120&G[1])>>>3;if(!(Se<0||Se>=8)){Y===5&&(ie=(7&G[1])<<1|G[2]>>>7,(124&G[2])>>>2);var we=self.navigator.userAgent.toLowerCase();return we.indexOf("firefox")!==-1?O>=6?(Y=5,z=new Array(4),ie=O-3):(Y=2,z=new Array(2),ie=O):we.indexOf("android")!==-1?(Y=2,z=new Array(2),ie=O):(Y=5,ie=O,z=new Array(4),O>=6?ie=O-3:Se===1&&(Y=2,z=new Array(2),ie=O)),z[0]=Y<<3,z[0]|=(15&O)>>>1,z[1]=(15&O)<<7,z[1]|=(15&Se)<<3,Y===5&&(z[1]|=(15&ie)>>>1,z[2]=(1&ie)<<7,z[2]|=8,z[3]=0),{config:z,samplingRate:se,channelCount:Se,codec:"mp4a.40."+Y,originalCodec:"mp4a.40."+C}}this._onError(_.a.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},A.prototype._parseMP3AudioData=function(v,w,R,C){if(!(R<4)){this._littleEndian;var O=new Uint8Array(v,w,R),G=null;if(C){if(O[0]!==255)return;var z=O[1]>>>3&3,Y=(6&O[1])>>1,ie=(240&O[2])>>>4,se=(12&O[2])>>>2,Se=(O[3]>>>6&3)!==3?2:1,we=0,Pe=0;switch(z){case 0:we=this._mpegAudioV25SampleRateTable[se];break;case 2:we=this._mpegAudioV20SampleRateTable[se];break;case 3:we=this._mpegAudioV10SampleRateTable[se]}switch(Y){case 1:ie<this._mpegAudioL3BitRateTable.length&&(Pe=this._mpegAudioL3BitRateTable[ie]);break;case 2:ie<this._mpegAudioL2BitRateTable.length&&(Pe=this._mpegAudioL2BitRateTable[ie]);break;case 3:ie<this._mpegAudioL1BitRateTable.length&&(Pe=this._mpegAudioL1BitRateTable[ie])}G={bitRate:Pe,samplingRate:we,channelCount:Se,codec:"mp3",originalCodec:"mp3"}}else G=O;return G}d.a.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},A.prototype._parseOpusAudioPacket=function(v,w,R,C,O){if(O===0)this._parseOpusSequenceHeader(v,w,R);else if(O===1)this._parseOpusAudioData(v,w,R,C);else if(O!==2)return void this._onError(_.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(O))},A.prototype._parseOpusSequenceHeader=function(v,w,R){if(R<=16)d.a.w(this.TAG,"Flv: Invalid OpusSequenceHeader, lack of data!");else{var C=this._audioMetadata,O=this._audioTrack;C||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(C=this._audioMetadata={}).type="audio",C.id=O.id,C.timescale=this._timescale,C.duration=this._duration);var G=new DataView(v,w,R);G.setUint8(8,0);var z=G.getUint8(9);G.setUint16(10,G.getUint16(10,!0),!1);var Y=G.getUint32(12,!0);G.setUint32(12,G.getUint32(12,!0),!1);var ie={config:new Uint8Array(v,w+8,R-8),channelCount:z,samplingFrequence:Y,codec:"opus",originalCodec:"opus"};if(C.config){if(N(ie.config,C.config))return;d.a.w(this.TAG,"OpusSequenceHeader has been changed, re-generate initialization segment")}C.audioSampleRate=ie.samplingFrequence,C.channelCount=ie.channelCount,C.codec=ie.codec,C.originalCodec=ie.originalCodec,C.config=ie.config,C.refSampleDuration=20,d.a.v(this.TAG,"Parsed OpusSequenceHeader"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",C);var se=this._mediaInfo;se.audioCodec=C.originalCodec,se.audioSampleRate=C.audioSampleRate,se.audioChannelCount=C.channelCount,se.hasVideo?se.videoCodec!=null&&(se.mimeType='video/x-flv; codecs="'+se.videoCodec+","+se.audioCodec+'"'):se.mimeType='video/x-flv; codecs="'+se.audioCodec+'"',se.isComplete()&&this._onMediaInfo(se)}},A.prototype._parseOpusAudioData=function(v,w,R,C){var O=this._audioTrack,G=new Uint8Array(v,w,R),z=this._timestampBase+C,Y={unit:G,length:G.byteLength,dts:z,pts:z};O.samples.push(Y),O.length+=G.length},A.prototype._parseFlacAudioPacket=function(v,w,R,C,O){if(O===0)this._parseFlacSequenceHeader(v,w,R);else if(O===1)this._parseFlacAudioData(v,w,R,C);else if(O!==2)return void this._onError(_.a.FORMAT_ERROR,"Flv: Invalid Flac audio packet type ".concat(O))},A.prototype._parseFlacSequenceHeader=function(v,w,R){var C=this._audioMetadata,O=this._audioTrack;C||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(C=this._audioMetadata={}).type="audio",C.id=O.id,C.timescale=this._timescale,C.duration=this._duration);var G=new Uint8Array(v,w+4,R-4),z=new T.a(G),Y=z.readBits(16),ie=z.readBits(16),se=ie===Y?ie:null;z.readBits(24),z.readBits(24);var Se=z.readBits(20),we=z.readBits(3)+1,Pe=z.readBits(5)+1;z.destroy();var Ge=new Uint8Array(G.byteLength+4);Ge.set(G,4),Ge[0]=128,Ge[1]=G.byteLength>>>16&255,Ge[2]=G.byteLength>>>8&255,Ge[3]=G.byteLength>>>0&255;var it={config:Ge,channelCount:we,samplingFrequence:Se,sampleSize:Pe,codec:"flac",originalCodec:"flac"};if(C.config){if(N(it.config,C.config))return;d.a.w(this.TAG,"FlacSequenceHeader has been changed, re-generate initialization segment")}C.audioSampleRate=it.samplingFrequence,C.channelCount=it.channelCount,C.sampleSize=it.sampleSize,C.codec=it.codec,C.originalCodec=it.originalCodec,C.config=it.config,C.refSampleDuration=se!=null?1e3*se/it.samplingFrequence:null,d.a.v(this.TAG,"Parsed FlacSequenceHeader"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",C);var Ie=this._mediaInfo;Ie.audioCodec=C.originalCodec,Ie.audioSampleRate=C.audioSampleRate,Ie.audioChannelCount=C.channelCount,Ie.hasVideo?Ie.videoCodec!=null&&(Ie.mimeType='video/x-flv; codecs="'+Ie.videoCodec+","+Ie.audioCodec+'"'):Ie.mimeType='video/x-flv; codecs="'+Ie.audioCodec+'"',Ie.isComplete()&&this._onMediaInfo(Ie)},A.prototype._parseFlacAudioData=function(v,w,R,C){var O=this._audioTrack,G=new Uint8Array(v,w,R),z=this._timestampBase+C,Y={unit:G,length:G.byteLength,dts:z,pts:z};O.samples.push(Y),O.length+=G.length},A.prototype._parseVideoData=function(v,w,R,C,O){if(R<=1)d.a.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(this._hasVideoFlagOverrided!==!0||this._hasVideo!==!1){var G=new Uint8Array(v,w,R)[0],z=(112&G)>>>4;if(128&G){var Y=15&G,ie=String.fromCharCode.apply(String,new Uint8Array(v,w,R).slice(1,5));if(ie==="hvc1")this._parseEnhancedHEVCVideoPacket(v,w+5,R-5,C,O,z,Y);else{if(ie!=="av01")return void this._onError(_.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: ".concat(ie));this._parseEnhancedAV1VideoPacket(v,w+5,R-5,C,O,z,Y)}}else{var se=15&G;if(se===7)this._parseAVCVideoPacket(v,w+1,R-1,C,O,z);else{if(se!==12)return void this._onError(_.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: ".concat(se));this._parseHEVCVideoPacket(v,w+1,R-1,C,O,z)}}}},A.prototype._parseAVCVideoPacket=function(v,w,R,C,O,G){if(R<4)d.a.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var z=this._littleEndian,Y=new DataView(v,w,R),ie=Y.getUint8(0),se=(16777215&Y.getUint32(0,!z))<<8>>8;if(ie===0)this._parseAVCDecoderConfigurationRecord(v,w+4,R-4);else if(ie===1)this._parseAVCVideoData(v,w+4,R-4,C,O,G,se);else if(ie!==2)return void this._onError(_.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(ie))}},A.prototype._parseHEVCVideoPacket=function(v,w,R,C,O,G){if(R<4)d.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var z=this._littleEndian,Y=new DataView(v,w,R),ie=Y.getUint8(0),se=(16777215&Y.getUint32(0,!z))<<8>>8;if(ie===0)this._parseHEVCDecoderConfigurationRecord(v,w+4,R-4);else if(ie===1)this._parseHEVCVideoData(v,w+4,R-4,C,O,G,se);else if(ie!==2)return void this._onError(_.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(ie))}},A.prototype._parseEnhancedHEVCVideoPacket=function(v,w,R,C,O,G,z){var Y=this._littleEndian,ie=new DataView(v,w,R);if(z===0)this._parseHEVCDecoderConfigurationRecord(v,w,R);else if(z===1){var se=(4294967040&ie.getUint32(0,!Y))>>8;this._parseHEVCVideoData(v,w+3,R-3,C,O,G,se)}else if(z===3)this._parseHEVCVideoData(v,w,R,C,O,G,0);else if(z!==2)return void this._onError(_.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(z))},A.prototype._parseEnhancedAV1VideoPacket=function(v,w,R,C,O,G,z){if(this._littleEndian,z===0)this._parseAV1CodecConfigurationRecord(v,w,R);else if(z===1)this._parseAV1VideoData(v,w,R,C,O,G,0);else{if(z===5)return void this._onError(_.a.FORMAT_ERROR,"Flv: Not Supported MP2T AV1 video packet type ".concat(z));if(z!==2)return void this._onError(_.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(z))}},A.prototype._parseAVCDecoderConfigurationRecord=function(v,w,R){if(R<7)d.a.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var C=this._videoMetadata,O=this._videoTrack,G=this._littleEndian,z=new DataView(v,w,R);if(C){if(C.avcc!==void 0){var Y=new Uint8Array(v,w,R);if(N(Y,C.avcc))return;d.a.w(this.TAG,"AVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(C=this._videoMetadata={}).type="video",C.id=O.id,C.timescale=this._timescale,C.duration=this._duration;var ie=z.getUint8(0),se=z.getUint8(1);if(z.getUint8(2),z.getUint8(3),ie===1&&se!==0)if(this._naluLengthSize=1+(3&z.getUint8(4)),this._naluLengthSize===3||this._naluLengthSize===4){var Se=31&z.getUint8(5);if(Se!==0){Se>1&&d.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = ".concat(Se));for(var we=6,Pe=0;Pe<Se;Pe++){var Ge=z.getUint16(we,!G);if(we+=2,Ge!==0){var it=new Uint8Array(v,w+we,Ge);we+=Ge;var Ie=y.a.parseSPS(it);if(Pe===0){C.codecWidth=Ie.codec_size.width,C.codecHeight=Ie.codec_size.height,C.presentWidth=Ie.present_size.width,C.presentHeight=Ie.present_size.height,C.profile=Ie.profile_string,C.level=Ie.level_string,C.bitDepth=Ie.bit_depth,C.chromaFormat=Ie.chroma_format,C.sarRatio=Ie.sar_ratio,C.frameRate=Ie.frame_rate,Ie.frame_rate.fixed!==!1&&Ie.frame_rate.fps_num!==0&&Ie.frame_rate.fps_den!==0||(C.frameRate=this._referenceFrameRate);var rt=C.frameRate.fps_den,tt=C.frameRate.fps_num;C.refSampleDuration=C.timescale*(rt/tt);for(var xe=it.subarray(1,4),ht="avc1.",_t=0;_t<3;_t++){var et=xe[_t].toString(16);et.length<2&&(et="0"+et),ht+=et}C.codec=ht;var Ve=this._mediaInfo;Ve.width=C.codecWidth,Ve.height=C.codecHeight,Ve.fps=C.frameRate.fps,Ve.profile=C.profile,Ve.level=C.level,Ve.refFrames=Ie.ref_frames,Ve.chromaFormat=Ie.chroma_format_string,Ve.sarNum=C.sarRatio.width,Ve.sarDen=C.sarRatio.height,Ve.videoCodec=ht,Ve.hasAudio?Ve.audioCodec!=null&&(Ve.mimeType='video/x-flv; codecs="'+Ve.videoCodec+","+Ve.audioCodec+'"'):Ve.mimeType='video/x-flv; codecs="'+Ve.videoCodec+'"',Ve.isComplete()&&this._onMediaInfo(Ve)}}}var fe=z.getUint8(we);if(fe!==0){for(fe>1&&d.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = ".concat(fe)),we++,Pe=0;Pe<fe;Pe++)Ge=z.getUint16(we,!G),we+=2,Ge!==0&&(we+=Ge);C.avcc=new Uint8Array(R),C.avcc.set(new Uint8Array(v,w,R),0),d.a.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",C)}else this._onError(_.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(_.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(_.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: ".concat(this._naluLengthSize-1));else this._onError(_.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},A.prototype._parseHEVCDecoderConfigurationRecord=function(v,w,R){if(R<22)d.a.w(this.TAG,"Flv: Invalid HEVCDecoderConfigurationRecord, lack of data!");else{var C=this._videoMetadata,O=this._videoTrack,G=this._littleEndian,z=new DataView(v,w,R);if(C){if(C.hvcc!==void 0){var Y=new Uint8Array(v,w,R);if(N(Y,C.hvcc))return;d.a.w(this.TAG,"HEVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(C=this._videoMetadata={}).type="video",C.id=O.id,C.timescale=this._timescale,C.duration=this._duration;var ie=z.getUint8(0),se=31&z.getUint8(1);if(ie!==0&&ie!==1||se===0)this._onError(_.a.FORMAT_ERROR,"Flv: Invalid HEVCDecoderConfigurationRecord");else if(this._naluLengthSize=1+(3&z.getUint8(21)),this._naluLengthSize===3||this._naluLengthSize===4){for(var Se=z.getUint8(22),we=0,Pe=23;we<Se;we++){var Ge=63&z.getUint8(Pe+0),it=z.getUint16(Pe+1,!G);Pe+=3;for(var Ie=0;Ie<it;Ie++){var rt=z.getUint16(Pe+0,!G);if(Ie===0)if(Ge===33){Pe+=2;var tt=new Uint8Array(v,w+Pe,rt),xe=S.a.parseSPS(tt);C.codecWidth=xe.codec_size.width,C.codecHeight=xe.codec_size.height,C.presentWidth=xe.present_size.width,C.presentHeight=xe.present_size.height,C.profile=xe.profile_string,C.level=xe.level_string,C.bitDepth=xe.bit_depth,C.chromaFormat=xe.chroma_format,C.sarRatio=xe.sar_ratio,C.frameRate=xe.frame_rate,xe.frame_rate.fixed!==!1&&xe.frame_rate.fps_num!==0&&xe.frame_rate.fps_den!==0||(C.frameRate=this._referenceFrameRate);var ht=C.frameRate.fps_den,_t=C.frameRate.fps_num;C.refSampleDuration=C.timescale*(ht/_t),C.codec=xe.codec_mimetype;var et=this._mediaInfo;et.width=C.codecWidth,et.height=C.codecHeight,et.fps=C.frameRate.fps,et.profile=C.profile,et.level=C.level,et.refFrames=xe.ref_frames,et.chromaFormat=xe.chroma_format_string,et.sarNum=C.sarRatio.width,et.sarDen=C.sarRatio.height,et.videoCodec=xe.codec_mimetype,et.hasAudio?et.audioCodec!=null&&(et.mimeType='video/x-flv; codecs="'+et.videoCodec+","+et.audioCodec+'"'):et.mimeType='video/x-flv; codecs="'+et.videoCodec+'"',et.isComplete()&&this._onMediaInfo(et),Pe+=rt}else Pe+=2+rt;else Pe+=2+rt}}C.hvcc=new Uint8Array(R),C.hvcc.set(new Uint8Array(v,w,R),0),d.a.v(this.TAG,"Parsed HEVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",C)}else this._onError(_.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: ".concat(this._naluLengthSize-1))}},A.prototype._parseAV1CodecConfigurationRecord=function(v,w,R){if(R<4)d.a.w(this.TAG,"Flv: Invalid AV1CodecConfigurationRecord, lack of data!");else{var C=this._videoMetadata,O=this._videoTrack,G=(this._littleEndian,new DataView(v,w,R));C?C.av1c!==void 0&&d.a.w(this.TAG,"Found another AV1CodecConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(C=this._videoMetadata={}).type="video",C.id=O.id,C.timescale=this._timescale,C.duration=this._duration);var z=127&G.getUint8(0);if(G.getUint8(1),G.getUint8(1),G.getUint8(2),z===1){var Y=P.a.parseOBUs(new Uint8Array(v,w+4,R-4));if(Y!=null){C.profile=Y.profile_string,C.level=Y.level_string,C.bitDepth=Y.bit_depth,C.chromaFormat=Y.chroma_format,C.frameRate=Y.frame_rate,Y.frame_rate.fixed!==!1&&Y.frame_rate.fps_num!==0&&Y.frame_rate.fps_den!==0||(C.frameRate=this._referenceFrameRate);var ie=C.frameRate.fps_den,se=C.frameRate.fps_num;C.refSampleDuration=C.timescale*(ie/se),C.codec=Y.codec_mimetype,C.extra=Y;var Se=this._mediaInfo;Se.fps=C.frameRate.fps,Se.profile=C.profile,Se.level=C.level,Se.refFrames=Y.ref_frames,Se.chromaFormat=Y.chroma_format_string,Se.videoCodec=Y.codec_mimetype,Se.hasAudio?Se.audioCodec!=null&&(Se.mimeType='video/x-flv; codecs="'+Se.videoCodec+","+Se.audioCodec+'"'):Se.mimeType='video/x-flv; codecs="'+Se.videoCodec+'"',Se.isComplete()&&this._onMediaInfo(Se),C.av1c=new Uint8Array(R),C.av1c.set(new Uint8Array(v,w,R),0),d.a.v(this.TAG,"Preparing AV1CodecConfigurationRecord")}else this._onError(_.a.FORMAT_ERROR,"Flv: Invalid AV1CodecConfigurationRecord")}else this._onError(_.a.FORMAT_ERROR,"Flv: Invalid AV1CodecConfigurationRecord")}},A.prototype._parseAVCVideoData=function(v,w,R,C,O,G,z){for(var Y=this._littleEndian,ie=new DataView(v,w,R),se=[],Se=0,we=0,Pe=this._naluLengthSize,Ge=this._timestampBase+C,it=G===1;we<R;){if(we+4>=R){d.a.w(this.TAG,"Malformed Nalu near timestamp ".concat(Ge,", offset = ").concat(we,", dataSize = ").concat(R));break}var Ie=ie.getUint32(we,!Y);if(Pe===3&&(Ie>>>=8),Ie>R-Pe)return void d.a.w(this.TAG,"Malformed Nalus near timestamp ".concat(Ge,", NaluSize > DataSize!"));var rt=31&ie.getUint8(we+Pe);rt===5&&(it=!0);var tt=new Uint8Array(v,w+we,Pe+Ie),xe={type:rt,data:tt};se.push(xe),Se+=tt.byteLength,we+=Pe+Ie}if(se.length){var ht=this._videoTrack,_t={units:se,length:Se,isKeyframe:it,dts:Ge,cts:z,pts:Ge+z};it&&(_t.fileposition=O),ht.samples.push(_t),ht.length+=Se}},A.prototype._parseHEVCVideoData=function(v,w,R,C,O,G,z){for(var Y=this._littleEndian,ie=new DataView(v,w,R),se=[],Se=0,we=0,Pe=this._naluLengthSize,Ge=this._timestampBase+C,it=G===1;we<R;){if(we+4>=R){d.a.w(this.TAG,"Malformed Nalu near timestamp ".concat(Ge,", offset = ").concat(we,", dataSize = ").concat(R));break}var Ie=ie.getUint32(we,!Y);if(Pe===3&&(Ie>>>=8),Ie>R-Pe)return void d.a.w(this.TAG,"Malformed Nalus near timestamp ".concat(Ge,", NaluSize > DataSize!"));var rt=ie.getUint8(we+Pe)>>1&63;rt!==19&&rt!==20&&rt!==21||(it=!0);var tt=new Uint8Array(v,w+we,Pe+Ie),xe={type:rt,data:tt};se.push(xe),Se+=tt.byteLength,we+=Pe+Ie}if(se.length){var ht=this._videoTrack,_t={units:se,length:Se,isKeyframe:it,dts:Ge,cts:z,pts:Ge+z};it&&(_t.fileposition=O),ht.samples.push(_t),ht.length+=Se}},A.prototype._parseAV1VideoData=function(v,w,R,C,O,G,z){this._littleEndian;var Y,ie=[],se=this._timestampBase+C,Se=G===1;if(Se){var we=this._videoMetadata,Pe=P.a.parseOBUs(new Uint8Array(v,w,R),we.extra);if(Pe==null)return void this._onError(_.a.FORMAT_ERROR,"Flv: Invalid AV1 VideoData");console.log(Pe),we.codecWidth=Pe.codec_size.width,we.codecHeight=Pe.codec_size.height,we.presentWidth=Pe.present_size.width,we.presentHeight=Pe.present_size.height,we.sarRatio=Pe.sar_ratio;var Ge=this._mediaInfo;Ge.width=we.codecWidth,Ge.height=we.codecHeight,Ge.sarNum=we.sarRatio.width,Ge.sarDen=we.sarRatio.height,d.a.v(this.TAG,"Parsed AV1DecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",we)}if(Y=R,ie.push({unitType:0,data:new Uint8Array(v,w+0,R)}),ie.length){var it=this._videoTrack,Ie={units:ie,length:Y,isKeyframe:Se,dts:se,cts:z,pts:se+z};Se&&(Ie.fileposition=O),it.samples.push(Ie),it.length+=Y}},A}(),I=i(14),F=function(A,v,w){for(var R,C=0,O=v.length;C<O;C++)!R&&C in v||(R||(R=Array.prototype.slice.call(v,0,C)),R[C]=v[C]);return A.concat(R||Array.prototype.slice.call(v))},V=function(){function A(){}return A.init=function(){for(var v in A.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],hvc1:[],hvcC:[],av01:[],av1C:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[],Opus:[],dOps:[],"ac-3":[],dac3:[],"ec-3":[],dec3:[],fLaC:[],dfLa:[]},A.types)A.types.hasOwnProperty(v)&&(A.types[v]=[v.charCodeAt(0),v.charCodeAt(1),v.charCodeAt(2),v.charCodeAt(3)]);var w=A.constants={};w.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),w.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),w.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),w.STSC=w.STCO=w.STTS,w.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),w.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),w.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),w.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),w.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),w.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},A.box=function(v){for(var w=8,R=null,C=Array.prototype.slice.call(arguments,1),O=C.length,G=0;G<O;G++)w+=C[G].byteLength;(R=new Uint8Array(w))[0]=w>>>24&255,R[1]=w>>>16&255,R[2]=w>>>8&255,R[3]=255&w,R.set(v,4);var z=8;for(G=0;G<O;G++)R.set(C[G],z),z+=C[G].byteLength;return R},A.generateInitSegment=function(v){var w=A.box(A.types.ftyp,A.constants.FTYP),R=A.moov(v),C=new Uint8Array(w.byteLength+R.byteLength);return C.set(w,0),C.set(R,w.byteLength),C},A.moov=function(v){var w=A.mvhd(v.timescale,v.duration),R=A.trak(v),C=A.mvex(v);return A.box(A.types.moov,w,R,C)},A.mvhd=function(v,w){return A.box(A.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,255&v,w>>>24&255,w>>>16&255,w>>>8&255,255&w,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},A.trak=function(v){return A.box(A.types.trak,A.tkhd(v),A.mdia(v))},A.tkhd=function(v){var w=v.id,R=v.duration,C=v.presentWidth,O=v.presentHeight;return A.box(A.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,w>>>24&255,w>>>16&255,w>>>8&255,255&w,0,0,0,0,R>>>24&255,R>>>16&255,R>>>8&255,255&R,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,C>>>8&255,255&C,0,0,O>>>8&255,255&O,0,0]))},A.mdia=function(v){return A.box(A.types.mdia,A.mdhd(v),A.hdlr(v),A.minf(v))},A.mdhd=function(v){var w=v.timescale,R=v.duration;return A.box(A.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,w>>>24&255,w>>>16&255,w>>>8&255,255&w,R>>>24&255,R>>>16&255,R>>>8&255,255&R,85,196,0,0]))},A.hdlr=function(v){var w=null;return w=v.type==="audio"?A.constants.HDLR_AUDIO:A.constants.HDLR_VIDEO,A.box(A.types.hdlr,w)},A.minf=function(v){var w=null;return w=v.type==="audio"?A.box(A.types.smhd,A.constants.SMHD):A.box(A.types.vmhd,A.constants.VMHD),A.box(A.types.minf,w,A.dinf(),A.stbl(v))},A.dinf=function(){return A.box(A.types.dinf,A.box(A.types.dref,A.constants.DREF))},A.stbl=function(v){return A.box(A.types.stbl,A.stsd(v),A.box(A.types.stts,A.constants.STTS),A.box(A.types.stsc,A.constants.STSC),A.box(A.types.stsz,A.constants.STSZ),A.box(A.types.stco,A.constants.STCO))},A.stsd=function(v){return v.type==="audio"?v.codec==="mp3"?A.box(A.types.stsd,A.constants.STSD_PREFIX,A.mp3(v)):v.codec==="ac-3"?A.box(A.types.stsd,A.constants.STSD_PREFIX,A.ac3(v)):v.codec==="ec-3"?A.box(A.types.stsd,A.constants.STSD_PREFIX,A.ec3(v)):v.codec==="opus"?A.box(A.types.stsd,A.constants.STSD_PREFIX,A.Opus(v)):v.codec=="flac"?A.box(A.types.stsd,A.constants.STSD_PREFIX,A.fLaC(v)):A.box(A.types.stsd,A.constants.STSD_PREFIX,A.mp4a(v)):v.type==="video"&&v.codec.startsWith("hvc1")?A.box(A.types.stsd,A.constants.STSD_PREFIX,A.hvc1(v)):v.type==="video"&&v.codec.startsWith("av01")?A.box(A.types.stsd,A.constants.STSD_PREFIX,A.av01(v)):A.box(A.types.stsd,A.constants.STSD_PREFIX,A.avc1(v))},A.mp3=function(v){var w=v.channelCount,R=v.audioSampleRate,C=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,w,0,16,0,0,0,0,R>>>8&255,255&R,0,0]);return A.box(A.types[".mp3"],C)},A.mp4a=function(v){var w=v.channelCount,R=v.audioSampleRate,C=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,w,0,16,0,0,0,0,R>>>8&255,255&R,0,0]);return A.box(A.types.mp4a,C,A.esds(v))},A.ac3=function(v){var w=v.channelCount,R=v.audioSampleRate,C=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,w,0,16,0,0,0,0,R>>>8&255,255&R,0,0]);return A.box(A.types["ac-3"],C,A.box(A.types.dac3,new Uint8Array(v.config)))},A.ec3=function(v){var w=v.channelCount,R=v.audioSampleRate,C=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,w,0,16,0,0,0,0,R>>>8&255,255&R,0,0]);return A.box(A.types["ec-3"],C,A.box(A.types.dec3,new Uint8Array(v.config)))},A.esds=function(v){var w=v.config||[],R=w.length,C=new Uint8Array([0,0,0,0,3,23+R,0,1,0,4,15+R,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([R]).concat(w).concat([6,1,2]));return A.box(A.types.esds,C)},A.Opus=function(v){var w=v.channelCount,R=v.audioSampleRate,C=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,w,0,16,0,0,0,0,R>>>8&255,255&R,0,0]);return A.box(A.types.Opus,C,A.dOps(v))},A.dOps=function(v){var w=v.channelCount,R=v.channelConfigCode,C=v.audioSampleRate;if(v.config)return A.box(A.types.dOps,v.config);var O=[];switch(R){case 1:case 2:O=[0];break;case 0:O=[255,1,1,0,1];break;case 128:O=[255,2,0,0,1];break;case 3:O=[1,2,1,0,2,1];break;case 4:O=[1,2,2,0,1,2,3];break;case 5:O=[1,3,2,0,4,1,2,3];break;case 6:O=[1,4,2,0,4,1,2,3,5];break;case 7:O=[1,4,2,0,4,1,2,3,5,6];break;case 8:O=[1,5,3,0,6,1,2,3,4,5,7];break;case 130:O=[1,1,2,0,1];break;case 131:O=[1,1,3,0,1,2];break;case 132:O=[1,1,4,0,1,2,3];break;case 133:O=[1,1,5,0,1,2,3,4];break;case 134:O=[1,1,6,0,1,2,3,4,5];break;case 135:O=[1,1,7,0,1,2,3,4,5,6];break;case 136:O=[1,1,8,0,1,2,3,4,5,6,7]}var G=new Uint8Array(F([0,w,0,0,C>>>24&255,C>>>17&255,C>>>8&255,C>>>0&255,0,0],O));return A.box(A.types.dOps,G)},A.fLaC=function(v){var w=v.channelCount,R=Math.min(v.audioSampleRate,65535),C=v.sampleSize,O=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,w,0,C,0,0,0,0,R>>>8&255,255&R,0,0]);return A.box(A.types.fLaC,O,A.dfLa(v))},A.dfLa=function(v){var w=new Uint8Array(F([0,0,0,0],v.config));return A.box(A.types.dfLa,w)},A.avc1=function(v){var w=v.avcc,R=v.codecWidth,C=v.codecHeight,O=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,R>>>8&255,255&R,C>>>8&255,255&C,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return A.box(A.types.avc1,O,A.box(A.types.avcC,w))},A.hvc1=function(v){var w=v.hvcc,R=v.codecWidth,C=v.codecHeight,O=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,R>>>8&255,255&R,C>>>8&255,255&C,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return A.box(A.types.hvc1,O,A.box(A.types.hvcC,w))},A.av01=function(v){var w=v.av1c,R=v.codecWidth||192,C=v.codecHeight||108,O=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,R>>>8&255,255&R,C>>>8&255,255&C,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return A.box(A.types.av01,O,A.box(A.types.av1C,w))},A.mvex=function(v){return A.box(A.types.mvex,A.trex(v))},A.trex=function(v){var w=v.id,R=new Uint8Array([0,0,0,0,w>>>24&255,w>>>16&255,w>>>8&255,255&w,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return A.box(A.types.trex,R)},A.moof=function(v,w){return A.box(A.types.moof,A.mfhd(v.sequenceNumber),A.traf(v,w))},A.mfhd=function(v){var w=new Uint8Array([0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,255&v]);return A.box(A.types.mfhd,w)},A.traf=function(v,w){var R=v.id,C=A.box(A.types.tfhd,new Uint8Array([0,0,0,0,R>>>24&255,R>>>16&255,R>>>8&255,255&R])),O=A.box(A.types.tfdt,new Uint8Array([0,0,0,0,w>>>24&255,w>>>16&255,w>>>8&255,255&w])),G=A.sdtp(v),z=A.trun(v,G.byteLength+16+16+8+16+8+8);return A.box(A.types.traf,C,O,z,G)},A.sdtp=function(v){for(var w=v.samples||[],R=w.length,C=new Uint8Array(4+R),O=0;O<R;O++){var G=w[O].flags;C[O+4]=G.isLeading<<6|G.dependsOn<<4|G.isDependedOn<<2|G.hasRedundancy}return A.box(A.types.sdtp,C)},A.trun=function(v,w){var R=v.samples||[],C=R.length,O=12+16*C,G=new Uint8Array(O);w+=8+O,G.set([0,0,15,1,C>>>24&255,C>>>16&255,C>>>8&255,255&C,w>>>24&255,w>>>16&255,w>>>8&255,255&w],0);for(var z=0;z<C;z++){var Y=R[z].duration,ie=R[z].size,se=R[z].flags,Se=R[z].cts;G.set([Y>>>24&255,Y>>>16&255,Y>>>8&255,255&Y,ie>>>24&255,ie>>>16&255,ie>>>8&255,255&ie,se.isLeading<<2|se.dependsOn,se.isDependedOn<<6|se.hasRedundancy<<4|se.isNonSync,0,0,Se>>>24&255,Se>>>16&255,Se>>>8&255,255&Se],12+16*z)}return A.box(A.types.trun,G)},A.mdat=function(v){return A.box(A.types.mdat,v)},A}();V.init();var ne=V,te=function(){function A(){}return A.getSilentFrame=function(v,w){if(v==="mp4a.40.2"){if(w===1)return new Uint8Array([0,200,0,128,35,128]);if(w===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(w===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(w===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(w===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(w===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(w===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(w===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(w===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},A}(),Z=i(12),Q=function(){function A(v){this.TAG="MP4Remuxer",this._config=v,this._isLive=v.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new Z.c("audio"),this._videoSegmentInfoList=new Z.c("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!u.a.chrome||!(u.a.version.major<50||u.a.version.major===50&&u.a.version.build<2661)),this._fillSilentAfterSeek=u.a.msedge||u.a.msie,this._mp3UseMpegAudio=!u.a.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return A.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},A.prototype.bindDataSource=function(v){return v.onDataAvailable=this.remux.bind(this),v.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(A.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(v){this._onInitSegment=v},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(v){this._onMediaSegment=v},enumerable:!1,configurable:!0}),A.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},A.prototype.seek=function(v){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},A.prototype.remux=function(v,w,R){if(R===void 0&&(R=!1),!this._onMediaSegment)throw new f.a("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(v,w),w&&this._remuxVideo(w,R),v&&this._remuxAudio(v,R)},A.prototype._onTrackMetadataReceived=function(v,w){var R=null,C="mp4",O=w.codec;if(v==="audio")this._audioMeta=w,w.codec==="mp3"&&this._mp3UseMpegAudio?(C="mpeg",O="",R=new Uint8Array):R=ne.generateInitSegment(w);else{if(v!=="video")return;this._videoMeta=w,R=ne.generateInitSegment(w)}if(!this._onInitSegment)throw new f.a("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(v,{type:v,data:R.buffer,codec:O,container:"".concat(v,"/").concat(C),mediaDuration:w.duration})},A.prototype._calculateDtsBase=function(v,w){this._dtsBaseInited||(v&&v.samples&&v.samples.length&&(this._audioDtsBase=v.samples[0].dts),w&&w.samples&&w.samples.length&&(this._videoDtsBase=w.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},A.prototype.getTimestampBase=function(){if(this._dtsBaseInited)return this._dtsBase},A.prototype.flushStashedSamples=function(){var v=this._videoStashedLastSample,w=this._audioStashedLastSample,R={type:"video",id:1,sequenceNumber:0,samples:[],length:0};v!=null&&(R.samples.push(v),R.length=v.length);var C={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};w!=null&&(C.samples.push(w),C.length=w.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(R,!0),this._remuxAudio(C,!0)},A.prototype._remuxAudio=function(v,w){if(this._audioMeta!=null){var R,C=v,O=C.samples,G=void 0,z=-1,Y=this._audioMeta.refSampleDuration,ie=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,se=this._dtsBaseInited&&this._audioNextDts===void 0,Se=!1;if((O&&O.length!==0||w&&this._audioStashedLastSample!=null)&&(O.length!==1||w)){var we=0,Pe=null,Ge=0;ie?(we=0,Ge=C.length):(we=8,Ge=8+C.length);var it=null;if(O.length>1&&!w&&(Ge-=(it=O.pop()).length),this._audioStashedLastSample!=null){var Ie=this._audioStashedLastSample;this._audioStashedLastSample=null,O.unshift(Ie),Ge+=Ie.length}it!=null&&(this._audioStashedLastSample=it);var rt=O[0].dts-this._dtsBase;if(this._audioNextDts)G=rt-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())G=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(Se=!0);else{var tt=this._audioSegmentInfoList.getLastSampleBefore(rt);if(tt!=null){var xe=rt-(tt.originalDts+tt.duration);xe<=3&&(xe=0),G=rt-(tt.dts+tt.duration+xe)}else G=0}if(Se){var ht=rt-G,_t=this._videoSegmentInfoList.getLastSegmentBefore(rt);if(_t!=null&&_t.beginDts<ht){if(gt=te.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var et=_t.beginDts,Ve=ht-_t.beginDts;d.a.v(this.TAG,"InsertPrefixSilentAudio: dts: ".concat(et,", duration: ").concat(Ve)),O.unshift({unit:gt,dts:et,pts:et}),Ge+=gt.byteLength}}else Se=!1}for(var fe=[],be=0;be<O.length;be++){var Ue=(Ie=O[be]).unit,ge=Ie.dts-this._dtsBase,Je=(et=ge,!1),ut=null,st=0;if(!(ge<-.001)){if(this._audioMeta.codec!=="mp3"&&Y!=null){var We=ge;if(this._audioNextDts&&(We=this._audioNextDts),(G=ge-We)<=-3*Y){d.a.w(this.TAG,"Dropping 1 audio frame (originalDts: ".concat(ge," ms ,curRefDts: ").concat(We," ms)  due to dtsCorrection: ").concat(G," ms overlap."));continue}if(G>=3*Y&&this._fillAudioTimestampGap&&!u.a.safari){Je=!0;var gt,X=Math.floor(G/Y);d.a.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+"originalDts: ".concat(ge," ms, curRefDts: ").concat(We," ms, ")+"dtsCorrection: ".concat(Math.round(G)," ms, generate: ").concat(X," frames")),et=Math.floor(We),st=Math.floor(We+Y)-et,(gt=te.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))==null&&(d.a.w(this.TAG,"Unable to generate silent frame for "+"".concat(this._audioMeta.originalCodec," with ").concat(this._audioMeta.channelCount," channels, repeat last frame")),gt=Ue),ut=[];for(var re=0;re<X;re++){We+=Y;var K=Math.floor(We),j=Math.floor(We+Y)-K,oe={dts:K,pts:K,cts:0,unit:gt,size:gt.byteLength,duration:j,originalDts:ge,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};ut.push(oe),Ge+=oe.size}this._audioNextDts=We+Y}else et=Math.floor(We),st=Math.floor(We+Y)-et,this._audioNextDts=We+Y}else et=ge-G,be!==O.length-1?st=O[be+1].dts-this._dtsBase-G-et:it!=null?st=it.dts-this._dtsBase-G-et:st=fe.length>=1?fe[fe.length-1].duration:Math.floor(Y),this._audioNextDts=et+st;z===-1&&(z=et),fe.push({dts:et,pts:et,cts:0,unit:Ie.unit,size:Ie.unit.byteLength,duration:st,originalDts:ge,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),Je&&fe.push.apply(fe,ut)}}if(fe.length===0)return C.samples=[],void(C.length=0);for(ie?Pe=new Uint8Array(Ge):((Pe=new Uint8Array(Ge))[0]=Ge>>>24&255,Pe[1]=Ge>>>16&255,Pe[2]=Ge>>>8&255,Pe[3]=255&Ge,Pe.set(ne.types.mdat,4)),be=0;be<fe.length;be++)Ue=fe[be].unit,Pe.set(Ue,we),we+=Ue.byteLength;var _e=fe[fe.length-1];R=_e.dts+_e.duration;var ae=new Z.b;ae.beginDts=z,ae.endDts=R,ae.beginPts=z,ae.endPts=R,ae.originalBeginDts=fe[0].originalDts,ae.originalEndDts=_e.originalDts+_e.duration,ae.firstSample=new Z.d(fe[0].dts,fe[0].pts,fe[0].duration,fe[0].originalDts,!1),ae.lastSample=new Z.d(_e.dts,_e.pts,_e.duration,_e.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(ae),C.samples=fe,C.sequenceNumber++;var Te=null;Te=ie?new Uint8Array:ne.moof(C,z),C.samples=[],C.length=0;var Ee={type:"audio",data:this._mergeBoxes(Te,Pe).buffer,sampleCount:fe.length,info:ae};ie&&se&&(Ee.timestampOffset=z),this._onMediaSegment("audio",Ee)}}},A.prototype._remuxVideo=function(v,w){if(this._videoMeta!=null){var R,C,O=v,G=O.samples,z=void 0,Y=-1,ie=-1;if(G&&G.length!==0){if(G.length!==1||w){var se=8,Se=null,we=8+v.length,Pe=null;if(G.length>1&&!w&&(we-=(Pe=G.pop()).length),this._videoStashedLastSample!=null){var Ge=this._videoStashedLastSample;this._videoStashedLastSample=null,G.unshift(Ge),we+=Ge.length}Pe!=null&&(this._videoStashedLastSample=Pe);var it=G[0].dts-this._dtsBase;if(this._videoNextDts)z=it-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())z=0;else{var Ie=this._videoSegmentInfoList.getLastSampleBefore(it);if(Ie!=null){var rt=it-(Ie.originalDts+Ie.duration);rt<=3&&(rt=0),z=it-(Ie.dts+Ie.duration+rt)}else z=0}for(var tt=new Z.b,xe=[],ht=0;ht<G.length;ht++){var _t=(Ge=G[ht]).dts-this._dtsBase,et=Ge.isKeyframe,Ve=_t-z,fe=Ge.cts,be=Ve+fe;Y===-1&&(Y=Ve,ie=be);var Ue=0;if(ht!==G.length-1?Ue=G[ht+1].dts-this._dtsBase-z-Ve:Pe!=null?Ue=Pe.dts-this._dtsBase-z-Ve:Ue=xe.length>=1?xe[xe.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),et){var ge=new Z.d(Ve,be,Ue,Ge.dts,!0);ge.fileposition=Ge.fileposition,tt.appendSyncPoint(ge)}xe.push({dts:Ve,pts:be,cts:fe,units:Ge.units,size:Ge.length,isKeyframe:et,duration:Ue,originalDts:_t,flags:{isLeading:0,dependsOn:et?2:1,isDependedOn:et?1:0,hasRedundancy:0,isNonSync:et?0:1}})}for((Se=new Uint8Array(we))[0]=we>>>24&255,Se[1]=we>>>16&255,Se[2]=we>>>8&255,Se[3]=255&we,Se.set(ne.types.mdat,4),ht=0;ht<xe.length;ht++)for(var Je=xe[ht].units;Je.length;){var ut=Je.shift().data;Se.set(ut,se),se+=ut.byteLength}var st=xe[xe.length-1];if(R=st.dts+st.duration,C=st.pts+st.duration,this._videoNextDts=R,tt.beginDts=Y,tt.endDts=R,tt.beginPts=ie,tt.endPts=C,tt.originalBeginDts=xe[0].originalDts,tt.originalEndDts=st.originalDts+st.duration,tt.firstSample=new Z.d(xe[0].dts,xe[0].pts,xe[0].duration,xe[0].originalDts,xe[0].isKeyframe),tt.lastSample=new Z.d(st.dts,st.pts,st.duration,st.originalDts,st.isKeyframe),this._isLive||this._videoSegmentInfoList.append(tt),O.samples=xe,O.sequenceNumber++,this._forceFirstIDR){var We=xe[0].flags;We.dependsOn=2,We.isNonSync=0}var gt=ne.moof(O,Y);O.samples=[],O.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(gt,Se).buffer,sampleCount:xe.length,info:tt})}}else!w||this._videoStashedLastSample}},A.prototype._mergeBoxes=function(v,w){var R=new Uint8Array(v.byteLength+w.byteLength);return R.set(v,0),R.set(w,v.byteLength),R},A}(),he=i(17),de=i(1),M=(i(2),function(){function A(v,w){this.TAG="TransmuxingController",this._emitter=new r.a,this._config=w,v.segments||(v.segments=[{duration:v.duration,filesize:v.filesize,url:v.url}]),typeof v.cors!="boolean"&&(v.cors=!0),typeof v.withCredentials!="boolean"&&(v.withCredentials=!1),this._mediaDataSource=v,this._currentSegmentIndex=0;var R=0;this._mediaDataSource.segments.forEach(function(C){C.timestampBase=R,R+=C.duration,C.cors=v.cors,C.withCredentials=v.withCredentials,w.referrerPolicy&&(C.referrerPolicy=w.referrerPolicy)}),isNaN(R)||this._mediaDataSource.duration===R||(this._mediaDataSource.duration=R),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return A.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},A.prototype.on=function(v,w){this._emitter.addListener(v,w)},A.prototype.off=function(v,w){this._emitter.removeListener(v,w)},A.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},A.prototype._loadSegment=function(v,w){this._currentSegmentIndex=v;var R=this._mediaDataSource.segments[v],C=this._ioctl=new he.a(R,this._config,v);C.onError=this._onIOException.bind(this),C.onSeeked=this._onIOSeeked.bind(this),C.onComplete=this._onIOComplete.bind(this),C.onRedirect=this._onIORedirect.bind(this),C.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),w?this._demuxer.bindDataSource(this._ioctl):C.onDataArrival=this._onInitChunkArrival.bind(this),C.open(w)},A.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},A.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},A.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},A.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},A.prototype.seek=function(v){if(this._mediaInfo!=null&&this._mediaInfo.isSeekable()){var w=this._searchSegmentIndexContains(v);if(w===this._currentSegmentIndex){var R=this._mediaInfo.segments[w];if(R==null)this._pendingSeekTime=v;else{var C=R.getNearestKeyframe(v);this._remuxer.seek(C.milliseconds),this._ioctl.seek(C.fileposition),this._pendingResolveSeekPoint=C.milliseconds}}else{var O=this._mediaInfo.segments[w];O==null?(this._pendingSeekTime=v,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(w)):(C=O.getNearestKeyframe(v),this._internalAbort(),this._remuxer.seek(v),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[w].timestampBase,this._loadSegment(w,C.fileposition),this._pendingResolveSeekPoint=C.milliseconds,this._reportSegmentMediaInfo(w))}this._enableStatisticsReporter()}},A.prototype._searchSegmentIndexContains=function(v){for(var w=this._mediaDataSource.segments,R=w.length-1,C=0;C<w.length;C++)if(v<w[C].timestampBase){R=C-1;break}return R},A.prototype._onInitChunkArrival=function(v,w){var R=this,C=0;if(w>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,C=this._demuxer.parseChunks(v,w);else{var O=null;(O=k.probe(v)).match&&(this._setupFLVDemuxerRemuxer(O),C=this._demuxer.parseChunks(v,w)),O.match||O.needMoreData||(O=I.a.probe(v)).match&&(this._setupTSDemuxerRemuxer(O),C=this._demuxer.parseChunks(v,w)),O.match||O.needMoreData||(O=null,d.a.e(this.TAG,"Non MPEG-TS/FLV, Unsupported media type!"),Promise.resolve().then(function(){R._internalAbort()}),this._emitter.emit(de.a.DEMUX_ERROR,_.a.FORMAT_UNSUPPORTED,"Non MPEG-TS/FLV, Unsupported media type!"))}return C},A.prototype._setupFLVDemuxerRemuxer=function(v){this._demuxer=new k(v,this._config),this._remuxer||(this._remuxer=new Q(this._config));var w=this._mediaDataSource;w.duration==null||isNaN(w.duration)||(this._demuxer.overridedDuration=w.duration),typeof w.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=w.hasAudio),typeof w.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=w.hasVideo),this._demuxer.timestampBase=w.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},A.prototype._setupTSDemuxerRemuxer=function(v){var w=this._demuxer=new I.a(v,this._config);this._remuxer||(this._remuxer=new Q(this._config)),w.onError=this._onDemuxException.bind(this),w.onMediaInfo=this._onMediaInfo.bind(this),w.onMetaDataArrived=this._onMetaDataArrived.bind(this),w.onTimedID3Metadata=this._onTimedID3Metadata.bind(this),w.onSynchronousKLVMetadata=this._onSynchronousKLVMetadata.bind(this),w.onAsynchronousKLVMetadata=this._onAsynchronousKLVMetadata.bind(this),w.onSMPTE2038Metadata=this._onSMPTE2038Metadata.bind(this),w.onSCTE35Metadata=this._onSCTE35Metadata.bind(this),w.onPESPrivateDataDescriptor=this._onPESPrivateDataDescriptor.bind(this),w.onPESPrivateData=this._onPESPrivateData.bind(this),this._remuxer.bindDataSource(this._demuxer),this._demuxer.bindDataSource(this._ioctl),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},A.prototype._onMediaInfo=function(v){var w=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},v),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,c.a.prototype));var R=Object.assign({},v);Object.setPrototypeOf(R,c.a.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=R,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var C=w._pendingSeekTime;w._pendingSeekTime=null,w.seek(C)})},A.prototype._onMetaDataArrived=function(v){this._emitter.emit(de.a.METADATA_ARRIVED,v)},A.prototype._onScriptDataArrived=function(v){this._emitter.emit(de.a.SCRIPTDATA_ARRIVED,v)},A.prototype._onTimedID3Metadata=function(v){var w=this._remuxer.getTimestampBase();w!=null&&(v.pts!=null&&(v.pts-=w),v.dts!=null&&(v.dts-=w),this._emitter.emit(de.a.TIMED_ID3_METADATA_ARRIVED,v))},A.prototype._onSynchronousKLVMetadata=function(v){var w=this._remuxer.getTimestampBase();w!=null&&(v.pts!=null&&(v.pts-=w),v.dts!=null&&(v.dts-=w),this._emitter.emit(de.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,v))},A.prototype._onAsynchronousKLVMetadata=function(v){this._emitter.emit(de.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,v)},A.prototype._onSMPTE2038Metadata=function(v){var w=this._remuxer.getTimestampBase();w!=null&&(v.pts!=null&&(v.pts-=w),v.dts!=null&&(v.dts-=w),v.nearest_pts!=null&&(v.nearest_pts-=w),this._emitter.emit(de.a.SMPTE2038_METADATA_ARRIVED,v))},A.prototype._onSCTE35Metadata=function(v){var w=this._remuxer.getTimestampBase();w!=null&&(v.pts!=null&&(v.pts-=w),v.nearest_pts!=null&&(v.nearest_pts-=w),this._emitter.emit(de.a.SCTE35_METADATA_ARRIVED,v))},A.prototype._onPESPrivateDataDescriptor=function(v){this._emitter.emit(de.a.PES_PRIVATE_DATA_DESCRIPTOR,v)},A.prototype._onPESPrivateData=function(v){var w=this._remuxer.getTimestampBase();w!=null&&(v.pts!=null&&(v.pts-=w),v.nearest_pts!=null&&(v.nearest_pts-=w),v.dts!=null&&(v.dts-=w),this._emitter.emit(de.a.PES_PRIVATE_DATA_ARRIVED,v))},A.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},A.prototype._onIOComplete=function(v){var w=v+1;w<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer&&this._remuxer.flushStashedSamples(),this._loadSegment(w)):(this._remuxer&&this._remuxer.flushStashedSamples(),this._emitter.emit(de.a.LOADING_COMPLETE),this._disableStatisticsReporter())},A.prototype._onIORedirect=function(v){var w=this._ioctl.extraData;this._mediaDataSource.segments[w].redirectedURL=v},A.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(de.a.RECOVERED_EARLY_EOF)},A.prototype._onIOException=function(v,w){d.a.e(this.TAG,"IOException: type = ".concat(v,", code = ").concat(w.code,", msg = ").concat(w.msg)),this._emitter.emit(de.a.IO_ERROR,v,w),this._disableStatisticsReporter()},A.prototype._onDemuxException=function(v,w){d.a.e(this.TAG,"DemuxException: type = ".concat(v,", info = ").concat(w)),this._emitter.emit(de.a.DEMUX_ERROR,v,w)},A.prototype._onRemuxerInitSegmentArrival=function(v,w){this._emitter.emit(de.a.INIT_SEGMENT,v,w)},A.prototype._onRemuxerMediaSegmentArrival=function(v,w){if(this._pendingSeekTime==null&&(this._emitter.emit(de.a.MEDIA_SEGMENT,v,w),this._pendingResolveSeekPoint!=null&&v==="video")){var R=w.info.syncPoints,C=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,u.a.safari&&R.length>0&&R[0].originalDts===C&&(C=R[0].pts),this._emitter.emit(de.a.RECOMMEND_SEEKPOINT,C)}},A.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},A.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},A.prototype._reportSegmentMediaInfo=function(v){var w=this._mediaInfo.segments[v],R=Object.assign({},w);R.duration=this._mediaInfo.duration,R.segmentCount=this._mediaInfo.segmentCount,delete R.segments,delete R.keyframesIndex,this._emitter.emit(de.a.MEDIA_INFO,R)},A.prototype._reportStatisticsInfo=function(){var v={};v.url=this._ioctl.currentURL,v.hasRedirect=this._ioctl.hasRedirect,v.hasRedirect&&(v.redirectedURL=this._ioctl.currentRedirectedURL),v.speed=this._ioctl.currentSpeed,v.loaderType=this._ioctl.loaderType,v.currentSegmentIndex=this._currentSegmentIndex,v.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(de.a.STATISTICS_INFO,v)},A}());n.a=M},function(t,n,i){var s=function(){function r(){}return r.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(d,u){return d.__proto__=u,d},Object.assign=Object.assign||function(d){if(d==null)throw new TypeError("Cannot convert undefined or null to object");for(var u=Object(d),c=1;c<arguments.length;c++){var l=arguments[c];if(l!=null)for(var h in l)l.hasOwnProperty(h)&&(u[h]=l[h])}return u},String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(d,u){var c=u>0?0|u:0;return this.substring(c,c+d.length)===d}}),typeof self.Promise!="function"&&i(26).polyfill()},r}();s.install(),n.a=s},function(t,n,i){function s(c){var l={};function h(f){if(l[f])return l[f].exports;var p=l[f]={i:f,l:!1,exports:{}};return c[f].call(p.exports,p,p.exports,h),p.l=!0,p.exports}h.m=c,h.c=l,h.i=function(f){return f},h.d=function(f,p,m){h.o(f,p)||Object.defineProperty(f,p,{configurable:!1,enumerable:!0,get:m})},h.r=function(f){Object.defineProperty(f,"__esModule",{value:!0})},h.n=function(f){var p=f&&f.__esModule?function(){return f.default}:function(){return f};return h.d(p,"a",p),p},h.o=function(f,p){return Object.prototype.hasOwnProperty.call(f,p)},h.p="/",h.oe=function(f){throw console.error(f),f};var o=h(h.s=ENTRY_MODULE);return o.default||o}function r(c){return(c+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function d(c,l,h){var o={};o[h]=[];var f=l.toString(),p=f.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!p)return o;for(var m,y=p[1],_=new RegExp("(\\\\n|\\W)"+r(y)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");m=_.exec(f);)m[3]!=="dll-reference"&&o[h].push(m[3]);for(_=new RegExp("\\("+r(y)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");m=_.exec(f);)c[m[2]]||(o[h].push(m[1]),c[m[2]]=i(m[1]).m),o[m[2]]=o[m[2]]||[],o[m[2]].push(m[4]);for(var S,b=Object.keys(o),x=0;x<b.length;x++)for(var L=0;L<o[b[x]].length;L++)S=o[b[x]][L],isNaN(1*S)||(o[b[x]][L]=1*o[b[x]][L]);return o}function u(c){return Object.keys(c).reduce(function(l,h){return l||c[h].length>0},!1)}t.exports=function(c,l){l=l||{};var h={main:i.m},o=l.all?{main:Object.keys(h.main)}:function(_,S){for(var b={main:[S]},x={main:[]},L={main:{}};u(b);)for(var N=Object.keys(b),P=0;P<N.length;P++){var T=N[P],k=b[T].pop();if(L[T]=L[T]||{},!L[T][k]&&_[T][k]){L[T][k]=!0,x[T]=x[T]||[],x[T].push(k);for(var I=d(_,_[T][k],T),F=Object.keys(I),V=0;V<F.length;V++)b[F[V]]=b[F[V]]||[],b[F[V]]=b[F[V]].concat(I[F[V]])}}return x}(h,c),f="";Object.keys(o).filter(function(_){return _!=="main"}).forEach(function(_){for(var S=0;o[_][S];)S++;o[_].push(S),h[_][S]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",f=f+"var "+_+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(S))+")({"+o[_].map(function(b){return JSON.stringify(b)+": "+h[_][b].toString()}).join(",")+`});
`}),f=f+"new (("+s.toString().replace("ENTRY_MODULE",JSON.stringify(c))+")({"+o.main.map(function(_){return JSON.stringify(_)+": "+h.main[_].toString()}).join(",")+"}))(self);";var p=new self.Blob([f],{type:"text/javascript"});if(l.bare)return p;var m=(self.URL||self.webkitURL||self.mozURL||self.msURL).createObjectURL(p),y=new self.Worker(m);return y.objectURL=m,y}},function(t,n,i){var s=i(10),r=i.n(s),d=i(0),u=i(5),c=i(7),l=i(3),h=function(){function o(f){this.TAG="MSEController",this._config=f,this._emitter=new r.a,this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onStartStreaming:this._onStartStreaming.bind(this),onEndStreaming:this._onEndStreaming.bind(this),onQualityChange:this._onQualityChange.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._useManagedMediaSource="ManagedMediaSource"in self&&!("MediaSource"in self),this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElementProxy=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]}}return o.prototype.destroy=function(){this._mediaSource&&this.shutdown(),this._mediaSourceObjectURL&&this.revokeObjectURL(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},o.prototype.on=function(f,p){this._emitter.addListener(f,p)},o.prototype.off=function(f,p){this._emitter.removeListener(f,p)},o.prototype.initialize=function(f){if(this._mediaSource)throw new l.a("MediaSource has been attached to an HTMLMediaElement!");this._useManagedMediaSource&&d.a.v(this.TAG,"Using ManagedMediaSource");var p=this._mediaSource=this._useManagedMediaSource?new self.ManagedMediaSource:new self.MediaSource;p.addEventListener("sourceopen",this.e.onSourceOpen),p.addEventListener("sourceended",this.e.onSourceEnded),p.addEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(p.addEventListener("startstreaming",this.e.onStartStreaming),p.addEventListener("endstreaming",this.e.onEndStreaming),p.addEventListener("qualitychange",this.e.onQualityChange)),this._mediaElementProxy=f},o.prototype.shutdown=function(){if(this._mediaSource){var f=this._mediaSource;for(var p in this._sourceBuffers){var m=this._pendingSegments[p];m.splice(0,m.length),this._pendingSegments[p]=null,this._pendingRemoveRanges[p]=null,this._lastInitSegments[p]=null;var y=this._sourceBuffers[p];if(y){if(f.readyState!=="closed"){try{f.removeSourceBuffer(y)}catch(_){d.a.e(this.TAG,_.message)}y.removeEventListener("error",this.e.onSourceBufferError),y.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[p]=null,this._sourceBuffers[p]=null}}if(f.readyState==="open")try{f.endOfStream()}catch(_){d.a.e(this.TAG,_.message)}this._mediaElementProxy=null,f.removeEventListener("sourceopen",this.e.onSourceOpen),f.removeEventListener("sourceended",this.e.onSourceEnded),f.removeEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(f.removeEventListener("startstreaming",this.e.onStartStreaming),f.removeEventListener("endstreaming",this.e.onEndStreaming),f.removeEventListener("qualitychange",this.e.onQualityChange)),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._mediaSource=null}},o.prototype.isManagedMediaSource=function(){return this._useManagedMediaSource},o.prototype.getObject=function(){if(!this._mediaSource)throw new l.a("MediaSource has not been initialized yet!");return this._mediaSource},o.prototype.getHandle=function(){if(!this._mediaSource)throw new l.a("MediaSource has not been initialized yet!");return this._mediaSource.handle},o.prototype.getObjectURL=function(){if(!this._mediaSource)throw new l.a("MediaSource has not been initialized yet!");return this._mediaSourceObjectURL==null&&(this._mediaSourceObjectURL=URL.createObjectURL(this._mediaSource)),this._mediaSourceObjectURL},o.prototype.revokeObjectURL=function(){this._mediaSourceObjectURL&&(URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},o.prototype.appendInitSegment=function(f,p){if(p===void 0&&(p=void 0),!this._mediaSource||this._mediaSource.readyState!=="open"||this._mediaSource.streaming===!1)return this._pendingSourceBufferInit.push(f),void this._pendingSegments[f.type].push(f);var m=f,y="".concat(m.container);m.codec&&m.codec.length>0&&(m.codec==="opus"&&u.a.safari&&(m.codec="Opus"),y+=";codecs=".concat(m.codec));var _=!1;if(d.a.v(this.TAG,"Received Initialization Segment, mimeType: "+y),this._lastInitSegments[m.type]=m,y!==this._mimeTypes[m.type]){if(this._mimeTypes[m.type])d.a.v(this.TAG,"Notice: ".concat(m.type," mimeType changed, origin: ").concat(this._mimeTypes[m.type],", target: ").concat(y));else{_=!0;try{var S=this._sourceBuffers[m.type]=this._mediaSource.addSourceBuffer(y);S.addEventListener("error",this.e.onSourceBufferError),S.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(b){return d.a.e(this.TAG,b.message),void this._emitter.emit(c.a.ERROR,{code:b.code,msg:b.message})}}this._mimeTypes[m.type]=y}p||this._pendingSegments[m.type].push(m),_||this._sourceBuffers[m.type]&&!this._sourceBuffers[m.type].updating&&this._doAppendSegments(),u.a.safari&&m.container==="audio/mpeg"&&m.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=m.mediaDuration/1e3,this._updateMediaSourceDuration())},o.prototype.appendMediaSegment=function(f){var p=f;this._pendingSegments[p.type].push(p),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var m=this._sourceBuffers[p.type];!m||m.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},o.prototype.flush=function(){for(var f in this._sourceBuffers)if(this._sourceBuffers[f]){var p=this._sourceBuffers[f];if(this._mediaSource.readyState==="open")try{p.abort()}catch(x){d.a.e(this.TAG,x.message)}var m=this._pendingSegments[f];if(m.splice(0,m.length),this._mediaSource.readyState!=="closed"){for(var y=0;y<p.buffered.length;y++){var _=p.buffered.start(y),S=p.buffered.end(y);this._pendingRemoveRanges[f].push({start:_,end:S})}if(p.updating||this._doRemoveRanges(),u.a.safari){var b=this._lastInitSegments[f];b&&(this._pendingSegments[f].push(b),p.updating||this._doAppendSegments())}}}},o.prototype.endOfStream=function(){var f=this._mediaSource,p=this._sourceBuffers;f&&f.readyState==="open"?p.video&&p.video.updating||p.audio&&p.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,f.endOfStream()):f&&f.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},o.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var f=this._mediaElementProxy.getCurrentTime();for(var p in this._sourceBuffers){var m=this._sourceBuffers[p];if(m){var y=m.buffered;if(y.length>=1&&f-y.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},o.prototype._doCleanupSourceBuffer=function(){var f=this._mediaElementProxy.getCurrentTime();for(var p in this._sourceBuffers){var m=this._sourceBuffers[p];if(m){for(var y=m.buffered,_=!1,S=0;S<y.length;S++){var b=y.start(S),x=y.end(S);if(b<=f&&f<x+3){if(f-b>=this._config.autoCleanupMaxBackwardDuration){_=!0;var L=f-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[p].push({start:b,end:L})}}else x<f&&(_=!0,this._pendingRemoveRanges[p].push({start:b,end:x}))}_&&!m.updating&&this._doRemoveRanges()}}},o.prototype._updateMediaSourceDuration=function(){var f=this._sourceBuffers;if(this._mediaElementProxy.getReadyState()!==0&&this._mediaSource.readyState==="open"&&!(f.video&&f.video.updating||f.audio&&f.audio.updating)){var p=this._mediaSource.duration,m=this._pendingMediaDuration;m>0&&(isNaN(p)||m>p)&&(d.a.v(this.TAG,"Update MediaSource duration from ".concat(p," to ").concat(m)),this._mediaSource.duration=m),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},o.prototype._doRemoveRanges=function(){for(var f in this._pendingRemoveRanges)if(this._sourceBuffers[f]&&!this._sourceBuffers[f].updating)for(var p=this._sourceBuffers[f],m=this._pendingRemoveRanges[f];m.length&&!p.updating;){var y=m.shift();p.remove(y.start,y.end)}},o.prototype._doAppendSegments=function(){var f=this._pendingSegments;for(var p in f)if(this._sourceBuffers[p]&&!this._sourceBuffers[p].updating&&this._mediaSource.streaming!==!1&&f[p].length>0){var m=f[p].shift();if(typeof m.timestampOffset=="number"&&isFinite(m.timestampOffset)){var y=this._sourceBuffers[p].timestampOffset,_=m.timestampOffset/1e3;Math.abs(y-_)>.1&&(d.a.v(this.TAG,"Update MPEG audio timestampOffset from ".concat(y," to ").concat(_)),this._sourceBuffers[p].timestampOffset=_),delete m.timestampOffset}if(!m.data||m.data.byteLength===0)continue;try{this._sourceBuffers[p].appendBuffer(m.data),this._isBufferFull=!1}catch(S){this._pendingSegments[p].unshift(m),S.code===22?(this._isBufferFull||this._emitter.emit(c.a.BUFFER_FULL),this._isBufferFull=!0):(d.a.e(this.TAG,S.message),this._emitter.emit(c.a.ERROR,{code:S.code,msg:S.message}))}}},o.prototype._onSourceOpen=function(){if(d.a.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var f=this._pendingSourceBufferInit;f.length;){var p=f.shift();this.appendInitSegment(p,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(c.a.SOURCE_OPEN)},o.prototype._onStartStreaming=function(){d.a.v(this.TAG,"ManagedMediaSource onStartStreaming"),this._emitter.emit(c.a.START_STREAMING)},o.prototype._onEndStreaming=function(){d.a.v(this.TAG,"ManagedMediaSource onEndStreaming"),this._emitter.emit(c.a.END_STREAMING)},o.prototype._onQualityChange=function(){d.a.v(this.TAG,"ManagedMediaSource onQualityChange")},o.prototype._onSourceEnded=function(){d.a.v(this.TAG,"MediaSource onSourceEnded")},o.prototype._onSourceClose=function(){d.a.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(this._mediaSource.removeEventListener("startstreaming",this.e.onStartStreaming),this._mediaSource.removeEventListener("endstreaming",this.e.onEndStreaming),this._mediaSource.removeEventListener("qualitychange",this.e.onQualityChange)))},o.prototype._hasPendingSegments=function(){var f=this._pendingSegments;return f.video.length>0||f.audio.length>0},o.prototype._hasPendingRemoveRanges=function(){var f=this._pendingRemoveRanges;return f.video.length>0||f.audio.length>0},o.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(c.a.UPDATE_END)},o.prototype._onSourceBufferError=function(f){d.a.e(this.TAG,"SourceBuffer Error: ".concat(f))},o}();n.a=h},function(t,n,i){var s=i(10),r=i.n(s),d=i(20),u=i.n(d),c=i(0),l=i(9),h=i(18),o=i(1),f=(i(24),i(13)),p=i(14),m=function(){function y(_,S){if(this.TAG="Transmuxer",this._emitter=new r.a,S.enableWorker&&typeof Worker<"u")try{this._worker=u()(24),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[_,S]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},l.a.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:l.a.getConfig()})}catch{c.a.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new h.a(_,S)}else this._controller=new h.a(_,S);if(this._controller){var b=this._controller;b.on(o.a.IO_ERROR,this._onIOError.bind(this)),b.on(o.a.DEMUX_ERROR,this._onDemuxError.bind(this)),b.on(o.a.INIT_SEGMENT,this._onInitSegment.bind(this)),b.on(o.a.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),b.on(o.a.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),b.on(o.a.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),b.on(o.a.MEDIA_INFO,this._onMediaInfo.bind(this)),b.on(o.a.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),b.on(o.a.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),b.on(o.a.TIMED_ID3_METADATA_ARRIVED,this._onTimedID3MetadataArrived.bind(this)),b.on(o.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,this._onSynchronousKLVMetadataArrived.bind(this)),b.on(o.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,this._onAsynchronousKLVMetadataArrived.bind(this)),b.on(o.a.SMPTE2038_METADATA_ARRIVED,this._onSMPTE2038MetadataArrived.bind(this)),b.on(o.a.SCTE35_METADATA_ARRIVED,this._onSCTE35MetadataArrived.bind(this)),b.on(o.a.PES_PRIVATE_DATA_DESCRIPTOR,this._onPESPrivateDataDescriptor.bind(this)),b.on(o.a.PES_PRIVATE_DATA_ARRIVED,this._onPESPrivateDataArrived.bind(this)),b.on(o.a.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),b.on(o.a.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return y.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),l.a.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},y.prototype.on=function(_,S){this._emitter.addListener(_,S)},y.prototype.off=function(_,S){this._emitter.removeListener(_,S)},y.prototype.hasWorker=function(){return this._worker!=null},y.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},y.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},y.prototype.seek=function(_){this._worker?this._worker.postMessage({cmd:"seek",param:_}):this._controller.seek(_)},y.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},y.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},y.prototype.switchPrimaryAudio=function(){this._worker?this._worker.postMessage({cmd:"switch_audio",param:"primary"}):this._controller._demuxer instanceof p.a&&(this._controller._demuxer.preferred_secondary_audio=!1)},y.prototype.switchSecondaryAudio=function(){this._worker?this._worker.postMessage({cmd:"switch_audio",param:"secondary"}):this._controller._demuxer instanceof p.a&&(this._controller._demuxer.preferred_secondary_audio=!0)},y.prototype._onInitSegment=function(_,S){var b=this;Promise.resolve().then(function(){b._emitter.emit(o.a.INIT_SEGMENT,_,S)})},y.prototype._onMediaSegment=function(_,S){var b=this;Promise.resolve().then(function(){b._emitter.emit(o.a.MEDIA_SEGMENT,_,S)})},y.prototype._onLoadingComplete=function(){var _=this;Promise.resolve().then(function(){_._emitter.emit(o.a.LOADING_COMPLETE)})},y.prototype._onRecoveredEarlyEof=function(){var _=this;Promise.resolve().then(function(){_._emitter.emit(o.a.RECOVERED_EARLY_EOF)})},y.prototype._onMediaInfo=function(_){var S=this;Promise.resolve().then(function(){S._emitter.emit(o.a.MEDIA_INFO,_)})},y.prototype._onMetaDataArrived=function(_){var S=this;Promise.resolve().then(function(){S._emitter.emit(o.a.METADATA_ARRIVED,_)})},y.prototype._onScriptDataArrived=function(_){var S=this;Promise.resolve().then(function(){S._emitter.emit(o.a.SCRIPTDATA_ARRIVED,_)})},y.prototype._onTimedID3MetadataArrived=function(_){var S=this;Promise.resolve().then(function(){S._emitter.emit(o.a.TIMED_ID3_METADATA_ARRIVED,_)})},y.prototype._onSynchronousKLVMetadataArrived=function(_){var S=this;Promise.resolve().then(function(){S._emitter.emit(o.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,_)})},y.prototype._onAsynchronousKLVMetadataArrived=function(_){var S=this;Promise.resolve().then(function(){S._emitter.emit(o.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,_)})},y.prototype._onSMPTE2038MetadataArrived=function(_){var S=this;Promise.resolve().then(function(){S._emitter.emit(o.a.SMPTE2038_METADATA_ARRIVED,_)})},y.prototype._onSCTE35MetadataArrived=function(_){var S=this;Promise.resolve().then(function(){S._emitter.emit(o.a.SCTE35_METADATA_ARRIVED,_)})},y.prototype._onPESPrivateDataDescriptor=function(_){var S=this;Promise.resolve().then(function(){S._emitter.emit(o.a.PES_PRIVATE_DATA_DESCRIPTOR,_)})},y.prototype._onPESPrivateDataArrived=function(_){var S=this;Promise.resolve().then(function(){S._emitter.emit(o.a.PES_PRIVATE_DATA_ARRIVED,_)})},y.prototype._onStatisticsInfo=function(_){var S=this;Promise.resolve().then(function(){S._emitter.emit(o.a.STATISTICS_INFO,_)})},y.prototype._onIOError=function(_,S){var b=this;Promise.resolve().then(function(){b._emitter.emit(o.a.IO_ERROR,_,S)})},y.prototype._onDemuxError=function(_,S){var b=this;Promise.resolve().then(function(){b._emitter.emit(o.a.DEMUX_ERROR,_,S)})},y.prototype._onRecommendSeekpoint=function(_){var S=this;Promise.resolve().then(function(){S._emitter.emit(o.a.RECOMMEND_SEEKPOINT,_)})},y.prototype._onLoggingConfigChanged=function(_){this._worker&&this._worker.postMessage({cmd:"logging_config",param:_})},y.prototype._onWorkerMessage=function(_){var S=_.data,b=S.data;if(S.msg==="destroyed"||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(S.msg){case o.a.INIT_SEGMENT:case o.a.MEDIA_SEGMENT:this._emitter.emit(S.msg,b.type,b.data);break;case o.a.LOADING_COMPLETE:case o.a.RECOVERED_EARLY_EOF:this._emitter.emit(S.msg);break;case o.a.MEDIA_INFO:Object.setPrototypeOf(b,f.a.prototype),this._emitter.emit(S.msg,b);break;case o.a.METADATA_ARRIVED:case o.a.SCRIPTDATA_ARRIVED:case o.a.TIMED_ID3_METADATA_ARRIVED:case o.a.SYNCHRONOUS_KLV_METADATA_ARRIVED:case o.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED:case o.a.SMPTE2038_METADATA_ARRIVED:case o.a.SCTE35_METADATA_ARRIVED:case o.a.PES_PRIVATE_DATA_DESCRIPTOR:case o.a.PES_PRIVATE_DATA_ARRIVED:case o.a.STATISTICS_INFO:this._emitter.emit(S.msg,b);break;case o.a.IO_ERROR:case o.a.DEMUX_ERROR:this._emitter.emit(S.msg,b.type,b.info);break;case o.a.RECOMMEND_SEEKPOINT:this._emitter.emit(S.msg,b);break;case"logcat_callback":c.a.emitter.emit("log",b.type,b.logcat)}},y}();n.a=m},function(t,n,i){var s=i(8),r=function(){function d(){}return d._ebsp2rbsp=function(u){for(var c=u,l=c.byteLength,h=new Uint8Array(l),o=0,f=0;f<l;f++)f>=2&&c[f]===3&&c[f-1]===0&&c[f-2]===0||(h[o]=c[f],o++);return new Uint8Array(h.buffer,0,o)},d.parseSPS=function(u){for(var c=u.subarray(1,4),l="avc1.",h=0;h<3;h++){var o=c[h].toString(16);o.length<2&&(o="0"+o),l+=o}var f=d._ebsp2rbsp(u),p=new s.a(f);p.readByte();var m=p.readByte();p.readByte();var y=p.readByte();p.readUEG();var _=d.getProfileString(m),S=d.getLevelString(y),b=1,x=420,L=8,N=8;if((m===100||m===110||m===122||m===244||m===44||m===83||m===86||m===118||m===128||m===138||m===144)&&((b=p.readUEG())===3&&p.readBits(1),b<=3&&(x=[0,420,422,444][b]),L=p.readUEG()+8,N=p.readUEG()+8,p.readBits(1),p.readBool()))for(var P=b!==3?8:12,T=0;T<P;T++)p.readBool()&&(T<6?d._skipScalingList(p,16):d._skipScalingList(p,64));p.readUEG();var k=p.readUEG();if(k===0)p.readUEG();else if(k===1){p.readBits(1),p.readSEG(),p.readSEG();var I=p.readUEG();for(T=0;T<I;T++)p.readSEG()}var F=p.readUEG();p.readBits(1);var V=p.readUEG(),ne=p.readUEG(),te=p.readBits(1);te===0&&p.readBits(1),p.readBits(1);var Z=0,Q=0,he=0,de=0;p.readBool()&&(Z=p.readUEG(),Q=p.readUEG(),he=p.readUEG(),de=p.readUEG());var M=1,A=1,v=0,w=!0,R=0,C=0;if(p.readBool()){if(p.readBool()){var O=p.readByte();O>0&&O<16?(M=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][O-1],A=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][O-1]):O===255&&(M=p.readByte()<<8|p.readByte(),A=p.readByte()<<8|p.readByte())}if(p.readBool()&&p.readBool(),p.readBool()&&(p.readBits(4),p.readBool()&&p.readBits(24)),p.readBool()&&(p.readUEG(),p.readUEG()),p.readBool()){var G=p.readBits(32),z=p.readBits(32);w=p.readBool(),v=(R=z)/(C=2*G)}}var Y=1;M===1&&A===1||(Y=M/A);var ie=0,se=0;b===0?(ie=1,se=2-te):(ie=b===3?1:2,se=(b===1?2:1)*(2-te));var Se=16*(V+1),we=16*(ne+1)*(2-te);Se-=(Z+Q)*ie,we-=(he+de)*se;var Pe=Math.ceil(Se*Y);return p.destroy(),p=null,{codec_mimetype:l,profile_idc:m,level_idc:y,profile_string:_,level_string:S,chroma_format_idc:b,bit_depth:L,bit_depth_luma:L,bit_depth_chroma:N,ref_frames:F,chroma_format:x,chroma_format_string:d.getChromaFormatString(x),frame_rate:{fixed:w,fps:v,fps_den:C,fps_num:R},sar_ratio:{width:M,height:A},codec_size:{width:Se,height:we},present_size:{width:Pe,height:we}}},d._skipScalingList=function(u,c){for(var l=8,h=8,o=0;o<c;o++)h!==0&&(h=(l+u.readSEG()+256)%256),l=h===0?l:h},d.getProfileString=function(u){switch(u){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},d.getLevelString=function(u){return(u/10).toFixed(1)},d.getChromaFormatString=function(u){switch(u){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},d}();n.a=r},function(t,n,i){i.r(n),i(0);var s=i(9),r=i(19),d=i(18),u=i(1),c=i(14);n.default=function(l){var h=null,o=(function(Z,Q){l.postMessage({msg:"logcat_callback",data:{type:Z,logcat:Q}})}).bind(this);function f(Z,Q){var he={msg:u.a.INIT_SEGMENT,data:{type:Z,data:Q}};l.postMessage(he,[Q.data])}function p(Z,Q){var he={msg:u.a.MEDIA_SEGMENT,data:{type:Z,data:Q}};l.postMessage(he,[Q.data])}function m(){var Z={msg:u.a.LOADING_COMPLETE};l.postMessage(Z)}function y(){var Z={msg:u.a.RECOVERED_EARLY_EOF};l.postMessage(Z)}function _(Z){var Q={msg:u.a.MEDIA_INFO,data:Z};l.postMessage(Q)}function S(Z){var Q={msg:u.a.METADATA_ARRIVED,data:Z};l.postMessage(Q)}function b(Z){var Q={msg:u.a.SCRIPTDATA_ARRIVED,data:Z};l.postMessage(Q)}function x(Z){var Q={msg:u.a.TIMED_ID3_METADATA_ARRIVED,data:Z};l.postMessage(Q)}function L(Z){var Q={msg:u.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,data:Z};l.postMessage(Q)}function N(Z){var Q={msg:u.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,data:Z};l.postMessage(Q)}function P(Z){var Q={msg:u.a.SMPTE2038_METADATA_ARRIVED,data:Z};l.postMessage(Q)}function T(Z){var Q={msg:u.a.SCTE35_METADATA_ARRIVED,data:Z};l.postMessage(Q)}function k(Z){var Q={msg:u.a.PES_PRIVATE_DATA_DESCRIPTOR,data:Z};l.postMessage(Q)}function I(Z){var Q={msg:u.a.PES_PRIVATE_DATA_ARRIVED,data:Z};l.postMessage(Q)}function F(Z){var Q={msg:u.a.STATISTICS_INFO,data:Z};l.postMessage(Q)}function V(Z,Q){l.postMessage({msg:u.a.IO_ERROR,data:{type:Z,info:Q}})}function ne(Z,Q){l.postMessage({msg:u.a.DEMUX_ERROR,data:{type:Z,info:Q}})}function te(Z){l.postMessage({msg:u.a.RECOMMEND_SEEKPOINT,data:Z})}r.a.install(),l.addEventListener("message",function(Z){switch(Z.data.cmd){case"init":(h=new d.a(Z.data.param[0],Z.data.param[1])).on(u.a.IO_ERROR,V.bind(this)),h.on(u.a.DEMUX_ERROR,ne.bind(this)),h.on(u.a.INIT_SEGMENT,f.bind(this)),h.on(u.a.MEDIA_SEGMENT,p.bind(this)),h.on(u.a.LOADING_COMPLETE,m.bind(this)),h.on(u.a.RECOVERED_EARLY_EOF,y.bind(this)),h.on(u.a.MEDIA_INFO,_.bind(this)),h.on(u.a.METADATA_ARRIVED,S.bind(this)),h.on(u.a.SCRIPTDATA_ARRIVED,b.bind(this)),h.on(u.a.TIMED_ID3_METADATA_ARRIVED,x.bind(this)),h.on(u.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,L.bind(this)),h.on(u.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,N.bind(this)),h.on(u.a.SMPTE2038_METADATA_ARRIVED,P.bind(this)),h.on(u.a.SCTE35_METADATA_ARRIVED,T.bind(this)),h.on(u.a.PES_PRIVATE_DATA_DESCRIPTOR,k.bind(this)),h.on(u.a.PES_PRIVATE_DATA_ARRIVED,I.bind(this)),h.on(u.a.STATISTICS_INFO,F.bind(this)),h.on(u.a.RECOMMEND_SEEKPOINT,te.bind(this));break;case"destroy":h&&(h.destroy(),h=null),l.postMessage({msg:"destroyed"});break;case"start":h.start();break;case"stop":h.stop();break;case"seek":h.seek(Z.data.param);break;case"pause":h.pause();break;case"resume":h.resume();break;case"logging_config":var Q=Z.data.param;s.a.applyConfig(Q),Q.enableCallback===!0?s.a.addLogListener(o):s.a.removeLogListener(o);break;case"switch_audio":h._demuxer instanceof c.a&&(Z.data.param==="primary"?h._demuxer.preferred_secondary_audio=!1:Z.data.param==="secondary"&&(h._demuxer.preferred_secondary_audio=!0))}})}},function(t,n,i){t.exports=i(30).default},function(t,n,i){(function(s,r){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var d;d=function(){function u(z){return typeof z=="function"}var c=Array.isArray?Array.isArray:function(z){return Object.prototype.toString.call(z)==="[object Array]"},l=0,h=void 0,o=void 0,f=function(z,Y){x[l]=z,x[l+1]=Y,(l+=2)===2&&(o?o(L):I())},p=typeof window<"u"?window:void 0,m=p||{},y=m.MutationObserver||m.WebKitMutationObserver,_=typeof self>"u"&&s!==void 0&&{}.toString.call(s)==="[object process]",S=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function b(){var z=setTimeout;return function(){return z(L,1)}}var x=new Array(1e3);function L(){for(var z=0;z<l;z+=2)(0,x[z])(x[z+1]),x[z]=void 0,x[z+1]=void 0;l=0}var N,P,T,k,I=void 0;function F(z,Y){var ie=this,se=new this.constructor(te);se[ne]===void 0&&C(se);var Se=ie._state;if(Se){var we=arguments[Se-1];f(function(){return w(Se,se,we,ie._result)})}else A(ie,se,z,Y);return se}function V(z){if(z&&typeof z=="object"&&z.constructor===this)return z;var Y=new this(te);return Q(Y,z),Y}_?I=function(){return s.nextTick(L)}:y?(P=0,T=new y(L),k=document.createTextNode(""),T.observe(k,{characterData:!0}),I=function(){k.data=P=++P%2}):S?((N=new MessageChannel).port1.onmessage=L,I=function(){return N.port2.postMessage(0)}):I=p===void 0?function(){try{var z=Function("return this")().require("vertx");return(h=z.runOnLoop||z.runOnContext)!==void 0?function(){h(L)}:b()}catch{return b()}}():b();var ne=Math.random().toString(36).substring(2);function te(){}function Z(z,Y,ie){Y.constructor===z.constructor&&ie===F&&Y.constructor.resolve===V?function(se,Se){Se._state===1?de(se,Se._result):Se._state===2?M(se,Se._result):A(Se,void 0,function(we){return Q(se,we)},function(we){return M(se,we)})}(z,Y):ie===void 0?de(z,Y):u(ie)?function(se,Se,we){f(function(Pe){var Ge=!1,it=function(Ie,rt,tt,xe){try{Ie.call(rt,tt,xe)}catch(ht){return ht}}(we,Se,function(Ie){Ge||(Ge=!0,Se!==Ie?Q(Pe,Ie):de(Pe,Ie))},function(Ie){Ge||(Ge=!0,M(Pe,Ie))},Pe._label);!Ge&&it&&(Ge=!0,M(Pe,it))},se)}(z,Y,ie):de(z,Y)}function Q(z,Y){if(z===Y)M(z,new TypeError("You cannot resolve a promise with itself"));else if(Se=typeof(se=Y),se===null||Se!=="object"&&Se!=="function")de(z,Y);else{var ie=void 0;try{ie=Y.then}catch(we){return void M(z,we)}Z(z,Y,ie)}var se,Se}function he(z){z._onerror&&z._onerror(z._result),v(z)}function de(z,Y){z._state===void 0&&(z._result=Y,z._state=1,z._subscribers.length!==0&&f(v,z))}function M(z,Y){z._state===void 0&&(z._state=2,z._result=Y,f(he,z))}function A(z,Y,ie,se){var Se=z._subscribers,we=Se.length;z._onerror=null,Se[we]=Y,Se[we+1]=ie,Se[we+2]=se,we===0&&z._state&&f(v,z)}function v(z){var Y=z._subscribers,ie=z._state;if(Y.length!==0){for(var se=void 0,Se=void 0,we=z._result,Pe=0;Pe<Y.length;Pe+=3)se=Y[Pe],Se=Y[Pe+ie],se?w(ie,se,Se,we):Se(we);z._subscribers.length=0}}function w(z,Y,ie,se){var Se=u(ie),we=void 0,Pe=void 0,Ge=!0;if(Se){try{we=ie(se)}catch(it){Ge=!1,Pe=it}if(Y===we)return void M(Y,new TypeError("A promises callback cannot return that same promise."))}else we=se;Y._state!==void 0||(Se&&Ge?Q(Y,we):Ge===!1?M(Y,Pe):z===1?de(Y,we):z===2&&M(Y,we))}var R=0;function C(z){z[ne]=R++,z._state=void 0,z._result=void 0,z._subscribers=[]}var O=function(){function z(Y,ie){this._instanceConstructor=Y,this.promise=new Y(te),this.promise[ne]||C(this.promise),c(ie)?(this.length=ie.length,this._remaining=ie.length,this._result=new Array(this.length),this.length===0?de(this.promise,this._result):(this.length=this.length||0,this._enumerate(ie),this._remaining===0&&de(this.promise,this._result))):M(this.promise,new Error("Array Methods must be provided an Array"))}return z.prototype._enumerate=function(Y){for(var ie=0;this._state===void 0&&ie<Y.length;ie++)this._eachEntry(Y[ie],ie)},z.prototype._eachEntry=function(Y,ie){var se=this._instanceConstructor,Se=se.resolve;if(Se===V){var we=void 0,Pe=void 0,Ge=!1;try{we=Y.then}catch(Ie){Ge=!0,Pe=Ie}if(we===F&&Y._state!==void 0)this._settledAt(Y._state,ie,Y._result);else if(typeof we!="function")this._remaining--,this._result[ie]=Y;else if(se===G){var it=new se(te);Ge?M(it,Pe):Z(it,Y,we),this._willSettleAt(it,ie)}else this._willSettleAt(new se(function(Ie){return Ie(Y)}),ie)}else this._willSettleAt(Se(Y),ie)},z.prototype._settledAt=function(Y,ie,se){var Se=this.promise;Se._state===void 0&&(this._remaining--,Y===2?M(Se,se):this._result[ie]=se),this._remaining===0&&de(Se,this._result)},z.prototype._willSettleAt=function(Y,ie){var se=this;A(Y,void 0,function(Se){return se._settledAt(1,ie,Se)},function(Se){return se._settledAt(2,ie,Se)})},z}(),G=function(){function z(Y){this[ne]=R++,this._result=this._state=void 0,this._subscribers=[],te!==Y&&(typeof Y!="function"&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof z?function(ie,se){try{se(function(Se){Q(ie,Se)},function(Se){M(ie,Se)})}catch(Se){M(ie,Se)}}(this,Y):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return z.prototype.catch=function(Y){return this.then(null,Y)},z.prototype.finally=function(Y){var ie=this.constructor;return u(Y)?this.then(function(se){return ie.resolve(Y()).then(function(){return se})},function(se){return ie.resolve(Y()).then(function(){throw se})}):this.then(Y,Y)},z}();return G.prototype.then=F,G.all=function(z){return new O(this,z).promise},G.race=function(z){var Y=this;return c(z)?new Y(function(ie,se){for(var Se=z.length,we=0;we<Se;we++)Y.resolve(z[we]).then(ie,se)}):new Y(function(ie,se){return se(new TypeError("You must pass an array to race."))})},G.resolve=V,G.reject=function(z){var Y=new this(te);return M(Y,z),Y},G._setScheduler=function(z){o=z},G._setAsap=function(z){f=z},G._asap=f,G.polyfill=function(){var z=void 0;if(r!==void 0)z=r;else if(typeof self<"u")z=self;else try{z=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var Y=z.Promise;if(Y){var ie=null;try{ie=Object.prototype.toString.call(Y.resolve())}catch{}if(ie==="[object Promise]"&&!Y.cast)return}z.Promise=G},G.Promise=G,G},t.exports=d()}).call(this,i(27),i(28))},function(t,n){var i,s,r=t.exports={};function d(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function c(S){if(i===setTimeout)return setTimeout(S,0);if((i===d||!i)&&setTimeout)return i=setTimeout,setTimeout(S,0);try{return i(S,0)}catch{try{return i.call(null,S,0)}catch{return i.call(this,S,0)}}}(function(){try{i=typeof setTimeout=="function"?setTimeout:d}catch{i=d}try{s=typeof clearTimeout=="function"?clearTimeout:u}catch{s=u}})();var l,h=[],o=!1,f=-1;function p(){o&&l&&(o=!1,l.length?h=l.concat(h):f=-1,h.length&&m())}function m(){if(!o){var S=c(p);o=!0;for(var b=h.length;b;){for(l=h,h=[];++f<b;)l&&l[f].run();f=-1,b=h.length}l=null,o=!1,function(x){if(s===clearTimeout)return clearTimeout(x);if((s===u||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(x);try{s(x)}catch{try{return s.call(null,x)}catch{return s.call(this,x)}}}(S)}}function y(S,b){this.fun=S,this.array=b}function _(){}r.nextTick=function(S){var b=new Array(arguments.length-1);if(arguments.length>1)for(var x=1;x<arguments.length;x++)b[x-1]=arguments[x];h.push(new y(S,b)),h.length!==1||o||c(m)},y.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=_,r.addListener=_,r.once=_,r.off=_,r.removeListener=_,r.removeAllListeners=_,r.emit=_,r.prependListener=_,r.prependOnceListener=_,r.listeners=function(S){return[]},r.binding=function(S){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(S){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,n){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch{typeof window=="object"&&(i=window)}t.exports=i},function(t,n,i){i.r(n);var s=i(0),r=i(9),d=i(3),u=i(7),c=i(21),l=i(22),h=i(1),o=i(4),f=i(11);n.default=function(p){var m="PlayerEngineWorker",y=(function(M,A){p.postMessage({msg:"logcat_callback",type:M,logcat:A})}).bind(void 0),_=null,S=null,b=null,x=null,L=!1,N=!1,P=0,T=0,k=!1;function I(){b&&(b.shutdown(),b.destroy(),b=null)}function F(){if(_==null||S==null)throw new d.a("Worker not initialized");if(x)throw new d.a("Transmuxer has been initialized");N||(!S.deferLoadAfterSourceOpen||L?((x=new l.a(_,S)).on(h.a.INIT_SEGMENT,function(M,A){b.appendInitSegment(A)}),x.on(h.a.MEDIA_SEGMENT,function(M,A){b.appendMediaSegment(A),p.postMessage({msg:"buffered_position_changed",buffered_position_milliseconds:A.info.endDts})}),x.on(h.a.LOADING_COMPLETE,function(){b.endOfStream(),p.postMessage({msg:"player_event",event:o.a.LOADING_COMPLETE})}),x.on(h.a.RECOVERED_EARLY_EOF,function(){p.postMessage({msg:"player_event",event:o.a.RECOVERED_EARLY_EOF})}),x.on(h.a.IO_ERROR,function(M,A){p.postMessage({msg:"player_event",event:o.a.ERROR,error_type:f.b.NETWORK_ERROR,error_detail:M,info:A})}),x.on(h.a.DEMUX_ERROR,function(M,A){p.postMessage({msg:"player_event",event:o.a.ERROR,error_type:f.b.MEDIA_ERROR,error_detail:M,info:A})}),x.on(h.a.MEDIA_INFO,function(M){he(h.a.MEDIA_INFO,M)}),x.on(h.a.STATISTICS_INFO,function(M){he(h.a.STATISTICS_INFO,M)}),x.on(h.a.RECOMMEND_SEEKPOINT,function(M){(function(A){p.postMessage({msg:"transmuxing_event",event:h.a.RECOMMEND_SEEKPOINT,milliseconds:A})})(M)}),x.on(h.a.METADATA_ARRIVED,function(M){de(o.a.METADATA_ARRIVED,M)}),x.on(h.a.SCRIPTDATA_ARRIVED,function(M){de(o.a.SCRIPTDATA_ARRIVED,M)}),x.on(h.a.TIMED_ID3_METADATA_ARRIVED,function(M){de(o.a.TIMED_ID3_METADATA_ARRIVED,M)}),x.on(h.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,function(M){de(o.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,M)}),x.on(h.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,function(M){de(o.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,M)}),x.on(h.a.SMPTE2038_METADATA_ARRIVED,function(M){de(o.a.SMPTE2038_METADATA_ARRIVED,M)}),x.on(h.a.SCTE35_METADATA_ARRIVED,function(M){de(o.a.SCTE35_METADATA_ARRIVED,M)}),x.on(h.a.PES_PRIVATE_DATA_DESCRIPTOR,function(M){de(o.a.PES_PRIVATE_DATA_DESCRIPTOR,M)}),x.on(h.a.PES_PRIVATE_DATA_ARRIVED,function(M){de(o.a.PES_PRIVATE_DATA_ARRIVED,M)}),x.open()):N=!0)}function V(){b&&b.flush(),x&&(x.close(),x.destroy(),x=null)}function ne(){L=!0,N&&(N=!1,F())}function te(){p.postMessage({msg:"mse_event",event:u.a.UPDATE_END})}function Z(){s.a.v(m,"MSE SourceBuffer is full, report to main thread"),p.postMessage({msg:"mse_event",event:u.a.BUFFER_FULL})}function Q(M){p.postMessage({msg:"player_event",event:o.a.ERROR,error_type:f.b.MEDIA_ERROR,error_detail:f.b.MEDIA_MSE_ERROR,info:M})}function he(M,A){p.postMessage({msg:"transmuxing_event",event:M,info:A})}function de(M,A){p.postMessage({msg:"player_event",event:M,extraData:A})}p.addEventListener("message",function(M){if(!k){var A=M.data;switch(A.cmd){case"logging_config":var v=A;r.a.applyConfig(v.logging_config),v.logging_config.enableCallback===!0?r.a.addLogListener(y):r.a.removeLogListener(y);break;case"init":_=(v=A).media_data_source,S=v.config;break;case"destroy":(function(){x&&V(),b&&I(),k=!0,p.postMessage({msg:"destroyed"})})();break;case"initialize_mse":(function(){s.a.v(m,"Initializing MediaSource in DedicatedWorker"),(b=new c.a(S)).on(u.a.SOURCE_OPEN,ne.bind(this)),b.on(u.a.UPDATE_END,te.bind(this)),b.on(u.a.BUFFER_FULL,Z.bind(this)),b.on(u.a.ERROR,Q.bind(this)),b.initialize({getCurrentTime:function(){return P},getReadyState:function(){return T}});var w=b.getHandle();p.postMessage({msg:"mse_init",handle:w},[w])})();break;case"shutdown_mse":I();break;case"load":F();break;case"unload":V();break;case"unbuffered_seek":v=A,b.flush(),x.seek(v.milliseconds);break;case"timeupdate":P=(v=A).current_time;break;case"readystatechange":T=(v=A).ready_state;break;case"pause_transmuxer":x.pause();break;case"resume_transmuxer":x.resume();break;case"switch_audio":(v=A).audio_track==="primary"?x.switchPrimaryAudio():v.audio_track==="secondary"&&x.switchSecondaryAudio()}}})}},function(t,n,i){i.r(n);var s=i(19),r=i(17),d={enableWorker:!1,enableWorkerForMSE:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,liveBufferLatencyChasing:!1,liveBufferLatencyChasingOnPaused:!1,liveBufferLatencyMaxLatency:1.5,liveBufferLatencyMinRemain:.5,liveSync:!1,liveSyncMaxLatency:1.2,liveSyncTargetLatency:.8,liveSyncPlaybackRate:1.2,liveSyncMinLatency:void 0,liveSyncMinPlaybackRate:.95,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function u(){return Object.assign({},d)}var c=i(10),l=i.n(c),h=i(20),o=i(0),f=i(9),p=i(7),m=i(4),y=i(1),_=i(5),S=i(12),b=function(){function M(A,v,w){this.TAG="SeekingHandler",this._config=null,this._media_element=null,this._always_seek_keyframe=!1,this._on_unbuffered_seek=null,this._request_set_current_time=!1,this._seek_request_record_clocktime=null,this._idr_sample_list=new S.a,this.e=null,this._config=A,this._media_element=v,this._on_unbuffered_seek=w,this.e={onMediaSeeking:this._onMediaSeeking.bind(this)};var R=_.a.chrome&&(_.a.version.major<50||_.a.version.major===50&&_.a.version.build<2661);this._always_seek_keyframe=!!(R||_.a.msedge||_.a.msie),this._always_seek_keyframe&&(this._config.accurateSeek=!1),this._media_element.addEventListener("seeking",this.e.onMediaSeeking)}return M.prototype.destroy=function(){this._idr_sample_list.clear(),this._idr_sample_list=null,this._media_element.removeEventListener("seeking",this.e.onMediaSeeking),this._media_element=null,this._on_unbuffered_seek=null},M.prototype.seek=function(A){var v=this._isPositionBuffered(A),w=!1;if(A<1&&this._media_element.buffered.length>0){var R=this._media_element.buffered.start(0);(R<1&&A<R||_.a.safari)&&(w=!0,A=_.a.safari?.1:R)}if(w)this.directSeek(A);else if(v)if(this._always_seek_keyframe){var C=this._getNearestKeyframe(Math.floor(1e3*A));C!=null&&(A=C.dts/1e3),this.directSeek(A)}else this.directSeek(A);else this._idr_sample_list.clear(),this._on_unbuffered_seek(Math.floor(1e3*A)),this._config.accurateSeek&&this.directSeek(A)},M.prototype.directSeek=function(A){this._request_set_current_time=!0,this._media_element.currentTime=A},M.prototype.appendSyncPoints=function(A){this._idr_sample_list.appendArray(A)},M.prototype._onMediaSeeking=function(A){if(this._request_set_current_time)this._request_set_current_time=!1;else{var v=this._media_element.currentTime,w=this._media_element.buffered;if(v<1&&w.length>0){var R=w.start(0);if(R<1&&v<R||_.a.safari){var C=_.a.safari?.1:R;return void this.directSeek(C)}}if(this._isPositionBuffered(v)){if(this._always_seek_keyframe){var O=this._getNearestKeyframe(Math.floor(1e3*v));O!=null&&(v=O.dts/1e3,this.directSeek(v))}}else this._seek_request_record_clocktime=M._getClockTime(),window.setTimeout(this._pollAndApplyUnbufferedSeek.bind(this),50)}},M.prototype._pollAndApplyUnbufferedSeek=function(){if(this._seek_request_record_clocktime!=null)if(this._seek_request_record_clocktime<=M._getClockTime()-100){var A=this._media_element.currentTime;this._seek_request_record_clocktime=null,this._isPositionBuffered(A)||(this._idr_sample_list.clear(),this._on_unbuffered_seek(Math.floor(1e3*A)),this._config.accurateSeek&&this.directSeek(A))}else window.setTimeout(this._pollAndApplyUnbufferedSeek.bind(this),50)},M.prototype._isPositionBuffered=function(A){for(var v=this._media_element.buffered,w=0;w<v.length;w++){var R=v.start(w),C=v.end(w);if(A>=R&&A<C)return!0}return!1},M.prototype._getNearestKeyframe=function(A){return this._idr_sample_list.getLastSyncPointBeforeDts(A)},M._getClockTime=function(){return self.performance&&self.performance.now?self.performance.now():Date.now()},M}(),x=function(){function M(A,v,w,R){this.TAG="LoadingController",this._config=null,this._media_element=null,this._on_pause_transmuxer=null,this._on_resume_transmuxer=null,this._paused=!1,this.e=null,this._config=A,this._media_element=v,this._on_pause_transmuxer=w,this._on_resume_transmuxer=R,this.e={onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this)}}return M.prototype.destroy=function(){this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this.e=null,this._media_element=null,this._config=null,this._on_pause_transmuxer=null,this._on_resume_transmuxer=null},M.prototype.notifyBufferedPositionChanged=function(A){!this._config.isLive&&this._config.lazyLoad&&(A==null?this._suspendTransmuxerIfNeeded():this._suspendTransmuxerIfBufferedPositionExceeded(A))},M.prototype._onMediaTimeUpdate=function(A){this._paused&&this._resumeTransmuxerIfNeeded()},M.prototype._suspendTransmuxerIfNeeded=function(){for(var A=this._media_element.buffered,v=this._media_element.currentTime,w=0,R=0;R<A.length;R++){var C=A.start(R),O=A.end(R);if(C<=v&&v<O){w=O;break}}w>0&&this._suspendTransmuxerIfBufferedPositionExceeded(w)},M.prototype._suspendTransmuxerIfBufferedPositionExceeded=function(A){A>=this._media_element.currentTime+this._config.lazyLoadMaxDuration&&!this._paused&&(o.a.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this.suspendTransmuxer(),this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate))},M.prototype.suspendTransmuxer=function(){this._paused=!0,this._on_pause_transmuxer()},M.prototype._resumeTransmuxerIfNeeded=function(){for(var A=this._media_element.buffered,v=this._media_element.currentTime,w=this._config.lazyLoadRecoverDuration,R=!1,C=0;C<A.length;C++){var O=A.start(C),G=A.end(C);if(v>=O&&v<G){v>=G-w&&(R=!0);break}}R&&(o.a.v(this.TAG,"Continue loading from paused position"),this.resumeTransmuxer(),this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate))},M.prototype.resumeTransmuxer=function(){this._paused=!1,this._on_resume_transmuxer()},M}(),L=function(){function M(A,v){this.TAG="StartupStallJumper",this._media_element=null,this._on_direct_seek=null,this._canplay_received=!1,this.e=null,this._media_element=A,this._on_direct_seek=v,this.e={onMediaCanPlay:this._onMediaCanPlay.bind(this),onMediaStalled:this._onMediaStalled.bind(this),onMediaProgress:this._onMediaProgress.bind(this)},this._media_element.addEventListener("canplay",this.e.onMediaCanPlay),this._media_element.addEventListener("stalled",this.e.onMediaStalled),this._media_element.addEventListener("progress",this.e.onMediaProgress)}return M.prototype.destroy=function(){this._media_element.removeEventListener("canplay",this.e.onMediaCanPlay),this._media_element.removeEventListener("stalled",this.e.onMediaStalled),this._media_element.removeEventListener("progress",this.e.onMediaProgress),this._media_element=null,this._on_direct_seek=null},M.prototype._onMediaCanPlay=function(A){this._canplay_received=!0,this._media_element.removeEventListener("canplay",this.e.onMediaCanPlay)},M.prototype._onMediaStalled=function(A){this._detectAndFixStuckPlayback(!0)},M.prototype._onMediaProgress=function(A){this._detectAndFixStuckPlayback()},M.prototype._detectAndFixStuckPlayback=function(A){var v=this._media_element,w=v.buffered;A||!this._canplay_received||v.readyState<2?w.length>0&&v.currentTime<w.start(0)&&(o.a.w(this.TAG,"Playback seems stuck at ".concat(v.currentTime,", seek to ").concat(w.start(0))),this._on_direct_seek(w.start(0)),this._media_element.removeEventListener("progress",this.e.onMediaProgress)):this._media_element.removeEventListener("progress",this.e.onMediaProgress)},M}(),N=function(){function M(A,v,w){this._config=null,this._media_element=null,this._on_direct_seek=null,this._config=A,this._media_element=v,this._on_direct_seek=w}return M.prototype.destroy=function(){this._on_direct_seek=null,this._media_element=null,this._config=null},M.prototype.notifyBufferedRangeUpdate=function(){this._chaseLiveLatency()},M.prototype._chaseLiveLatency=function(){var A=this._media_element.buffered,v=this._media_element.currentTime,w=this._media_element.paused;if(this._config.isLive&&this._config.liveBufferLatencyChasing&&A.length!=0&&(this._config.liveBufferLatencyChasingOnPaused||!w)){var R=A.end(A.length-1);if(R>this._config.liveBufferLatencyMaxLatency&&R-v>this._config.liveBufferLatencyMaxLatency){var C=R-this._config.liveBufferLatencyMinRemain;this._on_direct_seek(C)}}},M}(),P=function(){function M(A,v){this.TAG="LiveLatencySynchronizer",this._config=null,this._media_element=null,this.e=null,this._config=A,this._media_element=v,this.e={onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this)},this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate)}return M.prototype.destroy=function(){this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element=null,this._config=null},M.prototype._onMediaTimeUpdate=function(A){if(this._config.isLive&&this._config.liveSync){var v=this._getCurrentLatency();if(v>this._config.liveSyncMaxLatency){var w=Math.min(2,Math.max(1,this._config.liveSyncPlaybackRate));this._media_element.playbackRate!==w&&(o.a.v(this.TAG,"playbackRate ".concat(this._media_element.playbackRate," => ").concat(w)),this._media_element.playbackRate=w)}else v>this._config.liveSyncTargetLatency||(this._config.liveSyncMinLatency!=null&&v<this._config.liveSyncMinLatency?(w=Math.min(1,Math.max(.5,this._config.liveSyncMinPlaybackRate)),this._media_element.playbackRate!==w&&(o.a.v(this.TAG,"playbackRate ".concat(this._media_element.playbackRate," => ").concat(w)),this._media_element.playbackRate=w)):this._media_element.playbackRate!==1&&this._media_element.playbackRate!==0&&(o.a.v(this.TAG,"playbackRate ".concat(this._media_element.playbackRate," => 1")),this._media_element.playbackRate=1))}},M.prototype._getCurrentLatency=function(){if(!this._media_element)return 0;var A=this._media_element.buffered,v=this._media_element.currentTime;return A.length==0?0:A.end(A.length-1)-v},M}(),T=function(){function M(A,v){this.TAG="PlayerEngineDedicatedThread",this._emitter=new c,this._media_element=null,this._worker_destroying=!1,this._seeking_handler=null,this._loading_controller=null,this._startup_stall_jumper=null,this._live_latency_chaser=null,this._live_latency_synchronizer=null,this._pending_seek_time=null,this._media_info=null,this._statistics_info=null,this.e=null,this._prev_ready_state=0,this._media_data_source=A,this._config=u(),typeof v=="object"&&Object.assign(this._config,v),A.isLive===!0&&(this._config.isLive=!0),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this),onMediaLoadedMetadata:this._onMediaLoadedMetadata.bind(this),onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this),onMediaReadyStateChanged:this._onMediaReadyStateChange.bind(this)},f.a.registerListener(this.e.onLoggingConfigChanged),this._worker=h(29,{all:!0}),this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",media_data_source:this._media_data_source,config:this._config}),this._worker.postMessage({cmd:"logging_config",logging_config:f.a.getConfig()})}return M.isSupported=function(){return!!self.Worker&&(!(!self.MediaSource||!("canConstructInDedicatedWorker"in self.MediaSource)||self.MediaSource.canConstructInDedicatedWorker!==!0)||!(!self.ManagedMediaSource||!("canConstructInDedicatedWorker"in self.ManagedMediaSource)||self.ManagedMediaSource.canConstructInDedicatedWorker!==!0))},M.prototype.destroy=function(){this._emitter.emit(m.a.DESTROYING),this.unload(),this.detachMediaElement(),this._worker_destroying=!0,this._worker.postMessage({cmd:"destroy"}),f.a.removeListener(this.e.onLoggingConfigChanged),this.e=null,this._media_data_source=null,this._emitter.removeAllListeners(),this._emitter=null},M.prototype.on=function(A,v){var w=this;this._emitter.addListener(A,v),A===m.a.MEDIA_INFO&&this._media_info?Promise.resolve().then(function(){return w._emitter.emit(m.a.MEDIA_INFO,w.mediaInfo)}):A==m.a.STATISTICS_INFO&&this._statistics_info&&Promise.resolve().then(function(){return w._emitter.emit(m.a.STATISTICS_INFO,w.statisticsInfo)})},M.prototype.off=function(A,v){this._emitter.removeListener(A,v)},M.prototype.attachMediaElement=function(A){this._media_element=A,this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element.addEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element.addEventListener("emptied",this.e.onMediaReadyStateChanged),this._media_element.addEventListener("ended",this.e.onMediaReadyStateChanged),this._media_element.addEventListener("waiting",this.e.onMediaReadyStateChanged),this._media_element.addEventListener("canplay",this.e.onMediaReadyStateChanged),this._media_element.addEventListener("canplaythrough",this.e.onMediaReadyStateChanged),this._media_element.addEventListener("loadstart",this.e.onMediaReadyStateChanged),this._media_element.addEventListener("loadeddata",this.e.onMediaReadyStateChanged),this._media_element.addEventListener("loadedmetadata",this.e.onMediaReadyStateChanged),this._media_element.addEventListener("progress",this.e.onMediaReadyStateChanged),this._media_element.addEventListener("stalled",this.e.onMediaReadyStateChanged),this._worker.postMessage({cmd:"initialize_mse"})},M.prototype.detachMediaElement=function(){this._worker.postMessage({cmd:"shutdown_mse"}),this._media_element&&(this._media_element.removeEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element.removeEventListener("emptied",this.e.onMediaReadyStateChanged),this._media_element.removeEventListener("ended",this.e.onMediaReadyStateChanged),this._media_element.removeEventListener("waiting",this.e.onMediaReadyStateChanged),this._media_element.removeEventListener("canplay",this.e.onMediaReadyStateChanged),this._media_element.removeEventListener("canplaythrough",this.e.onMediaReadyStateChanged),this._media_element.removeEventListener("loadstart",this.e.onMediaReadyStateChanged),this._media_element.removeEventListener("loadeddata",this.e.onMediaReadyStateChanged),this._media_element.removeEventListener("loadedmetadata",this.e.onMediaReadyStateChanged),this._media_element.removeEventListener("progress",this.e.onMediaReadyStateChanged),this._media_element.removeEventListener("stalled",this.e.onMediaReadyStateChanged),this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element=null)},M.prototype.load=function(){this._worker.postMessage({cmd:"load"}),this._seeking_handler=new b(this._config,this._media_element,this._onRequiredUnbufferedSeek.bind(this)),this._loading_controller=new x(this._config,this._media_element,this._onRequestPauseTransmuxer.bind(this),this._onRequestResumeTransmuxer.bind(this)),this._startup_stall_jumper=new L(this._media_element,this._onRequestDirectSeek.bind(this)),this._config.isLive&&this._config.liveBufferLatencyChasing&&(this._live_latency_chaser=new N(this._config,this._media_element,this._onRequestDirectSeek.bind(this))),this._config.isLive&&this._config.liveSync&&(this._live_latency_synchronizer=new P(this._config,this._media_element)),this._media_element.readyState>0&&this._seeking_handler.directSeek(0)},M.prototype.unload=function(){var A,v,w,R,C,O;(A=this._media_element)===null||A===void 0||A.pause(),this._worker.postMessage({cmd:"unload"}),(v=this._live_latency_synchronizer)===null||v===void 0||v.destroy(),this._live_latency_synchronizer=null,(w=this._live_latency_chaser)===null||w===void 0||w.destroy(),this._live_latency_chaser=null,(R=this._startup_stall_jumper)===null||R===void 0||R.destroy(),this._startup_stall_jumper=null,(C=this._loading_controller)===null||C===void 0||C.destroy(),this._loading_controller=null,(O=this._seeking_handler)===null||O===void 0||O.destroy(),this._seeking_handler=null},M.prototype.play=function(){return this._media_element.play()},M.prototype.pause=function(){this._media_element.pause()},M.prototype.seek=function(A){this._media_element&&this._seeking_handler?this._seeking_handler.seek(A):this._pending_seek_time=A},M.prototype.switchPrimaryAudio=function(){this._worker.postMessage({cmd:"switch_audio",audio_track:"primary"})},M.prototype.switchSecondaryAudio=function(){this._worker.postMessage({cmd:"switch_audio",audio_track:"secondary"})},Object.defineProperty(M.prototype,"mediaInfo",{get:function(){return Object.assign({},this._media_info)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"statisticsInfo",{get:function(){return Object.assign({},this._statistics_info)},enumerable:!1,configurable:!0}),M.prototype._onLoggingConfigChanged=function(A){var v;(v=this._worker)===null||v===void 0||v.postMessage({cmd:"logging_config",logging_config:A})},M.prototype._onMSEUpdateEnd=function(){this._config.isLive&&this._config.liveBufferLatencyChasing&&this._live_latency_chaser&&this._live_latency_chaser.notifyBufferedRangeUpdate(),this._loading_controller.notifyBufferedPositionChanged()},M.prototype._onMSEBufferFull=function(){o.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._loading_controller.suspendTransmuxer()},M.prototype._onMediaLoadedMetadata=function(A){this._pending_seek_time!=null&&(this._seeking_handler.seek(this._pending_seek_time),this._pending_seek_time=null)},M.prototype._onRequestDirectSeek=function(A){this._seeking_handler.directSeek(A)},M.prototype._onRequiredUnbufferedSeek=function(A){this._worker.postMessage({cmd:"unbuffered_seek",milliseconds:A})},M.prototype._onRequestPauseTransmuxer=function(){this._worker.postMessage({cmd:"pause_transmuxer"})},M.prototype._onRequestResumeTransmuxer=function(){this._worker.postMessage({cmd:"resume_transmuxer"})},M.prototype._onMediaTimeUpdate=function(A){this._worker.postMessage({cmd:"timeupdate",current_time:A.target.currentTime})},M.prototype._onMediaReadyStateChange=function(){var A;this._media_element!=null&&this._prev_ready_state!==((A=this._media_element)===null||A===void 0?void 0:A.readyState)&&(this._prev_ready_state=this._media_element.readyState,this._worker.postMessage({cmd:"readystatechange",ready_state:this._media_element.readyState}))},M.prototype._onWorkerMessage=function(A){var v,w=A.data,R=w.msg;if(R=="destroyed"||this._worker_destroying)return this._worker_destroying=!1,(v=this._worker)===null||v===void 0||v.terminate(),void(this._worker=null);switch(R){case"mse_init":var C=w;"ManagedMediaSource"in self&&!("MediaSource"in self)&&(this._media_element.disableRemotePlayback=!0),this._media_element.srcObject=C.handle;break;case"mse_event":(C=w).event==p.a.UPDATE_END?this._onMSEUpdateEnd():C.event==p.a.BUFFER_FULL&&this._onMSEBufferFull();break;case"transmuxing_event":if((C=w).event==y.a.MEDIA_INFO){var O=w;this._media_info=O.info,this._emitter.emit(m.a.MEDIA_INFO,Object.assign({},O.info))}else if(C.event==y.a.STATISTICS_INFO){var G=w;this._statistics_info=this._fillStatisticsInfo(G.info),this._emitter.emit(m.a.STATISTICS_INFO,Object.assign({},G.info))}else if(C.event==y.a.RECOMMEND_SEEKPOINT){var z=w;this._media_element&&!this._config.accurateSeek&&this._seeking_handler.directSeek(z.milliseconds/1e3)}break;case"player_event":if((C=w).event==m.a.ERROR){var Y=w;this._emitter.emit(m.a.ERROR,Y.error_type,Y.error_detail,Y.info)}else if("extraData"in C){var ie=w;this._emitter.emit(ie.event,ie.extraData)}break;case"logcat_callback":C=w,o.a.emitter.emit("log",C.type,C.logcat);break;case"buffered_position_changed":C=w,this._loading_controller.notifyBufferedPositionChanged(C.buffered_position_milliseconds/1e3)}},M.prototype._fillStatisticsInfo=function(A){if(A.playerType="MSEPlayer",!(this._media_element instanceof HTMLVideoElement))return A;var v=!0,w=0,R=0;if(this._media_element.getVideoPlaybackQuality){var C=this._media_element.getVideoPlaybackQuality();w=C.totalVideoFrames,R=C.droppedVideoFrames}else this._media_element.webkitDecodedFrameCount!=null?(w=this._media_element.webkitDecodedFrameCount,R=this._media_element.webkitDroppedFrameCount):v=!1;return v&&(A.decodedFrames=w,A.droppedFrames=R),A},M}(),k=function(){function M(){}return M.supportMSEH264Playback=function(){var A=self.MediaSource&&self.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),v=self.ManagedMediaSource&&self.ManagedMediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');return A===!0||v===!0},M.supportMSEH265Playback=function(){var A=self.MediaSource&&self.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"'),v=self.ManagedMediaSource&&self.ManagedMediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"');return A===!0||v===!0},M.supportWorkerForMSEH265Playback=function(){return new Promise(function(A){if(T.isSupported()){var v=URL.createObjectURL(new Blob([`
                const hevc_mime_type = 'video/mp4; codecs="hvc1.1.6.L93.B0"';
                const support_w3c_mse = self.MediaSource && self.MediaSource.isTypeSupported(hevc_mime_type);
                const support_apple_mme = self.ManagedMediaSource && self.ManagedMediaSource.isTypeSupported(hevc_mime_type);
                self.postMessage(support_w3c_mse === true || support_apple_mme === true);
            `],{type:"application/javascript"}));new Worker(v).addEventListener("message",function(w){return A(w.data)}),URL.revokeObjectURL(v)}else A(!1)})},M.supportNetworkStreamIO=function(){var A=new r.a({},u()),v=A.loaderType;return A.destroy(),v=="fetch-stream-loader"||v=="xhr-moz-chunked-loader"},M.getNetworkLoaderTypeName=function(){var A=new r.a({},u()),v=A.loaderType;return A.destroy(),v},M.supportNativeMediaPlayback=function(A){M.videoElement==null&&(M.videoElement=window.document.createElement("video"));var v=M.videoElement.canPlayType(A);return v==="probably"||v=="maybe"},M.getFeatureList=function(){var A={msePlayback:!1,mseLivePlayback:!1,mseH265Playback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeMP4H265Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return A.msePlayback=M.supportMSEH264Playback(),A.networkStreamIO=M.supportNetworkStreamIO(),A.networkLoaderName=M.getNetworkLoaderTypeName(),A.mseLivePlayback=A.msePlayback&&A.networkStreamIO,A.mseH265Playback=M.supportMSEH265Playback(),A.nativeMP4H264Playback=M.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),A.nativeMP4H265Playback=M.supportNativeMediaPlayback('video/mp4; codecs="hvc1.1.6.L93.B0"'),A.nativeWebmVP8Playback=M.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),A.nativeWebmVP9Playback=M.supportNativeMediaPlayback('video/webm; codecs="vp9"'),A},M}(),I=i(2),F=i(21),V=i(22),ne=i(11),te=i(3),Z=function(){function M(A,v){this.TAG="PlayerEngineMainThread",this._emitter=new c,this._media_element=null,this._mse_controller=null,this._transmuxer=null,this._pending_seek_time=null,this._seeking_handler=null,this._loading_controller=null,this._startup_stall_jumper=null,this._live_latency_chaser=null,this._live_latency_synchronizer=null,this._mse_source_opened=!1,this._has_pending_load=!1,this._loaded_metadata_received=!1,this._media_info=null,this._statistics_info=null,this.e=null,this._media_data_source=A,this._config=u(),typeof v=="object"&&Object.assign(this._config,v),A.isLive===!0&&(this._config.isLive=!0),this.e={onMediaLoadedMetadata:this._onMediaLoadedMetadata.bind(this)}}return M.prototype.destroy=function(){this._emitter.emit(m.a.DESTROYING),this._transmuxer&&this.unload(),this._media_element&&this.detachMediaElement(),this.e=null,this._media_data_source=null,this._emitter.removeAllListeners(),this._emitter=null},M.prototype.on=function(A,v){var w=this;this._emitter.addListener(A,v),A===m.a.MEDIA_INFO&&this._media_info?Promise.resolve().then(function(){return w._emitter.emit(m.a.MEDIA_INFO,w.mediaInfo)}):A==m.a.STATISTICS_INFO&&this._statistics_info&&Promise.resolve().then(function(){return w._emitter.emit(m.a.STATISTICS_INFO,w.statisticsInfo)})},M.prototype.off=function(A,v){this._emitter.removeListener(A,v)},M.prototype.attachMediaElement=function(A){var v=this;this._media_element=A,A.src="",A.removeAttribute("src"),A.srcObject=null,A.load(),A.addEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._mse_controller=new F.a(this._config),this._mse_controller.on(p.a.UPDATE_END,this._onMSEUpdateEnd.bind(this)),this._mse_controller.on(p.a.BUFFER_FULL,this._onMSEBufferFull.bind(this)),this._mse_controller.on(p.a.SOURCE_OPEN,this._onMSESourceOpen.bind(this)),this._mse_controller.on(p.a.ERROR,this._onMSEError.bind(this)),this._mse_controller.on(p.a.START_STREAMING,this._onMSEStartStreaming.bind(this)),this._mse_controller.on(p.a.END_STREAMING,this._onMSEEndStreaming.bind(this)),this._mse_controller.initialize({getCurrentTime:function(){return v._media_element.currentTime},getReadyState:function(){return v._media_element.readyState}}),this._mse_controller.isManagedMediaSource()?(A.disableRemotePlayback=!0,A.srcObject=this._mse_controller.getObject()):A.src=this._mse_controller.getObjectURL()},M.prototype.detachMediaElement=function(){this._media_element&&(this._mse_controller.shutdown(),this._media_element.removeEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element=null,this._mse_controller.revokeObjectURL()),this._mse_controller&&(this._mse_controller.destroy(),this._mse_controller=null)},M.prototype.load=function(){var A=this;if(!this._media_element)throw new te.a("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new te.a("load() has been called, please call unload() first!");this._has_pending_load||(!this._config.deferLoadAfterSourceOpen||this._mse_source_opened?(this._transmuxer=new V.a(this._media_data_source,this._config),this._transmuxer.on(y.a.INIT_SEGMENT,function(v,w){A._mse_controller.appendInitSegment(w)}),this._transmuxer.on(y.a.MEDIA_SEGMENT,function(v,w){A._mse_controller.appendMediaSegment(w),!A._config.isLive&&v==="video"&&w.data&&w.data.byteLength>0&&"info"in w&&A._seeking_handler.appendSyncPoints(w.info.syncPoints),A._loading_controller.notifyBufferedPositionChanged(w.info.endDts/1e3)}),this._transmuxer.on(y.a.LOADING_COMPLETE,function(){A._mse_controller.endOfStream(),A._emitter.emit(m.a.LOADING_COMPLETE)}),this._transmuxer.on(y.a.RECOVERED_EARLY_EOF,function(){A._emitter.emit(m.a.RECOVERED_EARLY_EOF)}),this._transmuxer.on(y.a.IO_ERROR,function(v,w){A._emitter.emit(m.a.ERROR,ne.b.NETWORK_ERROR,v,w)}),this._transmuxer.on(y.a.DEMUX_ERROR,function(v,w){A._emitter.emit(m.a.ERROR,ne.b.MEDIA_ERROR,v,w)}),this._transmuxer.on(y.a.MEDIA_INFO,function(v){A._media_info=v,A._emitter.emit(m.a.MEDIA_INFO,Object.assign({},v))}),this._transmuxer.on(y.a.STATISTICS_INFO,function(v){A._statistics_info=A._fillStatisticsInfo(v),A._emitter.emit(m.a.STATISTICS_INFO,Object.assign({},v))}),this._transmuxer.on(y.a.RECOMMEND_SEEKPOINT,function(v){A._media_element&&!A._config.accurateSeek&&A._seeking_handler.directSeek(v/1e3)}),this._transmuxer.on(y.a.METADATA_ARRIVED,function(v){A._emitter.emit(m.a.METADATA_ARRIVED,v)}),this._transmuxer.on(y.a.SCRIPTDATA_ARRIVED,function(v){A._emitter.emit(m.a.SCRIPTDATA_ARRIVED,v)}),this._transmuxer.on(y.a.TIMED_ID3_METADATA_ARRIVED,function(v){A._emitter.emit(m.a.TIMED_ID3_METADATA_ARRIVED,v)}),this._transmuxer.on(y.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,function(v){A._emitter.emit(m.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,v)}),this._transmuxer.on(y.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,function(v){A._emitter.emit(m.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,v)}),this._transmuxer.on(y.a.SMPTE2038_METADATA_ARRIVED,function(v){A._emitter.emit(m.a.SMPTE2038_METADATA_ARRIVED,v)}),this._transmuxer.on(y.a.SCTE35_METADATA_ARRIVED,function(v){A._emitter.emit(m.a.SCTE35_METADATA_ARRIVED,v)}),this._transmuxer.on(y.a.PES_PRIVATE_DATA_DESCRIPTOR,function(v){A._emitter.emit(m.a.PES_PRIVATE_DATA_DESCRIPTOR,v)}),this._transmuxer.on(y.a.PES_PRIVATE_DATA_ARRIVED,function(v){A._emitter.emit(m.a.PES_PRIVATE_DATA_ARRIVED,v)}),this._seeking_handler=new b(this._config,this._media_element,this._onRequiredUnbufferedSeek.bind(this)),this._loading_controller=new x(this._config,this._media_element,this._onRequestPauseTransmuxer.bind(this),this._onRequestResumeTransmuxer.bind(this)),this._startup_stall_jumper=new L(this._media_element,this._onRequestDirectSeek.bind(this)),this._config.isLive&&this._config.liveBufferLatencyChasing&&(this._live_latency_chaser=new N(this._config,this._media_element,this._onRequestDirectSeek.bind(this))),this._config.isLive&&this._config.liveSync&&(this._live_latency_synchronizer=new P(this._config,this._media_element)),this._media_element.readyState>0&&this._seeking_handler.directSeek(0),this._transmuxer.open()):this._has_pending_load=!0)},M.prototype.unload=function(){var A,v,w,R,C,O,G,z,Y;(A=this._media_element)===null||A===void 0||A.pause(),(v=this._live_latency_synchronizer)===null||v===void 0||v.destroy(),this._live_latency_synchronizer=null,(w=this._live_latency_chaser)===null||w===void 0||w.destroy(),this._live_latency_chaser=null,(R=this._startup_stall_jumper)===null||R===void 0||R.destroy(),this._startup_stall_jumper=null,(C=this._loading_controller)===null||C===void 0||C.destroy(),this._loading_controller=null,(O=this._seeking_handler)===null||O===void 0||O.destroy(),this._seeking_handler=null,(G=this._mse_controller)===null||G===void 0||G.flush(),(z=this._transmuxer)===null||z===void 0||z.close(),(Y=this._transmuxer)===null||Y===void 0||Y.destroy(),this._transmuxer=null},M.prototype.play=function(){return this._media_element.play()},M.prototype.pause=function(){this._media_element.pause()},M.prototype.seek=function(A){this._media_element&&this._seeking_handler?this._seeking_handler.seek(A):this._pending_seek_time=A},M.prototype.switchPrimaryAudio=function(){this._transmuxer.switchPrimaryAudio()},M.prototype.switchSecondaryAudio=function(){this._transmuxer.switchSecondaryAudio()},Object.defineProperty(M.prototype,"mediaInfo",{get:function(){return Object.assign({},this._media_info)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"statisticsInfo",{get:function(){return Object.assign({},this._statistics_info)},enumerable:!1,configurable:!0}),M.prototype._onMSESourceOpen=function(){this._mse_source_opened=!0,this._has_pending_load&&(this._has_pending_load=!1,this.load())},M.prototype._onMSEUpdateEnd=function(){this._config.isLive&&this._config.liveBufferLatencyChasing&&this._live_latency_chaser&&this._live_latency_chaser.notifyBufferedRangeUpdate(),this._loading_controller.notifyBufferedPositionChanged()},M.prototype._onMSEBufferFull=function(){o.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._loading_controller.suspendTransmuxer()},M.prototype._onMSEError=function(A){this._emitter.emit(m.a.ERROR,ne.b.MEDIA_ERROR,ne.a.MEDIA_MSE_ERROR,A)},M.prototype._onMSEStartStreaming=function(){this._loaded_metadata_received&&(this._config.isLive||(o.a.v(this.TAG,"Resume transmuxing task due to ManagedMediaSource onStartStreaming"),this._loading_controller.resumeTransmuxer()))},M.prototype._onMSEEndStreaming=function(){this._config.isLive||(o.a.v(this.TAG,"Suspend transmuxing task due to ManagedMediaSource onEndStreaming"),this._loading_controller.suspendTransmuxer())},M.prototype._onMediaLoadedMetadata=function(A){this._loaded_metadata_received=!0,this._pending_seek_time!=null&&(this._seeking_handler.seek(this._pending_seek_time),this._pending_seek_time=null)},M.prototype._onRequestDirectSeek=function(A){this._seeking_handler.directSeek(A)},M.prototype._onRequiredUnbufferedSeek=function(A){this._mse_controller.flush(),this._transmuxer.seek(A)},M.prototype._onRequestPauseTransmuxer=function(){this._transmuxer.pause()},M.prototype._onRequestResumeTransmuxer=function(){this._transmuxer.resume()},M.prototype._fillStatisticsInfo=function(A){if(A.playerType="MSEPlayer",!(this._media_element instanceof HTMLVideoElement))return A;var v=!0,w=0,R=0;if(this._media_element.getVideoPlaybackQuality){var C=this._media_element.getVideoPlaybackQuality();w=C.totalVideoFrames,R=C.droppedVideoFrames}else this._media_element.webkitDecodedFrameCount!=null?(w=this._media_element.webkitDecodedFrameCount,R=this._media_element.webkitDroppedFrameCount):v=!1;return v&&(A.decodedFrames=w,A.droppedFrames=R),A},M}(),Q=function(){function M(A,v){this.TAG="MSEPlayer",this._type="MSEPlayer",this._media_element=null,this._player_engine=null;var w=A.type.toLowerCase();if(w!=="mse"&&w!=="mpegts"&&w!=="m2ts"&&w!=="flv")throw new te.b("MSEPlayer requires an mpegts/m2ts/flv MediaDataSource input!");if(v&&v.enableWorkerForMSE&&T.isSupported())try{this._player_engine=new T(A,v)}catch{o.a.e(this.TAG,"Error while initializing PlayerEngineDedicatedThread, fallback to PlayerEngineMainThread"),this._player_engine=new Z(A,v)}else this._player_engine=new Z(A,v)}return M.prototype.destroy=function(){this._player_engine.destroy(),this._player_engine=null,this._media_element=null},M.prototype.on=function(A,v){this._player_engine.on(A,v)},M.prototype.off=function(A,v){this._player_engine.off(A,v)},M.prototype.attachMediaElement=function(A){this._media_element=A,this._player_engine.attachMediaElement(A)},M.prototype.detachMediaElement=function(){this._media_element=null,this._player_engine.detachMediaElement()},M.prototype.load=function(){this._player_engine.load()},M.prototype.unload=function(){this._player_engine.unload()},M.prototype.play=function(){return this._player_engine.play()},M.prototype.pause=function(){this._player_engine.pause()},M.prototype.switchPrimaryAudio=function(){this._player_engine.switchPrimaryAudio()},M.prototype.switchSecondaryAudio=function(){this._player_engine.switchSecondaryAudio()},Object.defineProperty(M.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"buffered",{get:function(){return this._media_element.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"duration",{get:function(){return this._media_element.duration},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"volume",{get:function(){return this._media_element.volume},set:function(A){this._media_element.volume=A},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"muted",{get:function(){return this._media_element.muted},set:function(A){this._media_element.muted=A},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"currentTime",{get:function(){return this._media_element?this._media_element.currentTime:0},set:function(A){this._player_engine.seek(A)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"mediaInfo",{get:function(){return this._player_engine.mediaInfo},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"statisticsInfo",{get:function(){return this._player_engine.statisticsInfo},enumerable:!1,configurable:!0}),M}(),he=function(){function M(A,v){this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new l.a,this._config=u(),typeof v=="object"&&Object.assign(this._config,v);var w=A.type.toLowerCase();if(w==="mse"||w==="mpegts"||w==="m2ts"||w==="flv")throw new te.b("NativePlayer does't support mse/mpegts/m2ts/flv MediaDataSource input!");if(A.hasOwnProperty("segments"))throw new te.b("NativePlayer(".concat(A.type,") doesn't support multipart playback!"));this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=A,this._mediaElement=null}return M.prototype.destroy=function(){this._emitter.emit(m.a.DESTROYING),this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},M.prototype.on=function(A,v){var w=this;A===m.a.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){w._emitter.emit(m.a.MEDIA_INFO,w.mediaInfo)}):A===m.a.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){w._emitter.emit(m.a.STATISTICS_INFO,w.statisticsInfo)}),this._emitter.addListener(A,v)},M.prototype.off=function(A,v){this._emitter.removeListener(A,v)},M.prototype.attachMediaElement=function(A){if(this._mediaElement=A,A.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{A.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},M.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},M.prototype.load=function(){if(!this._mediaElement)throw new te.a("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},M.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},M.prototype.play=function(){return this._mediaElement.play()},M.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(M.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(A){this._mediaElement.volume=A},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(A){this._mediaElement.muted=A},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(A){this._mediaElement?this._mediaElement.currentTime=A:this._pendingSeekTime=A},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"mediaInfo",{get:function(){var A={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(A.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(A.width=this._mediaElement.videoWidth,A.height=this._mediaElement.videoHeight)),A},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"statisticsInfo",{get:function(){var A={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return A;var v=!0,w=0,R=0;if(this._mediaElement.getVideoPlaybackQuality){var C=this._mediaElement.getVideoPlaybackQuality();w=C.totalVideoFrames,R=C.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(w=this._mediaElement.webkitDecodedFrameCount,R=this._mediaElement.webkitDroppedFrameCount):v=!1;return v&&(A.decodedFrames=w,A.droppedFrames=R),A},enumerable:!1,configurable:!0}),M.prototype._onvLoadedMetadata=function(A){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(m.a.MEDIA_INFO,this.mediaInfo)},M.prototype._reportStatisticsInfo=function(){this._emitter.emit(m.a.STATISTICS_INFO,this.statisticsInfo)},M}();s.a.install();var de={createPlayer:function(M,A){var v=M;if(v==null||typeof v!="object")throw new te.b("MediaDataSource must be an javascript object!");if(!v.hasOwnProperty("type"))throw new te.b("MediaDataSource must has type field to indicate video file type!");switch(v.type){case"mse":case"mpegts":case"m2ts":case"flv":return new Q(v,A);default:return new he(v,A)}},isSupported:function(){return k.supportMSEH264Playback()},getFeatureList:function(){return k.getFeatureList()},supportWorkerForMSEH265Playback:function(){return k.supportWorkerForMSEH265Playback()}};de.BaseLoader=I.a,de.LoaderStatus=I.c,de.LoaderErrors=I.b,de.Events=m.a,de.ErrorTypes=ne.b,de.ErrorDetails=ne.a,de.MSEPlayer=Q,de.NativePlayer=he,de.LoggingControl=f.a,Object.defineProperty(de,"version",{enumerable:!0,get:function(){return"1.7.3"}}),n.default=de}])})})(Uh);var US=Uh.exports;const $S=Eo(US);class hc{constructor(e,t){ve(this,"restart_required_when_quality_switched",!1);ve(this,"player");ve(this,"playback_mode");ve(this,"watch_content_element");ve(this,"watch_header_element");ve(this,"watch_player_element");ve(this,"request_picture_in_picture",null);this.player=e,this.playback_mode=t,this.watch_content_element=document.querySelector(".watch-content"),this.watch_header_element=document.querySelector(".watch-header"),this.watch_player_element=document.querySelector(".watch-player")}async init(){const e=_n();if(!("documentPictureInPicture"in window)){this.player.template.pipButton.style.display="none",console.log("[DocumentPiPManager] Initialized. (Document Picture-in-Picture API is not supported.)");return}this.request_picture_in_picture=this.player.video.requestPictureInPicture,this.player.video.requestPictureInPicture=async()=>{if(documentPictureInPicture.window)return documentPictureInPicture.window.close(),{};documentPictureInPicture.onenter=c=>{console.log("[DocumentPiPManager] Picture-in-Picture window entered."),e.is_document_pip=!0,e.event_emitter.emit("SetControlDisplayTimer",{is_player_region_event:!0,timeout_seconds:0})};const t=await documentPictureInPicture.requestWindow({width:540,height:304}),n=t.document.createElement("meta");n.name="darkreader-lock",t.document.head.appendChild(n),[...document.styleSheets].forEach(c=>{try{const l=[...c.cssRules].map(o=>o.cssText).join(""),h=document.createElement("style");h.textContent=l,t.document.head.appendChild(h)}catch{const h=document.createElement("link");h.rel="stylesheet",h.type=c.type,h.media=c.media.mediaText,h.href=c.href,t.document.head.appendChild(h)}}),t.document.body.classList.add("watch-container"),t.document.body.classList.add("watch-container--fullscreen"),Mi(()=>e.is_control_display,c=>{c?t.document.body.classList.add("watch-container--control-display"):t.document.body.classList.remove("watch-container--control-display")});const i=t.document.createElement("div");i.classList.add("watch-content"),i.append(this.watch_header_element),i.append(this.watch_player_element),t.document.body.append(i);const s=document.createElement("div");s.classList.add("playing-in-pip");const r=document.createElement("span");r.classList.add("playing-in-pip__text"),r.textContent="Picture-in-Picture を再生しています",s.append(r);const d=document.createElement("button");d.classList.add("playing-in-pip__close-button"),d.textContent="Picture-in-Picture を終了",d.onclick=()=>t.close(),s.append(d),this.watch_content_element.append(s);const u=c=>{e.event_emitter.emit("SetControlDisplayTimer",{event:c,is_player_region_event:!0,timeout_seconds:1.25})};return i.addEventListener("mousemove",u),i.addEventListener("touchmove",u),i.addEventListener("click",u),t.addEventListener("pagehide",()=>{e.is_document_pip=!1,s.remove(),this.watch_content_element.append(this.watch_header_element),this.watch_content_element.append(this.watch_player_element),console.log("[DocumentPiPManager] Picture-in-Picture window exited.")}),{}},console.log("[DocumentPiPManager] Initialized.")}async destroy(){if(!("documentPictureInPicture"in window)){console.log("[DocumentPiPManager] Destroyed. (Document Picture-in-Picture API is not supported.)");return}documentPictureInPicture.window!==null&&documentPictureInPicture.window.close(),documentPictureInPicture.onenter=null,this.request_picture_in_picture!==null&&(this.player.video.requestPictureInPicture=this.request_picture_in_picture),console.log("[DocumentPiPManager] Destroyed.")}}class fc{constructor(e,t,n=window.document){ve(this,"restart_required_when_quality_switched",!1);ve(this,"player");ve(this,"playback_mode");ve(this,"document");ve(this,"abort_controller",null);this.player=e,this.playback_mode=t,this.document=n}async init(){const e=ci(),t=_n(),n=Mn();this.abort_controller=new AbortController,document.querySelector(".route-container"),this.player.container.querySelector(".dplayer-capture-icon"),this.player.container.querySelector(".dplayer-comment-capture-icon"),document.querySelector(".tweet-form__textarea"),document.querySelector(".tweet-button"),document.querySelector(".remote-control-button-data"),document.querySelector(".remote-control-button-back"),document.querySelector(".remote-control-button-select"),document.querySelector(".remote-control-button-up"),document.querySelector(".remote-control-button-left"),document.querySelector(".remote-control-button-right"),document.querySelector(".remote-control-button-down"),document.querySelector(".remote-control-button-blue"),document.querySelector(".remote-control-button-red"),document.querySelector(".remote-control-button-green"),document.querySelector(".remote-control-button-yellow");const i=[{mode:"Live",key:"ArrowUp",repeat:!1,ctrl:!1,shift:!1,alt:!1,handler:()=>{t.is_zapping=!0,Gs.push({path:`/watch/${e.channel.previous.display_channel_id}`})}},{mode:"Live",key:"ArrowDown",repeat:!1,ctrl:!1,shift:!1,alt:!1,handler:()=>{t.is_zapping=!0,Gs.push({path:`/watch/${e.channel.next.display_channel_id}`})}},{mode:"Both",key:"Slash",repeat:!1,ctrl:!1,shift:!1,alt:!1,handler:()=>{t.shortcut_key_modal=!t.shortcut_key_modal}},{mode:"Both",key:"Space",repeat:!1,ctrl:!1,shift:!1,alt:!1,handler:()=>{this.player.toggle()}},{mode:"Video",key:"ArrowLeft",repeat:!0,ctrl:!1,shift:!1,alt:!1,handler:()=>{this.player.seek(this.player.video.currentTime-5)}},{mode:"Video",key:"ArrowRight",repeat:!0,ctrl:!1,shift:!1,alt:!1,handler:()=>{this.player.seek(this.player.video.currentTime+5)}},{mode:"Video",key:"ArrowLeft",repeat:!0,ctrl:!0,shift:!1,alt:!1,handler:()=>{this.player.seek(this.player.video.currentTime-15)}},{mode:"Video",key:"ArrowRight",repeat:!0,ctrl:!0,shift:!1,alt:!1,handler:()=>{this.player.seek(this.player.video.currentTime+15)}},{mode:"Video",key:"ArrowLeft",repeat:!0,ctrl:!1,shift:!0,alt:!1,handler:()=>{this.player.seek(this.player.video.currentTime-30)}},{mode:"Video",key:"ArrowRight",repeat:!0,ctrl:!1,shift:!0,alt:!1,handler:()=>{this.player.seek(this.player.video.currentTime+30)}},{mode:"Video",key:"ArrowLeft",repeat:!0,ctrl:!1,shift:!1,alt:!0,handler:()=>{this.player.seek(this.player.video.currentTime-60)}},{mode:"Video",key:"ArrowRight",repeat:!0,ctrl:!1,shift:!1,alt:!0,handler:()=>{this.player.seek(this.player.video.currentTime+60)}},{mode:"Both",key:"KeyF",repeat:!1,ctrl:!1,shift:!1,alt:!1,handler:()=>{this.player.fullScreen.toggle()}},{mode:"Both",key:"KeyE",repeat:!1,ctrl:!1,shift:!1,alt:!1,handler:()=>{document.pictureInPictureEnabled&&this.player.template.pipButton.click()}},{mode:"Both",key:"KeyD",repeat:!1,ctrl:!1,shift:!1,alt:!1,handler:()=>{this.player.template.showDanmaku.click(),this.player.template.showDanmakuToggle.checked?this.player.notice(`${this.player.tran("Show comment")}`):this.player.notice(`${this.player.tran("Hide comment")}`)}},{mode:"Live",key:"KeyM",repeat:!1,ctrl:!1,shift:!1,alt:!1,handler:()=>{this.player.controller.show(),this.player.comment.show(),t.event_emitter.emit("SetControlDisplayTimer",{}),window.setTimeout(()=>this.player.template.commentInput.focus(),100)}},{mode:"Both",key:"KeyP",repeat:!1,ctrl:!1,shift:!1,alt:!1,handler:()=>{t.is_panel_display=!t.is_panel_display}},{mode:"Live",key:"KeyK",repeat:!1,ctrl:!1,shift:!1,alt:!1,handler:()=>{t.tv_panel_active_tab="Program"}},{mode:"Video",key:"KeyK",repeat:!1,ctrl:!1,shift:!1,alt:!1,handler:()=>{t.video_panel_active_tab="RecordedProgram"}},{mode:"Live",key:"KeyL",repeat:!1,ctrl:!1,shift:!1,alt:!1,handler:()=>{t.tv_panel_active_tab="Channel"}},{mode:"Both",key:"Semicolon",repeat:!1,ctrl:!1,shift:!1,alt:!1,handler:()=>{this.playback_mode==="Live"?t.tv_panel_active_tab="Comment":t.video_panel_active_tab="Comment"}}];let s=0;this.document.addEventListener("keydown",r=>{if(r.isComposing===!0||r.keyCode===229)return;let d=!1;r.repeat&&(d=!0);const u=Dt.time();u-s<.05&&(d=!0),s=u;const c=Dt.isMacOS()===!0?r.metaKey:r.ctrlKey,l=r.shiftKey,h=r.altKey;this.playback_mode==="Live"?t.tv_panel_active_tab:t.video_panel_active_tab;const o=document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement;if(this.playback_mode==="Live"&&d===!1&&c===!1&&h===(n.settings.tv_channel_selection_requires_alt_key===!0)&&o===!1){const f=l?"BS":"GR";let p=null;if(["Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9"].includes(r.code)&&(p=Number(r.code.replace("Digit",""))),r.code==="Digit0"&&(p=10),r.code==="Minus"&&(p=11),r.code==="Equal"&&(p=12),["Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9"].includes(r.code)&&(p=Number(r.code.replace("Numpad",""))),r.code==="Numpad0"&&(p=10),p!==null){const m=e.getChannelByRemoconID(f,p);if(m!==null&&m.display_channel_id!==e.display_channel_id){Gs.push({path:`/watch/${m.display_channel_id}`}),r.preventDefault(),r.stopPropagation();return}}}if(this.playback_mode==="Live"&&r.code==="KeyM"&&d===!1&&c===!0&&l===!1&&h===!1&&this.player.template.controller.classList.contains("dplayer-controller-comment")&&(o===!1||document.activeElement===this.player.template.commentInput)){this.player.comment.hide(),r.preventDefault(),r.stopPropagation();return}if(o!==!0){for(const f of i)if(!(f.mode!=="Both"&&f.mode!==this.playback_mode)&&f.key===r.code&&!(f.repeat===!1&&d===!0)&&f.ctrl===c&&f.shift===l&&f.alt===h){f.handler(),r.preventDefault(),r.stopPropagation();return}}},{signal:this.abort_controller.signal}),console.log("[KeyboardShortcutManager] Initialized.")}async destroy(){const e=_n();if(this.playback_mode==="Live"&&e.is_zapping===!0){const t=Mi(()=>e.is_player_initialized,(i,s)=>{s===!1&&i===!0&&(t(),n(),this.abort_controller!==null&&(this.abort_controller.abort(),this.abort_controller=null),console.log("[KeyboardShortcutManager] Destroyed. (Zapping finished)"))}),n=Mi(()=>e.is_watching,(i,s)=>{s===!0&&i===!1&&(t(),n(),this.abort_controller!==null&&(this.abort_controller.abort(),this.abort_controller=null),console.log("[KeyboardShortcutManager] Destroyed. (Zapping canceled)"))})}else this.abort_controller!==null&&(this.abort_controller.abort(),this.abort_controller=null),console.log("[KeyboardShortcutManager] Destroyed.")}}function GS(a,e=0,{start:t=!0,middle:n=!0,once:i=!1}={}){let s=t,r=0,d,u=!1;function c(...l){if(u)return;const h=Date.now()-r;r=Date.now(),t&&n&&h>=e&&(s=!0),s?(s=!1,a.apply(this,l),i&&c.cancel()):(n&&h<e||!n)&&(clearTimeout(d),d=setTimeout(()=>{r=Date.now(),a.apply(this,l),i&&c.cancel()},n?e-h:e))}return c.cancel=()=>{clearTimeout(d),u=!0},c}class pc{constructor(e){ve(this,"restart_required_when_quality_switched",!1);ve(this,"player");ve(this,"watch_session",null);ve(this,"comment_session",null);ve(this,"vpos_base_timestamp",0);ve(this,"keep_seat_interval_id",null);ve(this,"abort_controller",new AbortController);ve(this,"reconnecting",!1);ve(this,"destroyed",!1);this.player=e}get watch_session_type(){var e;return((e=this.watch_session)==null?void 0:e.url.includes("nicovideo.jp"))===!0?"ニコニコ実況":"NX-Jikkyo "}async init(){const e=_n(),t=Ir();this.destroyed=!1,await t.fetchUser();const n=await this.initWatchSession();if(n.is_success===!1){e.live_comment_init_failed_message=n.detail,console.error(`[LiveCommentManager][WatchSession] Error: ${n.detail}`),n.detail!=="このチャンネルはニコニコ実況に対応していません。"&&this.player.template.notice.textContent.includes("再起動しています…")===!1&&this.player.notice(n.detail,void 0,void 0,"#FF6F6A");return}this.initCommentSession(n),console.log("[LiveCommentManager] Initialized.")}async initWatchSession(){var u;const e=ci(),t=Mn(),n=Ir();let i=!1;const s=await gp.fetchWebSocketInfo(e.channel.current.id);if(s===null)return{is_success:!1,detail:"コメント受信用 WebSocket API の情報を取得できませんでした。"};if(s.watch_session_url===null)return{is_success:!1,detail:"このチャンネルはニコニコ実況に対応していません。"};let r=s.watch_session_url;t.settings.prefer_posting_to_nicolive===!0&&(s.nicolive_watch_session_url!==null?(console.log("[LiveCommentManager][WatchSession] Post comments to Nicolive."),r=s.nicolive_watch_session_url):s.is_nxjikkyo_exclusive===!0?console.warn("[LiveCommentManager][WatchSession] Failed to get Nicolive watch session URL. (This channel is exclusive to NX-Jikkyo.)"):n.user===null?console.warn("[LiveCommentManager][WatchSession] Failed to get Nicolive watch session URL. (Not logged in to KonomiTV)"):((u=n.user)==null?void 0:u.niconico_user_id)===null?console.warn("[LiveCommentManager][WatchSession] Failed to get Nicolive watch session URL. (Not linked with Niconico account)"):s.nicolive_watch_session_error!==null&&(console.warn(`[LiveCommentManager][WatchSession] Failed to get Nicolive watch session URL. (${s.nicolive_watch_session_error})`),this.player.notice(`${s.nicolive_watch_session_error}代わりに NX-Jikkyo にコメントします。`,void 0,void 0,"#FFA86A"))),console.log(`[LiveCommentManager][WatchSession] Connected to ${r}`),this.watch_session=new WebSocket(r),this.watch_session.addEventListener("open",()=>{var c;(c=this.watch_session)==null||c.send(JSON.stringify({type:"startWatching",data:{reconnect:!1}}))},{signal:this.abort_controller.signal});const d=async c=>{if(i===!0)return;const l=c instanceof CloseEvent?c.code:"Error";this.player.template.notice.textContent.includes("再起動しています…")===!1&&this.player.notice(`${this.watch_session_type}との接続が切断されました。(Code: ${l})`,void 0,void 0,"#FF6F6A"),console.error(`[LiveCommentManager][WatchSession] Connection closed. (Code: ${l})`),await Dt.sleep(3),await this.reconnect()};return this.watch_session.addEventListener("close",d,{signal:this.abort_controller.signal}),this.watch_session.addEventListener("error",d,{signal:this.abort_controller.signal}),this.watch_session.addEventListener("message",async c=>{if(this.watch_session===null)return;const l=JSON.parse(c.data);switch(l.type){case"seat":{if(this.keep_seat_interval_id!==null)break;this.keep_seat_interval_id=window.setInterval(()=>{this.watch_session&&this.watch_session.readyState===WebSocket.OPEN?this.watch_session.send(JSON.stringify({type:"keepSeat"})):window.clearInterval(this.keep_seat_interval_id??0)},l.data.keepIntervalSec*1e3);break}case"ping":{this.watch_session.send(JSON.stringify({type:"pong"}));break}case"error":{if(l.data.code==="COMMENT_POST_NOT_ALLOWED"||l.data.code==="INVALID_MESSAGE")break;let h=`${this.watch_session_type}でエラーが発生しています。(Code: ${l.data.code})`;switch(l.data.code){case"CONNECT_ERROR":h=`${this.watch_session_type}のコメントサーバーに接続できません。`;break;case"CONTENT_NOT_READY":h=`${this.watch_session_type}が配信できない状態です。`;break;case"NO_THREAD_AVAILABLE":h=`${this.watch_session_type}のコメントスレッドを取得できません。`;break;case"NO_ROOM_AVAILABLE":h=`${this.watch_session_type}のコメント部屋を取得できません。`;break;case"NO_PERMISSION":h=`${this.watch_session_type}の API にアクセスする権限がありません。`;break;case"NOT_ON_AIR":h=`${this.watch_session_type}が放送中ではありません。`;break;case"BROADCAST_NOT_FOUND":h=`${this.watch_session_type}の配信情報を取得できません。`;break;case"INTERNAL_SERVERERROR":h=`${this.watch_session_type}でサーバーエラーが発生しています。`;break}this.player.template.notice.textContent.includes("再起動しています…")===!1&&this.player.notice(h,void 0,void 0,"#FF6F6A"),console.error(`[LiveCommentManager][WatchSession] Error occurred. (Code: ${l.data.code})`),await Dt.sleep(3),await this.reconnect();break}case"reconnect":{await this.reconnect();break}case"disconnect":{i=!0;let h=`${this.watch_session_type}との接続が切断されました。(${l.data.reason})`;switch(l.data.reason){case"TAKEOVER":h=`${this.watch_session_type}の番組から追い出されました。`;break;case"NO_PERMISSION":h=`${this.watch_session_type}の番組の座席を取得できませんでした。`;break;case"END_PROGRAM":h=`${this.watch_session_type}がリセットされたか、コミュニティの番組が終了しました。`;break;case"PING_TIMEOUT":h="コメントサーバーとの接続生存確認に失敗しました。";break;case"TOO_MANY_CONNECTIONS":h=`${this.watch_session_type}の同一ユーザからの接続数上限を越えています。`;break;case"TOO_MANY_WATCHINGS":h=`${this.watch_session_type}の同一ユーザからの視聴番組数上限を越えています。`;break;case"CROWDED":h=`${this.watch_session_type}の番組が満席です。`;break;case"MAINTENANCE_IN":h=`${this.watch_session_type}はメンテナンス中です。`;break;case"SERVICE_TEMPORARILY_UNAVAILABLE":h=`${this.watch_session_type}で一時的にサーバーエラーが発生しています。`;break}this.player.template.notice.textContent.includes("再起動しています…")===!1&&this.player.notice(h,void 0,void 0,"#FF6F6A"),console.error(`[LiveCommentManager][WatchSession] Disconnected. (Reason: ${l.data.reason})`),await Dt.sleep(3),await this.reconnect();break}}},{signal:this.abort_controller.signal}),new Promise(c=>{this.watch_session.addEventListener("message",async l=>{const h=JSON.parse(l.data);if(h.type==="room")return this.vpos_base_timestamp=jn(h.data.vposBaseTime).valueOf(),console.log(`[LiveCommentManager][WatchSession] Connected.
Thread ID: ${h.data.threadId}`),c({is_success:!0,detail:"視聴セッションを取得しました。",message_server_url:h.data.messageServer.uri,thread_id:h.data.threadId,your_post_key:h.data.yourPostKey?h.data.yourPostKey:null});if(h.type==="messageServer"){this.vpos_base_timestamp=jn(h.data.vposBaseTime).valueOf();const o=h.data.hashedUserId;return console.log("[LiveCommentManager][WatchSession] Connected."),c({is_success:!0,detail:"視聴セッションを取得しました。",message_server_url:s.comment_session_url,thread_id:"",your_post_key:`nicolive:${o}`})}},{signal:this.abort_controller.signal})})}initCommentSession(e){const t=_n(),n=Ir(),i=[];let s=!1;const r=[];this.comment_session=new WebSocket(e.message_server_url),this.comment_session.addEventListener("open",()=>{this.comment_session!==null&&this.comment_session.send(JSON.stringify([{ping:{content:"rs:0"}},{ping:{content:"ps:0"}},{thread:{version:"20061206",thread:e.thread_id,threadkey:e.your_post_key,user_id:"",res_from:-100}},{ping:{content:"pf:0"}},{ping:{content:"rf:0"}}]))},{signal:this.abort_controller.signal});const d=async c=>{const l=c instanceof CloseEvent?c.code:"Error";this.player.template.notice.textContent.includes("再起動しています…")===!1&&this.player.notice(`NX-Jikkyo との接続が切断されました。(Code: ${l})`,void 0,void 0,"#FF6F6A"),console.error(`[LiveCommentManager][CommentSession] Connection closed. (Code: ${l})`),await Dt.sleep(3),await this.reconnect()};this.comment_session.addEventListener("close",d,{signal:this.abort_controller.signal}),this.comment_session.addEventListener("error",d,{signal:this.abort_controller.signal});const u=GS(()=>{Dt.isSafari()===!1&&console.debug("[LiveCommentManager][CommentSession] Comments buffer length:",r.length),this.destroyed===!1&&t.event_emitter.emit("CommentReceived",{is_initial_comments:!1,comments:r}),r.length=0},333);this.comment_session.addEventListener("message",async c=>{var L,N;const l=JSON.parse(c.data);if(l.thread!==void 0&&l.thread.resultcode!==0){console.error(`[LiveCommentManager][CommentSession] Connection failed. (Code: ${l.thread.resultcode})`);return}if(l.ping!==void 0&&l.ping.content==="rf:0"){s=!0,this.destroyed===!1&&t.event_emitter.emit("CommentReceived",{is_initial_comments:!0,comments:i});return}const h=l.chat;if(h===void 0||h.content===void 0||h.content===""||h.yourpost&&h.yourpost===1&&s===!0||((N=(L=n.user)==null?void 0:L.niconico_user_id)==null?void 0:N.toString())===h.user_id.replace("nicolive:",""))return;const{color:o,position:f,size:p}=Oi.parseCommentCommand(h.mail);if(Oi.isMutedComment(h.content,h.user_id,o,f,p))return;const m={id:h.no,text:h.content,time:jn(h.date*1e3).format("HH:mm:ss"),playback_position:this.player.video.currentTime,user_id:h.user_id,my_post:!1,comment_source:h.user_id.startsWith("nicolive:")||h.user_id.startsWith("rekari:")?"ニコ実":"NX"};if(s===!1){i.push(m);return}let y=0;this.player.video.buffered.length>=1&&(y=this.player.video.buffered.end(0));const _=Math.max(y-this.player.video.currentTime,0),b=Mn().settings.comment_delay_seconds,x=_+b;Dt.isSafari()===!1&&console.debug(`[LiveCommentManager][CommentSession] Auto delay: ${_} sec, User delay: ${b} sec, Total delay: ${x} sec.`),await Dt.sleep(x),r.push(m),u(),this.player.video.paused===!1&&this.player.danmaku.draw({text:h.content,color:o,type:f,size:p})},{signal:this.abort_controller.signal})}sendComment(e){var c,l;const t=_n(),n=Mn(),i=Ir();if(t.live_comment_init_failed_message!==null){e.error(t.live_comment_init_failed_message);return}if(n.settings.prefer_posting_to_nicolive===!0&&(i.user===null?this.player.notice("ニコニコ実況にコメントするには、KonomiTV アカウントにログインしてください。代わりに NX-Jikkyo にコメントします。",void 0,void 0,"#FFA86A"):i.user.niconico_user_id===null&&this.player.notice("ニコニコ実況にコメントするには、ニコニコアカウントと連携してください。代わりに NX-Jikkyo にコメントします。",void 0,void 0,"#FFA86A")),this.watch_session_type==="ニコニコ実況"){if(((c=i.user)==null?void 0:c.niconico_user_premium)===!1&&(e.data.type==="top"||e.data.type==="bottom")){e.error("ニコニコ実況でコメントを上下に固定するには、ニコニコアカウントのプレミアム会員登録が必要です。");return}if(((l=i.user)==null?void 0:l.niconico_user_premium)===!1&&e.data.size==="big"){e.error("ニコニコ実況でコメントサイズを大きめに設定するには、ニコニコアカウントのプレミアム会員登録が必要です。");return}}if(this.watch_session===null||this.watch_session.readyState!==WebSocket.OPEN){console.error("[LiveCommentManager][WatchSession] Comment sending failed. (Connection is not established.)"),e.error("コメントの送信に失敗しました。WebSocket 接続が確立されていません。");return}const s={"#FFEAEA":"white","#F02840":"red","#FD7E80":"pink","#FDA708":"orange","#FFE133":"yellow","#64DD17":"green","#00D4F5":"cyan","#4763FF":"blue"},r={top:"ue",right:"naka",bottom:"shita"},d=Math.round((jn().valueOf()-this.vpos_base_timestamp)/10);this.watch_session.send(JSON.stringify({type:"postComment",data:{text:e.data.text,color:s[e.data.color.toUpperCase()],position:r[e.data.type],size:e.data.size,vpos:d,isAnonymous:!0}}));const u=new AbortController;this.watch_session.addEventListener("message",h=>{var f;const o=JSON.parse(h.data);switch(o.type){case"postCommentResult":{e.success(),t.event_emitter.emit("CommentSendCompleted",{comment:{id:Dt.time(),text:e.data.text,time:jn().format("HH:mm:ss"),playback_position:this.player.video.currentTime,user_id:`${((f=i.user)==null?void 0:f.niconico_user_id)??"Unknown"}`,my_post:!0,comment_source:this.watch_session_type==="ニコニコ実況"?"ニコ実":"NX"}}),u.abort();break}case"error":{let p=`コメントの送信に失敗しました。(${o.data.code})`;switch(o.data.code){case"COMMENT_POST_NOT_ALLOWED":p="コメントが許可されていません。";break;case"INVALID_MESSAGE":p="コメント内容が無効です。";break}console.error(`[LiveCommentManager][WatchSession] Comment sending failed. (Code: ${o.data.code})`),e.error(p),u.abort();break}}},{signal:u.signal})}async reconnect(){const e=_n(),t=this.watch_session!==null&&(this.watch_session.readyState===WebSocket.CLOSING||this.watch_session.readyState===WebSocket.CLOSED),n=this.comment_session!==null&&(this.comment_session.readyState===WebSocket.CLOSING||this.comment_session.readyState===WebSocket.CLOSED);if(this.reconnecting===!0&&t===!1&&n===!1)return;this.reconnecting=!0,console.warn("[LiveCommentManager] Reconnecting..."),this.player.template.notice.textContent.includes("再起動しています…")===!1&&this.player.notice(`${this.watch_session_type}に再接続しています…`),await this.destroy();const i=await this.initWatchSession();if(i.is_success===!1){e.live_comment_init_failed_message=i.detail,console.error("[LiveCommentManager] Reconnection failed."),this.player.template.notice.textContent.includes("再起動しています…")===!1&&this.player.notice(i.detail,void 0,void 0,"#FF6F6A"),this.reconnecting=!1;return}this.initCommentSession(i),this.destroyed=!1,this.reconnecting=!1,console.warn("[LiveCommentManager] Reconnected.")}async destroy(){const e=_n();this.abort_controller.abort(),this.abort_controller=new AbortController,this.watch_session!==null&&(this.watch_session.close(),this.watch_session=null),this.comment_session!==null&&(this.comment_session.close(),this.comment_session=null),this.keep_seat_interval_id!==null&&(window.clearInterval(this.keep_seat_interval_id),this.keep_seat_interval_id=null),this.vpos_base_timestamp=0,e.live_comment_init_failed_message=null,this.destroyed=!0,console.log("[LiveCommentManager] Destroyed.")}}const Ji=class Ji{constructor(e){ve(this,"player",null);ve(this,"player_managers",[]);ve(this,"playback_mode");ve(this,"tv_streaming_quality");ve(this,"tv_data_saver_mode");ve(this,"tv_low_latency_mode");ve(this,"video_streaming_quality");ve(this,"video_data_saver_mode");ve(this,"live_playback_buffer_seconds");ve(this,"live_force_seek_interval_timer_cancel",null);ve(this,"video_keep_alive_interval_timer_cancel",null);ve(this,"player_container_resize_observer",null);ve(this,"player_control_ui_hide_timer_id",0);ve(this,"screen_wake_lock",null);ve(this,"romsounds_context",new AudioContext);ve(this,"romsounds_buffers",[]);ve(this,"destroying",!1);ve(this,"destroyed",!1);this.playback_mode=e;const t=Mn(),n=Hs.getNetworkCircuitType();this.tv_streaming_quality=n==="Cellular"?t.settings.tv_streaming_quality_cellular:t.settings.tv_streaming_quality,this.tv_data_saver_mode=n==="Cellular"?t.settings.tv_data_saver_mode_cellular:t.settings.tv_data_saver_mode,this.tv_low_latency_mode=n==="Cellular"?t.settings.tv_low_latency_mode_cellular:t.settings.tv_low_latency_mode,this.video_streaming_quality=n==="Cellular"?t.settings.video_streaming_quality_cellular:t.settings.video_streaming_quality,this.video_data_saver_mode=n==="Cellular"?t.settings.video_data_saver_mode_cellular:t.settings.video_data_saver_mode,this.live_playback_buffer_seconds=this.tv_low_latency_mode?Ji.LIVE_PLAYBACK_BUFFER_SECONDS_LOW_LATENCY:Ji.LIVE_PLAYBACK_BUFFER_SECONDS,Dt.isSafari()===!0&&(this.live_playback_buffer_seconds+=.3)}async init(){const e=ci(),t=_n(),n=Mn();console.log("\x1B[31m[PlayerController] Initializing..."),this.destroyed=!1,t.is_player_initialized=!0,window.mpegts=$S,window.Hls=Ai;const i=this.playback_mode==="Live"?n.settings.tv_show_superimpose:n.settings.video_show_superimpose;localStorage.getItem("dplayer-danmaku-opacity")===null&&localStorage.setItem("dplayer-danmaku-opacity","1.0");let s="";if(t.recorded_program.id==-100&&(s=this.createSilentAudioBuffer(t.recorded_program.duration,3e3,1),console.log("\x1B[31m[PlayerController] audio_url:",s)),this.player=new X_({container:document.querySelector(".watch-player__dplayer"),theme:"#E64F97",lang:"ja-jp",live:this.playback_mode==="Live",liveSyncMinBufferSize:this.live_playback_buffer_seconds-.1,loop:(this.playback_mode==="Live",!1),autoplay:!0,airplay:!1,hotkey:!1,screenshot:!1,crossOrigin:"anonymous",volume:1,video:(()=>{const r=[];let d="";if(Hs.isHEVCVideoSupported()&&(this.playback_mode==="Live"&&this.tv_data_saver_mode===!0||this.playback_mode==="Video"&&this.video_data_saver_mode===!0)&&(d="-hevc"),this.playback_mode==="Live"){const u=`${Dt.api_base_url}/streams/live/${e.channel.current.display_channel_id}`;if(e.channel.current.is_radiochannel===!0)r.push({name:"48kHz/192kbps",type:"mpegts",url:`${u}/1080p/mpegts`});else for(const l of pp)r.push({name:l==="1080p-60fps"?"1080p (60fps)":l,type:"mpegts",url:`${u}/${l}${d}/mpegts`});let c=this.tv_streaming_quality;return e.channel.current.is_radiochannel&&(c="48kHz/192kbps"),{quality:r,defaultQuality:c}}else return{quality:[{name:"Silent",type:"normal",url:s}],defaultQuality:"Silent"}})(),danmaku:{user:"NX-Jikkyo",speedRate:n.settings.comment_speed_rate,fontSize:n.settings.comment_font_size,closeCommentFormAfterSend:n.settings.close_comment_form_after_sending},apiBackend:{read:async r=>{if(this.playback_mode==="Live")r.success([]);else{const d=await Np.fetchVideoJikkyoComments(t.recorded_program);if(d.is_success===!1)t.video_comment_init_failed_message=d.detail,d.detail!=="この録画番組の過去ログコメントは存在しないか、現在取得中です。"?r.error(d.detail):r.success([]);else{const u=t.recorded_program.recorded_video.recording_start_time;let c=0;t.event_emitter.emit("CommentReceived",{is_initial_comments:!0,comments:d.comments.map(l=>({id:c++,text:l.text,time:jn(u).add(l.time,"seconds").format("MM/DD HH:mm:ss"),playback_position:l.time,user_id:l.author,my_post:!1,comment_source:l.author.length>=35?"NX":"ニコ実"}))}),r.success(d.comments)}}},send:async r=>{if(this.playback_mode==="Live"){for(const d of this.player_managers)if(d instanceof pc){d.sendComment(r);return}}else r.error("録画番組にはコメントできません。")}},subtitle:{type:"aribb24"},pluginOptions:{mpegts:{config:{enableWorker:!0,enableWorkerForMSE:window.MediaSource&&window.MediaSource.canConstructInDedicatedWorker===!0,enableStashBuffer:!0,stashInitialSize:Math.floor(2048*1024),liveSync:this.tv_low_latency_mode,liveSyncMaxLatency:3,liveSyncTargetLatency:this.live_playback_buffer_seconds,liveSyncPlaybackRate:1.1}},hls:{...Ai.DefaultConfig,debug:!0,enableWorker:!0,preferManagedMediaSource:!1,manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e6,maxLoadTimeMs:1e6,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e6,maxLoadTimeMs:1e6,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e6,maxLoadTimeMs:1e6,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}}},aribb24:{disableSuperimposeRenderer:i===!1,normalFont:`"${n.settings.caption_font}", "Rounded M+ 1m for ARIB", sans-serif`,forceStrokeColor:n.settings.always_border_caption_text,forceBackgroundColor:(()=>{if(n.settings.specify_caption_opacity===!0)return`rgba(0, 0, 0, ${n.settings.caption_opacity})`})(),drcsReplacement:!0,enableRawCanvas:!0,useStroke:!0,usePUA:(()=>{const r=n.settings.caption_font,d=document.createElement("canvas").getContext("2d");return d.font='10px "Rounded M+ 1m for ARIB"',d.fillText("Test",0,0),d.font=`10px "${r}"`,d.fillText("Test",0,0),!!r.startsWith("Windows TV")})(),PRACallback:async r=>{if(i===!1)return;this.romsounds_context.state==="suspended"&&await this.romsounds_context.resume();const d=this.romsounds_context.createBufferSource();d.buffer=this.romsounds_buffers[r];const u=this.romsounds_context.createGain();d.connect(u),u.connect(this.romsounds_context.destination),u.gain.value=3,d.start(0)}}}}),this.playback_mode==="Video"){const r=localStorage.getItem("NX-Jikkyo-PlaybackRate");r!==null&&this.player.speed(parseFloat(r)),this.player.on("ratechange",()=>{var u;const d=(u=this.player)==null?void 0:u.video.playbackRate;d!==void 0&&localStorage.setItem("NX-Jikkyo-PlaybackRate",d.toString())})}this.player.video.muted=!0,window.player=this.player,this.player.container.classList.contains("dplayer-mobile")===!0&&this.player.volume(1,void 0,!0),this.player.controller.setAutoHide=r=>{},this.setupVideoPlaybackHandler(),this.setupFullscreenHandler(),this.setupSettingPanelHandler(),this.setupPlayerContainerResizeHandler(),this.setControlDisplayTimer(),t.event_emitter.off("SendNotification"),t.event_emitter.on("SendNotification",r=>{this.destroyed===!0||this.player===null||this.player.notice(r.message,r.duration,r.opacity,r.color)}),t.event_emitter.off("SetControlDisplayTimer"),t.event_emitter.on("SetControlDisplayTimer",r=>{this.setControlDisplayTimer(r.event,r.is_player_region_event,r.timeout_seconds)}),"wakeLock"in navigator&&navigator.wakeLock.request("screen").then(r=>{this.screen_wake_lock=r,console.log("\x1B[31m[PlayerController] Screen Wake Lock API: Screen Wake Lock acquired.")}),this.playback_mode==="Live"?this.player_managers=[new pc(this.player),new hc(this.player,this.playback_mode),new fc(this.player,this.playback_mode)]:this.player_managers=[new hc(this.player,this.playback_mode),new fc(this.player,this.playback_mode)],await Promise.all(this.player_managers.map(r=>r.init())),t.background_url=Hs.generatePlayerBackgroundURL(),t.is_background_display=!0,t.is_video_buffering=!1,console.log("\x1B[31m[PlayerController] Initialized.")}createSilentAudioBuffer(e,t,n){const s=[];for(let h=0;h<e;h+=3600){const o=Math.min(3600,e-h),f=Math.floor(o*t),p=new AudioBuffer({length:f,sampleRate:t,numberOfChannels:n});for(let m=0;m<n;m++){const y=p.getChannelData(m);for(let _=0;_<f;_++)y[_]=0}s.push(p)}const r=new Uint8Array(44),d=new DataView(r.buffer);d.setUint32(0,1380533830,!1),d.setUint32(4,36+e*t*n*2,!0),d.setUint32(8,1463899717,!1),d.setUint32(12,1718449184,!1),d.setUint32(16,16,!0),d.setUint16(20,1,!0),d.setUint16(22,n,!0),d.setUint32(24,t,!0),d.setUint32(28,t*n*2,!0),d.setUint16(32,n*2,!0),d.setUint16(34,16,!0),d.setUint32(36,1684108385,!1),d.setUint32(40,e*t*n*2,!0);const u=new ArrayBuffer(r.length+e*t*n*2),c=new DataView(u);c.setUint8(0,r[0]);for(let h=0;h<r.length;h++)c.setUint8(h,r[h]);let l=r.length;for(const h of s)for(let o=0;o<n;o++){const f=h.getChannelData(o);for(let p=0;p<h.length;p++)c.setInt16(l,f[p]*32767,!0),l+=2}return URL.createObjectURL(new Blob([u],{type:"audio/wav"}))}getPlaybackBufferSeconds(){if(this.player===null)return 0;if(this.playback_mode==="Live")try{const e=this.player.video.buffered.length,t=this.player.video.buffered.end(e-1)-this.player.video.currentTime;return Dt.mathFloor(t,3)}catch{return 0}else return 0}async recoverPlayback(){var t,n,i,s;pi(this.player!==null);const e=_n();if(await Dt.sleep(1),e.is_video_buffering===!0&&((n=(t=this.player)==null?void 0:t.video)==null?void 0:n.readyState)<3){console.warn("\x1B[31m[PlayerController] Video still buffering. (HTMLVideoElement.readyState < HAVE_FUTURE_DATA) trying to recover."),this.player.video.pause(),await Dt.sleep(.25);try{await this.player.video.play()}catch{pi(this.player!==null),console.warn("\x1B[31m[PlayerController] HTMLVideoElement.play() rejected. paused."),this.player.pause();return}if(await Dt.sleep(.5),e.is_video_buffering===!0&&((s=(i=this.player)==null?void 0:i.video)==null?void 0:s.readyState)<3){console.warn("\x1B[31m[PlayerController] Video still buffering. (HTMLVideoElement.readyState < HAVE_FUTURE_DATA) trying to recover."),this.player.video.pause(),await Dt.sleep(.25);try{await this.player.video.play()}catch{pi(this.player!==null),console.warn("\x1B[31m[PlayerController] (retry) HTMLVideoElement.play() rejected. paused."),this.player.pause()}}}}setupVideoPlaybackHandler(){pi(this.player!==null),ci();const e=_n(),t=()=>{this.player!==null&&(e.is_video_paused=this.player.video.paused,this.player.video.paused===!0&&e.is_loading===!1&&(e.is_video_buffering=!1),this.player.setting.hide(),this.setControlDisplayTimer())};this.player.on("play",t),this.player.on("pause",t),this.playback_mode==="Video"&&this.player.on("timeupdate",()=>{this.player!==null&&e.event_emitter.emit("PlaybackPositionChanged",{playback_position:this.player.video.currentTime})});let n=0,i=0;const s=document.querySelector(".program-info__next");s!==null&&(s.ontouchstart=()=>{if(this.player===null)return;const r=new Date().getTime(),d=r-i;d<500&&d>0&&(n++,n===3&&(this.player.infoPanel.toggle(),n=0)),i=r})}setupFullscreenHandler(){pi(this.player!==null);const e=_n(),t=document.body;this.player.fullScreen.isFullScreen=i=>!!(document.fullscreenElement||document.webkitFullscreenElement),this.player.fullScreen.request=i=>{if(pi(this.player!==null),this.player.fullScreen.isFullScreen()){this.player.fullScreen.cancel();return}if(t.requestFullscreen=t.requestFullscreen||t.webkitRequestFullscreen,t.requestFullscreen)t.requestFullscreen();else{this.player.notice("iPhone Safari は動画のフルスクリーン表示に対応していません。",void 0,void 0,"#FF6F6A");return}screen.orientation&&screen.orientation.lock("landscape").catch(()=>{})},this.player.fullScreen.cancel=i=>{document.exitFullscreen=document.exitFullscreen||document.webkitExitFullscreen,document.exitFullscreen&&document.exitFullscreen(),screen.orientation&&screen.orientation.unlock()};const n=()=>{pi(this.player!==null),e.is_fullscreen=this.player.fullScreen.isFullScreen()===!0};t.onfullscreenchange!==void 0?t.onfullscreenchange=n:t.onwebkitfullscreenchange!==void 0&&(t.onwebkitfullscreenchange=n)}setupSettingPanelHandler(){pi(this.player!==null);const e=_n();Dt.isTouchDevice()===!1&&(this.player.template.settingOriginPanel.insertAdjacentHTML("beforeend",`
            <div class="dplayer-setting-item dplayer-setting-keyboard-shortcut">
                <span class="dplayer-label">キーボードショートカット</span>
                <div class="dplayer-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32">
                        <path d="M22 16l-10.105-10.6-1.895 1.987 8.211 8.613-8.211 8.612 1.895 1.988 8.211-8.613z"></path>
                    </svg>
                </div>
            </div>`),this.player.template.settingOriginPanel.querySelector(".dplayer-setting-keyboard-shortcut").addEventListener("click",()=>{pi(this.player!==null),this.player.setting.hide(),e.shortcut_key_modal=!0}))}setupPlayerContainerResizeHandler(){const e=document.querySelector(".watch-player"),t=()=>{if(this.player===null)return;const n=this.player.danmaku.container,i=n.clientWidth,s=n.clientWidth*(9/16);if(e===null||e.clientHeight===null)return;const r=(e.clientHeight-s)/2,d=Dt.isSmartphoneVertical()?0:Dt.isSmartphoneHorizontal()?50:66;if(r<d){const u=(d-r)*2,c=i,l=s-u,h=(p,m)=>m===0?p:h(m,p%m),o=h(c,l),f=`${c/o} / ${l/o}`;n.style.transition="none",n.style.setProperty("--comment-area-aspect-ratio",f),n.style.setProperty("--comment-area-vertical-margin",`${u}px`),window.setTimeout(()=>n.style.transition="",.2*1e3)}else n.style.removeProperty("--comment-area-aspect-ratio"),n.style.removeProperty("--comment-area-vertical-margin")};t(),this.player_container_resize_observer=new ResizeObserver(t),this.player_container_resize_observer.observe(e)}setControlDisplayTimer(e=null,t=!1,n=3){const i=_n();if(Dt.isTouchDevice()===!0&&e!==null&&e.type==="mousemove"||Dt.isTouchDevice()===!1&&e!==null&&(e.type==="touchmove"||e.type==="click"))return;window.clearTimeout(this.player_control_ui_hide_timer_id);const s=()=>{if(this.player!==null){if(this.player.template.controller.classList.contains("dplayer-controller-comment")){this.player_control_ui_hide_timer_id=window.setTimeout(s,n*1e3);return}i.is_control_display=!1,this.player.controller.hide(),this.player.setting.hide()}};this.player!==null&&(Dt.isTouchDevice()===!0&&t===!0?this.player.controller.isShow()?(i.is_control_display=!0,this.player.controller.show(),this.player_control_ui_hide_timer_id=window.setTimeout(s,n*1e3)):(i.is_control_display=!1,this.player.controller.hide(),this.player.setting.hide()):(i.is_control_display=!0,this.player.controller.show(),this.player_control_ui_hide_timer_id=window.setTimeout(s,n*1e3)))}async destroy(){const e=_n();if(this.destroyed!==!0&&this.destroying!==!0){if(this.destroying=!0,console.log("\x1B[31m[PlayerController] Destroying..."),await Promise.all(this.player_managers.map(async t=>t.destroy())),this.player_managers=[],this.screen_wake_lock!==null&&(this.screen_wake_lock.release(),this.screen_wake_lock=null,console.log("\x1B[31m[PlayerController] Screen Wake Lock API: Screen Wake Lock released.")),e.is_background_display=!1,e.is_loading=!0,e.live_comment_init_failed_message=null,e.video_comment_init_failed_message=null,this.player!==null){const n=this.player.user.get("volume")/10;for(let i=0;i<10;i++)await Dt.sleep(.2/10),this.player&&this.player.video&&(this.player.video.volume=Math.max(Dt.mathFloor(this.player.video.volume-n,3),0));this.player.video.volume=0}if(this.live_force_seek_interval_timer_cancel!==null&&(this.live_force_seek_interval_timer_cancel(),this.live_force_seek_interval_timer_cancel=null),this.video_keep_alive_interval_timer_cancel!==null&&(this.video_keep_alive_interval_timer_cancel(),this.video_keep_alive_interval_timer_cancel=null),window.clearTimeout(this.player_control_ui_hide_timer_id),this.player_container_resize_observer!==null&&(this.player_container_resize_observer.disconnect(),this.player_container_resize_observer=null),this.player!==null){if(this.player.events.events.error&&(this.player.events.events.error=[]),this.player.plugins.mpegts)try{this.player.plugins.mpegts.unload(),this.player.plugins.mpegts.detachMediaElement(),this.player.plugins.mpegts.destroy()}catch{}this.player.danmaku.clear();try{this.player.destroy(!0)}catch{}this.player=null}this.destroying=!1,this.destroyed=!0,e.is_player_initialized=!1,console.log("\x1B[31m[PlayerController] Destroyed.")}}};ve(Ji,"LIVE_PLAYBACK_BUFFER_SECONDS_LOW_LATENCY",.8),ve(Ji,"LIVE_PLAYBACK_BUFFER_SECONDS",4);let mc=Ji;export{dl as I,mc as P,JS as W,_n as u};
